---
title: 'Turbopack'
description: 'Turbopackは、JavaScriptとTypeScript向けに最適化されたインクリメンタルバンドラーで、Rustで書かれ、Next.jsに組み込まれています。'
---

[Turbopack](https://turbo.build/pack)は、JavaScriptとTypeScript向けに最適化されたインクリメンタルバンドラーで、Rustで書かれ、Next.jsに組み込まれています。

## 使用法 {#usage}

Turbopackは、Next.jsにおいて`pages`ディレクトリと`app`ディレクトリの両方で使用可能で、ローカル開発を高速化します。Turbopackを有効にするには、Next.jsの開発サーバーを起動するときに`--turbopack`フラグを使用します。

```json title="package.json" highlight={3}
{
  "scripts": {
    "dev": "next dev --turbopack", // 開発サーバーをTurbopackモードで起動します
    "build": "next build", // ビルド処理を実行します
    "start": "next start", // ビルドされたアプリケーションを起動します
    "lint": "next lint" // コードのリンティングを実行します
  }
}
```

## サポートされている機能 {#supported-features}

Next.jsのTurbopackは、ほとんどのユーザーに対して設定不要で使用でき、より高度なユースケースに合わせて拡張可能です。現在サポートされているTurbopackの機能について詳しく知りたい場合は、[APIリファレンス](/docs/app/api-reference/next-config-js/turbo)を参照してください。

## サポートされていない機能 {#unsupported-features}

現在、Turbopackは`next dev`のみをサポートし、`next build`はサポートしていません。安定性の向上に向けてビルドサポートの作業を進めています。

現在サポートされていない機能は以下の通りです：

- Turbopackは、いくつかの使用率の低いCSS Modules機能をサポートしていない[Lightning CSS](https://lightningcss.dev/)を利用します
  - 独立した疑似クラスとしての`:local`および`:global`。関数形式のみがサポートされています（例：`:global(a)`）。
  - CSS変数によって置き換えられた@valueルール。
  - `:import`および`:export` ICSSルール。
- [無効なCSSコメント構文](https://stackoverflow.com/questions/51843506/are-double-slash-comments-valid-in-css)（例：`//`）
  - CSSコメントは、仕様に従い`/* comment */`として記述する必要があります。
  - Sassなどのプリプロセッサは、この代替構文をサポートしています。
- `next.config.js`内の[`webpack()`](/docs/app/api-reference/next-config-js/webpack)設定
  - TurbopackはWebpackの代わりに使用されるため、webpack設定はサポートされていません。
  - Turbopackを設定するには、[ドキュメント](/docs/app/api-reference/next-config-js/turbo)を参照してください。
  - Turbopackでは、[Webpackローダーのサブセット](/docs/app/api-reference/next-config-js/turbo#configuring-webpack-loaders)がサポートされています。
- Babel (`.babelrc`)
  - Turbopackは、すべてのトランスパイルと最適化に[SWC](/docs/architecture/nextjs-compiler#why-swc)コンパイラを利用します。これにより、Babelはデフォルトで含まれません。
  - `.babelrc`ファイルがある場合、Next.jsに含まれている共通のBabelプラグインがSWC変換として有効化できるので、もう不要かもしれません。この詳細は[コンパイラドキュメント](/docs/architecture/nextjs-compiler#supported-features)で確認できます。
  - 特定のユースケースで依然としてBabelを使用する必要がある場合、Turbopackの[カスタムwebpackローダーのサポート](/docs/app/api-reference/next-config-js/turbo#configuring-webpack-loaders)を利用して`babel-loader`を含めます。
- App Routerでのrootレイアウトの自動生成
  - この動作は、入力ファイルを変更するため現在サポートされていません。代わりに、エラーが表示され、手動でrootレイアウトを希望の場所に追加するよう指示されます。
- `@next/font`（レガシーフォントサポート）。
  - `@next/font`は`next/font`に替わって非推奨となりました。[`next/font`](/docs/app/building-your-application/optimizing/fonts)は、Turbopackで完全にサポートされています。
- [Relay変換](/docs/architecture/nextjs-compiler#relay)
  - 将来的にこれを実装する予定です。
- `pages/_document.tsx`での`.css`インポートのブロック
  - 現状では、webpackを使用したNext.jsでは`pages/_document.tsx`での`.css`ファイルのインポートをブロックしています
  - この警告を将来的に実装する予定です。
- [`experimental.typedRoutes`](https://nextjs.org/docs/app/api-reference/next-config-js/typedRoutes)
  - 将来的にこれを実装する予定です。
- `experimental.nextScriptWorkers`
  - 将来的にこれを実装する予定です。
- `experimental.sri.algorithm`
  - 将来的にこれを実装する予定です。
- `experimental.fallbackNodePolyfills`
  - 将来的にこれを実装する予定です。
- `experimental.esmExternals`
  - 現在、Turbopackを使用したNext.jsでのレガシーesmExternals設定をサポートする予定はありません。
- [AMP](https://nextjs.org/docs/canary/pages/building-your-application/configuring/amp)。
  - 現在、Turbopackを使用したNext.jsでのAMPサポートをする予定はありません。
- Yarn PnP
  - 現在、Turbopackを使用したNext.jsでのYarn PnPサポートをする予定はありません。
- [`experimental.urlImports`](/docs/app/api-reference/next-config-js/urlImports)
  - 現在、Turbopackを使用したNext.jsでの`experimental.urlImports`をサポートする予定はありません。
- [`:import`および`:export` ICSSルール](https://github.com/css-modules/icss)
  - `:import`および`:export` ICSSルールは、Turbopackが使用するCSSパーサーである[Lightning CSS](https://lightningcss.dev/css-modules.html)がこれらのルールをサポートしていないため、現状ではTurbopackを使用したNext.jsでのサポートを予定していません。
- edge runtimeにおける`unstable_allowDynamic`設定

## トレースファイルの生成 {#generating-trace-files}

トレースファイルは、Next.jsチームがパフォーマンス指標とメモリ使用量を調査および改善するのに役立ちます。トレースファイルを生成するには、`next dev --turbopack`コマンドの末尾に`NEXT_TURBOPACK_TRACING=1`を追加します。これにより、`.next/trace.log`ファイルが生成されます。

Turbopackのパフォーマンスとメモリ使用量に関連する問題を報告する際は、トレースファイルを[GitHub](https://github.com/vercel/next.js)のイシューに含めてください。
