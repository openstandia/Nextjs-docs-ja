---
title: 'Server Components'
description: 'React Server Componentsを使用してアプリケーションの一部をサーバーでレンダリングする方法を学びましょう。'
related:
  description: 'Next.js がデータと静的レンダリングの結果をどのようにキャッシュするかを学びましょう。'
  links:
    - app/building-your-application/caching
---

React Server Componentsを使用すると、UIをサーバーでレンダリングし、オプションでキャッシュすることができます。Next.jsでは、レンダリング作業がルートセグメントによってさらに分割され、ストリーミングと部分的なレンダリングを可能にします。サーバーレンダリングには3つの異なる戦略があります：

- [静的レンダリング](#static-rendering-default)
- [動的レンダリング](#dynamic-rendering)
- [ストリーミング](#streaming)

このページでは、Server Componentsがどのように機能するのか、どのように利用するのか、そして異なるサーバーレンダリングの戦略について説明します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことには、いくつかの利点があります：

- **データ取得**: Server Componentsを使用すると、データ取得をデータソースに近いサーバーに移動できます。これにより、レンダリングに必要なデータを取得する時間とクライアントが行う必要があるリクエストの数を減らし、パフォーマンスを向上させることができます。
- **セキュリティ**: Server Componentsにより、トークンやAPIキーなどの機密データやロジックをクライアントに公開するリスクを回避しながら、サーバーに保持することができます。
- **キャッシング**: サーバーでレンダリングすることで、結果をキャッシュし、後に続くリクエストや異なるユーザー間で再利用できます。これにより、各リクエストごとのレンダリングとデータ取得の量を減らし、パフォーマンスを向上させ、コストを削減します。
- **パフォーマンス**: Server Componentsは、パフォーマンスを基準から最適化するための追加ツールを提供します。たとえば、完全にClient Componentsで構成されたアプリから始め、非対話型のUI部分をServer Componentsに移動することで、必要なクライアントサイドのJavaScriptの量を減らすことができます。これにより、インターネットが遅いユーザーや、性能の低いデバイスを使用しているユーザーにとって、ダウンロード、解析、実行するクライアントサイドのJavaScriptが少なくなり、有益です。
- **初回ページロードと[最初のコンテンツフルペイント（FCP）](https://web.dev/fcp/)**: サーバーでは、ユーザーがページをすぐに表示できるようにHTMLを生成できます。これにより、クライアントがページをレンダリングするために必要なJavaScriptをダウンロード、解析、実行するのを待たずに済みます。
- **検索エンジン最適化とソーシャルネットワーク共有**: レンダリングされたHTMLは、検索エンジンのボットによってページをインデックスするため、また、ソーシャルネットワークのボットによってソーシャルカードのプレビューを生成するために使用されます。
- **ストリーミング**: Server Componentsにより、レンダリング作業をチャンクに分割し、準備ができたらクライアントにストリームで送信できます。これにより、ページの一部がサーバーでのレンダリングを待たずに早くに表示されます。

## Next.jsでのServer Componentsの使用 {#using-server-components-in-next-js}

デフォルトで、Next.jsはServer Componentsを使用します。これにより、追加の設定なしでサーバーレンダリングを自動的に実装できます。必要に応じてClient Componentsに移行することも可能です。詳細については[Client Components](/docs/app/building-your-application/rendering/client-components)をご覧ください。

## Server Componentsはどのようにレンダリングされるのか？ {#how-are-server-components-rendered}

サーバーで、Next.jsはReactのAPIを使用してレンダリングを操作します。レンダリング作業はチャンクに分割されます：個々のルートセグメントと[Suspense Boundaries](https://react.dev/reference/react/Suspense)によってです。

各チャンクは2つのステップでレンダリングされます：

1. ReactはServer Componentsを**React Server Component Payload (RSC Payload)**という特別なデータ形式にレンダリングします。
2. Next.jsはRSC PayloadとClient Component JavaScriptの指示を使用して、サーバー上で**HTML**をレンダリングします。

{/* レンダリングダイアグラム */}

その後、クライアント側にて：

1. HTMLを使用して、ルートの高速な非対話型プレビューを即座に表示します - これは初回ページロード時のみです。
2. React Server Components Payloadを使用して、ClientとServer Componentのツリーを同期し、DOMを更新します。
3. JavaScriptの指示を使用してClient Componentsを[ハイドレーション](https://react.dev/reference/react-dom/client/hydrateRoot)してアプリケーションを対話可能にします。

> #### React Server Component Payload (RSC)とは？
>
> RSC Payloadは、レンダリングされたReact Server Componentsツリーのコンパクトなバイナリ表現です。クライアント側でReactがブラウザーのDOMを更新するために使用します。RSC Payloadには以下が含まれます：
>
> - Server Componentsのレンダリング結果
> - Client Componentsがレンダリングされるべき場所のプレースホルダーとそのJavaScriptファイルへの参照
> - Server ComponentからClient Componentに渡されたprops

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングには、静的、動的、ストリーミングの3つのサブセットがあります。

### 静的レンダリング（デフォルト） {#static-rendering-default}

静的レンダリングでは、ルートは**ビルド時**または[データの再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)後にバックグラウンドでレンダリングされます。結果はキャッシュされ、[コンテンツデリバリーネットワーク（CDN）](https://developer.mozilla.org/docs/Glossary/CDN)にプッシュできます。この最適化により、ユーザーやサーバーリクエスト間でレンダリング作業の結果を共有することが可能になります。

静的レンダリングは、ユーザーにパーソナライズされていないデータを持ち、ビルド時に既知であるルート（例えば、静的なブログ投稿や製品ページ）に有用です。

### 動的レンダリング {#dynamic-rendering}

動的レンダリングでは、ルートはユーザーごとに**リクエスト時**にレンダリングされます。

動的レンダリングは、クッキーやURLの検索パラメータのように、ユーザーにパーソナライズされたデータやリクエスト時にのみ既知の情報を持つルートに有用です。

> **キャッシュデータを使用した動的ルート**
>
> ほとんどのWebサイトでは、ルートは完全に静的でも完全に動的でもありません - それはスペクトラムです。例えば、定期的に再検証されるキャッシュされた製品データを使用するeコマースページがある一方で、キャッシュされていない個別化された顧客データも保持します。
>
> Next.jsでは、キャッシュされたデータとキャッシュされていないデータの両方を持つ動的にレンダリングされたルートを持つことができます。これは、RSC Payloadとデータが別々にキャッシュされるためです。これにより、リクエスト時にすべてのデータをフェッチする際のパフォーマンスへの影響を心配することなく動的レンダリングに移行できます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache)と[データキャッシュ](/docs/app/building-your-application/caching#data-cache)について詳しく学びましょう。

#### 動的レンダリングへの切り替え {#switching-to-dynamic-rendering}

レンダリング中に、[動的API](#dynamic-apis)またはキャッシュされていないデータリクエストが見つかると、Next.jsはルート全体を動的にレンダリングするように切り替えます。この表は、動的APIとデータキャッシングがルートの静的レンダリングまたは動的レンダリングにどのように影響するかを要約しています：

| 動的API | データ       | ルート             |
| ------- | ------------ | ------------------ |
| No      | キャッシュ済 | 静的にレンダリング |
| Yes     | キャッシュ済 | 動的にレンダリング |
| No      | 未キャッシュ | 動的にレンダリング |
| Yes     | 未キャッシュ | 動的にレンダリング |

上記の表では、ルートを完全に静的にするには、すべてのデータがキャッシュされている必要があります。しかし、キャッシュされたおよび未キャッシュのデータフェッチを使用する動的にレンダリングされたルートを持つことも可能です。

開発者としては、静的レンダリングと動的レンダリングのどちらかを選択する必要はありません。Next.jsは、使用する機能やAPIに基づいて各ルートの最適なレンダリング戦略を自動的に選択します。代わりに、[キャッシュする](/docs/app/building-your-application/data-fetching/fetching)時や特定のデータを[再検証する](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)時を選び、UIの一部を[ストリーミング](#streaming)することを選択することができます。

### 動的API {#dynamic-apis}

動的APIは、リクエスト時にのみ既知で（プリレンダリング中に事前に知られていない）、このようなAPIを使用すると、開発者の意図を示し、リクエスト時にルート全体を動的レンダリングに移行します。これらのAPIには以下が含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)
- [`unstable_after`](/docs/app/api-reference/functions/unstable_after)

### ストリーミング {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並行化を示す図で、各チャンクのデータ取得、レンダリング、ハイドレーションを示しています。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングにより、サーバーからUIを順次レンダリングできます。作業はチャンクに分割され、準備ができ次第クライアントにストリームされます。これにより、ページ全体のコンテンツのレンダリングが完了する前に、ページの一部をユーザーにすぐに表示できます。

<Image
  alt="クライアント上で部分的にレンダリングされたページを示す図で、ストリーミング中のチャンクの読み込みUIを表示しています。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

ストリーミングはデフォルトでNext.jsのApp Routerに組み込まれています。これにより、初期ページロードのパフォーマンスが向上し、ルート全体のレンダリングを妨げるような遅いデータ取得に依存するUIも改善されます。たとえば、製品ページのレビューなどです。

`loading.js`を使用してルートセグメントをストリーミングし、[React Suspense](/docs/app/building-your-application/routing/loading-ui-and-streaming)でUIコンポーネントを使用し始めることができます。詳細については、[ロードUIとストリーミング](/docs/app/building-your-application/routing/loading-ui-and-streaming)セクションを参照してください。
