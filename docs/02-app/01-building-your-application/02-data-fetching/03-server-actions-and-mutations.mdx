---
title: 'Server Actions ã¨ Mutation'
nav_title: 'Server Actions ã¨ Mutation'
description: 'Next.js ã§ã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚„ãƒ‡ãƒ¼ã‚¿ã®å¤‰ç•°ã®å‡¦ç†æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚'
related:
  description: 'Next.js ã§ã® Server Actions ã®è¨­å®šæ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚'
  links:
    - app/api-reference/next-config-js/serverActions
---

[Server Actions](https://react.dev/reference/rsc/server-actions) ã¯ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹**éåŒæœŸé–¢æ•°**ã§ã™ã€‚ã“ã‚Œã¯ã€Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚„ãƒ‡ãƒ¼ã‚¿ã®å¤‰ç•°ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«ã€Server ãŠã‚ˆã³ Client Component ã‹ã‚‰å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

> **ğŸ¥ è¦–è´:** Server Actions ã‚’ç”¨ã„ãŸ Mutation ã«ã¤ã„ã¦è©³ã—ãå­¦ã³ã¾ã—ã‚‡ã† â†’ [YouTube (10 åˆ†é–“)](https://youtu.be/dDpZfOQBMaU?si=cJZHlUu_jFhCzHUg).

## è¦ç´„ {#convention}

Server Action ã¯ã€React ã® [`"use server"`](https://react.dev/reference/react/use-server) ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã§å®šç¾©ã§ãã¾ã™ã€‚ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ `async` é–¢æ•°ã®å…ˆé ­ã«é…ç½®ã—ã¦ã€ãã®é–¢æ•°ã‚’ Server Action ã¨ã—ã¦ãƒãƒ¼ã‚¯ã™ã‚‹ã‹ã€ã¾ãŸã¯åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†’é ­ã«é…ç½®ã—ã¦ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã™ã¹ã¦ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’ Server Action ã¨ã—ã¦ãƒãƒ¼ã‚¯ã§ãã¾ã™ã€‚

### Server Components {#server-components}

Server Components ã§ã¯ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³é–¢æ•°ãƒ¬ãƒ™ãƒ«ã¾ãŸã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ã® `"use server"` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚Server Action ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ã™ã‚‹ã«ã¯ã€é–¢æ•°æœ¬æ–‡ã®å…ˆé ­ã« `"use server"` ã‚’è¿½åŠ ã—ã¾ã™ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/page.tsx" switcher
export default function Page() {
  // Server Action
  async function create() {
    'use server'
    // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
  }

  return '...'
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/page.js" switcher
export default function Page() {
  // Server Action
  async function create() {
    'use server'
    // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
  }

  return '...'
}
```

</TabItem>
</Tabs>

### Client Components {#client-components}

Client Component ã§ Server Action ã‚’å‘¼ã³å‡ºã™ã«ã¯ã€æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãã®å†’é ­ã« `"use server"` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸã™ã¹ã¦ã®é–¢æ•°ã¯ã€Client ãŠã‚ˆã³ Server Components ã®ä¸¡æ–¹ã§å†åˆ©ç”¨ã§ãã‚‹ Server Action ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¾ã™ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/actions.ts" switcher
'use server'

export async function create() {}
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="app/actions.js" switcher
'use server'

export async function create() {}
```

</TabItem>
</Tabs>

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/ui/button.tsx" switcher
'use client'

import { create } from '@/app/actions'

export function Button() {
  return <button onClick={() => create()}>Create</button>
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/ui/button.js" switcher
'use client'

import { create } from '@/app/actions'

export function Button() {
  return <button onClick={() => create()}>Create</button>
}
```

</TabItem>
</Tabs>

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ props ã¨ã—ã¦æ¸¡ã™ {#passing-actions-as-props}

Server Action ã‚’ Client Component ã« props ã¨ã—ã¦æ¸¡ã™ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```jsx
<ClientComponent updateItemAction={updateItem} />
```

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/client-component.tsx" switcher
'use client'

export default function ClientComponent({
  updateItemAction,
}: {
  updateItemAction: (formData: FormData) => void
}) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/client-component.js" switcher
'use client'

export default function ClientComponent({ updateItemAction }) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

</TabItem>
</Tabs>

é€šå¸¸ã€Next.js ã® TypeScript ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ `client-component.tsx` å†…ã® `updateItemAction` ã‚’ã€ä¸€èˆ¬ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®å¢ƒç•Œã‚’è¶Šãˆã¦ç›´åˆ—åŒ–ã§ããªã„é–¢æ•°ã¨ã—ã¦ãƒ•ãƒ©ã‚°ã—ã¾ã™ã€‚ãŸã ã—ã€`action` ã¨ã„ã†åå‰ã® props ã‚„ `Action` ã§çµ‚ã‚ã‚‹ props ã¯ã€Server Action ã‚’å—ã‘å–ã‚‹ã¨æƒ³å®šã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ã«éããªã„ãŸã‚ã€TypeScript ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯å®Ÿéš›ã« Server Action ã‚’å—ã‘å–ã£ã¦ã„ã‚‹ã‹ã€é€šå¸¸ã®é–¢æ•°ã‚’å—ã‘å–ã£ã¦ã„ã‚‹ã‹ã‚’çŸ¥ã‚‹æ‰‹æ®µãŒã‚ã‚Šã¾ã›ã‚“ã€‚å®Ÿè¡Œæ™‚ã®å‹ãƒã‚§ãƒƒã‚¯ã¯ã€èª¤ã£ã¦é–¢æ•°ã‚’ Client Component ã«æ¸¡ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®å¯¾ç­–ã§ã™ã€‚

## æŒ™å‹• {#behavior}

- Server actions ã¯ [`<form>` è¦ç´ ](#forms)ã® `action` å±æ€§ã‚’ä½¿ç”¨ã—ã¦å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ï¼š
  - Server Components ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ»ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€JavaScript ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„ã‹ã€ç„¡åŠ¹ã«ãªã£ã¦ã„ã¦ã‚‚ãƒ•ã‚©ãƒ¼ãƒ ã¯é€ä¿¡ã•ã‚Œã¾ã™ã€‚
  - Client Components ã§ã¯ã€Server Actions ã‚’å‘¼ã³å‡ºã™ãƒ•ã‚©ãƒ¼ãƒ ã¯ã€JavaScript ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚é€ä¿¡ã‚’ã‚­ãƒ¥ãƒ¼ã«å…¥ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å„ªå…ˆã—ã¾ã™ã€‚
  - ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¾ã›ã‚“ã€‚
- Server Actions ã¯ `<form>` ã«é™å®šã•ã‚Œãšã€ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã€`useEffect`ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€`<button>` ãªã©ã®ä»–ã®ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‹ã‚‰å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚
- Server Actions ã¯ Next.js ã® [ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŠã‚ˆã³å†æ¤œè¨¼](/docs/app/building-your-application/caching) ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨çµ±åˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã€Next.js ã¯æ›´æ–°ã•ã‚ŒãŸ UI ã¨æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®ä¸¡æ–¹ã‚’ã€1 å›ã®ã‚µãƒ¼ãƒãƒ¼ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—ã§è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
- è£ã§ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ `POST` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã€ã“ã® HTTP ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿ãŒãã‚Œã‚‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚
- Server Actions ã®å¼•æ•°ã¨è¿”å´å€¤ã¯ React ã«ã‚ˆã‚Šç›´åˆ—åŒ–å¯èƒ½ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ç›´åˆ—åŒ–å¯èƒ½ãªå¼•æ•°ã¨å€¤ã®ãƒªã‚¹ãƒˆã«ã¤ã„ã¦ã¯ã€React ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚[ç›´åˆ—åŒ–å¯èƒ½ãªå¼•æ•°ã¨å€¤](https://react.dev/reference/react/use-server#serializable-parameters-and-return-values)ã€‚
- Server Actions ã¯é–¢æ•°ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã©ã“ã§ã‚‚å†åˆ©ç”¨ã§ãã¾ã™ã€‚
- Server Actions ã¯ã€ãã‚ŒãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã¾ãŸã¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‹ã‚‰ [ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ](/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes) ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚
- Server Actions ã¯ã€ãã‚ŒãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã¾ãŸã¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‹ã‚‰ [Route Segment Config](/docs/app/api-reference/file-conventions/route-segment-config) ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚`maxDuration` ãªã©ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å«ã¿ã¾ã™ã€‚

## ä¾‹ {#examples}

### ãƒ•ã‚©ãƒ¼ãƒ  {#forms}

React ã¯ HTML [`<form>`](https://developer.mozilla.org/docs/Web/HTML/Element/form) è¦ç´ ã‚’æ‹¡å¼µã—ã¦ã€`action` ãƒ—ãƒ­ãƒƒãƒ—ã§ Server Actions ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãƒ•ã‚©ãƒ¼ãƒ å†…ã§å‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯è‡ªå‹•çš„ã« [`FormData`](https://developer.mozilla.org/docs/Web/API/FormData/FormData) ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã¾ã™ã€‚React ã® `useState` ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç®¡ç†ã™ã‚‹å¿…è¦ã¯ãªãã€ä»£ã‚ã‚Šã«ãƒã‚¤ãƒ†ã‚£ãƒ–ã® [`FormData` ãƒ¡ã‚½ãƒƒãƒ‰](https://developer.mozilla.org/en-US/docs/Web/API/FormData#instance_methods) ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã§ãã¾ã™ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/invoices/page.tsx" switcher
export default function Page() {
  async function createInvoice(formData: FormData) {
    'use server'

    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†æ¤œè¨¼ã™ã‚‹
  }

  return <form action={createInvoice}>...</form>
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/invoices/page.js" switcher
export default function Page() {
  async function createInvoice(formData) {
    'use server'

    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†æ¤œè¨¼ã™ã‚‹
  }

  return <form action={createInvoice}>...</form>
}
```

</TabItem>
</Tabs>

> **Good to know:**
>
> - ä¾‹ï¼š[Loading ãŠã‚ˆã³ Error çŠ¶æ…‹ã®ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ](https://github.com/vercel/next.js/tree/canary/examples/next-forms)
> - å¤šãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ‰±ã†éš›ã¯ã€JavaScript ã® [`Object.fromEntries()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries) ã¨ [`entries()`](https://developer.mozilla.org/en-US/docs/Web/API/FormData/entries) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è€ƒæ…®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€`const rawFormData = Object.fromEntries(formData)` ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚ãŸã ã—ã€`formData` ã«ã¯ `$ACTION_` ã®è¿½åŠ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
> - è©³ã—ãã¯ã€React [`<form>` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://react.dev/reference/react-dom/components/form#handle-form-submission-with-a-server-action) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### è¿½åŠ å¼•æ•°ã‚’æ¸¡ã™ {#passing-additional-arguments}

JavaScript ã® `bind` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€Server Action ã«è¿½åŠ ã®å¼•æ•°ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/client-component.tsx" highlight={6} switcher
'use client'

import { updateUser } from './actions'

export function UserProfile({ userId }: { userId: string }) {
  const updateUserWithId = updateUser.bind(null, userId)

  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">Update User Name</button>
    </form>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/client-component.js" highlight={6} switcher
'use client'

import { updateUser } from './actions'

export function UserProfile({ userId }) {
  const updateUserWithId = updateUser.bind(null, userId)

  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">Update User Name</button>
    </form>
  )
}
```

</TabItem>
</Tabs>

Server Action ã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã«åŠ ãˆã¦ `userId` å¼•æ•°ã‚’å—ã‘å–ã‚Šã¾ã™ï¼š

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="app/actions.ts" switcher
'use server'

export async function updateUser(userId: string, formData: FormData) {}
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="app/actions.js" switcher
'use server'

export async function updateUser(userId, formData) {}
```

</TabItem>
</Tabs>

> **Good to know**:
>
> - ä»£æ›¿æ¡ˆã¨ã—ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ å†…ã« hidden input ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦å¼•æ•°ã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆä¾‹ï¼š`<input type="hidden" name="userId" value={userId} />`ï¼‰ã€‚ãŸã ã—ã€ã“ã®å€¤ã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸ HTML ã®ä¸€éƒ¨ã¨ãªã‚Šã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯ã•ã‚Œã¾ã›ã‚“ã€‚
> - `.bind` ã¯ Server ãŠã‚ˆã³ Client Component ã®ä¸¡æ–¹ã§å‹•ä½œã—ã¾ã™ã€‚ã¾ãŸã€ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

### ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ è¦ç´  {#nested-form-elements}

Server Action ã¯ `<button>`, `<input type="submit">`, `<input type="image">` ãªã©ã€`<form>` ã®å†…éƒ¨ã«ãƒã‚¹ãƒˆã•ã‚ŒãŸè¦ç´ ã§ã‚‚å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®è¦ç´ ã¯ `formAction` ãƒ—ãƒ­ãƒƒãƒ—ã¾ãŸã¯ [ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©](#event-handlers)ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

ã“ã‚Œã¯ã€ãƒ•ã‚©ãƒ¼ãƒ å†…ã§è¤‡æ•°ã® server actions ã‚’å‘¼ã³å‡ºã—ãŸã„å ´åˆã«ä¾¿åˆ©ã§ã™ã€‚ä¾‹ãˆã°ã€æŠ•ç¨¿ã®ä¸‹æ›¸ãã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ç‰¹å®šã® `<button>` è¦ç´ ã‚’ä½œæˆã—ã€ã•ã‚‰ã«ãã‚Œã‚’å…¬é–‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[React `<form>` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://react.dev/reference/react-dom/components/form#handling-multiple-submission-types)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ {#programmatic-form-submission}

[`requestSubmit()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/requestSubmit) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚ˆã£ã¦ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ `âŒ˜` + `Enter` ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹å ´åˆã€`onKeyDown` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³ã§ãã¾ã™ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/entry.tsx" switcher
'use client'

export function Entry() {
  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }

  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/entry.js" switcher
'use client'

export function Entry() {
  const handleKeyDown = (e) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }

  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```

</TabItem>
</Tabs>

ã“ã‚Œã«ã‚ˆã‚Šã€æœ€ã‚‚è¿‘ã„ `<form>` å…ˆç¥–ãŒé€ä¿¡ã•ã‚Œã€Server Action ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

### ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ {#server-side-form-validation}

åŸºæœ¬çš„ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ `required` ã‚„ `type="email"` ãªã©ã® HTML å±æ€§ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

ã‚ˆã‚Šé«˜åº¦ãªã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ã€[zod](https://zod.dev/) ã®ã‚ˆã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹å‰ã«ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¤œè¨¼ã§ãã¾ã™ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/actions.ts" switcher
'use server'

import { z } from 'zod'

const schema = z.object({
  email: z.string({
    invalid_type_error: 'Invalid Email',
  }),
})

export default async function createUser(formData: FormData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })

  // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãŒç„¡åŠ¹ãªå ´åˆã¯æ—©ã‚ã«è¿”ã™
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }

  // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/actions.js" switcher
'use server'

import { z } from 'zod'

const schema = z.object({
  email: z.string({
    invalid_type_error: 'Invalid Email',
  }),
})

export default async function createsUser(formData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })

  // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãŒç„¡åŠ¹ãªå ´åˆã¯æ—©ã‚ã«è¿”ã™
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }

  // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
}
```

</TabItem>
</Tabs>

ã‚µãƒ¼ãƒãƒ¼ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ¤œè¨¼ã•ã‚ŒãŸå¾Œã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å†…ã§ã‚·ãƒªã‚¢ãƒ«åŒ–å¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã€React ã® `useFormState` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ `useFormState` ã«æ¸¡ã™ã¨ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ãŒå¤‰æ›´ã•ã‚Œã€æ–°ã—ã„ `prevState` ã¾ãŸã¯ `initialState` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æœ€åˆã®å¼•æ•°ã¨ã—ã¦å—ã‘å–ã‚Šã¾ã™ã€‚
- `useFormState` ã¯ React ãƒ•ãƒƒã‚¯ã§ã‚ã‚‹ãŸã‚ã€Client Component ã§ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'

export async function createUser(prevState: any, formData: FormData) {
  const res = await fetch('https://...')
  const json = await res.json()

  if (!res.ok) {
    return { message: 'Please enter a valid email' }
  }

  redirect('/dashboard')
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'

export async function createUser(prevState, formData) {
  const res = await fetch('https://...')
  const json = await res.json()

  if (!res.ok) {
    return { message: 'Please enter a valid email' }
  }

  redirect('/dashboard')
}
```

</TabItem>
</Tabs>

æ¬¡ã«ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ `useFormState` ãƒ•ãƒƒã‚¯ã«æ¸¡ã—ã€è¿”ã•ã‚ŒãŸ `state` ã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/ui/signup.tsx" highlight={11,18-20} switcher
'use client'

import { useFormState } from 'react-dom'
import { createUser } from '@/app/actions'

const initialState = {
  message: '',
}

export function Signup() {
  const [state, formAction] = useFormState(createUser, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="email">Email</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button>Sign up</button>
    </form>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/ui/signup.js" highlight={11,18-20} switcher
'use client'

import { useFormState } from 'react-dom'
import { createUser } from '@/app/actions'

const initialState = {
  message: '',
}

export function Signup() {
  const [state, formAction] = useFormState(createUser, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="email">Email</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button>Sign up</button>
    </form>
  )
}
```

</TabItem>
</Tabs>

> **Good to know:**
>
> - ã“ã‚Œã‚‰ã®ä¾‹ã¯ã€Next.js App Router ã«ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã¦ã„ã‚‹ React ã® `useFormState` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚React 19 ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€`useActionState` ã‚’ä»£ã‚ã‚Šã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[React ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://react.dev/reference/react/useActionState)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ä¿ç•™çŠ¶æ…‹ {#pending-states}

> - ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹å‰ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚[èªè¨¼ã¨èªå¯](#authentication-and-authorization)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus) ãƒ•ãƒƒã‚¯ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹é–“ã«èª­ã¿è¾¼ã¿ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ `pending` ãƒ–ãƒ¼ãƒ«å€¤ã‚’å…¬é–‹ã—ã¾ã™ã€‚

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/submit-button.tsx" highlight={6} switcher
'use client'

import { useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button disabled={pending} type="submit">
      Sign Up
    </button>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/submit-button.js" highlight={6} switcher
'use client'

import { useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button disabled={pending} type="submit">
      Sign Up
    </button>
  )
}
```

</TabItem>
</Tabs>

> **Good to know:**
>
> - React 19 ã§ã¯ã€`useFormStatus` ã¯è¿”ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã« dataã€methodã€action ãªã©ã®è¿½åŠ ã®ã‚­ãƒ¼ã‚’å«ã¿ã¾ã™ã€‚React 19 ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„å ´åˆã¯ã€`pending` ã‚­ãƒ¼ã®ã¿ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚
> - React 19 ã§ã¯ã€`useActionState` ã¯è¿”ã•ã‚Œã‚‹ state ã« `pending` ã‚­ãƒ¼ã‚‚å«ã¿ã¾ã™ã€‚

### æ¥½è¦³çš„ãªæ›´æ–° {#optimistic-updates}

React [`useOptimistic`](https://react.dev/reference/react/useOptimistic) ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€Server Action ãŒå®Ÿè¡Œã‚’å®Œäº†ã™ã‚‹å‰ã«ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…ã¤ã“ã¨ãªã UI ã‚’æ¥½è¦³çš„ã«æ›´æ–°ã§ãã¾ã™ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/page.tsx" switcher
'use client'

import { useOptimistic } from 'react'
import { send } from './actions'

type Message = {
  message: string
}

export function Thread({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<
    Message[],
    string
  >(messages, (state, newMessage) => [...state, { message: newMessage }])

  const formAction = async (formData) => {
    const message = formData.get('message') as string
    addOptimisticMessage(message)
    await send(message)
  }

  return (
    <div>
      {optimisticMessages.map((m, i) => (
        <div key={i}>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">Send</button>
      </form>
    </div>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/page.js" switcher
'use client'

import { useOptimistic } from 'react'
import { send } from './actions'

export function Thread({ messages }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic(
    messages,
    (state, newMessage) => [...state, { message: newMessage }]
  )

  const formAction = async (formData) => {
    const message = formData.get('message')
    addOptimisticMessage(message)
    await send(message)
  }

  return (
    <div>
      {optimisticMessages.map((m) => (
        <div>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">Send</button>
      </form>
    </div>
  )
}
```

</TabItem>
</Tabs>

### ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© {#event-handlers}

Server Actions ã‚’ `<form>` è¦ç´ å†…ã§ä½¿ç”¨ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ãŒã€`onClick` ãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§å‘¼ã³å‡ºã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ã„ã„ã­æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã«ã¯ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/like-button.tsx" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }: { initialLikes: number }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>Total Likes: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        Like
      </button>
    </>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/like-button.js" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>Total Likes: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        Like
      </button>
    </>
  )
}
```

</TabItem>
</Tabs>

ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ `onChange` ã§ä¿å­˜ã™ã‚‹ãªã©ã€ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```tsx title="app/ui/edit-post.tsx"
'use client'

import { publishPost, saveDraft } from './actions'

export default function EditPost() {
  return (
    <form action={publishPost}>
      <textarea
        name="content"
        onChange={async (e) => {
          await saveDraft(e.target.value)
        }}
      />
      <button type="submit">Publish</button>
    </form>
  )
}
```

ã“ã®ã‚ˆã†ãªå ´åˆã€è¤‡æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒçŸ­æœŸé–“ã«ã™ã°ã‚„ãç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ä¸è¦ãª Server Action ã®å‘¼ã³å‡ºã—ã‚’é˜²ããŸã‚ã«ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

### `useEffect` {#useeffect}

React [`useEffect`](https://react.dev/reference/react/useEffect) ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¨ãã‚„ä¾å­˜é–¢ä¿‚ãŒå¤‰åŒ–ã—ãŸã¨ãã« Server Action ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã«ä¾å­˜ã™ã‚‹å¤‰ç•°ã‚„è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹å¤‰ç•°ã«ä¾¿åˆ©ã§ã™ã€‚ä¾‹ãˆã°ã€ã‚¢ãƒ—ãƒªã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã® `onKeyDown`ã€ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ãƒ•ãƒƒã‚¯ã€ã¾ãŸã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¨ãã®ãƒ“ãƒ¥ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆã®æ›´æ–°ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/view-count.tsx" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect } from 'react'

export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews)

  useEffect(() => {
    const updateViews = async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    }

    updateViews()
  }, [])

  return <p>Total Views: {views}</p>
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/view-count.js" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect } from 'react'

export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews)

  useEffect(() => {
    const updateViews = async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    }

    updateViews()
  }, [])

  return <p>Total Views: {views}</p>
}
```

</TabItem>
</Tabs>

`useEffect` ã®[æŒ™å‹•ã¨æ³¨æ„äº‹é …](https://react.dev/reference/react/useEffect#caveats)ã‚’è€ƒæ…®ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° {#error-handling}

ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸå ´åˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸Šã®æœ€ã‚‚è¿‘ã„ [`error.js`](/docs/app/building-your-application/routing/error-handling) ã¾ãŸã¯ `<Suspense>` ãƒã‚¦ãƒ³ãƒ€ãƒªã«ã‚ˆã£ã¦æ•æ‰ã•ã‚Œã¾ã™ã€‚UI ã«ã‚ˆã£ã¦ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†ã•ã›ã‚‹ãŸã‚ã«ã€`try/catch` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

ä¾‹ãˆã°ã€æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½œæˆã™ã‚‹éš›ã®ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™æ–¹æ³•ã®ä¾‹ï¼š

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="app/actions.ts" switcher
'use server'

export async function createTodo(prevState: any, formData: FormData) {
  try {
    // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
  } catch (e) {
    throw new Error('Failed to create task')
  }
}
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="app/actions.js" switcher
'use server'

export async function createTodo(prevState, formData) {
  try {
    //  ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ç•°ã•ã›ã‚‹
  } catch (e) {
    throw new Error('Failed to create task')
  }
}
```

</TabItem>
</Tabs>

> **Good to know:**
>
> - ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ä»¥å¤–ã«ã€`useFormState` ã§å‡¦ç†ã™ã‚‹ãŸã‚ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚[ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#server-side-form-validation)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ‡ãƒ¼ã‚¿ã®å†æ¤œè¨¼ {#revalidating-data}

Next.js Cache ã® [Next.js ã‚­ãƒ£ãƒƒã‚·ãƒ¥](/docs/app/building-your-application/caching) ã‚’ Server Actions å†…ã§å†æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[`revalidatePath`](/docs/app/api-reference/functions/revalidatePath) API ã‚’ä½¿ç”¨ã—ã¦ï¼š

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="app/actions.ts" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="app/actions.js" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

</TabItem>
</Tabs>

ã¾ãŸã¯ã€[`revalidateTag`](/docs/app/api-reference/functions/revalidateTag)ã‚’ä½¿ç”¨ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ä½¿ç”¨ã—ã¦ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’ç„¡åŠ¹ã«ã™ã‚‹ï¼š

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="app/actions.ts" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="app/actions.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

</TabItem>
</Tabs>

### ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ {#redirecting}

Server Action ã®å®Œäº†å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç•°ãªã‚‹ãƒ«ãƒ¼ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã„å ´åˆã€[`redirect`](/docs/app/api-reference/functions/redirect) API ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`redirect` ã¯ `try/catch` ãƒ–ãƒ­ãƒƒã‚¯ã®å¤–ã§å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id: string) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸæŠ•ç¨¿ã‚’æ›´æ–°ã™ã‚‹
  redirect(`/post/${id}`) // æ–°ã—ã„æŠ•ç¨¿ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹
}
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸæŠ•ç¨¿ã‚’æ›´æ–°ã™ã‚‹
  redirect(`/post/${id}`) // æ–°ã—ã„æŠ•ç¨¿ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹
}
```

</TabItem>
</Tabs>

### Cookie {#cookies}

Server Action å†…ã§ [`cookies`](/docs/app/api-reference/functions/cookies) API ã‚’ä½¿ç”¨ã—ã¦ cookie ã‚’å–å¾—ã€è¨­å®šã€ãŠã‚ˆã³å‰Šé™¤ã§ãã¾ã™ï¼š

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  const cookieStore = await cookies()

  // Cookie ã‚’å–å¾—
  cookieStore.get('name')?.value

  // Cookie ã‚’è¨­å®š
  cookieStore.set('name', 'Delba')

  // Cookie ã‚’å‰Šé™¤
  cookieStore.delete('name')
}
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  // Cookie ã‚’å–å¾—
  const cookieStore = await cookies()

  // Cookie ã‚’å–å¾—
  cookieStore.get('name')?.value

  // Cookie ã‚’è¨­å®š
  cookieStore.set('name', 'Delba')

  // Cookie ã‚’å‰Šé™¤
  cookieStore.delete('name')
}
```

</TabItem>
</Tabs>

Server Actions ã‹ã‚‰ Cookie ã‚’å‰Šé™¤ã™ã‚‹ [è¿½åŠ ã®ä¾‹](/docs/app/api-reference/functions/cookies#deleting-cookies) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ {#security}

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Server Action ãŒä½œæˆã•ã‚Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã¨ãã€ãã‚Œã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãª HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ãã—ã¦ã€åŒã˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‰æãŠã‚ˆã³èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€Server Action ã‚„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ãŒã‚³ãƒ¼ãƒ‰å†…ã®ä»–ã®å ´æ‰€ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œãªãã¦ã‚‚ã€ä¾ç„¶ã¨ã—ã¦ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã€Next.js ã«ã¯ä»¥ä¸‹ã®çµ„ã¿è¾¼ã¿æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ï¼š

- **å®‰å…¨ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ID:** Next.js ã¯æš—å·åŒ–ã•ã‚ŒãŸéæ±ºå®šçš„ãª ID ã‚’ä½œæˆã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ Server Action ã‚’å‚ç…§ã—å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã® ID ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹ãŸã‚ã«ãƒ“ãƒ«ãƒ‰é–“ã§å®šæœŸçš„ã«å†è¨ˆç®—ã•ã‚Œã¾ã™ã€‚
- **ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰å‰Šé™¤:** ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰ã¯ã€ID ã«ã‚ˆã£ã¦å‚ç…§ã•ã‚Œã‚‹æœªä½¿ç”¨ã® Server Actions ãŒå‰Šé™¤ã•ã‚Œã€ç¬¬ä¸‰è€…ã«ã‚ˆã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’å›é¿ã—ã¾ã™ã€‚

> **Good to know**:
>
> ID ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä½œæˆã•ã‚Œã€æœ€å¤§ 14 æ—¥é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚æ–°ã—ã„ãƒ“ãƒ«ãƒ‰ãŒé–‹å§‹ã•ã‚Œã‚‹ã‹ã€ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ã¨ã€ãã‚Œã‚‰ã¯å†ç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æ”¹å–„ã¯ã€èªè¨¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ¬ å¦‚ã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã§ã®ãƒªã‚¹ã‚¯ã‚’è»½æ¸›ã—ã¾ã™ã€‚ã—ã‹ã—ã€ä¾ç„¶ã¨ã—ã¦ Server Actions ã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãª HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨åŒæ§˜ã«æ‰±ã†ã¹ãã§ã™ã€‚

```jsx
// app/actions.js
'use server'

// ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€Next.js
// ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ Server Action ã‚’å‚ç…§ã—å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«
// ã‚»ã‚­ãƒ¥ã‚¢ãª ID ã‚’ä½œæˆã—ã¾ã™ã€‚
export async function updateUserAction(formData) {}

// ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€Next.js
// ã¯è‡ªå‹•çš„ã«ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ `next build` æ™‚ã«å‰Šé™¤ã—ã€‚
// ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã›ã‚“ã€‚
export async function deleteUserAction(formData) {}
```

### èªè¨¼ã¨èªå¯ {#authentication-and-authorization}

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã¹ãã§ã™ã€‚ä¾‹ãˆã°ï¼š

```tsx title="app/actions.ts"
'use server'

import { auth } from './lib'

export function addItem() {
  const { user } = auth()
  if (!user) {
    throw new Error('You must be signed in to perform this action')
  }

  // ...
}
```

### ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã¨æš—å·åŒ– {#closures-and-encryption}

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ Server Action ã‚’å®šç¾©ã™ã‚‹ã¨ã€ãã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯å¤–å´ã®é–¢æ•°ã‚¹ã‚³ãƒ¼ãƒ—ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹[ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£](https://developer.mozilla.org/ja/docs/Web/JavaScript/Closures)ã‚’ä½œæˆã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`publish` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ `publishVersion` å¤‰æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/page.tsx" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('The version has changed since pressing publish');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>Publish</button>
    </form>
  );
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/page.js" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('The version has changed since pressing publish');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>Publish</button>
    </form>
  );
}
```

</TabItem>
</Tabs>

ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹éš›ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹ï¼š`publishVersion`ï¼‰ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«ä¾¿åˆ©ã§ã™ã€‚

ãŸã ã—ã€ã“ã‚ŒãŒèµ·ã“ã‚‹ã¨ã€ã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚ŒãŸå¤‰æ•°ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã•ã‚Œã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹éš›ã«ã‚µãƒ¼ãƒãƒ¼ã«æˆ»ã•ã‚Œã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ãŒéœ²å‡ºã—ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€Next.js ã¯é–‰ã˜ãŸå¤‰æ•°ã‚’è‡ªå‹•çš„ã«æš—å·åŒ–ã—ã¾ã™ã€‚æ–°ã—ã„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ¼ã¯ã€Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ãŸã³ã«å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ç‰¹å®šã®ãƒ“ãƒ«ãƒ‰ã«å¯¾ã—ã¦ã®ã¿å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

> **Good to know:** æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«éœ²å‡ºã™ã‚‹ã®ã‚’é˜²ããŸã‚ã«æš—å·åŒ–ã ã‘ã«é ¼ã‚‹ã“ã¨ã¯æ¨å¥¨ã—ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã€[React taint API](/docs/app/building-your-application/data-fetching/fetching#preventing-sensitive-data-from-being-exposed-to-the-client) ã‚’ä½¿ç”¨ã—ã¦ã€ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã•ã‚Œãªã„ã‚ˆã†ç©æ¥µçš„ã«é˜²æ­¢ã—ã¦ãã ã•ã„ã€‚

### æš—å·åŒ–ã‚­ãƒ¼ã®ä¸Šæ›¸ãï¼ˆé«˜åº¦ãªçŸ¥è­˜ï¼‰ {#overwriting-encryption-keys-advanced}

Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¤‡æ•°ã®ã‚µãƒ¼ãƒãƒ¼ã«ã‚ãŸã£ã¦ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã™ã‚‹å ´åˆã€å„ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç•°ãªã‚‹æš—å·åŒ–ã‚­ãƒ¼ã‚’æŒã¤å¯èƒ½æ€§ãŒã‚ã‚Šã€æ½œåœ¨çš„ãªä¸æ•´åˆã‚’å¼•ãèµ·ã“ã™ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’è»½æ¸›ã™ã‚‹ãŸã‚ã«ã€`process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY` ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦æš—å·åŒ–ã‚­ãƒ¼ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®å¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€æš—å·åŒ–ã‚­ãƒ¼ã‚’ãƒ“ãƒ«ãƒ‰é–“ã§æŒç¶šçš„ã«ã—ã€ã™ã¹ã¦ã®ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåŒã˜ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã¯ã€è¤‡æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«ã‚ãŸã£ã¦ä¸€è²«ã—ãŸæš—å·åŒ–å‹•ä½œãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¨ã£ã¦é‡è¦ãªå ´åˆã®é«˜åº¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã™ã€‚ã‚­ãƒ¼ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ç½²åãªã©ã®æ¨™æº–çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

> **Good to know:** Vercel ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã“ã‚Œã‚’è‡ªå‹•çš„ã«å‡¦ç†ã—ã¾ã™ã€‚

### è¨±å¯ã•ã‚ŒãŸã‚ªãƒªã‚¸ãƒ³ï¼ˆé«˜åº¦ãªçŸ¥è­˜ï¼‰ {#allowed-origins-advanced}

Server Actions ã¯ `<form>` è¦ç´ å†…ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã€[CSRF æ”»æ’ƒ](https://developer.mozilla.org/ja/docs/Glossary/CSRF)ã®å½±éŸ¿ã‚’å—ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã¯ã€Server Actions ã¯ `POST` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã€ã“ã® HTTP ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿ãŒãã‚Œã‚‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç‰¹ã« [SameSite Cookie](https://web.dev/articles/samesite-cookies-explained) ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚ã‚‹å ´åˆã€ãƒ¢ãƒ€ãƒ³ãªãƒ–ãƒ©ã‚¦ã‚¶ã§ã® CSRF è„†å¼±æ€§ã®å¤šãã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

è¿½åŠ ã®ä¿è­·ã¨ã—ã¦ã€Next.js ã® Server Actions ã¯ [Origin ãƒ˜ãƒƒãƒ€ãƒ¼](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Origin)ã‚’ [Host ãƒ˜ãƒƒãƒ€ãƒ¼](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Host)ï¼ˆã¾ãŸã¯ `X-Forwarded-Host`ï¼‰ã¨æ¯”è¼ƒã—ã¾ã™ã€‚ã“ã‚Œã‚‰ãŒä¸€è‡´ã—ãªã„å ´åˆã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ä¸­æ–­ã•ã‚Œã¾ã™ã€‚è¨€ã„æ›ãˆã‚Œã°ã€Server Actions ã¯ãƒšãƒ¼ã‚¸ã‚’ãƒ›ã‚¹ãƒˆã—ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒ›ã‚¹ãƒˆã§ã®ã¿å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚„å¤šå±¤ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆã‚µãƒ¼ãƒãƒ¼ API ãŒæœ¬ç•ªãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ç•°ãªã‚‹å ´åˆï¼‰ã‚’ä½¿ç”¨ã™ã‚‹å¤§è¦æ¨¡ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ [`serverActions.allowedOrigins`](/docs/app/api-reference/next-config-js/serverActions) ã‚’ä½¿ç”¨ã—ã¦å®‰å…¨ãªã‚ªãƒªã‚¸ãƒ³ã®ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æ–‡å­—åˆ—ã®é…åˆ—ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

```js title="next.config.js"
/** @type {import('next').NextConfig} */
module.exports = {
  experimental: {
    serverActions: {
      allowedOrigins: ['my-proxy.com', '*.my-proxy.com'],
    },
  },
}
```

[Security and Server Actions](https://nextjs.org/blog/security-nextjs-server-components-actions)ã«ã¤ã„ã¦è©³ã—ãå­¦ã³ã¾ã—ã‚‡ã†ã€‚

## è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹ {#additional-resources}

è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã® React ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

- [Server Actions](https://react.dev/reference/rsc/server-actions)
- [`"use server"`](https://react.dev/reference/react/use-server)
- [`<form>`](https://react.dev/reference/react-dom/components/form)
- [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus)
- [`useActionState`](https://react.dev/reference/react/useActionState)
- [`useOptimistic`](https://react.dev/reference/react/useOptimistic)
