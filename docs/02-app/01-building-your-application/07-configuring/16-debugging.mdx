---
title: 'デバッグ'
description: 'VS Code または Chrome DevToolsを使用して Next.js アプリケーションをデバッグする方法を学びましょう。'
---

{/* このドキュメントの内容は、app router と pages router の間で共有されています。Pages Routerに特化したコンテンツを追加するには、`<PagesOnly>Content</PagesOnly>` コンポーネントを使用できます。共有コンテンツはコンポーネントでラップしないでください。 */}

このドキュメントでは、[VS Code デバッガー](https://code.visualstudio.com/docs/editor/debugging)または[Chrome DevTools](https://developers.google.com/web/tools/chrome-devtools)を使用して、ソースマップのサポートを完全に活用して Next.js のフロントエンドおよびバックエンドコードをデバッグする方法を説明します。

Node.jsにアタッチできるデバッガーであれば、どれでもNext.jsアプリケーションをデバッグできます。詳細は Node.js の[デバッグガイド](https://nodejs.org/en/docs/guides/debugging-getting-started/)をご参照ください。

## VS Code でのデバッグ {#debugging-with-vs-code}

プロジェクトの root に次の内容で `.vscode/launch.json` という名前のファイルを作成します:

```json title="launch.json"
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node-terminal",
      "request": "launch",
      "command": "npm run dev"
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    },
    {
      "name": "Next.js: debug full stack",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/next",
      "runtimeArgs": ["--inspect"],
      "skipFiles": ["<node_internals>/**"],
      "serverReadyAction": {
        "action": "debugWithEdge",
        "killOnServerStop": true,
        "pattern": "- Local:.+(https?://.+)",
        "uriFormat": "%s",
        "webRoot": "${workspaceFolder}"
      }
    }
  ]
}
```

`npm run dev` は、Yarnを使用している場合は `yarn dev`、pnpmを使用している場合は `pnpm dev` に置き換えることができます。

アプリケーションが起動する際の[ポート番号を変更している場合](https://nextjs.org/docs/canary/pages/api-reference/cli/next#next-dev-options)、`http://localhost:3000` の `3000` を使用しているポートに置き換えてください。

Next.jsを root 以外のディレクトリから実行している場合（例えば、Turborepoを使用している場合）は、サーバーサイドおよびフルスタックのデバッグタスクに `cwd` を追加する必要があります。例えば、 `"cwd": "${workspaceFolder}/apps/web"`。

次に、デバッグパネル（Windows/Linuxでは `Ctrl+Shift+D`、macOSでは `⇧+⌘+D`）に移動し、起動構成を選択し、 `F5` を押すか、コマンドパレットから **Debug: Start Debugging** を選択してデバッグセッションを開始します。

## Jetbrains WebStorm でのデバッガーの使用 {#using-the-debugger-in-jetbrains-webstorm}

ランタイム構成を一覧するドロップダウンメニューをクリックし、`Edit Configurations...` をクリックします。 URLとして `http://localhost:3000` を使った `JavaScript Debug` デバッグ構成を作成します。好みに合わせて（ブラウザのデバッグ、プロジェクトファイルとして保存など）カスタマイズし、`OK` をクリックします。このデバッグ構成を実行すると、指定したブラウザが自動的に開きます。この時点で、NextJSノードアプリケーションとクライアント/ブラウザアプリケーションの2つがデバッグモードで動作しています。

## Chrome DevTools でのデバッグ {#debugging-with-chrome-devtools}

### クライアントサイドのコード {#client-side-code}

開発サーバーを通常どおり `next dev`、`npm run dev`、または `yarn dev` を実行して起動します。サーバーが起動したら、Chromeで `http://localhost:3000`（またはあなたの代替URL）を開きます。次に、Chromeのデベロッパーツールを開きます（Windows/Linuxでは `Ctrl+Shift+J`、macOSでは `⌥+⌘+I`）、**Sources** タブに移動します。

次に、クライアントサイドのコードが [`debugger`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/debugger) ステートメントに達すると、コードの実行が一時停止し、そのファイルがデバッグエリアに表示されます。また、Windows/Linuxでは `Ctrl+P`、macOSでは `⌘+P` を押してファイルを検索し、手動でブレークポイントを設定することもできます。ここで検索する際、ソースファイルのパスは `webpack://_N_E/./` で始まります。

### サーバーサイドのコード {#server-side-code}

Chrome DevToolsでサーバーサイドのNext.jsコードをデバッグするには、基盤となる Node.js プロセスに [`--inspect`](https://nodejs.org/api/cli.html#cli_inspect_host_port) フラグを渡す必要があります：

```bash title="Terminal"
NODE_OPTIONS='--inspect' next dev
```

> **Good to know**: `NODE_OPTIONS='--inspect=0.0.0.0'` を使用すると、Dockerコンテナ内でアプリを実行する際のリモートデバッグアクセスをローカルホスト外に許可できます。

`npm run dev` または `yarn dev` を使用している場合は、 `package.json` の `dev` スクリプトを更新する必要があります：

```json title="package.json"
{
  "scripts": {
    "dev": "NODE_OPTIONS='--inspect' next dev"
  }
}
```

`--inspect` フラグで Next.js 開発サーバーを起動すると、次のような表示になります：

```bash title="Terminal"
Debugger listening on ws://127.0.0.1:9229/0cf90313-350d-4466-a748-cd60f4e47c95
For help, see: https://nodejs.org/en/docs/inspector
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
```

サーバーが起動したら、Chromeで新しいタブを開き、 `chrome://inspect` を訪れます。ここで、Next.jsアプリケーションが **Remote Target** セクションに表示されているはずです。アプリケーションの下にある **inspect** をクリックして、別のDevToolsウィンドウを開き、**Sources** タブに移動します。

ここでのサーバーサイドコードのデバッグは、Chrome DevToolsでのクライアントサイドコードのデバッグとよく似ています。ただし、ここで `Ctrl+P` または `⌘+P` を使用してファイルを検索すると、ソースファイルのパスは `webpack://{application-name}/./`（`{application-name}` は `package.json` に従ってアプリケーションの名前に置き換えられます）で始まります。

### Chrome DevTools でサーバーエラーを検査する {#inspect-server-errors-with-chrome-devtools}

エラーに遭遇したときは、ソースコードを検査することでエラーの根本原因を追跡するのに役立ちます。

Next.js は開発オーバーレイに Node.js ロゴのような緑色のボタンを表示します。そのボタンをクリックすることで、Chrome DevTool の URL がクリップボードにコピーされ、そのURLで新しいブラウザタブを開くと、Chrome DevToolで Next.js サーバープロセスを検査できます。

<Image
  alt="Chrome DevTool URLのコピー例"
  srcLight="/docs/dark/copy-devtool-url-example.png"
  srcDark="/docs/dark/copy-devtool-url-example.png"
  width="1600"
  height="594"
/>

### Windowsでのデバッグ {#debugging-on-windows}

Windowsユーザーは、`NODE_OPTIONS='--inspect'` を使用する際に、この構文がWindowsプラットフォームでサポートされていないための問題に直面するかもしれません。これを回避するには、開発依存関係として（`npm`や`yarn`と共に`-D`を使用して）[`cross-env`](https://www.npmjs.com/package/cross-env)パッケージをインストールし、`dev` スクリプトを次のように置き換えます。

```json title="package.json"
{
  "scripts": {
    "dev": "cross-env NODE_OPTIONS='--inspect' next dev"
  }
}
```

`cross-env` は、Mac、Linux、Windowsを含むどのプラットフォームでも`NODE_OPTIONS`環境変数を設定し、デバイスやオペレーティングシステムを跨いで一貫してデバッグすることを可能にします。

> **Good to know**: Windows Defenderがマシンで無効になっていることを確認してください。この外部サービスは*すべてのファイル読み込み*をチェックするため、`next dev`における高速リフレッシュ時間を大幅に増やすと報告されています。これは Next.js に関係しない既知の問題ですが、Next.js の開発には影響を与えます。

## 詳細情報 {#more-information}

JavaScript デバッガーの使用方法についてさらに学びたい場合は、次のドキュメントをご覧ください：

- [VS Codeでの Node.js デバッグ: ブレークポイント](https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_breakpoints)
- [Chrome DevTools: JavaScriptデバッグ](https://developers.google.com/web/tools/chrome-devtools/javascript)
