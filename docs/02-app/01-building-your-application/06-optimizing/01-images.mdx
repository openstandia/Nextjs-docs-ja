---
title: '画像の最適化'
nav_title: '画像'
description: '`next/image` コンポーネントを使用して画像を最適化する'
related:
  title: 'APIリファレンス'
  description: 'next/image API について詳しく学ぶ'
  links:
    - app/api-reference/components/image
---

{/* このドキュメントの内容はapp routerとpages routerの間で共有されています。Pages Routerに特有のコンテンツを追加するには `<PagesOnly>Content</PagesOnly>` コンポーネントを使用できます。共有されるコンテンツは、コンポーネントでラップしないでください。 */}

<details>
  <summary>例</summary>

- [Imageコンポーネント](https://github.com/vercel/next.js/tree/canary/examples/image-component)

</details>

[Web Almanac](https://almanac.httparchive.org)によると、画像は典型的なウェブサイトの[ページ重量](https://almanac.httparchive.org/en/2022/page-weight#content-type-and-file-formats)で大きな割合を占めており、ウェブサイトの[LCPのパフォーマンス](https://almanac.httparchive.org/en/2022/performance#lcp-image-optimization)に大きな影響を与える可能性があります。

Next.jsのImageコンポーネントは、HTMLの`<img>`要素を拡張し、次の機能を提供して画像を自動的に最適化します：

- **サイズの最適化:** 各デバイスに適したサイズの画像を、WebPやAVIFのようなモダンな画像フォーマットで自動的に配信します
- **視覚的安定性:** 画像の読み込み中に自動的に[レイアウトシフト](https://nextjs.org/learn/seo/web-performance/cls)を防ぎます
- **ページの読み込み速度向上:** 画像はビューポートに入ったときにのみネイティブブラウザの遅延読み込みを使用して読み込まれ、任意でぼかしプレースホルダーを使用できます
- **アセットの柔軟性:** リモートサーバーに保存された画像でも、オンデマンドで画像のリサイズが可能です

> **🎥 視聴:** `next/image`の使用方法についてさらに学ぶ → [YouTube (9分)](https://youtu.be/IU_qq_c_lKA).

## 使用方法 {#usage}

```js
import Image from 'next/image'
```

次に、画像の`src`を定義できます（ローカルまたはリモート）：

### ローカル画像 {#local-images}

ローカル画像を使用するには、`.jpg`、`.png`、または`.webp`画像ファイルを`import`します。

Next.jsはインポートされたファイルに基づいて、画像の固有の`width`と`height`を[自動的に決定](#image-sizing)します。これらの値は、画像の比率を決定し、画像のロード時に[Cumulative Layout Shift](https://nextjs.org/learn/seo/web-performance/cls)を防ぐために使用されます。

<AppOnly>

```jsx title="app/page.js"
import Image from 'next/image'
import profilePic from './me.png'

export default function Page() {
  return (
    <Image
      src={profilePic}
      alt="作者の写真"
      // width={500} は自動提供されます
      // height={500} は自動提供されます
      // blurDataURL="data:..." は自動提供されます
      // placeholder="blur" // 読み込み中のぼかしをオプションで利用可能
    />
  )
}
```

</AppOnly>

<PagesOnly>

```jsx title="pages/index.js"
import Image from 'next/image'
import profilePic from '../public/me.png'

export default function Page() {
  return (
    <Image
      src={profilePic}
      alt="作者の写真"
      // width={500} は自動提供されます
      // height={500} は自動提供されます
      // blurDataURL="data:..." は自動提供されます
      // placeholder="blur" // 読み込み中のぼかしをオプションで利用可能
    />
  )
}
```

</PagesOnly>

> **注意:** `await`を使った動的`import()`や`require()`は*サポートされていません*。`import`はビルド時に解析できるよう静的である必要があります。

特定の画像を許可し、他のすべてをブロックするために、`next.config.js`ファイルで`localPatterns`をオプションで設定できます。

```js title="next.config.js"
module.exports = {
  images: {
    localPatterns: [
      {
        pathname: '/assets/images/**',
        search: '',
      },
    ],
  },
}
```

### リモート画像 {#remote-images}

リモート画像を使用するには、`src`プロパティがURL文字列である必要があります。

Next.jsはビルドプロセス中にリモートファイルにアクセスできないため、[`width`](/docs/app/api-reference/components/image#width)、[`height`](/docs/app/api-reference/components/image#height)およびオプションの[`blurDataURL`](/docs/app/api-reference/components/image#blurdataurl)プロップを手動で指定する必要があります。

`width`および`height`属性は画像の正しいアスペクト比を推測し、画像の読み込みによるレイアウトシフトを回避するために使用されます。`width`および`height`は画像ファイルの表示サイズを決定しません。[Image Sizing](#image-sizing)について詳しく学んでください。

```jsx title="app/page.js"
import Image from 'next/image'

export default function Page() {
  return (
    <Image
      src="https://s3.amazonaws.com/my-bucket/profile.png"
      alt="作者の写真"
      width={500}
      height={500}
    />
  )
}
```

画像を安全に最適化するには、`next.config.js`にサポートされるURLパターンのリストを定義します。悪意のある使用を防ぐため、できるだけ具体的にします。たとえば、次の設定は特定のAWS S3バケットからの画像のみを許可します：

```js title="next.config.js"
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 's3.amazonaws.com',
        port: '',
        pathname: '/my-bucket/**',
      },
    ],
  },
}
```

[`remotePatterns`](/docs/app/api-reference/components/image#remotepatterns) の設定について詳しく学んでください。画像の`src`に相対URLを使用したい場合は、[`loader`](/docs/app/api-reference/components/image#loader)を使用します。

### ドメイン {#domains}

リモート画像を最適化したいが、内蔵のNext.js Image Optimization APIを使用したい場合があります。そのためには、`loader`をデフォルトの設定のままにして、画像の`src`プロップに絶対URLを入力します。

悪意のあるユーザーからアプリケーションを保護するために、`next/image`コンポーネントとともに使用する予定のリモートホスト名のリストを定義する必要があります。

> [`remotePatterns`](/docs/app/api-reference/components/image#remotepatterns) の設定について詳しく学んでください。

### ローダー {#loaders}

[先ほどの例](#local-images)では、ローカル画像に部分的なURL (`"/me.png"`) が提供されています。これはローダーアーキテクチャによって可能です。

ローダーは画像のURLを生成する関数です。それは提供された`src`を変更し、異なるサイズで画像をリクエストするための複数のURLを生成します。これらの複数のURLは自動[srcset](https://developer.mozilla.org/docs/Web/API/HTMLImageElement/srcset)生成に使用され、サイト訪問者には彼らのビュー ポートに合わせた画像が配信されます。

Next.jsアプリケーションのデフォルトのローダーは、内蔵のImage Optimization APIを使用し、ウェブ上のどこからでも画像を最適化し、その後、Next.jsのウェブサーバーから直接画像を提供します。CDNまたは画像サーバーから直接画像を提供したい場合は、数行のJavaScriptで独自のローダー関数を書くことができます。

[`loader`プロップ](/docs/app/api-reference/components/image#loader)で画像ごとに、または[`loaderFile`設定](/docs/app/api-reference/components/image#loaderfile)でアプリケーションレベルでローダーを定義できます。

## 優先順位 {#priority}

各ページの[最大コンテンツペイント (LCP) 要素](https://web.dev/lcp/#what-elements-are-considered) になる画像に `priority` プロパティを追加する必要があります。これにより、Next.jsはプリロードタグや優先度のヒントを通じて画像のロードを特別に優先し、LCPに意味のあるブーストが得られます。

LCP要素は通常、ページのビューポート内に表示される最大の画像またはテキストブロックです。`next dev`を実行すると、LCP要素が`priority`プロパティのない`<Image>`である場合、コンソール警告が表示されます。

LCP画像を特定した後は、次のようにプロパティを追加できます：

<PagesOnly>

```jsx title="app/page.js"
import Image from 'next/image'

export default function Home() {
  return (
    <>
      <h1>私のホームページ</h1>
      <Image src="/me.png" alt="作者の写真" width={500} height={500} priority />
      <p>私のホームページへようこそ！</p>
    </>
  )
}
```

</PagesOnly>

<AppOnly>

```jsx title="app/page.js"
import Image from 'next/image'
import profilePic from '../public/me.png'

export default function Page() {
  return <Image src={profilePic} alt="作者の写真" priority />
}
```

</AppOnly>

[`next/image`コンポーネントのドキュメント](/docs/app/api-reference/components/image#priority)で優先順位についての詳細を参照してください。

## 画像サイズ設定 {#image-sizing}

画像がパフォーマンスに悪影響を与える最も一般的な方法の1つが、画像がページ上の他の要素を読み込み時に押しのけることによる*レイアウトシフト*です。このパフォーマンス問題はユーザーには非常に煩わしいため、[累積レイアウトシフト (Cumulative Layout Shift)](https://web.dev/cls/)という独自のCore Web Vitalがあります。画像に基づくレイアウトシフトを避ける方法は、[常に画像のサイズを設定すること](https://web.dev/optimize-cls/#images-without-dimensions)です。これにより、ブラウザは画像のために十分なスペースを正確に確保できます。

`next/image`は優れたパフォーマンス結果を保証するよう設計されているため、レイアウトシフトを引き起こす方法で使用することはできず、次の3つの方法のいずれかでサイズを設定する**必要があります**：

1. [静的インポート](#local-images)を使用して自動的に設定
2. 画像のアスペクト比を決定するために使用される [`width`](/docs/app/api-reference/components/image#width) と [`height`](/docs/app/api-reference/components/image#height) プロパティを含む手動設定
3. [fill](/docs/app/api-reference/components/image#fill) を使用して暗黙的に設定し、画像が親要素を埋める設定にする

> **画像のサイズがわからない場合は？**
>
> 画像のサイズを知らずに画像にアクセスしている場合、以下のことができます：
>
> **`fill`を使用する**
>
> [`fill`](/docs/app/api-reference/components/image#fill) プロップを使用することで、画像が親要素によってサイズが設定されます。CSSを使用して画像の親要素にページスペースを確保し、任意で [`sizes`](/docs/app/api-reference/components/image#sizes) プロップを使用してメディアクエリのブレークポイントに合わせてください。さらに、`fill`、`contain`、`cover` を使用して[`object-fit`](https://developer.mozilla.org/docs/Web/CSS/object-fit) を定義し、[`object-position`](https://developer.mozilla.org/docs/Web/CSS/object-position)でそのスペースの占有方法を決定できます。
>
> **画像を標準化する**
>
> 管理可能なソースから画像を提供する場合、画像パイプラインを変更して特定のサイズに画像を標準化してください。
>
> **APIコールを変更する**
>
> アプリケーションがAPIコール（たとえばCMSへの）を使用して画像URLを取得している場合、APIコールを変更してURLと一緒に画像の寸法を返すことができるかもしれません。

提案された方法がどれも画像のサイズ設定に役立たない場合、`next/image`コンポーネントは標準の`<img>`要素と並んでページ上でよく動作するように設計されています。

## スタイリング {#styling}

Imageコンポーネントのスタイリングは、通常の`<img>`要素のスタイリングに似ていますが、以下のガイドラインを守る必要があります：

- `className`または`style`を使用し`styled-jsx`を使用しない
  - ほとんどのケースで、`className`プロップの使用を推奨します。これはインポートされた[CSSモジュール](/docs/app/building-your-application/styling/css)や[グローバルスタイルシート](/docs/app/building-your-application/styling/css#global-styles)などで使用できます
  - `style`プロップを使用してインラインスタイルを割り当てることもできます
  - [styled-jsx](/docs/app/building-your-application/styling/css-in-js)は現在のコンポーネントにスコープされているため使用できません（スタイルを`global`としてマーキングしない限り）
- `fill`を使用する場合、親要素は`position: relative`を持つ必要があります
  - これは、そのレイアウトモードで画像要素が適切にレンダリングされるために必要です
- `fill`を使用する場合、親要素は`display: block`を持つ必要があります
  - これは`<div>`要素のデフォルトですが、これ以外の場合は指定する必要があります

## 例 {#examples}

### レスポンシブ {#responsive}

<Image
  alt="親コンテナの幅と高さを埋めるレスポンシブ画像"
  srcLight="/docs/light/responsive-image.png"
  srcDark="/docs/dark/responsive-image.png"
  width="1600"
  height="629"
/>

```jsx
import Image from 'next/image'
import mountains from '../public/mountains.jpg'

export default function Responsive() {
  return (
    <div style={{ display: 'flex', flexDirection: 'column' }}>
      <Image
        alt="山々"
        // インポートすることで
        // widthとheightが自動で設定されます
        src={mountains}
        sizes="100vw"
        // 画像をフル幅表示
        style={{
          width: '100%',
          height: 'auto',
        }}
      />
    </div>
  )
}
```

### コンテナを埋める {#fill-container}

<Image
  alt="親コンテナの幅を埋める画像のグリッド"
  srcLight="/docs/light/fill-container.png"
  srcDark="/docs/dark/fill-container.png"
  width="1600"
  height="529"
/>

```jsx
import Image from 'next/image'
import mountains from '../public/mountains.jpg'

export default function Fill() {
  return (
    <div
      style={{
        display: 'grid',
        gridGap: '8px',
        gridTemplateColumns: 'repeat(auto-fit, minmax(400px, auto))',
      }}
    >
      <div style={{ position: 'relative', height: '400px' }}>
        <Image
          alt="山々"
          src={mountains}
          fill
          sizes="(min-width: 808px) 50vw, 100vw"
          style={{
            objectFit: 'cover', // cover、contain、none
          }}
        />
      </div>
      {/* さらに画像をグリッドに表示します... */}
    </div>
  )
}
```

### 背景画像 {#background-image}

<Image
  alt="ページのフル幅と高さを取る背景画像"
  srcLight="/docs/light/background-image.png"
  srcDark="/docs/dark/background-image.png"
  width="1600"
  height="427"
/>

```jsx
import Image from 'next/image'
import mountains from '../public/mountains.jpg'

export default function Background() {
  return (
    <Image
      alt="山々"
      src={mountains}
      placeholder="blur"
      quality={100}
      fill
      sizes="100vw"
      style={{
        objectFit: 'cover',
      }}
    />
  )
}
```

さまざまなスタイルとともに使用されるImage コンポーネントの例については、[Image Component Demo](https://image-component.nextjs.gallery) を参照してください。

## その他のプロパティ {#other-properties}

[**next/image コンポーネントに利用可能なすべてのプロパティを表示する**](/docs/app/api-reference/components/image)

## 設定 {#configuration}

`next/image`コンポーネントとNext.js Image Optimization APIは、[`next.config.js`ファイル](/docs/app/api-reference/next-config-js)で設定できます。これらの設定により、[リモート画像の有効化](/docs/app/api-reference/components/image#remotepatterns)、[カスタム画像ブレークポイントの定義](/docs/app/api-reference/components/image#devicesizes)、[キャッシング動作の変更](/docs/app/api-reference/components/image#caching-behavior) などが可能です。

[**詳細情報のためのフル画像設定ドキュメントを読む**](/docs/app/api-reference/components/image#configuration-options)
