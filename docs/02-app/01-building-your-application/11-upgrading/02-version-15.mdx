---
title: バージョン 15
description: Next.js アプリケーションをバージョン 14から 15にアップグレードしましょう。
---

{/* このドキュメントの内容は、アプリルーターとページルーターの間で共通しています。ページルーターに特化した内容を追加したい場合は `<PagesOnly>Content</PagesOnly>` コンポーネントを使用できます。共通の内容はコンポーネントでラップしないでください。*/}

## 14 から 15 へのアップグレード

Next.js バージョン 15 に更新するには、お好みのパッケージマネージャーを使用して次のコマンドを実行してください：

```bash filename="Terminal"
npm i next@rc react@rc react-dom@rc eslint-config-next@rc
```

```bash filename="Terminal"
yarn add next@rc react@rc react-dom@rc eslint-config-next@rc
```

```bash filename="Terminal"
pnpm up next@rc react@rc react-dom@rc eslint-config-next@rc
```

```bash filename="Terminal"
bun add next@rc react@rc react-dom@rc eslint-config-next@rc
```

> **Good to know:**
>
> - ピアデペンデンシーの警告が表示された場合は、`react` と `react-dom`を推奨バージョンに更新するか、`--force` または `--legacy-peer-deps` フラグを使用して警告を無視する必要があるかもしれません。Next.js 15とReact 19の両方が安定版になったら、これらは必要ありません。
> - TypeScript を使用している場合は、一時的に React の型をオーバーライドする必要があります。 詳しくは、[React 19 RC アップグレードガイド](https://react.dev/blog/2024/04/25/react-19-upgrade-guide#installing)を参照してください。

## 最低限必要な React バージョン

- 最小の `react` および `react-dom` は、現在19です

## React 19

- `useFormState` は `useActionState` に置き換えられました。 `useFormState` フックは React 19 でも利用可能ですが、非推奨であり、将来のリリースで削除されます。 `useActionState` が推奨され、`pending`状態を直接読み取るなどの追加プロパティが含まれています。[詳細を見る](https://react.dev/reference/react/useActionState)
- `useFormStatus` は、`data`、`method`、および `action` などの追加キーを含むようになりました。React 19 を使用していない場合は、 `pending` キーのみが利用可能です。[詳細を見る](https://react.dev/reference/react-dom/hooks/useFormStatus)
- [React 19 アップグレードガイド](https://react.dev/blog/2024/04/25/react-19-upgrade-guide)で詳細を確認できます

## `fetch` リクエスト

[`fetch` リクエスト](/docs/app/api-reference/functions/fetch)は、デフォルトではキャッシュされなくなりました。

特定の `fetch` リクエストをキャッシュに加えたい場合は、オプションとして `cache: 'force-cache'` を指定できます。

```js filename="app/layout.js"
export default async function RootLayout() {
  const a = await fetch('https://...') // キャッシュされない
  const b = await fetch('https://...', { cache: 'force-cache' }) // キャッシュされた

  // ...
}
```

レイアウトまたはページ内のすべての `fetch` リクエストをキャッシュに加えたい場合は、`export const fetchCache = 'default-cache'` [セグメント設定オプション](/docs/app/api-reference/file-conventions/route-segment-config)を使用できます。個別の `fetch` リクエストが `cache` オプションを指定している場合は、それが使用されます。

```js filename="app/layout.js"
// これはルートレイアウトなので、アプリ内の
// キャッシュオプションが設定されていないすべての fetch リクエストはキャッシュされます。
export const fetchCache = 'default-cache'

export default async function RootLayout() {
  const a = await fetch('https://...') // キャッシュされた
  const b = await fetch('https://...', { cache: 'no-store' }) // キャッシュされない

  // ...
}
```

## ルートハンドラー

[ルートハンドラー](/docs/app/api-reference/file-conventions/route) の `GET` 関数は、デフォルトではキャッシュされなくなりました。 `GET` メソッドをキャッシュに加えたい場合は、ルートハンドラーファイルで `export const dynamic = 'force-static'` などの[ルート設定オプション](/docs/app/api-reference/file-conventions/route-segment-config)を使用できます。

```js filename="app/api/route.js"
export const dynamic = 'force-static'

export async function GET() {}
```

## クライアントサイドルーターキャッシュ

`<Link>` または `useRouter` を使用してページ間を移動する際、[ページ](/docs/app/api-reference/file-conventions/page) セグメントは、クライアントサイドルーターキャッシュから再利用されなくなりました。ただし、ブラウザの戻るおよび進むナビゲーション中および共有レイアウトでは引き続き再利用されます。

ページセグメントをキャッシュに加えたい場合は、[`staleTimes`](/docs/app/api-reference/next-config-js/staleTimes) 設定オプションを使用できます：

```js filename="next.config.js"
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    staleTimes: {
      dynamic: 30,
      static: 180,
    },
  },
}

module.exports = nextConfig
```

[レイアウト](/docs/app/api-reference/file-conventions/layout) および [ローディング状態](/docs/app/api-reference/file-conventions/loading) は、ナビゲーション中に引き続きキャッシュされ、再利用されます。

## `next/font`

`@next/font` パッケージは組み込みの [`next/font`](/docs/app/api-reference/components/font) に置き換えられました。安全かつ自動的にインポートをリネームする[コードモッドが利用可能](/docs/app/building-your-application/upgrading/codemods#built-in-next-font)です。

```js filename="app/layout.js"
// Before
import { Inter } from '@next/font/google'

// After
import { Inter } from 'next/font/google'
```

## bundlePagesRouterDependencies

`experimental.bundlePagesExternals` は安定し、`bundlePagesRouterDependencies` にリネームされました。

```js filename="next.config.js"
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Before
  experimental: {
    bundlePagesExternals: true,
  },

  // After
  bundlePagesRouterDependencies: true,
}

module.exports = nextConfig
```

## serverExternalPackages

`experimental.serverComponentsExternalPackages` は安定し、`serverExternalPackages` にリネームされました。

```js filename="next.config.js"
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Before
  experimental: {
    serverComponentsExternalPackages: ['package-name'],
  },

  // After
  serverExternalPackages: ['package-name'],
}

module.exports = nextConfig
```

## Speed Insights

Speed Insights の自動インストルメンテーションは Next.js 15で削除されました。

Speed Insights を引き続き使用するには、[Vercel Speed Insights クイックスタート](https://vercel.com/docs/speed-insights/quickstart) ガイドに従ってください。

## `NextRequest` ジオロケーション

`NextRequest` の `geo` と `ip` プロパティが削除されました。これらの値は、ホスティングプロバイダーによって提供される必要がありました。

Vercel を使用している場合は、代わりに [`@vercel/functions`](https://vercel.com/docs/functions/vercel-functions-package) の `geolocation` と `ipAddress` 関数を使用できます：

```ts filename="middleware.ts"
import { geolocation } from '@vercel/functions'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  const { city } = geolocation(request)

  // ...
}
```

```ts filename="middleware.ts"
import { ipAddress } from '@vercel/functions'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  const ip = ipAddress(request)

  // ...
}
```