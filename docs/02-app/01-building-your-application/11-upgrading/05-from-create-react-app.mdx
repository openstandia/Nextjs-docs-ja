---
title: 'Create React Appからの移行'
description: '既存のReactアプリケーションをCreate React AppからNext.jsに移行する方法を学びます。'
---

このガイドは、既存のCreate React AppのサイトをNext.jsに移行するのに役立ちます。

## なぜ切り替えるのか？ {#why-switch}

Create React AppからNext.jsに切り替える理由はいくつかあります：

### 初期ページ読み込み時間の遅さ {#slow-initial-page-loading-time}

Create React Appは純粋にクライアントサイドのReactを使用しています。クライアントサイドのみのアプリケーション、つまりシングルページアプリケーション（SPA）では、初期ページ読み込み時間が遅いことがよくあります。この遅さの原因は以下の通りです：

1. ブラウザがReactコードとアプリケーション全体のバンドルをダウンロードして実行するのを待たなければならず、その後にコードがデータをロードする要求を送信できる。
2. 新しい機能や依存関係を追加するたびにアプリケーションコードが大きくなる。

### 自動コード分割の欠如 {#no-automatic-code-splitting}

前述の遅い読み込み時間の問題は、コード分割である程度管理できます。しかし、手動でコード分割を試みると、パフォーマンスが悪化することがよくあります。手動でコード分割すると、意図せずにネットワークウォーターフォールを導入することが簡単です。Next.jsは、自動コード分割を組み込んだルーターを提供しています。

### ネットワークウォーターフォール {#network-waterfalls}

アプリケーションがデータを取得するためにクライアント-サーバー間で順次要求を行うと、パフォーマンスが低下することがよくあります。SPAでの一般的なデータ取得パターンは、最初にプレースホルダーをレンダリングし、コンポーネントがマウントされた後にデータを取得することです。残念ながら、これは、データを取得する子コンポーネントは、親コンポーネントが自分のデータを読み込むまでデータの取得を開始できないことを意味しています。

Next.jsでは、クライアントでのデータの取得も可能ですが、データ取得をサーバーにシフトするオプションもあり、クライアント-サーバーのウォーターフォールを排除できます。

### 高速で意図したロード状態 {#fast-and-intentional-loading-states}

[React Suspenseによるストリーミング](/docs/app/building-your-application/routing/loading-ui-and-streaming#streaming-with-suspense)のサポートが組み込まれているため、意図したとおりにUIのどの部分を最初に、どの順序でロードするかを決定し、ネットワークウォーターフォールを避けることができます。

これにより、ページのロードを高速化し、[レイアウトのシフト](https://vercel.com/blog/how-core-web-vitals-affect-seo)をなくすことができます。

### データ取得戦略の選択 {#choose-the-data-fetching-strategy}

必要に応じて、Next.jsはページおよびコンポーネント単位でデータ取得戦略を選択できます。ビルド時に取得するか、サーバーの要求時に取得するか、クライアントで取得するかを決定できます。たとえば、CMSからデータを取得し、ブログ投稿をビルド時にレンダリングすることで、CDNで効率的にキャッシュできます。

### ミドルウェア {#middleware}

[Next.js Middleware](/docs/app/building-your-application/routing/middleware)を使用すると、要求が完了する前にサーバー上でコードを実行できます。これは特に、認証されたページ訪問時にログインページにリダイレクトすることで、認証されていないコンテンツのちらつきを防ぐのに役立ちます。ミドルウェアはまた[国際化](/docs/app/building-your-application/routing/internationalization)や実験にも役立ちます。

### 組み込みの最適化 {#built-in-optimizations}

[画像](/docs/app/building-your-application/optimizing/images)、[フォント](/docs/app/building-your-application/optimizing/fonts)、および[サードパーティスクリプト](/docs/app/building-your-application/optimizing/scripts)は、アプリケーションのパフォーマンスに大きな影響を与えることがよくあります。Next.jsは、それらを自動的に最適化する組み込みコンポーネントを提供しています。

## 移行ステップ {#migration-steps}

この移行の目的は、できるだけ早く稼働するNext.jsアプリケーションを準備することです。これにより、Next.jsの機能を段階的に採用できるようになります。まず、既存のルーターを移行せずに、純粋なクライアントサイドアプリケーション（SPA）として保持します。これにより、移行プロセス中に問題が発生する可能性が最小化され、マージの競合が削減されます。

### ステップ1: Next.jsの依存関係をインストール {#step-1-install-the-next-js-dependency}

まずは、`next`を依存としてインストールします：

```bash title="Terminal"
npm install next@latest
```

### ステップ2: Next.jsの設定ファイルを作成 {#step-2-create-the-next-js-configuration-file}

プロジェクトのrootに`next.config.mjs`を作成します。このファイルには[Next.jsの設定オプション](/docs/app/api-reference/next-config-js)が含まれます。

```js title="next.config.mjs"
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export', // シングルページアプリケーション（SPA）を出力。
  distDir: './build', // ビルド出力ディレクトリを`./dist`に変更。
}

export default nextConfig
```

### ステップ3: root レイアウトを作成 {#step-3-create-the-root-layout}

Next.js [App Router](/docs/app)アプリケーションには、すべてのページをラップする[React Server Component](/docs/app/building-your-application/rendering/server-components)である[ルートレイアウト](/docs/app/building-your-application/routing/layouts-and-templates#root-layout-required)ファイルが含まれている必要があります。このファイルは`app`ディレクトリの最上部に定義されます。

CRAアプリケーションのルートレイアウトファイルに最も近いのは、`<html>`、`<head>`、および`<body>`タグが含まれている`index.html`ファイルです。

このステップでは、`index.html`ファイルをルートレイアウトファイルに変換します：

1. `src`ディレクトリに新しい`app`ディレクトリを作成します。
2. その`app`ディレクトリに新しい`layout.tsx`ファイルを作成します：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return '...'
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/layout.js" switcher
export default function RootLayout({ children }) {
  return '...'
}
```

</TabItem>
</Tabs>

> **Good to know**: レイアウトファイルには`.js`、`.jsx`、または`.tsx`拡張子を使用できます。

`index.html`ファイルの内容を先ほど作成した`<RootLayout>`コンポーネントにコピーします。その際、`body.div#root`および`body.noscript`タグを`<div id="root">{children}</div>`に置き換えます：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <head>
        <meta charSet="UTF-8" />
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/layout.js" switcher
export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
</Tabs>

> **Good to know**: Next.jsはCRAの`public/manifest.json`ファイル、追加のアイコノグラフィー（[`favicon`、`icon`、`apple-icon`](/docs/app/api-reference/file-conventions/metadata/app-icons)を除く）、および[テスト設定](/docs/app/building-your-application/testing)を無視しますが、これらが要件である場合、Next.jsはこれらのオプションもサポートします。詳細は [メタデータAPI](/docs/app/building-your-application/optimizing/metadata) と [テスト](/docs/app/building-your-application/testing)のドキュメントを参照してください。

### ステップ4: メタデータ {#step-4-metadata}

Next.jsには、デフォルトで[メタ文字セット](https://developer.mozilla.org/docs/Web/HTML/Element/meta#charset)と[メタビューポート](https://developer.mozilla.org/docs/Web/HTML/Viewport_meta_tag)タグが含まれているため、それらを`<head>`から安全に削除できます：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <head>
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/layout.js" switcher
export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <head>
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
</Tabs>

任意の[メタデータファイル](/docs/app/building-your-application/optimizing/metadata#file-based-metadata)（たとえば`favicon.ico`、`icon.png`、`robots.txt`など）は、`app`ディレクトリの最上部に配置されている限り、自動的にアプリケーションの`<head>`タグに追加されます。[すべてのサポートされるファイル](/docs/app/building-your-application/optimizing/metadata#file-based-metadata)を`app`ディレクトリに移動した後、それらの`<link>`タグを安全に削除できます：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <head>
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/layout.js" switcher
export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <head>
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
</Tabs>

最後に、Next.jsは[メタデータAPI](/docs/app/building-your-application/optimizing/metadata)を使用して最後の`<head>`タグを管理できます。最終的なメタデータ情報をエクスポートされた[`metadata`オブジェクト](/docs/app/api-reference/functions/generate-metadata#metadata-object)に移動します：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/layout.tsx" switcher
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'React App',
  description: 'Web site created with Next.js.',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/layout.js" switcher
export const metadata = {
  title: 'React App',
  description: 'Web site created with Next.js.',
}

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

</TabItem>
</Tabs>

上記の変更により、すべてを`index.html`に宣言することからNext.jsの規約に基づくアプローチにシフトしました（[メタデータAPI](/docs/app/building-your-application/optimizing/metadata)）。このアプローチにより、SEOおよびページの共有性の向上が容易になります。

### ステップ5: スタイル {#step-5-styles}

Create React Appと同様に、Next.jsは[CSS Modules](/docs/app/building-your-application/styling/css#css-modules)を標準でサポートしています。

グローバルCSSファイルを使用している場合は、それを`app/layout.tsx`ファイルにインポートします：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/layout.tsx" switcher
import '../index.css'

// ...
```

</TabItem>
</Tabs>

Tailwindを使用している場合は、`postcss`と`autoprefixer`をインストールする必要があります：

```bash title="Terminal"
npm install postcss autoprefixer
```

次に、プロジェクトのルートに`postcss.config.js`ファイルを作成します：

```js title="postcss.config.js"
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### ステップ6: エントリーポイントページを作成 {#step-6-create-the-entrypoint-page}

Next.jsでは、`page.tsx`ファイルを作成することでアプリケーションのエントリーポイントを宣言します。このファイルのCRAでの最も近い相当物は、`src/index.tsx`ファイルです。このステップでは、アプリケーションのエントリーポイントを設定します。

**`[[...slug]]`ディレクトリを`app`ディレクトリに作成します。**

このガイドでは、いったんNext.jsをSPA（シングルページアプリケーション）としてセットアップすることを目指しています。そのため、ページのエントリーポイントはアプリケーション内のすべての可能なルートをキャッチする必要があります。そのために、`app`ディレクトリ内に新しい`[[...slug]]`ディレクトリを作成します。

このディレクトリは、[オプションのキャッチオールルートセグメント](/docs/app/building-your-application/routing/dynamic-routes#optional-catch-all-segments)と呼ばれます。Next.jsは[ディレクトリを使用してルートを定義する](/docs/app/building-your-application/routing/defining-routes#creating-routes)ファイルシステムベースのルーターを使用しています。この特殊なディレクトリは、アプリケーションのすべてのルートがその中に含まれる`page.tsx`ファイルにリダイレクトされることを保証します。

**`app/[[...slug]]`ディレクトリ内に新しい`page.tsx`ファイルを作成し、次の内容を入力します：**

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/[[...slug]]/page.tsx" switcher
export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return '...' // 後でこれを更新します
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/[[...slug]]/page.js" switcher
export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return '...' // 後でこれを更新します
}
```

</TabItem>
</Tabs>

このファイルは[Server Component](/docs/app/building-your-application/rendering/server-components)です。このファイルは`next build`を実行すると、静的アセットに事前レンダリングされます。動的コードは不要です。

このファイルはグローバルCSSをインポートし、[`generateStaticParams`](/docs/app/api-reference/functions/generate-static-params)を用いて1つのルート、つまり`/`のインデックスルートのみを生成するつもりであることを示します。

次に、クライアントのみで動作するCRAアプリケーションの残りの部分を移動します。

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/[[...slug]]/client.tsx" switcher
'use client'

import dynamic from 'next/dynamic'

const App = dynamic(() => import('../../App'), { ssr: false })

export function ClientOnly() {
  return <App />
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/[[...slug]]/client.js" switcher
'use client'

import dynamic from 'next/dynamic'

const App = dynamic(() => import('../../App'), { ssr: false })

export function ClientOnly() {
  return <App />
}
```

</TabItem>
</Tabs>

このファイルは`'use client'`ディレクティブで定義された[Client Component](/docs/app/building-your-application/rendering/client-components)です。 クライアントコンポーネントは、クライアントに送信される前にサーバー上でHTMLに事前レンダリングされます。

開始するために、クライアント専用のアプリケーションが必要なため、Next.jsを、`App`コンポーネントから自動的に事前レンダリングを無効にするように設定できます。

```tsx
const App = dynamic(() => import('../../App'), { ssr: false })
```

さあ、新しいコンポーネントを使用するようにエントリポイントページを更新しましょう：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/[[...slug]]/page.tsx" switcher
import { ClientOnly } from './client'

export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return <ClientOnly />
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/[[...slug]]/page.js" switcher
import { ClientOnly } from './client'

export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return <ClientOnly />
}
```

</TabItem>
</Tabs>

### ステップ7: 静的イメージのインポートを更新 {#step-7-update-static-image-imports}

Next.jsは静的イメージのインポートをCRAとは少し異なって扱います。CRAでは、画像ファイルをインポートすると、そのパブリックURLを文字列として返します：

```tsx title="App.tsx"
import image from './img.png'

export default function App() {
  return <img src={image} />
}
```

Next.jsでは、静的イメージのインポートはオブジェクトを返します。このオブジェクトはNext.jsの[`<Image>`コンポーネント](/docs/app/api-reference/components/image)と直接的に使用できるか、既存の`<img>`タグにオブジェクトの`src`プロパティを使用することができます。

`<Image>`コンポーネントには[自動イメージ最適化](/docs/app/building-your-application/optimizing/images)の利点があります。 `<Image>`コンポーネントは画像の寸法に基づいて、生成された`<img>`の`width`と`height`属性を自動的に設定します。これは画像が読み込まれたときにレイアウトシフトを防ぐのに役立ちます。ただし、これは片方の寸法のみがスタイル設定されており、他方が`auto`にスタイル設定されていない場合に問題を引き起こす可能性があります。`auto`に設定されていない場合、寸法は`<img>`寸法属性の値にデフォルト設定され、画像が歪んで表示される可能性があります。

`<img>`タグを保持することで、アプリケーションの変更量を減らし、上記の問題を防ぐことができます。その後、[ローダーを設定することでイメージを最適化する](/docs/app/building-your-application/optimizing/images#loaders)ために`<Image>`コンポーネントにオプションで移行したり、イメージ最適化が自動で行われるデフォルトのNext.jsサーバーに移行するオプションがあります。

**`/public`からインポートされたイメージの絶対パスを相対インポートに変換：**

```tsx
// Before
import logo from '/logo.png'

// After
import logo from '../public/logo.png'
```

**イメージオブジェクト全体ではなく、`src`プロパティを`<img>`タグに渡す：**

```tsx
// Before
<img src={logo} />

// After
<img src={logo.src} />
```

それ以外にも、ファイル名に基づいたイメージアセットのパブリックURLを参照することができます。例えば、`public/logo.png`はアプリケーションの`/logo.png`でイメージを提供します。これは`src`値です。

> **警告：** TypeScriptを使用している場合、`src`プロパティへのアクセス時に型エラーが発生することがあります。それを修正するには、`tsconfig.json`ファイルの[`include`配列](https://www.typescriptlang.org/tsconfig#include)に`next-env.d.ts`を追加する必要があります。 Next.jsはアプリケーションをステップ9で実行するときにこのファイルを自動生成します。

### ステップ8: 環境変数の移行 {#step-8-migrate-the-environment-variables}

Next.jsは、CRAと類似した`.env`[環境変数](/docs/app/building-your-application/configuring/environment-variables)をサポートしています。

主な違いは、クライアントサイドでの環境変数の公開に使用されるプレフィックスです。すべての`REACT_APP_`プレフィックスを持つ環境変数を`NEXT_PUBLIC_`に変更します。

### ステップ9: `package.json`のスクリプトを更新 {#step-9-update-scripts-in-package-json}

アプリケーションを実行してNext.jsへの移行が成功したかどうかをテストできるはずですが、その前に、`package.json`の`scripts`をNext.js関連のコマンドに更新し、`.gitignore`ファイルに`.next`と`next-env.d.ts`を追加する必要があります：

```json title="package.json"
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "npx serve@latest ./build"
  }
}
```

```txt title=".gitignore"
# ... {#}
.next
next-env.d.ts
```

`npm run dev`を実行し、[`http://localhost:3000`](http://localhost:3000) を開いてみてください。 Next.jsでアプリケーションが動作しているはずです。

### ステップ10: クリーンアップ {#step-10-clean-up}

Create React App関連のアーティファクトからのコードベースのクリーンアップが可能です：

- `public/index.html`を削除
- `src/index.tsx`を削除
- `src/react-app-env.d.ts`を削除
- `reportWebVitals`の設定を削除
- CRAの依存関係（`react-scripts`）をアンインストール

## バンドラーの互換性 {#bundler-compatibility}

Create React AppとNext.jsはどちらも、バンドルにwebpackをデフォルトとしています。

CRAアプリケーションをNext.jsに移行する際、移行したいカスタムwebpack設定があるかもしれません。Next.jsは[カスタムwebpack設定](/docs/app/api-reference/next-config-js/webpack)を提供することをサポートしています。

さらに、Next.jsは`next dev --turbo`を通じて[ターボパック](/docs/app/api-reference/next-config-js/turbo)をサポートしており、ローカル開発のパフォーマンスを向上します。ターボパックは、互換性と段階的導入のために一部の[webpackローダー](/docs/app/api-reference/next-config-js/turbo)をサポートしています。

## 次の段階 {#next-steps}

すべてが計画通りに進んだ場合、現在、シングルページアプリケーションとして動作するNext.jsアプリケーションがあります。しかし、まだNext.jsの多くの利点を活用していませんが、これから段階的に変更を加えてすべての利点を享受できます。次に行うべきことは以下のとおりです：

- React Routerから[Next.js App Router](/docs/app/building-your-application/routing)に移行して以下の機能を得る：
  - 自動コード分割
  - [ストリーミングサーバーレンダリング](/docs/app/building-your-application/routing/loading-ui-and-streaming)
  - [React Server Components](/docs/app/building-your-application/rendering/server-components)
- [`<Image>`コンポーネントで画像を最適化する](/docs/app/building-your-application/optimizing/images)
- [`next/font`でフォントを最適化する](/docs/app/building-your-application/optimizing/fonts)
- [`<Script>`コンポーネントでサードパーティスクリプトを最適化する](/docs/app/building-your-application/optimizing/scripts)
- [Next.jsルールをサポートするためにESLint設定を更新する](/docs/app/building-your-application/configuring/eslint)

> **Good to know:** 静的エクスポートの使用は、`useParams`フックを使用することを[現在サポートしていません](https://github.com/vercel/next.js/issues/54393)。
