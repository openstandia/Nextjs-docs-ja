---
title: 'Create React Appからの移行'
description: '既存のReactアプリケーションをCreate React AppからNext.jsに移行する方法を学びます。'
---

このガイドは、既存のCreate React AppサイトをNext.jsに移行するのを助けます。

## なぜ移行するのか？

Create React AppからNext.jsに移行したい理由はいくつかあります：

### 初回ページ読み込み時間の遅延

Create React Appは純粋にクライアントサイドのReactを使用しています。クライアントサイドのみのアプリケーション、いわゆるシングルページアプリケーション（SPA）は、しばしば初回ページ読み込み時間が遅くなることがあります。これにはいくつかの理由があります：

1. ブラウザは、Reactコードとアプリケーション全体のバンドルがダウンロードされて実行されるのを待つ必要があり、あなたのコードがデータをロードするためのリクエストを送信する前です。
2. アプリケーションコードは、新しい機能や依存関係を追加するたびに成長します。

### 自動コード分割の欠如

前述の読み込み時間の遅延問題は、ある程度コード分割を行うことで管理可能です。しかし、手動でコードを分割しようとすると、多くの場合、パフォーマンスが悪化します。コード分割を手動で行う際には、ネットワークのウォーターフォールを意図せずに導入することが容易です。Next.jsはルーターに組み込まれた自動コード分割を提供します。

### ネットワークウォーターフォール

パフォーマンスが悪化する一般的な原因は、データを取得するためにクライアントとサーバー間で順次リクエストを行うアプリケーションです。SPAでのデータ取得の一般的なパターンは、プレースホルダーを初めにレンダリングし、コンポーネントがマウントされた後にデータを取得することです。残念ながら、これはデータを取得する子コンポーネントが自分のデータのロードを完了するまでデータの取得を開始できないことを意味します。

クライアントでのデータ取得はNext.jsでサポートされていますが、データ取得をサーバーに移すオプションも提供しており、クライアントサーバーのウォーターフォールを排除することができます。

### 高速で意図的なロード状態

[React Suspenseを使ったストリーミング](/docs/app/building-your-application/routing/loading-ui-and-streaming#streaming-with-suspense)の組み込みサポートにより、ネットワークのウォーターフォールを導入することなく、UIのどの部分を最初にどの順序でロードしたいかをより意図的に制御できます。

これにより、より早くロードされるページを構築し、[レイアウトシフト](https://vercel.com/blog/how-core-web-vitals-affect-seo)を排除できます。

### データ取得戦略を選択

必要に応じて、Next.jsはページとコンポーネントごとにデータ取得戦略を選択することを可能にします。ビルド時、サーバーでのリクエスト時、またはクライアントでデータを取得することができます。例えば、CMSからデータを取得し、ビルド時にブログ投稿をレンダリングし、それをCDNで効率的にキャッシュすることができます。

### ミドルウェア

[Next.jsミドルウェア](/docs/app/building-your-application/routing/middleware)は、リクエストが完了する前にサーバー上でコードを実行することができます。これは、認証が必要なページにユーザーがアクセスした際にログインページにリダイレクトすることで認証されていないコンテンツのフラッシュを避けることができるため、特に便利です。また、ミドルウェアは実験や[国際化](/docs/app/building-your-application/routing/internationalization)にも役立ちます。

### 組み込みの最適化

[画像](/docs/app/building-your-application/optimizing/images)、[フォント](/docs/app/building-your-application/optimizing/fonts)、および[サードパーティのスクリプト](/docs/app/building-your-application/optimizing/scripts)は、しばしばアプリケーションのパフォーマンスに大きな影響を与えます。Next.jsには、それらを自動的に最適化する組み込みコンポーネントが付いています。

## 移行手順

この移行の目標は、可能な限り早く動作するNext.jsアプリケーションを取得し、その後徐々にNext.jsの機能を採用することです。まずは、既存のルーターを移行せずに純粋なクライアントサイドアプリケーション（SPA）として維持します。これにより、移行プロセス中に問題が発生する可能性を最小限にし、マージコンフリクトを減らすことができます。

### ステップ1：Next.jsの依存関係をインストール

最初に行う必要があるのは、`next`を依存関係としてインストールすることです：

```bash filename="Terminal"
npm install next@latest
```

### ステップ2：Next.jsの設定ファイルを作成

プロジェクトのrootに`next.config.mjs`を作成します。このファイルは[Next.jsの設定オプション](/docs/app/api-reference/next-config-js)を保持します。

```js filename="next.config.mjs"
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export', // シングルページアプリケーション（SPA）を出力します。
  distDir: './build', // ビルド出力ディレクトリを`./dist`に変更します。
}

export default nextConfig
```

### ステップ3：Root Layoutを作成

Next.jsの[App Router](/docs/app)アプリケーションには、必ず[Root Layout](/docs/app/building-your-application/routing/layouts-and-templates#root-layout-required)ファイルが含まれている必要があります。これはアプリケーション内のすべてのページをラップする[React Server Component](/docs/app/building-your-application/rendering/server-components)です。このファイルは`app`ディレクトリのトップレベルで定義されます。

CRAアプリケーションでのRoot Layoutファイルの最も近い等価物は、`<html>`、`<head>`、および`<body>`タグを含む`index.html`ファイルです。

このステップでは、`index.html`ファイルをRoot Layoutファイルに変換します：

1. `src`ディレクトリに新しい`app`ディレクトリを作成します。
2. その`app`ディレクトリ内に新しい`layout.tsx`ファイルを作成します：

```tsx filename="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return '...'
}
```

```jsx filename="app/layout.js" switcher
export default function RootLayout({ children }) {
  return '...'
}
```

> **Good to know**: Layoutファイルには`.js`、`.jsx`、または`.tsx`の拡張子を使用できます。

`index.html`ファイルの内容を先に作成した`<RootLayout>`コンポーネントにコピーし、`body.div#root`および`body.noscript`タグを`<div id="root">{children}</div>`に置き換えます：

```tsx filename="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <head>
        <meta charSet="UTF-8" />
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

```jsx filename="app/layout.js" switcher
export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

> **Good to know**: Next.jsはCRAの`public/manifest.json`ファイル、追加のアイコン類（[`favicon`, `icon`, `apple-icon`](/docs/app/api-reference/file-conventions/metadata/app-icons)を除く）、および[テスト設定](/docs/app/building-your-application/testing)を無視しますが、これらが必要な場合、Next.jsもそれらのオプションをサポートしています。詳細については、[Metadata API](/docs/app/building-your-application/optimizing/metadata)および[Testing](/docs/app/building-your-application/testing)ドキュメントを参照してください。

### ステップ4：メタデータ

Next.jsはデフォルトですでに[meta charset](https://developer.mozilla.org/docs/Web/HTML/Element/meta#charset)および[meta viewport](https://developer.mozilla.org/docs/Web/HTML/Viewport_meta_tag)タグを含んでいるため、これを `<head>`から安全に削除できます：

```tsx filename="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <head>
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

```jsx filename="app/layout.js" switcher
export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <head>
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

`favicon.ico`、`icon.png`、`robots.txt`などの[メタデータファイル](/docs/app/building-your-application/optimizing/metadata#file-based-metadata)は、`app`ディレクトリのトップレベルに配置されている限り、アプリケーションの`<head>`タグに自動的に追加されます。[すべてのサポートされているファイル](/docs/app/building-your-application/optimizing/metadata#file-based-metadata)を`app`ディレクトリに移動した後、それらの`<link>`タグを安全に削除できます：

```tsx filename="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <head>
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

```jsx filename="app/layout.js" switcher
export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <head>
        <title>React App</title>
        <meta name="description" content="Web site created..." />
      </head>
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

最後に、Next.jsは[メタデータAPI](/docs/app/building-your-application/optimizing/metadata)を使って最終的な`<head>`タグを管理できます。最終的なメタデータ情報をエクスポートされた[`metadata`オブジェクト](/docs/app/api-reference/functions/generate-metadata#metadata-object)に移動します：

```tsx filename="app/layout.tsx" switcher
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'React App',
  description: 'Web site created with Next.js.',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

```jsx filename="app/layout.js" switcher
export const metadata = {
  title: 'React App',
  description: 'Web site created with Next.js.',
}

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        <div id="root">{children}</div>
      </body>
    </html>
  )
}
```

これらの変更により、`index.html`にすべてを宣言する方法から、Next.jsの規約に基づいたアプローチにシフトしました（[Metadata API](/docs/app/building-your-application/optimizing/metadata)）。このアプローチにより、SEOおよびページのWeb共有性をより簡単に改善できます。

### ステップ5：スタイル

Create React Appと同様に、Next.jsには[CSSモジュール](/docs/app/building-your-application/styling/css#css-modules)の組み込みサポートがあります。

グローバルCSSファイルを使っている場合は、`app/layout.tsx`ファイルにインポートしてください：

```tsx filename="app/layout.tsx" switcher
import '../index.css'

// ...
```

Tailwindを使用している場合は、`postcss`と`autoprefixer`をインストールする必要があります：

```bash filename="Terminal"
npm install postcss autoprefixer
```

次に、プロジェクトのrootに`postcss.config.js`ファイルを作成します：

```js filename="postcss.config.js"
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### ステップ6：エントリポイントページを作成

Next.jsでは、アプリケーションのエントリポイントを`page.tsx`ファイルを作成することで宣言します。CRAでこのファイルに最も近い等価物は`src/index.tsx`ファイルです。このステップでは、アプリケーションのエントリポイントを設定します。

**`app`ディレクトリに`[[...slug]]`ディレクトリを作成**

このガイドの目的は、まずNext.jsをSPA（Single Page Application）としてセットアップすることです。そこで、ページエントリポイントがアプリケーションのすべての可能なルートをキャッチできるようにするため、`app`ディレクトリに新しい`[[...slug]]`ディレクトリを作成します。

このディレクトリは、[オプションのキャッチオールルートセグメント](/docs/app/building-your-application/routing/dynamic-routes#optional-catch-all-segments)と呼ばれます。Next.jsはファイルシステムベースのルーターを使用しており、[ディレクトリを使用してルートを定義します](/docs/app/building-your-application/routing/defining-routes#creating-routes)。この特別なディレクトリは、アプリケーションのすべてのルートがその中の`page.tsx`ファイルにディレクトされることを保証します。

**`app/[[...slug]]`ディレクトリ内に新しい`page.tsx`ファイルを作成し、次の内容を追加します：**

```tsx filename="app/[[...slug]]/page.tsx" switcher
export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return '...' // 後で更新します
}
```

```jsx filename="app/[[...slug]]/page.js" switcher
export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return '...' // 後で更新します
}
```

このファイルは[Server Component](/docs/app/building-your-application/rendering/server-components)です。`next build`を実行すると、ファイルは静的アセットにプリレンダリングされます。動的なコードを必要としません。

このファイルは、グローバルCSSをインポートし、[`generateStaticParams`](/docs/app/api-reference/functions/generate-static-params)を使用して1つのルート、`/`のインデックスルートのみを生成することを伝えます。

次に、クライアントのみで実行されるCRAアプリケーションの残りを移動します。

```tsx filename="app/[[...slug]]/client.tsx" switcher
'use client'

import dynamic from 'next/dynamic'

const App = dynamic(() => import('../../App'), { ssr: false })

export function ClientOnly() {
  return <App />
}
```

```jsx filename="app/[[...slug]]/client.js" switcher
'use client'

import dynamic from 'next/dynamic'

const App = dynamic(() => import('../../App'), { ssr: false })

export function ClientOnly() {
  return <App />
}
```

このファイルは、`'use client'`ディレクティブで定義されている[Client Component](/docs/app/building-your-application/rendering/client-components)です。クライアントコンポーネントもサーバー上で[HTMLにプレンダリングされて](/docs/app/building-your-application/rendering/client-components#how-are-client-components-rendered)クライアントに送信されます。

クライアントのみのアプリケーションを開始するために、Next.jsを設定して`App`コンポーネントからのプリレンダリングを無効にできます。

```tsx
const App = dynamic(() => import('../../App'), { ssr: false })
```

次に、エントリポイントページを新しいコンポーネントを使用するように更新します：

```tsx filename="app/[[...slug]]/page.tsx" switcher
import { ClientOnly } from './client'

export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return <ClientOnly />
}
```

```jsx filename="app/[[...slug]]/page.js" switcher
import { ClientOnly } from './client'

export function generateStaticParams() {
  return [{ slug: [''] }]
}

export default function Page() {
  return <ClientOnly />
}
```

### ステップ7：静的画像のインポートを更新

Next.jsは静的画像のインポートをCRAとはわずかに異なる方法で処理します。CRAでは、画像ファイルをインポートすると、そのパブリックURLが文字列として返されます：

```tsx filename="App.tsx"
import image from './img.png'

export default function App() {
  return <img src={image} />
}
```

Next.jsでは、静的画像のインポートはオブジェクトを返します。このオブジェクトはNext.jsの[`<Image>`コンポーネント](/docs/app/api-reference/components/image)で直接使用できますが、既存の`<img>`タグでオブジェクトの`src`プロパティを使用することもできます。

`<Image>`コンポーネントは[自動画像最適化](/docs/app/building-your-application/optimizing/images)の利点があります。`<Image>`コンポーネントは画像の寸法に基づいて結果の`<img>`の`width`および`height`属性を自動的に設定します。これにより、画像がロードされたときのレイアウトシフトを防止します。しかし、アプリがスタイルされていない場合に寸法がデフォルトの`<img>`寸法属性の値になり、画像が歪んで表示される可能性があります。

`<img>`タグを保持することで、アプリケーション内の変更を減らし、上記の問題を防ぐことができます。その後、後で画像を最適化するために、`<Image>`コンポーネントに移行することができます。

**`/public`からインポートされた画像の絶対インポートパスを相対インポートに変換します：**

```tsx
// Before
import logo from '/logo.png'

// After
import logo from '../public/logo.png'
```

**画像オブジェクト全体の代わりに画像の`src`プロパティを`<img>`タグに渡します：**

```tsx
// Before
<img src={logo} />

// After
<img src={logo.src} />
```

または、ファイル名に基づいて画像アセットのパブリックURLを参照することができます。例えば、`public/logo.png`はアプリケーション用に`/logo.png`で画像を提供します。これは`src`の値になります。

> **Warning:** TypeScriptを使用している場合、`src`プロパティにアクセスするときに型のエラーが発生する可能性があります。これを修正するには、`tsconfig.json`ファイルの[`include`配列](https://www.typescriptlang.org/tsconfig#include)に`next-env.d.ts`を追加する必要があります。Next.jsは、ステップ9でアプリケーションを実行するときに自動的にこのファイルを生成します。

### ステップ8：環境変数の移行

Next.jsは、CRAと同様に`.env`[環境変数](/docs/app/building-your-application/configuring/environment-variables)をサポートしています。

主な違いは、クライアントサイドで環境変数を公開するために使用されるプレフィックスです。`REACT_APP_`プレフィックスを持つすべての環境変数を`NEXT_PUBLIC_`に変更します。

### ステップ9：`package.json`のスクリプトを更新

これで、アプリケーションを実行して、Next.jsへの移行に成功したかどうかをテストできるはずです。しかし、その前に、`package.json`の`scripts`をNext.js関連のコマンドで更新し、`.next`と`next-env.d.ts`を`.gitignore`ファイルに追加する必要があります：

```json filename="package.json"
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "npx serve@latest ./build"
  }
}
```

```txt filename=".gitignore"
# ...
.next
next-env.d.ts
```

これで`npm run dev`を実行し、[`http://localhost:3000`](http://localhost:3000)を開いてください。アプリケーションがNext.jsで稼動しているのを確認できるはずです。

### ステップ10：クリーンアップ

Create React Appに関連するアーティファクトからコードベースをクリーンアップできます：

- `public/index.html`を削除
- `src/index.tsx`を削除
- `src/react-app-env.d.ts`を削除
- `reportWebVitals`のセットアップを削除
- CRAの依存関係（`react-scripts`）をアンインストール

## バンドラーの互換性

Create React App と Next.js はどちらもデフォルトでwebpackをバンドルに使用します。

CRAアプリケーションをNext.jsに移行する際に、移行しようとしているカスタムwebpack構成があるかもしれません。Next.jsは[カスタムwebpack構成](/docs/app/api-reference/next-config-js/webpack)を提供することをサポートしています。

さらに、Next.jsはローカル開発のパフォーマンスを向上させるために`next dev --turbo`を使って[Turbopack](/docs/app/api-reference/next-config-js/turbo)をサポートしています。Turbopackは互換性と段階的導入のために一部の[webpackローダー](/docs/app/api-reference/next-config-js/turbo)もサポートしています。

## 次のステップ

すべてが計画通りに進んだ場合、あなたは今、シングルページアプリケーションとして動作するNext.jsアプリケーションを持っています。しかし、あなたはまだNext.jsの利点の多くを活用していませんが、すべての利点を享受するために段階的な変更を開始することができます。次に行うことをお勧めします：

- React Routerから[Next.js App Router](/docs/app/building-your-application/routing)に移行して、次の機能を得る：
  - 自動コード分割
  - [ストリーミングサーバーレンダリング](/docs/app/building-your-application/routing/loading-ui-and-streaming)
  - [React Server Components](/docs/app/building-your-application/rendering/server-components)
- [`<Image>`コンポーネント](/docs/app/building-your-application/optimizing/images)で画像を最適化
- [`next/font`](/docs/app/building-your-application/optimizing/fonts)でフォントを最適化
- [`<Script>`コンポーネント](/docs/app/building-your-application/optimizing/scripts)でサードパーティスクリプトを最適化
- [Next.jsルールをサポートするESLint設定を更新](/docs/app/building-your-application/configuring/eslint)

> **Good to know:** 現在、静的エクスポートを使用する場合、`useParams`フックの使用は[サポートされていません](https://github.com/vercel/next.js/issues/54393)。