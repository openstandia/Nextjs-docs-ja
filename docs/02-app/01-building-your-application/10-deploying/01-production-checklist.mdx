---
title: 'Production Checklist'
description: 'Next.jsアプリケーションを本番環境に移行する前に、最高のパフォーマンスとユーザー体験を確保するための推奨事項です。'
---

Next.jsアプリケーションを本番環境に移行する前に、ユーザー体験、パフォーマンス、セキュリティを最高の状態にするために考慮すべき最適化とパターンがあります。

このページでは、アプリケーションを[構築する際](#during-development)、[本番環境に移行する前](#before-going-to-production)、および[デプロイ後](#after-deployment)に使用できるベストプラクティスと、理解しておくべき[Next.jsの自動最適化](#automatic-optimizations)を紹介します。

## 自動最適化 {#automatic-optimizations}

これらのNext.jsの最適化はデフォルトで有効になっており、設定は不要です：

<AppOnly>

- **[Server Components](/docs/app/building-your-application/rendering/server-components):** Next.jsはデフォルトでサーバーコンポーネントを使用します。サーバーコンポーネントはサーバー上で実行され、クライアントでのレンダリングにJavaScriptを必要としません。そのため、クライアント側のJavaScriptバンドルのサイズに影響を与えません。必要に応じてインタラクティブ性のために[クライアントコンポーネント](/docs/app/building-your-application/rendering/client-components)を使用できます。
- **[コード分割](/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works):** サーバーコンポーネントはルートセグメントによる自動コード分割を可能にします。適切な場合は、クライアントコンポーネントやサードパーティのライブラリを[遅延読み込み](/docs/app/building-your-application/optimizing/lazy-loading)することも検討してください。
- **[プリフェッチ](/docs/app/building-your-application/routing/linking-and-navigating#2-prefetching):** ユーザーのビューポートに新しいルートへのリンクが入ると、Next.jsはバックグラウンドでそのルートをプリフェッチします。これにより、新しいルートへのナビゲーションがほぼ瞬時に行われます。適切な場合はプリフェッチをオプトアウトできます。
- **[静的レンダリング](/docs/app/building-your-application/rendering/server-components#static-rendering-default):** Next.jsはビルド時にサーバー上でサーバーおよびクライアントコンポーネントを静的にレンダリングし、レンダリングされた結果をキャッシュしてアプリケーションのパフォーマンスを向上させます。適切な場合は特定のルートに対して[動的レンダリング](/docs/app/building-your-application/rendering/server-components#dynamic-rendering)をオプトインできます。 {/* TODO: PPRが安定したら更新する */}
- **[キャッシュ](/docs/app/building-your-application/caching):** Next.jsはデータリクエスト、サーバーおよびクライアントコンポーネントのレンダリング結果、静的アセットなどをキャッシュし、サーバー、データベース、バックエンドサービスへのネットワークリクエストの数を減らします。適切な場合はキャッシュをオプトアウトできます。

</AppOnly>

<PagesOnly>

- **[コード分割](https://nextjs.org/docs/canary/pages/building-your-application/routing/pages-and-layouts):** Next.jsはページごとにアプリケーションコードを自動でコード分割します。これにより、ナビゲーション時に現在のページに必要なコードのみが読み込まれます。適切な場合はサードパーティのライブラリを[遅延読み込み](https://nextjs.org/docs/canary/pages/building-your-application/optimizing/lazy-loading)することも検討してください。
- **[プリフェッチ](https://nextjs.org/docs/canary/pages/api-reference/components/link#prefetch):** ユーザーのビューポートに新しいルートへのリンクが入ると、Next.jsはバックグラウンドでそのルートをプリフェッチします。これにより、新しいルートへのナビゲーションがほぼ瞬時に行われます。適切な場合はプリフェッチをオプトアウトできます。
- **[自動静的最適化](https://nextjs.org/docs/canary/pages/building-your-application/rendering/automatic-static-optimization):** Next.jsはページにブロックデータ要件がない場合、ページが静的である（事前レンダリング可能である）と判断します。最適化されたページはキャッシュされ、複数のCDNロケーションからエンドユーザーに提供されます。適切な場合は[サーバーサイドレンダリング](https://nextjs.org/docs/canary/pages/building-your-application/data-fetching/get-server-side-props)をオプトインできます。

</PagesOnly>

これらのデフォルトはアプリケーションのパフォーマンスを向上させ、各ネットワークリクエストで転送されるデータの量とコストを削減することを目的としています。

## 開発中 {#during-development}

アプリケーションを構築する際に、最高のパフォーマンスとユーザー体験を確保するために以下の機能を使用することをお勧めします：

### ルーティングとレンダリング {#routing-and-rendering}

<AppOnly>

- **[Layouts](/docs/app/building-your-application/routing/layouts-and-templates#layouts):** Layoutsを使用して複数のページにわたってUIを共有し、ナビゲーション時に[部分的レンダリング](/docs/app/building-your-application/routing/linking-and-navigating#4-partial-rendering)を有効にします。
- **[`<Link>`コンポーネント](/docs/app/building-your-application/routing/linking-and-navigating#link-component):** `<Link>`コンポーネントを使用して[クライアントサイドナビゲーションとプリフェッチ](/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works)を行います。
- **[エラーハンドリング](/docs/app/building-your-application/routing/error-handling):** カスタムエラーページを作成して、本番環境での[キャッチオールエラー](/docs/app/building-your-application/routing/error-handling)と[404エラー](/docs/app/api-reference/file-conventions/not-found)を優雅に処理します。
- **[コンポジションパターン](/docs/app/building-your-application/rendering/composition-patterns):** サーバーおよびクライアントコンポーネントの推奨コンポジションパターンに従い、クライアントサイドのJavaScriptバンドルを不必要に増加させないように、[`"use client"`境界線](/docs/app/building-your-application/rendering/composition-patterns#moving-client-components-down-the-tree)の配置を確認します。
- **[動的API](/docs/app/building-your-application/rendering/server-components#dynamic-apis):** [`cookies`](/docs/app/api-reference/functions/cookies)や[`searchParams`](/docs/app/api-reference/file-conventions/page#searchparams-optional)のプロップのような動的APIは、ルート全体を[動的レンダリング](/docs/app/building-your-application/rendering/server-components#dynamic-rendering)にオプトインさせること（rootレイアウトで使用された場合はアプリ全体）を考慮してください。動的APIの使用は意図的であることを確認し、適切な場合は`<Suspense>`境界でラップしてください。

> **知っておくべきこと**：[部分的事前レンダリング（実験的）](https://nextjs.org/blog/next-14#partial-prerendering-preview)により、ルート全体を動的レンダリングにオプトインせずに、ルートの一部を動的にすることが可能になります。

</AppOnly>

<PagesOnly>

- **[`<Link>`コンポーネント](https://nextjs.org/docs/canary/pages/building-your-application/routing/linking-and-navigating):** クライアントサイドナビゲーションとプリフェッチのために`<Link>`コンポーネントを使用します。
- **[カスタムエラー](https://nextjs.org/docs/canary/pages/building-your-application/routing/custom-error):** [500ページ](https://nextjs.org/docs/canary/pages/building-your-application/routing/custom-error#500-page)と[404エラー](https://nextjs.org/docs/canary/pages/building-your-application/routing/custom-error#404-page)を優雅に処理します。

</PagesOnly>

### データフェッチングとキャッシング {#data-fetching-and-caching}

<AppOnly>

- **[サーバーコンポーネント](/docs/app/building-your-application/data-fetching/fetching):** サーバーでデータをフェッチするためにサーバーコンポーネントの利点を活用します。
- **[ルートハンドラー](/docs/app/building-your-application/routing/route-handlers):** クライアントコンポーネントからバックエンドリソースにアクセスするためにルートハンドラーを使用します。ただし、サーバーコンポーネントからルートハンドラーを呼び出して追加のサーバーリクエストを回避してください。
- **[ストリーミング](/docs/app/building-your-application/routing/loading-ui-and-streaming):** ローディングUIとReactのサスペンスを使用して、サーバーからクライアントにUIを段階的に送信し、データがフェッチされている間にルート全体がブロックされるのを防ぎます。
- **[並列データフェッチング](/docs/app/building-your-application/data-fetching/fetching#parallel-and-sequential-data-fetching):** ネットワークウォーターフォールを減らすために、適切な場合はデータを並列でフェッチします。適切な場合は[データのプリロード](/docs/app/building-your-application/data-fetching/fetching#preloading-data)も検討してください。
- **[データキャッシング](/docs/app/building-your-application/caching#data-cache):** データリクエストがキャッシュされているかどうかを確認し、適切な場合はキャッシュをオプトインします。`fetch`を使用しないリクエストが[キャッシュ](/docs/app/api-reference/legacy-apis/unstable_cache)されていることを確認してください。
- **[静的画像](/docs/app/building-your-application/optimizing/static-assets):** アプリケーションの静的アセット（例：画像）を自動でキャッシュするために、`public`ディレクトリを使用します。

</AppOnly>

<PagesOnly>

- **[APIルート](https://nextjs.org/docs/canary/pages/building-your-application/routing/api-routes):** バックエンドリソースにアクセスするためにルートハンドラーを使用し、クライアントに秘密の情報が露出されないようにします。
- **[データキャッシング](https://nextjs.org/docs/canary/pages/building-your-application/data-fetching/get-static-props):** データリクエストがキャッシュされているかどうかを確認し、適切な場合はキャッシュをオプトインします。`getStaticProps`を使用しないリクエストが適切にキャッシュされるようにしてください。
- **[インクリメンタル静的再生成](https://nextjs.org/docs/canary/pages/building-your-application/data-fetching/incremental-static-regeneration):** サイト全体を再構築せずにビルド後に静的ページを更新するためにインクリメンタル静的再生成を使用します。
- **[静的画像](https://nextjs.org/docs/canary/pages/building-your-application/optimizing/static-assets):** アプリケーションの静的アセット（例：画像）を自動でキャッシュするために、`public`ディレクトリを使用します。

</PagesOnly>

### UIとアクセシビリティ {#ui-and-accessibility}

<AppOnly>

- **[フォームとバリデーション](/docs/app/building-your-application/data-fetching/server-actions-and-mutations#forms):** サーバーアクションを使用してフォームの送信、サーバーサイドのバリデーション、エラーハンドリングを行います。

</AppOnly>

- **[フォントモジュール](/docs/app/building-your-application/optimizing/fonts):** フォントファイルを他の静的アセットと共に自動でホスティングし、外部ネットワークリクエストを削減し、[レイアウトシフト](https://web.dev/articles/cls)を減少させるためにフォントモジュールを使用します。
- **[`<Image>`コンポーネント](/docs/app/building-your-application/optimizing/images):** 画像を自動で最適化し、レイアウトシフトを防ぎ、WebPやAVIFなどの最新フォーマットで提供するために、Imageコンポーネントを使用します。
- **[`<Script>`コンポーネント](/docs/app/building-your-application/optimizing/scripts):** サードパーティスクリプトを最適化し、スクリプトを自動で遅延させてメインスレッドをブロックしないようにするためにScriptコンポーネントを使用します。
- **[ESLint](/docs/architecture/accessibility#linting):** アクセシビリティの問題を早期に捕捉するために、組み込みの`eslint-plugin-jsx-a11y`プラグインを使用します。

### セキュリティ {#security}

<AppOnly>

- **[汚染](/docs/app/building-your-application/data-fetching/fetching#preventing-sensitive-data-from-being-exposed-to-the-client):** データオブジェクトや特定の値を汚染することで、クライアントに機密データが露出しないようにします。
- **[サーバーアクション](/docs/app/building-your-application/data-fetching/server-actions-and-mutations#authentication-and-authorization):** ユーザーがサーバーアクションを呼び出す許可を得ていることを確認します。推奨される[セキュリティプラクティス](https://nextjs.org/blog/security-nextjs-server-components-actions)をレビューします。

</AppOnly>

- **[環境変数](/docs/app/building-your-application/configuring/environment-variables):** `.env.*`ファイルが`.gitignore`に追加され、公開された変数のみが`NEXT_PUBLIC_`で接頭されていることを確認します。
- **[コンテンツセキュリティポリシー](/docs/app/building-your-application/configuring/content-security-policy):** クロスサイトスクリプティング、クリックジャッキング、およびその他のコードインジェクション攻撃などのさまざまなセキュリティ脅威からアプリケーションを保護するためにコンテンツセキュリティポリシーを追加することを検討してください。

### メタデータとSEO {#metadata-and-seo}

<AppOnly>

- **[メタデータAPI](/docs/app/building-your-application/optimizing/metadata):** ページタイトル、説明などを追加することで、メタデータAPIを使用してアプリケーションの検索エンジン最適化（SEO）を改善します。
- **[Open Graph（OG）画像](/docs/app/api-reference/file-conventions/metadata/opengraph-image):** アプリケーションがソーシャルシェアに対応できるようにOG画像を作成します。
- **[サイトマップ](/docs/app/api-reference/functions/generate-sitemaps)と[ロボット](/docs/app/api-reference/file-conventions/metadata/robots):** サイトマップとrobotsファイルを生成して、検索エンジンがページをクロールしインデックスするのを助けます。

</AppOnly>

<PagesOnly>

- **[`<Head>`コンポーネント](https://nextjs.org/docs/canary/pages/api-reference/components/head):** ページタイトル、説明などを追加するために`next/head`コンポーネントを使用します。

</PagesOnly>

### タイプセーフティ {#type-safety}

- **TypeScriptと[TSプラグイン](/docs/app/building-your-application/configuring/typescript):** より良いタイプセーフティを得るためにTypeScriptとTypeScriptプラグインを使用し、エラーを早期に捕捉するのに役立てます。

## 本番環境に移行する前に {#before-going-to-production}

本番環境に移行する前に、`next build`を実行してローカルでアプリケーションをビルドし、ビルドエラーを捕捉します。その後、`next start`を実行して、本番環境に近い環境でアプリケーションのパフォーマンスを測定します。

### Core Web Vitals {#core-web-vitals}

- **[Lighthouse](https://developers.google.com/web/tools/lighthouse):** インコグニートモードでLighthouseを実行し、ユーザーがどのようにサイトを体験するかをよりよく理解し、改善の余地を特定します。これは模擬テストであり、Core Web Vitalsなどのフィールドデータを確認することと組み合わせるべきです。

<AppOnly>

- **[`useReportWebVitals`フック](/docs/app/api-reference/functions/use-report-web-vitals):** このフックを利用して、[Core Web Vitals](https://web.dev/articles/vitals)データを分析ツールに送信します。

</AppOnly>

### バンドルの分析 {#analyzing-bundles}

[`@next/bundle-analyzer`プラグイン](/docs/app/building-your-application/optimizing/package-bundling#analyzing-javascript-bundles)を使用して、JavaScriptバンドルのサイズを分析し、アプリケーションのパフォーマンスに影響を与える可能性のある大きなモジュールや依存関係を特定します。

さらに、新しい依存関係をアプリケーションに追加することの影響を理解するためには、次のツールが役立ちます：

- [Import Cost](https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost)
- [Package Phobia](https://packagephobia.com/)
- [Bundle Phobia](https://bundlephobia.com/)
- [bundlejs](https://bundlejs.com/)

## デプロイ後 {#after-deployment}

アプリケーションをデプロイする場所によっては、アプリケーションのパフォーマンスを監視し改善するのに役立つ追加のツールや統合機能にアクセスできるかもしれません。

Vercelでのデプロイに関しては、以下をお勧めします：

- **[Analytics](https://vercel.com/analytics?utm_source=next-site&utm_campaign=nextjs-docs&utm_medium=docs):** アプリケーションのトラフィックを理解するのに役立つ組み込みの分析ダッシュボードで、一意の訪問者数、ページビュー数などを確認できます。
- **[Speed Insights](https://vercel.com/docs/speed-insights?utm_source=next-site&utm_campaign=nextjs-docs&utm_medium=docs):** 訪問者データに基づいた実際のパフォーマンス洞察を提供し、フィールドでのウェブサイトのパフォーマンスを現実的に把握できます。
- **[Logging](https://vercel.com/docs/observability/runtime-logs?utm_source=next-site&utm_campaign=nextjs-docs&utm_medium=docs):** ランタイムおよびアクティビティログにより、本番環境でアプリケーションのデバッグと監視を支援します。あるいは、[統合ページ](https://vercel.com/integrations?utm_source=next-site&utm_campaign=nextjs-docs&utm_medium=docs)を参照して、サードパーティのツールやサービスのリストを確認できます。

> **知っておくべきこと：**
>
> 詳細なウェブサイトパフォーマンス向上のための戦略を含む、Vercelでの本番環境展開に関するベストプラクティスの包括的な理解を得るには、[Vercel Production Checklist](https://vercel.com/docs/production-checklist?utm_source=next-site&utm_campaign=nextjs-docs&utm_medium=docs)を参照してください。

これらの推奨事項に従うことで、より高速で信頼性の高い、安全なアプリケーションをユーザーに提供できるようになります。
