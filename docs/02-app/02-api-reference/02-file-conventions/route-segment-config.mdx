---
title: 'Route Segment Config'
description: 'Next.jsのルートセグメントの設定方法を学びます。'
---

ルートセグメントオプションでは、以下の変数を直接エクスポートすることで、[Page](/docs/app/building-your-application/routing/layouts-and-templates)、[Layout](/docs/app/building-your-application/routing/layouts-and-templates)または[Route Handler](/docs/app/building-your-application/routing/route-handlers)の動作を設定できます：

| オプション                                | 型                                                                                                                          | デフォルト                |
| ------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------- | -------------------------- |
| [`experimental_ppr`](#experimental_ppr)    | `boolean`                                                                                                                   |
| [`dynamic`](#dynamic)                      | `'auto' \| 'force-dynamic' \| 'error' \| 'force-static'`                                                                    | `'auto'`                   |
| [`dynamicParams`](#dynamicparams)          | `boolean`                                                                                                                   | `true`                     |
| [`revalidate`](#revalidate)                | `false \| 0 \| number`                                                                                                      | `false`                    |
| [`fetchCache`](#fetchcache)                | `'auto' \| 'default-cache' \| 'only-cache' \| 'force-cache' \| 'force-no-store' \| 'default-no-store' \| 'only-no-store'`   | `'auto'`                   |
| [`runtime`](#runtime)                      | `'nodejs' \| 'edge'`                                                                                                        | `'nodejs'`                 |
| [`preferredRegion`](#preferredregion)      | `'auto' \| 'global' \| 'home' \| string \| string[]`                                                                        | `'auto'`                   |
| [`maxDuration`](#maxduration)              | `number`                                                                                                                    | デプロイプラットフォームによる設定 |

## オプション

### `experimental_ppr`

[Partial Prerendering (PPR)](/docs/app/building-your-application/rendering/partial-prerendering)をレイアウトやページで有効にします。

```tsx filename="layout.tsx | page.tsx " switcher
export const experimental_ppr = true
// true | false
```

```jsx filename="layout.js | page.js " switcher
export const experimental_ppr = true
// true | false
```

### `dynamic`

レイアウトやページの動的動作を完全に静的または完全に動的に変更します。

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const dynamic = 'auto'
// 'auto' | 'force-dynamic' | 'error' | 'force-static'
```

```js filename="layout.js | page.js | route.js" switcher
export const dynamic = 'auto'
// 'auto' | 'force-dynamic' | 'error' | 'force-static'
```

> **Good to know**: `app`ディレクトリの新しいモデルでは、`pages`ディレクトリのページレベルでの`getServerSideProps`や`getStaticProps`のすべてまたは無のモデルではなく、`fetch`リクエストレベルでの細かなキャッシュ制御が優先されます。`dynamic`オプションは、以前のモデルに便利に戻る方法であり、移行を簡単にします。

- **`'auto'`** (デフォルト) ： できるだけキャッシュし、どのコンポーネントも動的な動作にオプトインできるようにします。
- **`'force-dynamic'`**： [動的レンダリング](/docs/app/building-your-application/rendering/server-components#dynamic-rendering)を強制し、各ユーザーのリクエスト時にルートがレンダリングされます。このオプションは以下と同等です：

  - `pages`ディレクトリの`getServerSideProps()`
  - レイアウトやページでの各`fetch()`リクエストのオプションを`{ cache: 'no-store', next: { revalidate: 0 } }`に設定
  - セグメント設定で`export const fetchCache = 'force-no-store'`を設定

- **`'error'`**： 静的レンダリングを強制し、[Dynamic APIs](/docs/app/building-your-application/rendering/server-components#dynamic-apis)またはキャッシュされていないデータを使用するコンポーネントがある場合にエラーを発生させることで、レイアウトやページのデータをキャッシュします。このオプションは以下と同等です：
  - `pages`ディレクトリの`getStaticProps()`
  - レイアウトやページでの各`fetch()`リクエストのオプションを`{ cache: 'force-cache' }`に設定
  - セグメント設定で`fetchCache = 'only-cache', dynamicParams = false`を設定
  - `dynamic = 'error'`は`dynamicParams`のデフォルトを`true`から`false`に変更します。動的paramsで生成されない動的paramsのページを動的にレンダリングするには、手動で`dynamicParams = true`を設定することで元に戻せます。
- **`'force-static'`**： 静的レンダリングを強制し、[`cookies`](/docs/app/api-reference/functions/cookies)、[`headers()`](/docs/app/api-reference/functions/headers)および[`useSearchParams()`](/docs/app/api-reference/functions/use-search-params)を強制的に空の値を返すことでレイアウトやページのデータをキャッシュします。

> **Good to know**:
>
> - `getServerSideProps`と`getStaticProps`から`dynamic: 'force-dynamic'`および`dynamic: 'error'`への[移行方法の手順](/docs/app/building-your-application/upgrading/app-router-migration#step-6-migrating-data-fetching-methods)に関する説明は、[アップグレードガイド](/docs/app/building-your-application/upgrading/app-router-migration#step-6-migrating-data-fetching-methods)にあります。

### `dynamicParams`

[generateStaticParams](/docs/app/api-reference/functions/generate-static-params)で生成されなかったdynamic route segmentが訪問されたときの動作を制御します。

```tsx filename="layout.tsx | page.tsx" switcher
export const dynamicParams = true // true | false,
```

```js filename="layout.js | page.js | route.js" switcher
export const dynamicParams = true // true | false,
```

- **`true`** (デフォルト)： `generateStaticParams`に含まれない動的セグメントはオンデマンドで生成されます。
- **`false`**： `generateStaticParams`に含まれない動的セグメントは404を返します。

> **Good to know**:
>
> - このオプションは、`pages`ディレクトリの`getStaticPaths`の`fallback: true | false | blocking`オプションを置き換えます。
> - すべてのパスを訪問された際に静的にレンダリングするには、`generateStaticParams`に空の配列を返すか、`export const dynamic = 'force-static'`を利用する必要があります。
> - `dynamicParams = true`の場合、セグメントは[Streaming Server Rendering](/docs/app/building-your-application/routing/loading-ui-and-streaming#streaming-with-suspense)を使用します。
> - `dynamic = 'error'`および`dynamic = 'force-static'`が使用されると、`dynamicParams`のデフォルトは`false`になります。

### `revalidate`

レイアウトやページのデフォルトの再検証時間を設定します。このオプションは、個別の`fetch`リクエストによって設定された`revalidate`値を上書きしません。

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const revalidate = false
// false | 0 | number
```

```js filename="layout.js | page.js | route.js" switcher
export const revalidate = false
// false | 0 | number
```

- **`false`** (デフォルト)： `fetch`リクエストがその`cache`オプションを`'force-cache'`に設定するか、[Dynamic API](/docs/app/building-your-application/rendering/server-components#server-rendering-strategies#dynamic-apis)が使用される前に発見されたときにキャッシュするためのデフォルトのヒューリスティックです。セマンティックには`revalidate: Infinity`と等しく、リソースを無期限にキャッシュすることを意味します。それでも、個別の`fetch`リクエストが`cache: 'no-store'`または`revalidate: 0`を使用してキャッシュされないようにして、ルートを動的にレンダリングすることができます。または、ルートのデフォルトより小さい正の数に`revalidate`を設定して、ルートの再検証頻度を増やすことができます。
- **`0`**： Dynamic APIsやキャッシュされていないデータフェッチが発見されなくても、レイアウトやページが常に[動的にレンダリング](/docs/app/building-your-application/rendering/server-components#dynamic-rendering)されることを保証します。このオプションは`cache`オプションを持たない`fetch`リクエストのデフォルトを`'no-store'`に変更しますが、`fetch`リクエストが`'force-cache'`にオプトインするか正の`revalidate`を使用するとそのままです。
- **`number`**：（秒単位）レイアウトやページのデフォルトの再検証頻度を`n`秒に設定します。

> **Good to know**:
>
> - `revalidate`の値は静的に分析可能である必要があります。たとえば、`revalidate = 600`は有効ですが、`revalidate = 60 * 10`は無効です。
> - `runtime = 'edge'`を使用する場合、`revalidate`の値は利用できません。
> - 開発時には、ページは_常に_オンデマンドでレンダリングされ、キャッシュされることはありません。これにより、変更をすぐに確認でき、再検証期間を待つ必要がありません。

#### Revalidation Frequency

- 単一ルートの各レイアウトとページの`revalidate`の最小値が_ルート全体_の再検証頻度を決定します。これにより、子ページが親レイアウトと同じ頻度で再検証されることが保証されます。
- 個別の`fetch`リクエストはルートのデフォルト`revalidate`より低い`revalidate`を設定して、ルート全体の再検証頻度を増やすことができます。これにより、特定の基準に基づいて、特定のルートのより頻繁な再検証に動的にオプトインすることができます。

### `fetchCache`

<details>
  <summary>これはデフォルトの動作を上書きする必要がある場合にのみ使用するべき高度なオプションです。</summary>

デフォルトでは、Next.jsは、[Dynamic APIs](/docs/app/building-your-application/rendering/server-components#server-rendering-strategies#dynamic-apis)が使用される**前に**到達可能な`fetch()`リクエストを**キャッシュし**、Dynamic APIsの後に見つかった`fetch`リクエストは**キャッシュしません**。

`fetchCache`は、レイアウトやページ内のすべての`fetch`リクエストのデフォルトの`cache`オプションをオーバーライドすることができます。

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const fetchCache = 'auto'
// 'auto' | 'default-cache' | 'only-cache'
// 'force-cache' | 'force-no-store' | 'default-no-store' | 'only-no-store'
```

```js filename="layout.js | page.js | route.js" switcher
export const fetchCache = 'auto'
// 'auto' | 'default-cache' | 'only-cache'
// 'force-cache' | 'force-no-store' | 'default-no-store' | 'only-no-store'
```

- **`'auto'`** (デフォルト)： Dynamic APIsの前に`fetch`リクエストの`cache`オプションを使用してキャッシュし、Dynamic APIsの後の`fetch`リクエストはキャッシュしません。
- **`'default-cache'`**： `fetch`に任意の`cache`オプションを渡すことができますが、オプションが指定されていない場合は`cache`オプションを`'force-cache'`に設定します。これにより、Dynamic APIsの後の`fetch`リクエストも静的と見なされます。
- **`'only-cache'`**： すべての`fetch`リクエストがキャッシュにオプトインすることを保証するため、デフォルトを`cache: 'force-cache'`に変更し、`fetch`リクエストが`cache: 'no-store'`を使用した場合にエラーを発生させます。
- **`'force-cache'`**： すべての`fetch`リクエストがキャッシュにオプトインすることを保証し、すべての`fetch`リクエストの`cache`オプションを`'force-cache'`に設定します。
- **`'default-no-store'`**： `fetch`に任意の`cache`オプションを渡すことができますが、オプションが指定されていない場合は`cache`オプションを`'no-store'`に設定します。これにより、Dynamic APIsの前の`fetch`リクエストも動的と見なされます。
- **`'only-no-store'`**： すべての`fetch`リクエストがキャッシュからオプトアウトすることを保証し、デフォルトを`cache: 'no-store'`に変更し、`fetch`リクエストが`cache: 'force-cache'`を使用した場合にエラーを発生させます。
- **`'force-no-store'`**： すべての`fetch`リクエストがキャッシュからオプトアウトすることを保証し、すべての`fetch`リクエストの`cache`オプションを`'no-store'`に設定します。これにより、すべての`fetch`リクエストが`'force-cache'`オプションを提供していても、毎リクエスト再フェッチされます。

#### クロスルートセグメントの動作

- 単一ルートの各レイアウトとページに設定されたオプションは互換性がある必要があります。
  - `'only-cache'`と`'force-cache'`の両方が提供されている場合、`'force-cache'`が勝ちます。`'only-no-store'`と`'force-no-store'`の両方が提供されている場合、`'force-no-store'`が勝ちます。`'force'`オプションはルート全体の動作を変更するので、`'force-*'`を持つ単一のセグメントは`'only-*'`によって引き起こされるエラーを防止します。
  - `'only-*'`および`'force-*'`オプションの意図は、ルート全体を完全に静的または完全に動的にすることを保証することです。このため以下が許可されていません：
    - 単一のルート内での`'only-cache'`と`'only-no-store'`の組み合わせ
    - 単一のルート内での`'force-cache'`と`'force-no-store'`の組み合わせ
  - 親は子が`'auto'`または`'*-cache'`を提供する場合、`'default-no-store'`を提供することはできません。それは同じフェッチに異なる動作をもたらす可能性があるためです。
- 一般的に、共有親レイアウトを`'auto'`として共有し、子セグメントが分岐するときにオプションをカスタマイズすることをお勧めします。

</details>

### `runtime`

アプリケーションをレンダリングするためにNode.jsランタイムを使用し、Middlewareに対してはEdgeランタイムを使用することをお勧めします（唯一サポートされているオプション）。

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const runtime = 'nodejs'
// 'nodejs' | 'edge'
```

```js filename="layout.js | page.js | route.js" switcher
export const runtime = 'nodejs'
// 'nodejs' | 'edge'
```

- **`'nodejs'`** (デフォルト)
- **`'edge'`**

異なるランタイムについての詳細は、[異なるランタイムを学ぶ](/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes)を参照してください。

### `preferredRegion`

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const preferredRegion = 'auto'
// 'auto' | 'global' | 'home' | ['iad1', 'sfo1']
```

```js filename="layout.js | page.js | route.js" switcher
export const preferredRegion = 'auto'
// 'auto' | 'global' | 'home' | ['iad1', 'sfo1']
```

`preferredRegion`およびサポートされる地域は、デプロイプラットフォームによって異なります。

> **Good to know**:
>
> - `preferredRegion`が指定されていない場合、それは最も近い親レイアウトのオプションを継承します。
> - root レイアウトはデフォルトで`すべての`地域になります。

### `maxDuration`

デフォルトでは、Next.jsはサーバーサイドロジックの実行（ページのレンダリングやAPIの処理）を制限しません。デプロイプラットフォームは、Next.jsのビルド出力から`maxDuration`を使用して特定の実行制限を追加できます。たとえば、[Vercel](https://vercel.com/docs/functions/serverless-functions/runtimes#max-duration)上で。

**注**：この設定にはNext.js `13.4.10`以上が必要です。

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const maxDuration = 5
```

```js filename="layout.js | page.js | route.js" switcher
export const maxDuration = 5
```

> **Good to know**:
>
> - [Server Actions](/docs/app/building-your-application/data-fetching/server-actions-and-mutations)を使用する場合は、ページレベルで`maxDuration`を設定して、ページ上で使用されるすべてのServer Actionsのデフォルトのタイムアウトを変更します。

### `generateStaticParams`

`generateStaticParams`関数は、[dynamic route segments](/docs/app/building-your-application/routing/dynamic-routes)と組み合わせて使用され、リクエスト時にオンデマンドで生成するのではなく、ビルド時に静的に生成されるルートセグメントパラメーターのリストを定義できます。

詳細は[APIリファレンス](/docs/app/api-reference/functions/generate-static-params)をご覧ください。

## バージョン履歴

| バージョン       |                                                                                                                                                                                                                                   |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `v15.0.0-RC`     | `export const runtime = "experimental-edge"`は廃止されました。[コーデモッド](/docs/app/building-your-application/upgrading/codemods#transform-app-router-route-segment-config-runtime-value-from-experimental-edge-to-edge)が利用可能です。 |