---
title: ルートセグメント設定
description: Next.jsのルートセグメントのオプション設定方法について学びましょう。
---

ルートセグメントオプションを使用すると、次の変数を直接エクスポートすることで、[ページ](/docs/app/building-your-application/routing/layouts-and-templates)、[レイアウト](/docs/app/building-your-application/routing/layouts-and-templates)、または[ルートハンドラー](/docs/app/building-your-application/routing/route-handlers)の動作を設定できます；

| オプション                             | タイプ                                                                                                                   | デフォルト                 |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------ | -------------------------- |
| [`experimental_ppr`](#experimental_ppr) | `boolean`                                                                                                                 |
| [`dynamic`](#dynamic)                 | `'auto' \| 'force-dynamic' \| 'error' \| 'force-static'`                                                                  | `'auto'`                   |
| [`dynamicParams`](#dynamicparams)     | `boolean`                                                                                                                 | `true`                     |
| [`revalidate`](#revalidate)           | `false \| 0 \| number`                                                                                                    | `false`                    |
| [`fetchCache`](#fetchcache)           | `'auto' \| 'default-cache' \| 'only-cache' \| 'force-cache' \| 'force-no-store' \| 'default-no-store' \| 'only-no-store'` | `'auto'`                   |
| [`runtime`](#runtime)                 | `'nodejs' \| 'edge'`                                                                                                      | `'nodejs'`                 |
| [`preferredRegion`](#preferredregion) | `'auto' \| 'global' \| 'home' \| string \| string[]`                                                                      | `'auto'`                   |
| [`maxDuration`](#maxduration)         | `number`                                                                                                                  | デプロイプラットフォームで設定 |

## オプション

### `experimental_ppr`

レイアウトまたはページに対して[部分プリレンダリング（PPR）](/docs/app/building-your-application/rendering/partial-prerendering)を有効にします。

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx " switcher
export const experimental_ppr = true
// true | false
```
</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="layout.js | page.js " switcher
export const experimental_ppr = true
// true | false
```
</TabItem>
</Tabs>


### `dynamic`

レイアウトまたはページの動的な動作を完全に静的または完全に動的に変更します。

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx | route.ts" switcher
export const dynamic = 'auto'
// 'auto' | 'force-dynamic' | 'error' | 'force-static'
```
</TabItem>
<TabItem value="js" label="JavaScript">

```js title="layout.js | page.js | route.js" switcher
export const dynamic = 'auto'
// 'auto' | 'force-dynamic' | 'error' | 'force-static'
```
</TabItem>
</Tabs>


> **Good to know**: `app`ディレクトリの新しいモデルは、`pages`ディレクトリの`getServerSideProps`と`getStaticProps`のページレベルのバイナリ全体または何もなしのモデルよりも、`fetch`リクエストレベルでの粒度のあるキャッシング制御を優先します； `dynamic`オプションは、従来のモデルに便利に戻る方法であり、より簡単な移行パスを提供します；

- **`'auto'`**（デフォルト）：動的動作を選択するいずれかのコンポーネントを妨げることなく、できるだけ多くのキャッシュを保持するためのデフォルトオプションです
- **`'force-dynamic'`**：リクエスト時にユーザーごとにルートがレンダリングされる[動的レンダリング](/docs/app/building-your-application/rendering/server-components#dynamic-rendering)を強制します；このオプションは次と同等です：

  - `pages`ディレクトリの`getServerSideProps()`です
  - レイアウトまたはページ内のすべての`fetch()`リクエストのオプションを`{ cache: 'no-store', next: { revalidate: 0 } }`に設定します
  - セグメント設定を`export const fetchCache = 'force-no-store'`に設定します

- **`'error'`**：静的レンダリングを強制し、[動的関数](/docs/app/building-your-application/rendering/server-components#dynamic-functions)またはキャッシュされていないデータを使用するコンポーネントがあるとエラーを発生させ、レイアウトまたはページのデータをキャッシュします；このオプションは次と同等です：
  - `pages`ディレクトリの`getStaticProps()`です
  - レイアウトまたはページ内のすべての`fetch()`リクエストのオプションを`{ cache: 'force-cache' }`に設定します
  - セグメント設定を`fetchCache = 'only-cache', dynamicParams = false`に設定します
  - `dynamic = 'error'`は`dynamicParams`のデフォルトを`true`から`false`に変更します；`generateStaticParams`によって生成されない動的パラメータのページを動的にレンダリングするには、手動で`dynamicParams = true`を設定して再度動的にレンダリングすることができます；
- **`'force-static'`**：静的レンダリングを強制し、[`cookies()`](/docs/app/api-reference/functions/cookies)、[`headers()`](/docs/app/api-reference/functions/headers)、[`useSearchParams()`](/docs/app/api-reference/functions/use-search-params)を空の値に強制します；

> **Good to know**:
>
> - `getServerSideProps`および`getStaticProps`から`dynamic: 'force-dynamic'`および`dynamic: 'error'`への[移行方法](/docs/app/building-your-application/upgrading/app-router-migration#step-6-migrating-data-fetching-methods)についての指示は、[アップグレードガイド](/docs/app/building-your-application/upgrading/app-router-migration#step-6-migrating-data-fetching-methods)にあります；

### `dynamicParams`

[generateStaticParams](/docs/app/api-reference/functions/generate-static-params)で生成されていない動的セグメントが訪問されたときの動作を制御します；

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx" switcher
export const dynamicParams = true // true | false,
```
</TabItem>
</Tabs>
<Tabs>
<TabItem value="js" label="JavaScript">

```js title="layout.js | page.js | route.js" switcher
export const dynamicParams = true // true | false,
```
</TabItem>
</Tabs>


- **`true`**（デフォルト）：`generateStaticParams`に含まれていない動的セグメントは、オンデマンドで生成されます
- **`false`**：`generateStaticParams`に含まれていない動的セグメントは404を返します

> **Good to know**:
>
> - このオプションは、`pages`ディレクトリの`getStaticPaths`の`fallback: true | false | blocking`オプションの代わりになります；
> - 訪問したすべてのパスを最初に静的にレンダリングするには、`generateStaticParams`で空の配列を返すか、`export const dynamic = 'force-static'`を使用する必要があります；
> - `dynamicParams = true`のとき、セグメントは[ストリーミングサーバーレンダリング](/docs/app/building-your-application/routing/loading-ui-and-streaming#streaming-with-suspense)を使用します；
> - `dynamic = 'error'`および`dynamic = 'force-static'`が使用されている場合、`dynamicParams`のデフォルトは`false`に変更されます；

### `revalidate`

レイアウトまたはページのデフォルトの再検証時間を設定します；このオプションは、個々の`fetch`リクエストで設定された`revalidate`値を上書きしません；

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx | route.ts" switcher
export const revalidate = false
// false | 0 | number
```
</TabItem>
<TabItem value="js" label="JavaScript">

```js title="layout.js | page.js | route.js" switcher
export const revalidate = false
// false | 0 | number
```
</TabItem>
</Tabs>


- **`false`**（デフォルト）：`cache`オプションを`'force-cache'`に設定した`fetch`リクエストや、[動的関数](/docs/app/building-your-application/rendering/server-components#server-rendering-strategies#dynamic-functions)が使用される前に発見された`fetch`リクエストをキャッシュするためのデフォルトヒューリスティックです;　これは`revalidate: Infinity`と同義であり、リソースは無期限にキャッシュされるべきことを意味します；個々の`fetch`リクエストはキャッシュを避けるために`cache: 'no-store'`または`revalidate: 0`を使用してルートを動的にレンダリングさせることができます；またはルートのデフォルトより低い正の数で`revalidate`を設定してルートの再検証頻度を増やすことができます；
- **`0`**：動的関数やキャッシュされていないデータフェッチが発見されていなくても、レイアウトまたはページが常に[動的にレンダリング](/docs/app/building-your-application/rendering/server-components#dynamic-rendering)されるようにします；このオプションは`cache`オプションを設定していない`fetch`リクエストのデフォルトを`'no-store'`に変更しますが、`'force-cache'`を選択した`fetch`リクエストや正の`revalidate`を使用するものはそのままにします；
- **`number`**： レイアウトまたはページのデフォルトの再検証頻度を`n`秒に設定します

> **Good to know**:
>
> - `revalidate`値は静的に解析可能である必要があります；例えば`revalidate = 600`は有効ですが、`revalidate = 60 * 10`は無効です；
> - `runtime = 'edge'`を使用する場合、`revalidate`値は使用できません；
> - 開発環境では、ページは常にオンデマンドでレンダリングされ、決してキャッシュされません；これにより、再検証期間を待つことなく、すぐに変更を見ることができます；

#### 再検証頻度

- 単一ルートの各レイアウトおよびページにわたる最小の`revalidate`は、ルート全体の再検証頻度を決定します；これにより、子ページは親レイアウトと同じ頻度で再検証されます；
- 個々の`fetch`リクエストは、ルートのデフォルト`revalidate`よりも低い`revalidate`を設定して、ルート全体の再検証頻度を増やすことができます；これにより、特定の基準に基づいて、特定のルートでより頻繁な再検証を動的に選択できます；

### `fetchCache`

<details>
  <summary>これは、デフォルトの動作を特にオーバーライドする必要がある場合にのみ使用されるべき高度なオプションです。</summary>

デフォルトでは、Next.jsは動的関数が使用される**前**の`fetch()`リクエストをキャッシュし、動的関数が使用された**後**の`fetch`リクエストはキャッシュしません；

`fetchCache`を使用すると、レイアウトまたはページ内のすべての`fetch`リクエストのデフォルト`cache`オプションをオーバーライドできます；

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx | route.ts" switcher
export const fetchCache = 'auto'
// 'auto' | 'default-cache' | 'only-cache'
// 'force-cache' | 'force-no-store' | 'default-no-store' | 'only-no-store'
```
</TabItem>
<TabItem value="js" label="JavaScript">

```js title="layout.js | page.js | route.js" switcher
export const fetchCache = 'auto'
// 'auto' | 'default-cache' | 'only-cache'
// 'force-cache' | 'force-no-store' | 'default-no-store' | 'only-no-store'
```
</TabItem>
</Tabs>


- **`'auto'`**（デフォルト）：動的関数の前の`fetch`リクエストが提供する`cache`オプションでキャッシュし、動的関数の後の`fetch`リクエストはキャッシュしないデフォルトオプションです；
- **`'default-cache'`**：キャッシュオプションを`fetch`に渡すことを許可しますが、オプションが提供されていない場合、キャッシュオプションを`'force-cache'`に設定します；これにより、動的関数の後の`fetch`リクエストも静的と見なされます；
- **`'only-cache'`**：オプションが提供されていない場合、デフォルトを`cache: 'force-cache'`に変更し、`cache: 'no-store'`を使用する`fetch`リクエストにエラーを発生させることで、すべての`fetch`リクエストがキャッシュを選択することを保証します；
- **`'force-cache'`**：すべての`fetch`リクエストがキャッシュを選択することを保証するため、すべての`fetch`リクエストのキャッシュオプションを`'force-cache'`に設定します；
- **`'default-no-store'`**：キャッシュオプションを`fetch`に渡すことを許可しますが、オプションが提供されていない場合、キャッシュオプションを`'no-store'`に設定します；これにより、動的関数の前の`fetch`リクエストも動的と見なされます；
- **`'only-no-store'`**：オプションが提供されていない場合、デフォルトを`cache: 'no-store'`に変更し、`cache: 'force-cache'`を使用する`fetch`リクエストにエラーを発生させることで、すべての`fetch`リクエストがキャッシュを選択しないことを保証します；
- **`'force-no-store'`**：すべての`fetch`リクエストがキャッシュを選択しないことを保証するため、すべての`fetch`リクエストのキャッシュオプションを`'no-store'`に設定します；これにより、すべての`fetch`リクエストは、`'force-cache'`オプションを提供する場合でも、リクエストごとに再フェッチされます；

#### 跨ルートセグメント動作

- 単一ルートの各レイアウトおよびページに設定されるオプションは互換性がある必要があります；
  - `'only-cache'`と`'force-cache'`の両方が提供されている場合、`'force-cache'`が優先されます；`'only-no-store'`と`'force-no-store'`の両方が提供されている場合、`'force-no-store'`が優先されます；forceオプションはルート全体の動作を変更するため、`'force-*'`を持つ単一のセグメントが`'only-*'`によって引き起こされるエラーを防ぎます；
  - `'only-*'`および`'force-*'`オプションの意図は、ルート全体が完全に静的または完全に動的であることを保証することです；つまり：
    - 単一のルートで`'only-cache'`と`'only-no-store'`の組み合わせは許可されません；
    - 単一のルートで`'force-cache'`と`'force-no-store'`の組み合わせは許可されません；
  - 親は、子が`'auto'`または`'*-cache'`を提供している場合、`'default-no-store'`を提供することはできません；これにより、同じフェッチが異なる動作をする可能性があります；
- 一般的には、共有される親のレイアウトをそのまま`'auto'`として残し、子セグメントが分岐する場所でオプションをカスタマイズすることが推奨されます；

</details>

### `runtime`

アプリケーションのレンダリングにはNode.jsランタイムを使用し、ミドルウェアにはEdgeランタイムを使用することをお勧めします（唯一サポートされているオプションです）；

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx | route.ts" switcher
export const runtime = 'nodejs'
// 'nodejs' | 'edge'
```
</TabItem>
<TabItem value="js" label="JavaScript">

```js title="layout.js | page.js | route.js" switcher
export const runtime = 'nodejs'
// 'nodejs' | 'edge'
```
</TabItem>
</Tabs>


- **`'nodejs'`**（デフォルト）
- **`'edge'`**

[さまざまなランタイム](/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes)について詳しく学んでください。

### `preferredRegion`

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx | route.ts" switcher
export const preferredRegion = 'auto'
// 'auto' | 'global' | 'home' | ['iad1', 'sfo1']
```
</TabItem>
<TabItem value="js" label="JavaScript">

```js title="layout.js | page.js | route.js" switcher
export const preferredRegion = 'auto'
// 'auto' | 'global' | 'home' | ['iad1', 'sfo1']
```
</TabItem>
</Tabs>


`preferredRegion`のサポートおよびサポートされるリージョンは、デプロイプラットフォームに依存しています；

> **Good to know**:
>
> - `preferredRegion`が指定されていない場合、最も近い親レイアウトのオプションを継承します；
> - ルートレイアウトはデフォルトで`all`リージョンになっています；

### `maxDuration`

デフォルトで、Next.jsはサーバーサイドロジック（ページのレンダリングやAPIの処理）の実行を制限しません；デプロイプラットフォームは、Next.jsビルド出力から`maxDuration`を使用して特定の実行制限を追加できます；たとえば、[Vercel](https://vercel.com/docs/functions/serverless-functions/runtimes#max-duration)での例です；

**注**：この設定にはNext.js `13.4.10`以上が必要です；

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="layout.tsx | page.tsx | route.ts" switcher
export const maxDuration = 5
```
</TabItem>
<TabItem value="js" label="JavaScript">

```js title="layout.js | page.js | route.js" switcher
export const maxDuration = 5
```
</TabItem>
</Tabs>


> **Good to know**:
>
> - [サーバーアクション](/docs/app/building-your-application/data-fetching/server-actions-and-mutations)を使用する場合、ページレベルで`maxDuration`を設定して、ページで使用されるすべてのサーバーアクションのデフォルトタイムアウトを変更します；

### `generateStaticParams`

`generateStaticParams`関数は、[動的ルートセグメント](/docs/app/building-your-application/routing/dynamic-routes)と組み合わせて使用することができ、ビルド時に静的に生成されるルートセグメントパラメータのリストを定義します；リクエスト時にオンデマンドで生成する代わりに、ビルド時に静的に生成されるルートセグメントパラメータのリストを定義するために使用されます；

詳細については、[APIリファレンス](/docs/app/api-reference/functions/generate-static-params)を参照してください；