---
title: 'カスタム Webpack コンフィグ'
nav_title: 'webpack'
description: 'Next.js で使用される webpack コンフィグをカスタマイズする方法を学びましょう'
---

{/* このドキュメントの内容は、app と pages router の間で共有されています。Pages Router に特化したコンテンツを追加するには、 `<PagesOnly>Content</PagesOnly>` コンポーネントを使用できます。共有されるコンテンツはコンポーネントでラップしないでください。 */}

> **覚えておくとよいこと**: webpack コンフィグへの変更はセマンティックバージョニング（semver）でカバーされていないため、自己責任で進めてください；

カスタム webpack コンフィグをアプリケーションに追加する前に、Next.js がすでにあなたのユースケースに対応していないか確認してください：

<AppOnly>

- [CSS imports](/docs/app/building-your-application/styling/css)
- [CSS modules](/docs/app/building-your-application/styling/css#css-modules)
- [Sass/SCSS imports](/docs/app/building-your-application/styling/sass)
- [Sass/SCSS modules](/docs/app/building-your-application/styling/sass)

</AppOnly>

<PagesOnly>

- [CSS imports](https://nextjs.org/docs/canary/pages/building-your-application/styling)
- [CSS modules](https://nextjs.org/docs/canary/pages/building-your-application/styling/css)
- [Sass/SCSS imports](https://nextjs.org/docs/canary/pages/building-your-application/styling/sass)
- [Sass/SCSS modules](https://nextjs.org/docs/canary/pages/building-your-application/styling/sass)
- [カスタム babel コンフィグをカスタマイズする](https://nextjs.org/docs/canary/pages/building-your-application/configuring/babel)

</PagesOnly>

よく求められる機能のいくつかは、プラグインとして利用可能です：

- [@next/mdx](https://github.com/vercel/next.js/tree/canary/packages/next-mdx)
- [@next/bundle-analyzer](https://github.com/vercel/next.js/tree/canary/packages/next-bundle-analyzer)

`webpack` の利用を拡張するためには、`next.config.js` 内でそのコンフィグを拡張する関数を次のように定義できます：

```js title="next.config.js"
module.exports = {
  webpack: (
    config,
    { buildId, dev, isServer, defaultLoaders, nextRuntime, webpack }
  ) => {
    // 重要: 修正されたコンフィグを返すこと
    return config
  },
}
```

> `webpack` 関数は3回実行されます；2回はサーバー（nodejs / edge runtime）のため、1回はクライアントのためです。これは、`isServer` プロパティを使用してクライアントとサーバーのコンフィグを区別することを可能にします。

`webpack` 関数の2番目の引数は次のプロパティを持つオブジェクトです：

- `buildId`: `String` - ビルド間での一意の識別子として使用されるビルドID；
- `dev`: `Boolean` - コンパイルが開発中に行われるかどうかを示します；
- `isServer`: `Boolean` - サーバーサイドコンパイルの場合は `true`、クライアントサイドコンパイルの場合は `false`；
- `nextRuntime`: `String | undefined` - サーバーサイドコンパイルのターゲットランタイム；`"edge"` または `"nodejs"` のいずれかであり、クライアントサイドコンパイルのためには `undefined` です；
- `defaultLoaders`: `Object` - Next.js によって内部的に使用されるデフォルトのローダー：
  - `babel`: `Object` - デフォルトの `babel-loader` コンフィグ；

`defaultLoaders.babel` の使用例：

```js
// babel-loader に依存するローダーを追加するための例のコンフィグ
// このソースコードは @next/mdx プラグインのソースから取得されたものです：
// https://github.com/vercel/next.js/tree/canary/packages/next-mdx
module.exports = {
  webpack: (config, options) => {
    config.module.rules.push({
      test: /\.mdx/,
      use: [
        options.defaultLoaders.babel,
        {
          loader: '@mdx-js/loader',
          options: pluginOptions.options,
        },
      ],
    })

    return config
  },
}
```

#### `nextRuntime` {#nextruntime}

`isServer` が `true` である場合、`nextRuntime` は `"edge"` または `"nodejs"` です；現時点で `nextRuntime` `"edge"` は edge runtime のみでミドルウェアおよび Server Components 用です；
