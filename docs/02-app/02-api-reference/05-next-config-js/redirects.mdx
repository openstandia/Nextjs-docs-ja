---
title: 'redirects'
description: 'Next.js アプリにリダイレクトを追加する。'
---

{/* このドキュメントの内容は、app router と pages router の両方で共有されます。Pages Router に特有のコンテンツを追加するには、`<PagesOnly>Content</PagesOnly>` コンポーネントを使用できます。共有コンテンツは、コンポーネントでラップしないでください。 */}

リダイレクトを使用すると、着信リクエストパスを別の宛先パスにリダイレクトできます。

リダイレクトを使用するには、`next.config.js` 内で `redirects` キーを使用します：

```js title="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/about',
        destination: '/',
        permanent: true,
      },
    ]
  },
}
```

`redirects` は非同期関数で、`source`、`destination`、および `permanent` プロパティを持つオブジェクトを保持する配列を返すことが求められます：

- `source` は、着信リクエストパスのパターンです
- `destination` は、ルートしたいパスです
- `permanent` は `true` または `false` - `true` の場合、クライアントや検索エンジンにリダイレクトを永続的にキャッシュすることを指示する 308 ステータスコードを使用し、`false` の場合、キャッシュされない一時的な 307 ステータスコードを使用します

> **なぜ Next.js は 307 と 308 を使用するのか？** 伝統的に、一時的なリダイレクトには 302 が使用され、恒久的なリダイレクトには 301 が使用されましたが、多くのブラウザがリダイレクトのリクエストメソッドを元のメソッドによらず `GET` に変更しました。例えば、ブラウザが `POST /v1/users` へのリクエストを行い、302 ステータスコードと `/v2/users` の location を返した場合、次回のリクエストは `POST /v2/users` ではなく `GET /v2/users` になるかもしれません。Next.js は、使用されたリクエストメソッドを明示的に保持するために、307 の一時的なリダイレクトと 308 の恒久的なリダイレクトのステータスコードを使用しています。

- `basePath`: `false` または `undefined` - false の場合、マッチング時に `basePath` が含まれません。外部リダイレクトにのみ使用されます。
- `locale`: `false` または `undefined` - ロケールがマッチング時に含まれないかどうか。
- `has` は、`type`、`key` および `value` プロパティを持つ [has オブジェクト](#header-cookie-and-query-matching) の配列です。
- `missing` は、`type`、`key` および `value` プロパティを持つ [missing オブジェクト](#header-cookie-and-query-matching) の配列です。

リダイレクトは、ファイルシステム（ページおよび `/public` ファイルを含む）よりも前にチェックされます。

Pages Router を使用する場合、[Middleware](/docs/app/building-your-application/routing/middleware) が存在してパスと一致しない限り、クライアント側ルーティング（`Link`、`router.push`）にはリダイレクトは適用されません。

リダイレクトが適用されると、リクエストで提供されたすべてのクエリ値がリダイレクトの宛先に渡されます。例えば、次のリダイレクト設定を見てみましょう：

```js
{
  source: '/old-blog/:path*',
  destination: '/blog/:path*',
  permanent: false
}
```

`/old-blog/post-1?hello=world` が要求された場合、クライアントは `/blog/post-1?hello=world` にリダイレクトされます。

## パスマッチング

パスマッチは許可されており、例えば `/old-blog/:slug` は `/old-blog/hello-world` にマッチします（ネストされたパスなし）：

```js title="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/old-blog/:slug',
        destination: '/news/:slug', // 一致したパラメータは宛先で使用できます
        permanent: true,
      },
    ]
  },
}
```

### ワイルドカードパスのマッチング

ワイルドカードパスをマッチさせるには、パラメータの後に `*` を使用します。例えば、`/blog/:slug*` は `/blog/a/b/c/d/hello-world` にマッチします：

```js title="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/blog/:slug*',
        destination: '/news/:slug*', // 一致したパラメータは宛先で使用できます
        permanent: true,
      },
    ]
  },
}
```

### 正規表現によるパスマッチング

正規表現によるパスマッチングをするには、パラメータの後にかっこで正規表現をラップします。例えば、`/post/:slug(\\d{1,})` は `/post/123` にマッチしますが `/post/abc` にはマッチしません：

```js title="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/post/:slug(\\d{1,})',
        destination: '/news/:slug', // 一致したパラメータは宛先で使用できます
        permanent: false,
      },
    ]
  },
}
```

次の文字 `(` `)` `{` `}` `:` `*` `+` `?` は正規表現のパスマッチングに使用されるため、それらを `source` 内に非特殊値として使用する場合は、先頭に `\\` を追加してエスケープする必要があります：

```js title="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        // この定義は `/english(default)/something` がリクエストされることにマッチします
        source: '/english\\(default\\)/:slug',
        destination: '/en-us/:slug',
        permanent: false,
      },
    ]
  },
}
```

## ヘッダー、Cookie、およびクエリのマッチング

リダイレクトがヘッダー、Cookie、またはクエリ値も `has` フィールドに一致する場合、または `missing` フィールドに一致しない場合にのみリダイレクトをマッチさせることができます。リダイレクトが適用されるためには、`source` とすべての `has` アイテムが一致し、すべての `missing` アイテムが一致しない必要があります。

`has` および `missing` アイテムには以下のフィールドがあります：

- `type`: `String` - `header`, `cookie`, `host`, または `query` のいずれかである必要があります
- `key`: `String` - マッチさせる選択したタイプのキー
- `value`: `String` または `undefined` - チェックする値。`undefined` の場合は任意の値が一致します。正規表現のような文字列を使用して値の特定の部分をキャプチャできます。例えば、値が `first-(?<paramName>.*)` の場合、`first-second` 用に `second` が宛先で `:paramName` として使用可能になります。

```js title="next.config.js"
module.exports = {
  async redirects() {
    return [
      // ヘッダー `x-redirect-me` が存在する場合
      // このリダイレクトが適用されます
      {
        source: '/:path((?!another-page$).*)',
        has: [
          {
            type: 'header',
            key: 'x-redirect-me',
          },
        ],
        permanent: false,
        destination: '/another-page',
      },
      // ヘッダー `x-dont-redirect` が存在する場合
      // このリダイレクトは適用されません
      {
        source: '/:path((?!another-page$).*)',
        missing: [
          {
            type: 'header',
            key: 'x-do-not-redirect',
          },
        ],
        permanent: false,
        destination: '/another-page',
      },
      // source、クエリ、および cookie が一致する場合
      // このリダイレクトが適用されます
      {
        source: '/specific/:path*',
        has: [
          {
            type: 'query',
            key: 'page',
            // ページの値は宛先で利用可能になりません
            // 値が提供されており、名前付きキャプチャグループが使用されていないためです
            // 例：(?(page>home))
            value: 'home',
          },
          {
            type: 'cookie',
            key: 'authorized',
            value: 'true',
          },
        ],
        permanent: false,
        destination: '/another/:path*',
      },
      // ヘッダー `x-authorized` が存在し
      // 一致する値が含まれている場合、このリダイレクトが適用されます
      {
        source: '/',
        has: [
          {
            type: 'header',
            key: 'x-authorized',
            value: '(?<authorized>yes|true)',
          },
        ],
        permanent: false,
        destination: '/home?authorized=:authorized',
      },
      // ホストが `example.com` の場合
      // このリダイレクトが適用されます
      {
        source: '/:path((?!another-page$).*)',
        has: [
          {
            type: 'host',
            value: 'example.com',
          },
        ],
        permanent: false,
        destination: '/another-page',
      },
    ]
  },
}
```

### basePath のサポートを伴うリダイレクト

リダイレクトで [`basePath` support](/docs/app/api-reference/next-config-js/basePath) を活用する場合、`source` および `destination` はそれぞれのリダイレクトに `basePath: false` を追加しない限り、自動的に `basePath` でプレフィックスされます：

```js title="next.config.js"
module.exports = {
  basePath: '/docs',

  async redirects() {
    return [
      {
        source: '/with-basePath', // 自動的に /docs/with-basePath になります
        destination: '/another', // 自動的に /docs/another になります
        permanent: false,
      },
      {
        // basePath: false が設定されているため /docs を追加しません
        source: '/without-basePath',
        destination: 'https://example.com',
        basePath: false,
        permanent: false,
      },
    ]
  },
}
```

### i18n サポートを伴うリダイレクト

<AppOnly>

リダイレクトで [`i18n` support](/docs/app/building-your-application/routing/internationalization) を活用する場合、`locale: false` をリダイレクトに追加しない限り、`source` および `destination` は指定された `locales` を処理するために自動的にプレフィックスされます。`locale: false` が使用される場合、適切に一致させるために、`source` および `destination` をロケールでプレフィックスする必要があります。

</AppOnly>

<PagesOnly>

リダイレクトで [`i18n` support](https://nextjs.org/docs/canary/pages/building-your-application/routing/internationalization) を活用する場合、`locale: false` をリダイレクトに追加しない限り、`source` および `destination` は指定された `locales` を処理するために自動的にプレフィックスされます。`locale: false` が使用される場合、適切に一致させるために、`source` および `destination` をロケールでプレフィックスする必要があります。

</PagesOnly>

```js title="next.config.js"
module.exports = {
  i18n: {
    locales: ['en', 'fr', 'de'],
    defaultLocale: 'en',
  },

  async redirects() {
    return [
      {
        source: '/with-locale', // すべてのロケールを自動的に処理します
        destination: '/another', // ロケールを自動的に渡します
        permanent: false,
      },
      {
        // locale: false が設定されているため、ロケールを自動的には処理しません
        source: '/nl/with-locale-manual',
        destination: '/nl/another',
        locale: false,
        permanent: false,
      },
      {
        // `en` が defaultLocale のため、`/` に一致します
        source: '/en',
        destination: '/en/another',
        locale: false,
        permanent: false,
      },
      // locale: false が設定されていても、すべてのロケールにマッチすることが可能です
      {
        source: '/:locale/page',
        destination: '/en/newpage',
        permanent: false,
        locale: false,
      },
      {
        // これは /(en|fr|de)/(.*) に変換されるため、トップレベルの `/` 或いは `/fr` ルートのように /:path* とは一致しません
        source: '/(.*)',
        destination: '/another',
        permanent: false,
      },
    ]
  },
}
```

まれに、古い HTTP クライアントが適切にリダイレクトを実行するためのカスタムステータスコードを割り当てる必要がある場合があります。このような場合、`permanent` プロパティの代わりに `statusCode` プロパティを使用できますが、両方を同時に使用することはできません。IE11 の互換性を確保するために、308 ステータスコードには `Refresh` ヘッダーが自動的に追加されます。

## その他のリダイレクト

- [API Routes](https://nextjs.org/docs/canary/pages/building-your-application/routing/api-routes) および [Route Handlers](/docs/app/building-your-application/routing/route-handlers) 内で、着信リクエストに基づいてリダイレクトできます。
- [`getStaticProps`](https://nextjs.org/docs/canary/pages/building-your-application/data-fetching/get-static-props) および [`getServerSideProps`](https://nextjs.org/docs/canary/pages/building-your-application/data-fetching/get-server-side-props) 内で、リクエスト時に特定のページをリダイレクトできます。

## バージョン履歴

| バージョン   | 変更点         |
| ----------- | --------------- |
| `v13.3.0` | `missing` 追加 |
| `v10.2.0` | `has` 追加     |
| `v9.5.0`  | `redirects` 追加 |
