---
title: assetPrefix
description: あなたのCDNを設定するためのassetPrefix設定オプションの使用方法を学びましょう。
---

{/* このドキュメントの内容は、アプリとページルーターの間で共有されています。`<PagesOnly>Content</PagesOnly>`コンポーネントを使用して、ページルーターに特化したコンテンツを追加できます。共有コンテンツはコンポーネントでラップしないでください。 */}

<AppOnly>

> **注意**: [Vercelへのデプロイ](/docs/app/building-your-application/deploying)は、Next.jsプロジェクトにグローバルCDNを自動的に設定します。
> 資産プレフィックスを手動で設定する必要はありません。

</AppOnly>

<PagesOnly>

> **注意**: [Vercelへのデプロイ](/docs/pages/building-your-application/deploying)は、Next.jsプロジェクトにグローバルCDNを自動的に設定します。
> 資産プレフィックスを手動で設定する必要はありません。

</PagesOnly>

> **Good to know**: Next.js 9.5+ではカスタマイズ可能な[Base Path](/docs/app/api-reference/next-config-js/basePath)のサポートが追加されました。これは、`/docs`のようにアプリケーションをサブパスにホストする際により適しています。
> この使用例ではカスタムアセットプレフィックスを使うことをおすすめしません。

## CDNの設定

[CDN](https://ja.wikipedia.org/wiki/Content_delivery_network)を設定するには、アセットプレフィックスを設定し、Next.jsがホストされているドメインに解決するようにCDNのオリジンを設定します。

`next.config.mjs`を開き、[フェーズ](/docs/app/api-reference/next-config-js#async-configuration)に基づいて`assetPrefix`設定を追加します：

```js title="next.config.mjs"
// @ts-check
import { PHASE_DEVELOPMENT_SERVER } from 'next/constants'

export default (phase) => {
  const isDev = phase === PHASE_DEVELOPMENT_SERVER
  /**
   * @type {import('next').NextConfig}
   */
  const nextConfig = {
    assetPrefix: isDev ? undefined : 'https://cdn.mydomain.com',
  }
  return nextConfig
}
```

Next.jsは、`/_next/`パス（`.next/static/`フォルダ）から読み込むJavaScriptとCSSファイルに対して、自動的にアセットプレフィックスを使用します。たとえば、上記の設定でのJSチャンクのリクエストは次のようになります：

```
/_next/static/chunks/4b9b41aaa062cbbfeff4add70f256968c51ece5d.4d708494b3aed70c04f0.js
```

これが次のように変わります：

```
https://cdn.mydomain.com/_next/static/chunks/4b9b41aaa062cbbfeff4add70f256968c51ece5d.4d708494b3aed70c04f0.js
```

特定のCDNにファイルをアップロードするための正確な設定は選択したCDNによります。CDNにホストする必要がある唯一のフォルダは、上記のURLリクエストが示すように`_next/static/`としてアップロードすべき`.next/static/`の内容です。そのため、**その他の`.next/`フォルダはアップロードしないでください**。サーバーコードや他の設定を一般に公開するべきではありません。

`assetPrefix`は`_next/static`へのリクエストをカバーしますが、以下のパスには影響を与えません：

<AppOnly>

- [public](/docs/app/building-your-application/optimizing/static-assets)フォルダ内のファイル；これらのアセットをCDN経由で提供したい場合は、プレフィックスを自分で追加する必要があります

</AppOnly>

<PagesOnly>

- [public](/docs/pages/building-your-application/optimizing/static-assets)フォルダ内のファイル；これらのアセットをCDN経由で提供したい場合は、プレフィックスを自分で追加する必要があります
- `getServerSideProps`ページへの`/_next/data/`リクエスト。これらのリクエストは常に静的でないため、メインドメインに対して行われます。
- `getStaticProps`ページへの`/_next/data/`リクエスト。これらのリクエストは、[Incremental Static Generation](/docs/pages/building-your-application/data-fetching/incremental-static-regeneration)をサポートするため、たとえ使用していない場合でも一貫性を保つためにメインドメインに対して行われます。

</PagesOnly>