---
title: 'カスタム Next.js キャッシュハンドラー'
nav_title: 'cacheHandler'
description: 'Redis、Memcached などの外部サービスを使用するために、データを保存および再検証する際に使用する Next.js のキャッシュを構成します。'
---

ページをキャッシュし再検証すること（Incremental Static Regeneration）には、同じ共有キャッシュを使用します。 [Vercelへデプロイする場合](https://vercel.com/docs/incremental-static-regeneration?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)、ISR キャッシュは自動的に永続ストレージに保存されます。

セルフホスティングする場合、ISR キャッシュは Next.js サーバーのファイルシステム（ディスク上）に保存されます。これは、PagesとApp Routerの両方を使用してセルフホスティングする際に自動的に動作します。

キャッシュされたページとデータを永続ストレージに保存するか、Next.js アプリケーションの複数のコンテナやインスタンス間でキャッシュを共有したい場合、Next.js のキャッシュ場所を構成できます。

```js title="next.config.js"
module.exports = {
  cacheHandler: require.resolve('./cache-handler.js'),
  cacheMaxMemorySize: 0, // デフォルトのメモリ内キャッシュを無効化
}
```

[カスタムキャッシュハンドラーの例](/docs/app/building-your-application/deploying#configuring-caching)を参照し、実装について詳しく学んでください。

## API リファレンス

キャッシュハンドラーは以下のメソッドを実装できます：`get`、`set`、および `revalidateTag`。

### `get()`

| パラメーター | 型       | 説明                  |
| ------------ | -------- | ------------------- |
| `key`        | `string` | キャッシュされた値のキーです。 |

キャッシュされた値を返すか、見つからない場合は `null` を返します。

### `set()`

| パラメーター | 型             | 説明                        |
| ------------ | -------------- | ------------------------- |
| `key`        | `string`       | データを保存するキーです。 |
| `data`       | Data or `null` | キャッシュするデータです。 |
| `ctx`        | `{ tags: [] }` | 提供されるキャッシュタグです。 |

`Promise<void>` を返します。

### `revalidateTag()`

| パラメーター | 型                     | 説明                       |
| ------------ | ---------------------- | ------------------------ |
| `tag`        | `string` or `string[]` | 再検証するキャッシュタグです。 |

`Promise<void>` を返します。[データの再検証について](/docs/app/building-your-application/data-fetching/incremental-static-regeneration) または [`revalidateTag()`](/docs/app/api-reference/functions/revalidateTag) 関数について詳しく学んでください。

**Good to know:**

- `revalidatePath` はキャッシュタグの上にある便利なレイヤです。`revalidatePath` を呼び出すと、`revalidateTag` 関数を呼び出し、パスに基づいてキャッシュキーにタグを付けたいかどうかを選択できます。

## バージョン履歴

| バージョン   | 変更内容                                             |
| ------------ | ---------------------------------------------------- |
| `v14.1.0`    | `cacheHandler` に名前を変更し、安定しました。         |
| `v13.4.0`    | `revalidateTag` のための `incrementalCacheHandlerPath` をサポート。 |
| `v13.4.0`    | スタンドアロン出力のための `incrementalCacheHandlerPath` をサポート。 |
| `v12.2.0`    | 実験的な `incrementalCacheHandlerPath` を追加。     |