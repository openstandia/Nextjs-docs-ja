---
title: 'unstable_cache'
description: 'unstable_cache 関数の API リファレンス。'
version: 'unstable'
---

> この API は将来のバージョンで廃止される予定です。バージョン15では、[`use cache`](/docs/app/api-reference/directives/use-cache) ディレクティブの使用を推奨します。

`unstable_cache` は、データベースクエリなどのコストの高い操作の結果をキャッシュし、複数のリクエストにわたって再利用することができます。

```jsx
import { getUser } from './data';
import { unstable_cache } from 'next/cache';

const getCachedUser = unstable_cache(
  async (id) => getUser(id),
  ['my-app-user']
);

export default async function Component({ userID }) {
  const user = await getCachedUser(userID);
  ...
}
```

> **Good to know**:
>
> - キャッシュスコープ内で `headers` や `cookies` などの動的データソースにアクセスすることはサポートされていません。キャッシュされた関数内でこれらのデータが必要な場合は、キャッシュされた関数の外で `headers` を使用し、必要な動的データを引数として渡してください。
> - この API は Next.js の組み込み [Data Cache](/docs/app/building-your-application/caching#data-cache) を使用して、リクエストとデプロイをまたいで結果を永続化します。

> **Warning**: この API は不安定であり、将来的に変更される可能性があります。この API が安定した際には、移行ドキュメントやコードモッドを提供する予定です。

## パラメータ {#parameters}

```jsx
const data = unstable_cache(fetchData, keyParts, options)()
```

- `fetchData`: これは、キャッシュしたいデータを取得する非同期関数です。`Promise` を返す関数でなければなりません。
- `keyParts`: これは、キャッシュに識別をさらに追加するキーの配列です。デフォルトでは、`unstable_cache` は既に引数と関数の文字列化バージョンをキャッシュキーとして使用しています。たいていの場合、これはオプションです；外部変数を引数として渡さずに使用する場合にのみ必要です。しかし、引数として渡さないクロージャを関数内で使用する場合、そのクロージャは追加することが重要です。
- `options`: これは、キャッシュの動作を制御するオブジェクトです。次のプロパティを含むことができます:
  - `tags`: キャッシュの無効化を制御するために使用できるタグの配列。Next.js はこれを関数の一意の識別には使用しません。
  - `revalidate`: キャッシュを再検証するまでの秒数。無期限または `revalidateTag()` や `revalidatePath()` メソッドが呼ばれるまでキャッシュしたい場合は、省略するか `false` を渡してください。

## 戻り値 {#returns}

`unstable_cache` は、呼び出されるとキャッシュされたデータに解決される Promise を返す関数を返します。データがキャッシュにない場合、指定された関数が呼び出され、その結果がキャッシュされて返されます。

## 例 {#example}

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/page.tsx" switcher
import { unstable_cache } from 'next/cache'

export default async function Page({ params }: { params: { userId: string } }) {
  const getCachedUser = unstable_cache(
    async () => {
      return { id: params.userId }
    },
    [params.userId], // ユーザーIDをキャッシュキーに追加
    {
      tags: ['users'],
      revalidate: 60,
    }
  )

  //...
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/page.jsx" switcher
import { unstable_cache } from 'next/cache';

export default async function Page({ params } }) {
  const getCachedUser = unstable_cache(
    async () => {
      return { id: params.userId };
    },
    [params.userId], // ユーザーIDをキャッシュキーに追加
    {
      tags: ["users"],
      revalidate: 60,
    }
  );

  //...
}
```

</TabItem>
</Tabs>

## バージョン履歴 {#version-history}

| Version   | Changes                         |
| --------- | ------------------------------- |
| `v14.0.0` | `unstable_cache` を導入しました |
