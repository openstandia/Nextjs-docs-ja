---
title: 'cacheTag'
description: 'Next.jsアプリケーションでcacheTag関数を使用してキャッシュ無効化を管理する方法を学びましょう。'
version: 'experimental'
related:
  title: '関連情報'
  description: '関連するAPIリファレンスを表示します。'
  links:
    - 'app/api-reference/next-config-js/dynamicIO'
    - 'app/api-reference/directives/use-cache'
    - 'app/api-reference/functions/revalidateTag'
---

`cacheTag`関数を使用すると、キャッシュされたデータにタグを付けて、オンデマンドで無効化できます。キャッシュエントリにタグを関連付けることで、他のキャッシュされたデータに影響を与えることなく、キャッシュの特定の部分を選択的にパージまたは再検証することができます。

## 使用方法 {#usage}

`cacheTag`を使用するには、`next.config.js`で[`dynamicIO`フラグ](/docs/app/api-reference/next-config-js/dynamicIO)を有効にし、`next/cache`から`cacheTag`をインポートします：

```ts title="next.config.ts"
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  experimental: {
    dynamicIO: true,
  },
}

export default nextConfig
```

```tsx title="app/actions.ts"
import { unstable_cacheTag as cacheTag } from 'next/cache'

export async function getData() {
  'use cache'
  cacheTag('my-data')
  const data = await fetch('/api/data')
  return data
}
```

## `revalidateTag`との組み合わせ {#combining-with-revalidatetag}

`revalidateTag`と組み合わせて`cacheTag`を使用し、要求に応じてタグ付きキャッシュエントリをパージします。これは、データのミューテーションや外部イベント後にデータを更新する際に便利です。

```tsx title="app/submit.ts"
'use server'

import { revalidateTag } from 'next/cache'

export default async function submit() {
  await addPost()
  revalidateTag('my-data')
}
```

## 例 {#examples}

### キャッシュされたデータにタグを付ける {#tagging-cached-data}

キャッシュされた関数またはコンポーネント内で`cacheTag`を呼び出すことで、キャッシュされたデータにタグを付けます：

```tsx title="app/components/bookings.tsx"
import {
  unstable_cacheTag as cacheTag,
  unstable_cacheLife as cacheLife,
} from 'next/cache'

interface BookingsProps {
  type: string
}

export async function Bookings({ type = 'massage' }: BookingsProps) {
  'use cache'
  cacheLife('minutes')
  cacheTag('bookings-data')

  async function getBookingsData() {
    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    return data
  }

  return //...
}
```

### データを使ってタグ付けする {#tagging-using-data}

非同期関数から返されるデータを使用して、キャッシュエントリにタグを付けることができます。

```tsx title="app/components/bookings.tsx"
import {
  unstable_cacheTag as cacheTag,
  unstable_cacheLife as cacheLife,
} from 'next/cache'

interface BookingsProps {
  type: string
}

export async function Bookings({ type = 'massage' }: BookingsProps) {
  async function getBookingsData() {
    'use cache'
    cacheLife('minutes')
    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    cacheTag('bookings-data', data.id)
    return data
  }
  return //...
}
```

### タグ付きキャッシュを無効化する {#invalidating-tagged-cache}

必要なときに特定のタグに対するキャッシュを無効化します：

```tsx title="app/actions.ts"
'use server'

import { revalidateTag } from 'next/cache'

export async function updateBookings() {
  await updateBookingData()
  revalidateTag('bookings-data')
}
```

## 注意点 {#notes}

- **冪等性のあるタグ**：同じタグを複数回適用しても追加の効果はありません。
- **複数のタグ**：`cacheTag`に配列を渡すことで、単一のキャッシュエントリに複数のタグを割り当てることができます。

```tsx
cacheTag(['tag-one', 'tag-two'])
```
