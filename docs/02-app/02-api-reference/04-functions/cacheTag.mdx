---
title: 'cacheTag'
description: 'cacheTag 関数を使用して、Next.js アプリケーションにおけるキャッシュの無効化を管理する方法を学びます。'
version: 'experimental'
related:
  title: 'Related'
  description: '関連する API リファレンスを表示します。'
  links:
    - app/api-reference/next-config-js/dynamicIO
    - app/api-reference/directives/use-cache
    - app/api-reference/functions/revalidateTag
---

`cacheTag` 関数を使用すると、オンデマンドで無効化するためにキャッシュされたデータにタグを付けることができます。タグをキャッシュエントリに関連付けることで、他のキャッシュされたデータに影響を与えることなく、特定のキャッシュの部分を選択的に削除または再検証できます。

## 使用方法 {#usage}

`cacheTag` を使用するには、`next.config.js` で [`dynamicIO` フラグ](/docs/app/api-reference/next-config-js/dynamicIO) を有効にし、`next/cache` から `cacheTag` をインポートします：

```ts title="next.config.ts"
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  experimental: {
    dynamicIO: true,
  },
}

export default nextConfig
```

```tsx title="app/actions.ts"
import { unstable_cacheTag as cacheTag } from 'next/cache'

export async function getData() {
  'use cache'
  cacheTag('my-data')
  const data = await fetch('/api/data')
  return data
}
```

## `revalidateTag` との組み合わせ {#combining-with-revalidatetag}

`cacheTag` を `revalidateTag` と組み合わせて、タグ付けされたキャッシュエントリをオンデマンドで削除します。これは、データの変更後や外部イベントの後にデータを更新するようなシナリオで役立ちます。

```tsx title="app/submit.ts"
'use server'

import { revalidateTag } from 'next/cache'

export default async function submit() {
  await addPost()
  revalidateTag('my-data')
}
```

## 例 {#examples}

### キャッシュされたデータにタグを付ける {#tagging-cached-data}

キャッシュされた関数やコンポーネント内で `cacheTag` を呼び出すことで、キャッシュされたデータにタグを付けます：

```tsx title="app/components/bookings.tsx"
import {
  unstable_cacheTag as cacheTag,
  unstable_cacheLife as cacheLife,
} from 'next/cache'

interface BookingsProps {
  type: string
}

export async function Bookings({ type = 'massage' }: BookingsProps) {
  'use cache'
  cacheLife('minutes')
  cacheTag('bookings-data')

  async function getBookingsData() {
    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    return data
  }

  return //...
}
```

### データを使用してタグ付けする {#tagging-using-data}

非同期関数から返されたデータを使用してキャッシュエントリにタグを付けることができます。

```tsx title="app/components/bookings.tsx"
import {
  unstable_cacheTag as cacheTag,
  unstable_cacheLife as cacheLife,
} from 'next/cache'

interface BookingsProps {
  type: string
}

export async function Bookings({ type = 'massage' }: BookingsProps) {
  async function getBookingsData() {
    'use cache'
    cacheLife('minutes')
    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    cacheTag('bookings-data', data.id)
    return data
  }
  return //...
}
```

### タグ付けされたキャッシュを無効化する {#invalidating-tagged-cache}

必要に応じて特定のタグのキャッシュを無効化します：

```tsx title="app/actions.ts"
'use server'

import { revalidateTag } from 'next/cache'

export async function updateBookings() {
  await updateBookingData()
  revalidateTag('bookings-data')
}
```

## 注意点 {#notes}

- **冪等なタグ**: 同じタグを複数回適用しても、追加の効果はありません
- **複数のタグ**: 配列を `cacheTag` に渡すことで、1つのキャッシュエントリに複数のタグを割り当てることができます

```tsx
cacheTag(['tag-one', 'tag-two'])
```
