---
title: 'cacheTag'
description: 'Next.jsアプリケーションでキャッシュ無効化を管理するためのcacheTag関数の使用方法を学びます。'
version: 'canary'
related:
  title: '関連'
  description: '関連APIリファレンスを表示します。'
  links:
    - app/api-reference/next-config-js/dynamicIO
    - app/api-reference/directives/use-cache
    - app/api-reference/functions/revalidateTag
    - app/api-reference/functions/cacheLife
---

`cacheTag`関数を使用することで、キャッシュされたデータにタグを付け、必要に応じて無効化ができます。タグをキャッシュエントリに関連付けることにより、他のキャッシュデータに影響を与えずに特定のキャッシュエントリを選択的にパージまたは再検証することができます。

## 使用法 {#usage}

`cacheTag`を使用するには、`next.config.js`ファイルで[`dynamicIO`フラグ](/docs/app/api-reference/next-config-js/dynamicIO)を有効にしてください：

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="next.config.ts" switcher
import type { NextConfig } from 'next'

// NextConfigの型をインポートします。

const nextConfig: NextConfig = {
  experimental: {
    dynamicIO: true, // dynamicIOフラグを有効にします。
  },
}

export default nextConfig
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="next.config.js" switcher
const nextConfig = {
  experimental: {
    dynamicIO: true, // dynamicIOフラグを有効にします。
  },
}

export default nextConfig
```

</TabItem>
</Tabs>

`cacheTag`関数は、単一の文字列値または文字列配列を取ります。

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/data.ts" switcher
import { unstable_cacheTag as cacheTag } from 'next/cache'

// cacheTagをnext/cacheからインポートします。

export async function getData() {
  'use cache'
  // キャッシュを使用するためのヒント。

  cacheTag('my-data')
  // キャッシュデータに'tag-one'と'tag-two'を割り当てます。

  const data = await fetch('/api/data')
  return data
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/data.js" switcher
import { unstable_cacheTag as cacheTag } from 'next/cache'

// cacheTagをnext/cacheからインポートします。

export async function getData() {
  'use cache'
  // キャッシュを使用するためのヒント。

  cacheTag('my-data')
  // キャッシュデータに'tag-one'と'tag-two'を割り当てます。

  const data = await fetch('/api/data')
  return data
}
```

</TabItem>
</Tabs>

その後、他の関数、たとえば[route handler](/docs/app/building-your-application/routing/route-handlers)または[Server Action](/docs/app/building-your-application/data-fetching/server-actions-and-mutations)内で[`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) APIを使用して、オンデマンドでキャッシュをパージできます：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/action.ts" switcher
'use server'

import { revalidateTag } from 'next/cache'

// revalidateTagをnext/cacheからインポートします。

export default async function submit() {
  await addPost()
  revalidateTag('my-data')
  // 'my-data'タグのキャッシュを再検証します。
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/action.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

// revalidateTagをnext/cacheからインポートします。

export default async function submit() {
  await addPost()
  revalidateTag('my-data')
  // 'my-data'タグのキャッシュを再検証します。
}
```

</TabItem>
</Tabs>

## 知っておくと良いこと {#good-to-know}

- **冪等性のあるタグ**：同じタグを複数回適用しても追加の効果はありません
- **複数のタグ**：配列を`cacheTag`に渡すことで、単一のキャッシュエントリに複数のタグを割り当てることができます

```tsx
cacheTag('tag-one', 'tag-two')
```

## 例 {#examples}

### コンポーネントや関数にタグを付ける {#tagging-components-or-functions}

キャッシュされた関数やコンポーネント内で`cacheTag`を呼び出して、キャッシュデータにタグを付けます：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/components/bookings.tsx" switcher
import { unstable_cacheTag as cacheTag } from 'next/cache'

// cacheTagをnext/cacheからインポートします。

interface BookingsProps {
  type: string
}

export async function Bookings({ type = 'haircut' }: BookingsProps) {
  'use cache'
  // キャッシュを使用するためのヒント。

  cacheTag('bookings-data')
  // キャッシュデータに'tag-three'を割り当てます。

  async function getBookingsData() {
    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    // typeに基づいてブッキングデータを取得します。

    return data
  }

  return //...
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/components/bookings.js" switcher
import { unstable_cacheTag as cacheTag } from 'next/cache'

// cacheTagをnext/cacheからインポートします。

export async function Bookings({ type = 'haircut' }) {
  'use cache'
  // キャッシュを使用するためのヒント。

  cacheTag('bookings-data')
  // キャッシュデータに'tag-three'を割り当てます。

  async function getBookingsData() {
    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    // typeに基づいてブッキングデータを取得します。

    return data
  }

  return //...
}
```

</TabItem>
</Tabs>

### 外部データからタグを作成する {#creating-tags-from-external-data}

非同期関数から返されたデータを使用して、キャッシュエントリにタグを付けることができます。

```tsx title="app/components/bookings.tsx"
import {
  unstable_cacheTag as cacheTag,
  unstable_cacheLife as cacheLife,
} from 'next/cache'

// cacheTagとcacheLifeをnext/cacheからインポートします。

interface BookingsProps {
  type: string
}

export async function Bookings({ type = 'haircut' }: BookingsProps) {
  async function getBookingsData() {
    'use cache'
    // キャッシュを使用するためのヒント。

    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    // typeに基づいてブッキングデータを取得します。

    cacheTag('bookings-data', data.id)
    // データIDを使用してキャッシュデータにタグを付けます。

    return data
  }
  return //...
}
```

<Tabs>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/components/bookings.js" switcher
import { unstable_cacheTag as cacheTag } from 'next/cache'

// cacheTagをnext/cacheからインポートします。

export async function Bookings({ type = 'haircut' }) {
  async function getBookingsData() {
    'use cache'
    // キャッシュを使用するためのヒント。

    const data = await fetch(`/api/bookings?type=${encodeURIComponent(type)}`)
    // typeに基づいてブッキングデータを取得します。

    cacheTag('bookings-data', data.id)
    // データIDを使用してキャッシュデータにタグを付けます。

    return data
  }
  return //...
}
```

</TabItem>
</Tabs>

### タグ付きキャッシュの無効化 {#invalidating-tagged-cache}

[`revalidateTag`](/docs/app/api-reference/functions/revalidateTag)を使用して、特定のタグのキャッシュを必要に応じて無効にします：

```tsx title="app/actions.ts"
'use server'

import { revalidateTag } from 'next/cache'

// revalidateTagをnext/cacheからインポートします。

export async function updateBookings() {
  await updateBookingData()
  revalidateTag('bookings-data')
  // 'bookings-data'タグのキャッシュを再検証します。
}
```

<Tabs>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/actions.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

// revalidateTagをnext/cacheからインポートします。

export async function updateBookings() {
  await updateBookingData()
  revalidateTag('bookings-data')
  // 'bookings-data'タグのキャッシュを再検証します。
}
```

</TabItem>
</Tabs>
