---
title: 'Video Optimization'
nav_title: 'Videos'
description: 'Next.jsアプリケーションの動画最適化の推奨事項とベストプラクティス。'
---

このページでは、Next.jsアプリケーションで動画を使用する方法を説明し、パフォーマンスに影響を与えずに動画ファイルを保存し表示する方法を示します。

## `<video>` および `<iframe>` の使用 {#using-video-and-iframe}

動画は、直接的な動画ファイルにはHTMLの**`<video>`**タグを、外部プラットフォームにホストされている動画には**`<iframe>`**を使用してページに埋め込むことができます。

### `<video>` {#video}

HTMLの[`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)タグは、セルフホストまたは直接配信される動画コンテンツを埋め込むことができ、再生と外観を完全に制御できます。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### 一般的な`<video>`タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                                                        | 例                                   |
| ------------- | ----------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `src`         | 動画ファイルのソースを指定します。                                                                          | `<video src="/path/to/video.mp4" />` |
| `width`       | 動画プレイヤーの幅を設定します。                                                                            | `<video width="320" />`              |
| `height`      | 動画プレイヤーの高さを設定します。                                                                          | `<video height="240" />`             |
| `controls`    | 存在する場合、デフォルトの再生コントロールセットを表示します。                                              | `<video controls />`                 |
| `autoPlay`    | ページが読み込まれると自動的に動画の再生を開始します。 注：自動再生ポリシーはブラウザーによって異なります。 | `<video autoPlay />`                 |
| `loop`        | 動画の再生をループさせます。                                                                                | `<video loop />`                     |
| `muted`       | デフォルトで音声をミュートします。`autoPlay`と一緒に使用されることが多いです。                              | `<video muted />`                    |
| `preload`     | 動画のプリロード方法を指定します。値：`none`、`metadata`、`auto`。                                          | `<video preload="none" />`           |
| `playsInline` | iOSデバイスでのインライン再生を有効にします。`autoPlay`がiOS Safariで動作するために必要なことが多いです。   | `<video playsInline />`              |

> **Good to know**: `autoPlay`属性を使用する際は、ほとんどのブラウザで動画を自動再生するために`muted`属性を含め、iOSデバイスとの互換性のために`playsInline`属性を含めることが重要です；

動画属性の包括的なリストについては、[MDNのドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes)を参照してください。

### 動画のベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ**：`<video>`タグを使用する際は、動画を再生できないブラウザのためにタグ内にフォールバックコンテンツを含める。
- **字幕またはキャプション**：聴覚障害者に向けて字幕やキャプションを含めます。字幕ファイルソースを指定するために`<video>`要素に[`<track>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track)タグを使用します。
- **アクセシブルなコントロール**：キーボード操作やスクリーンリーダーの互換性を考え、標準のHTML5ビデオコントロールを推奨します。高度なニーズには、[react-player](https://github.com/cookpete/react-player)や[video.js](https://videojs.com/)のようなサードパーティプレイヤーを検討し、アクセシブルなコントロールと一貫したブラウザ体験を提供します。

### `<iframe>` {#iframe}

HTMLの`<iframe>`タグを使用すると、YouTubeやVimeoなどの外部プラットフォームから動画を埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### 一般的な`<iframe>`タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                               | 例                                     |
| ----------------- | ------------------------------------------------------------------ | -------------------------------------- |
| `src`             | 埋め込むページのURL。                                              | `<iframe src="https://example.com" />` |
| `width`           | iframeの幅を設定します。                                           | `<iframe width="500" />`               |
| `height`          | iframeの高さを設定します。                                         | `<iframe height="300" />`              |
| `allowFullScreen` | iframeのコンテンツを全画面モードで表示できるようにします。         | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe内のコンテンツに追加の制限を設けます。                       | `<iframe sandbox />`                   |
| `loading`         | 読み込み動作を最適化します（例：遅延読み込み）。                   | `<iframe loading="lazy" />`            |
| `title`           | アクセシビリティをサポートするためにiframeにタイトルを提供します。 | `<iframe title="Description" />`       |

iframe属性の包括的なリストについては、[MDNのドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes)を参照してください。

### 動画の埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.jsアプリケーションで動画を埋め込む方法は2つあります：

- **セルフホストまたは直接動画ファイル**：`<video>`タグを使用してセルフホスト動画を埋め込み、プレイヤーの機能や外観に細かく制御が必要なシナリオに対応します。この方法はNext.js内でのカスタマイズと動画コンテンツの制御を可能にします。
- **動画ホスティングサービスの使用（YouTube、Vimeoなど）**：YouTubeやVimeoのような動画ホスティングサービス用に、`<iframe>`タグを使用してこれらのプラットフォームのiframeベースのプレイヤーを埋め込みます。この方法ではプレイヤーのいくつかの制御が制限されますが、これらのプラットフォームが提供する使いやすさや機能を利用できます。

アプリケーションの要件と提供したいユーザー体験に一致する埋め込み方法を選択してください。

### 外部にホストされた動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームから動画を埋め込むために、Next.jsを使用して動画情報を取得し、ReactのSuspenseを使用して読み込み中のフォールバック状態を処理します。

**1. 動画の埋め込み用のサーバーコンポーネントを作成**

最初のステップは、動画を埋め込むための適切なiframeを生成する[サーバーコンポーネント](https://nextjs.org/docs/app/building-your-application/rendering/server-components)を作成することです。このコンポーネントは、動画のソースURLを取得してiframeをレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. ReactのSuspenseを使用して動画コンポーネントをストリーム配信**

動画を埋め込むサーバーコンポーネントを作成した後、次のステップは[ReactのSuspense](https://react.dev/reference/react/Suspense)を使用してコンポーネントを[ストリーム](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)配信することです。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* 他のページのコンテンツ */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームから動画を埋め込む際には、次のベストプラクティスを考慮してください：
>
> - 動画の埋め込みがレスポンシブであることを確認します。CSSを使用してiframeまたは動画プレーヤーがさまざまな画面サイズに適応するようにします；
> - 特にデータプランが制限されたユーザー向けに、ネットワーク条件に基づいて動画を読み込むための[戦略を実装](https://yoast.com/site-speed-tips-for-faster-video/)します；

このアプローチにより、ページのブロッキングを防ぎ、動画コンポーネントがストリーム配信される間にページが操作可能になるため、ユーザーエクスペリエンスが向上します。

より魅力的で情報豊富な読み込み体験を提供するために、フォールバックUIとして読み込みスケルトンを使用することを検討してください。単純なロードメッセージを表示する代わりに、以下のようにビデオプレーヤーに似たスケルトンを表示することができます：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* 他のページのコンテンツ */}
    </section>
  )
}
```

## セルフホスト動画 {#self-hosted-videos}

いくつかの理由でセルフホスト動画が望ましい場合があります：

- **完全な制御と独立性**：セルフホスティングにより、動画コンテンツの管理が直接行え、再生から外観に至るまで完全に所有権と制御があります。外部プラットフォームの制約を受けません；
- **特定のニーズへのカスタマイズ**：動的背景動画などの特定の要件に最適で、設計および機能要件に合わせたカスタマイズが可能です；
- **パフォーマンスとスケーラビリティの考慮**：高トラフィックやコンテンツサイズの増加に効果的に対応するために、パフォーマンスが高くスケーラブルなストレージソリューションを選択します；
- **コストと統合**：ストレージと帯域幅のコストをNext.jsフレームワークや技術エコシステムとの簡単な統合のニーズとバランスを取ります；

### 動画ホスティングにVercel Blobを使用する {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)は動画をホスティングする効率的な方法を提供し、Next.jsと連携するスケーラブルなクラウドストレージソリューションを提供します。Vercel Blobを使用して動画をホスティングする方法を以下に示します：

**1. Vercel Blobに動画をアップロードする**

Vercelのダッシュボードで、"Storage"タブに移動し、お使いの[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)ストアを選択します。Blobテーブルの右上隅にある「Upload」ボタンを見つけてクリックし、アップロードする動画ファイルを選択します。アップロードが完了すると、動画ファイルがBlobテーブルに表示されます。

あるいは、サーバーアクションを使用して動画をアップロードすることもできます。詳細な手順については、[サーバーサイドアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload)に関するVercelのドキュメントを参照してください。Vercelは[クライアントサイドアップロード](https://vercel.com/docs/storage/vercel-blob/client-upload)もサポートしています。特定のユースケースにはこの方法が望ましいかもしれません。

**2. Next.jsで動画を表示する**

動画がアップロードされ保存されたら、Next.jsアプリケーションで表示できます。以下に示す例では、`<video>`タグとReact Suspenseを使用してこれを行う方法を示しています：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページが動画の`@vercel/blob` URLを使用して動画を表示し、`VideoComponent`で動画を表示します。React Suspenseを使用して動画のURLがフェッチされ、動画が表示可能になるまでフォールバックを表示しています。

### 動画に字幕を追加する {#adding-subtitles-to-your-video}

動画に字幕がある場合、`<video>`タグ内に`<track>`要素を使用して簡単に追加できます。動画ファイルと同様に、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)から字幕ファイルを取得することができます。以下は、字幕を含めるために`<VideoComponent>`を更新する方法です。

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチに従うことで、効果的にセルフホストし、Next.jsアプリケーションに動画を統合できます。

## リソース {#resources}

動画の最適化とベストプラクティスについてさらに学習を続けたい場合は、次のリソースを参照してください：

- **動画フォーマットとコーデックの理解**：MP4などの互換性のあるフォーマットやWebMなどのWeb最適化フォーマットなど、ニーズに合わせたフォーマットとコーデックを選択してください。詳細は[Mozilaの動画コーデックガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs)を参照してください。
- **動画圧縮**：FFmpegなどのツールを使用して動画を効果的に圧縮し、品質とファイルサイズをバランスします。圧縮技術については[FFmpegの公式ウェブサイト](https://www.ffmpeg.org/)で学んでください。
- **解像度とビットレートの調整**：[解像度とビットレート](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%20measure%20different%20aspects,yield%20different%20qualities%20of%20video)をビューイングプラットフォームに基づいて調整し、モバイルデバイス向けに低い設定を使用します。
- **コンテンツデリバリネットワーク(CDN)**：CDNを利用して動画の配信速度を向上させ、高トラフィックを管理します。一部のストレージソリューションでは、Vercel BlobのようにCDN機能が自動的に処理されます。[CDNとその利点について学ぶ](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)。

次の動画ストリーミングプラットフォームを探索して、Next.jsプロジェクトに動画を統合してください。

### オープンソースの`next-video`コンポーネント {#open-source-next-video-component}

- Vercel Blob、S3、Backblaze、およびMuxを含むさまざまなホスティングサービスと互換性のあるNext.jsの`<Video>`コンポーネントを提供します；
- 詳細なドキュメントは、さまざまなホスティングサービスでの`next-video.dev`の使用についてです([詳細なドキュメント](https://next-video.dev/docs))；

### Cloudinary インテグレーション {#cloudinary-integration}

- Next.jsでCloudinaryを使用するための[公式ドキュメントと統合ガイド](https://next.cloudinary.dev/)；
- [簡単な動画サポート](https://next.cloudinary.dev/cldvideoplayer/basic-usage)のための`<CldVideoPlayer>`コンポーネントを含みます；
- Next.jsとCloudinaryを統合した[例](https://github.com/cloudinary-community/cloudinary-examples/?tab=readme-ov-file#nextjs)や[適応型ビットレートストリーミング](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr)。；
- Node.js SDKを含む[他のCloudinaryライブラリ](https://cloudinary.com/documentation)も利用可能です；

### Mux Video API {#mux-video-api}

- MuxはMuxとNext.jsを使った動画コースを作成するための[スターターテンプレート](https://github.com/muxinc/video-course-starter-kit)を提供します；
- Next.jsアプリケーションの[高パフォーマンス](https://www.mux.com/for/nextjs)動画の埋め込みに関するMuxの推奨事項を学びます；
- Next.jsでMuxを実演する[例](https://with-mux-video.vercel.app/)を探ります；

### Fastly {#fastly}

- Next.jsに対する[ビデオ・オン・デマンド](https://www.fastly.com/products/streaming-media/video-on-demand)およびストリーミングメディア統合のためのFastlyのソリューションについてもっと知る。

### ImageKit.io インテグレーション {#imagekit-io-integration}

- Next.jsとImageKitを統合するための[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs)を確認して下さい；
- 統合は、シームレスな動画サポートを提供する`<IKVideo>`コンポーネントを提供します([シームレスなビデオサポート](https://imagekit.io/docs/integration/nextjs#rendering-videos))；
- Node.js SDKなどの他の[ImageKitライブラリ](https://imagekit.io/docs)を調べることもできます；
