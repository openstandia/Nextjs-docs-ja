---
title: 'Video Optimization'
nav_title: 'Videos'
description: 'Next.jsアプリケーションで動画を最適化するための推奨とベストプラクティス。'
---

このページでは、Next.jsアプリケーションで動画をどのように利用するかを説明し、パフォーマンスに影響を与えずに動画ファイルを保存・表示する方法を示します。

## `<video>`と`<iframe>`の使用法 {#using-video-and-iframe}

動画は、直接の動画ファイルに対してHTMLの**`<video>`**タグを、外部プラットフォームにホストされている動画に対して**`<iframe>`**を使用してページに埋め込むことができます。

### `<video>` {#video}

HTML [`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)タグは、自己ホスティングまたは直接提供される動画コンテンツを埋め込むことができ、再生と外観に完全なコントロールを与えます。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### 一般的な`<video>`タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                                                         | 例                                   |
| ------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------------ |
| `src`         | 動画ファイルのソースを指定します。                                                                           | `<video src="/path/to/video.mp4" />` |
| `width`       | ビデオプレーヤーの幅を設定します。                                                                           | `<video width="320" />`              |
| `height`      | ビデオプレーヤーの高さを設定します。                                                                         | `<video height="240" />`             |
| `controls`    | 存在する場合、デフォルトの再生コントロールセットを表示します。                                               | `<video controls />`                 |
| `autoPlay`    | ページがロードされたときに自動的に動画の再生を開始します。注：自動再生ポリシーはブラウザによって異なります。 | `<video autoPlay />`                 |
| `loop`        | 動画の再生をループします。                                                                                   | `<video loop />`                     |
| `muted`       | デフォルトで音声をミュートします。多くの場合、`autoPlay`と一緒に使用されます。                               | `<video muted />`                    |
| `preload`     | 動画のプリロード方法を指定します。値：`none`、`metadata`、`auto`。                                           | `<video preload="none" />`           |
| `playsInline` | iOSデバイスでのインライン再生を可能にし、多くの場合、iOS Safariで自動再生が機能するようにします。            | `<video playsInline />`              |

> **Good to know**: `autoPlay`属性を使用する場合、ほとんどのブラウザで動画が自動再生されるようにするために、`muted`属性も含めることと、iOSデバイスとの互換性のために`playsInline`属性を含めることが重要です。

動画属性の包括的なリストについては、[MDNのドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes)を参照してください。

### 動画のベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ:** `<video>`タグを使用する場合、動画再生をサポートしていないブラウザ向けに、タグ内にフォールバックコンテンツを含めてください
- **字幕またはキャプション:** 聴覚障害者や難聴者向けに字幕またはキャプションを含めてください。`<video>`要素と一緒に[`<track>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track)タグを利用してキャプションファイルソースを指定してください
- **アクセス可能なコントロール:** キーボードナビゲーションとスクリーンリーダーとの互換性のために標準のHTML5ビデオコントロールを推奨します。進んだニーズには、[react-player](https://github.com/cookpete/react-player)や[video.js](https://videojs.com/)のようなサードパーティのプレーヤーを検討してください。これらはアクセス可能なコントロールと一貫したブラウザ体験を提供します

### `<iframe>` {#iframe}

HTML `<iframe>`タグを使用すると、YouTubeやVimeoといった外部プラットフォームから動画を埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### 一般的な`<iframe>`タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                                   | 例                                     |
| ----------------- | ---------------------------------------------------------------------- | -------------------------------------- |
| `src`             | 埋め込むページのURLです。                                              | `<iframe src="https://example.com" />` |
| `width`           | iframeの幅を設定します。                                               | `<iframe width="500" />`               |
| `height`          | iframeの高さを設定します。                                             | `<iframe height="300" />`              |
| `allowFullScreen` | iframeのコンテンツがフルスクリーンモードで表示されることを許可します。 | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe内のコンテンツに追加の制限をかけます。                           | `<iframe sandbox />`                   |
| `loading`         | 読み込みの動作を最適化します（例：遅延読み込み）。                     | `<iframe loading="lazy" />`            |
| `title`           | iframeのアクセシビリティをサポートするためのタイトルを提供します。     | `<iframe title="Description" />`       |

iframe属性の包括的なリストについては、[MDNのドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes)を参照してください。

### 動画埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.jsアプリケーションで動画を埋め込む方法は2つあります：

- **自己ホスティングまたは直接動画ファイル:** `<video>`タグを使用して自己ホスティング動画を埋め込み、プレーヤーの機能と外観に対する細かい制御が必要なシナリオに適しています。この統合方法は、Next.jsの中で動画コンテンツのカスタマイズと制御を可能にします
- **動画ホスティングサービスの利用（YouTube、Vimeoなど）:** YouTubeやVimeoのような動画ホスティングサービスの場合、彼らのiframeベースのプレーヤーを`<iframe>`タグを使用して埋め込みます。この方法はプレーヤーに対する一部の制御を制限しますが、これらのプラットフォームが提供する使いやすさと機能を活用できます

アプリケーションの要件と提供したいユーザーエクスペリエンスに合わせて埋め込み方法を選んでください。

### 外部ホスト動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームから動画を埋め込むには、Next.jsを使用して動画情報を取得し、React Suspenseを使用してロード中のフォールバック状態を処理することができます。

**1. 動画埋め込みのためのServer Componentの作成**

最初のステップは、[Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components)を作成して、動画埋め込みのために適切なiframeを生成することです。このコンポーネントは、動画のソースURLを取得してiframeをレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. React Suspenseを使用した動画コンポーネントのストリーミング**

動画を埋め込むServer Componentを作成した後、次のステップは、[React Suspense](https://react.dev/reference/react/Suspense)を使用してコンポーネントを[ストリーミング](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)することです。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* ページの他の内容 */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームから動画を埋め込む際は、以下のベストプラクティスを検討してください：
>
> - 動画埋め込みがレスポンシブであることを確認してください。iframeまたは動画プレーヤーが異なる画面サイズに適応するようにCSSを使用してください
> - 特にデータプランが制限されているユーザー向けに、[ネットワーク条件に基づく動画ロードの戦略](https://yoast.com/site-speed-tips-for-faster-video/)を実装してください

このアプローチは、ページがブロックされるのを防ぎ、ユーザーが動画コンポーネントをストリーミング中にページと対話できるようにすることで、ユーザーエクスペリエンスを向上させます。

より魅力的で情報豊かなローディング体験を提供するために、フォールバックUIとしてローディングスケルトンを使用することを検討してください。単純なローディングメッセージを表示する代わりに、次のように動画プレーヤーを模したスケルトンを表示できます：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* ページの他の内容 */}
    </section>
  )
}
```

## 自己ホスティング動画 {#self-hosted-videos}

自己ホスティング動画は以下の理由で好まれるかもしれません：

- **完全なコントロールと独立性**: 自己ホスティングは、外部プラットフォームの制約なく、再生から外観まで、自分の動画コンテンツを直接管理できるので、完全な所有権と制御が得られます
- **特定のニーズへのカスタマイズ**: 動的背景動画のような特定の要件に適しており、設計と機能のニーズに合わせて調整可能なカスタマイズを可能にします
- **パフォーマンスとスケーラビリティの考慮事項**: パフォーマンスが高くスケーラブルなストレージソリューションを選択して、増加するトラフィックやコンテンツサイズを効果的にサポートします
- **コストと統合**: ストレージと帯域幅のコストを、Next.jsフレームワークやより広範な技術エコシステムへの簡単な統合のニーズとバランスをとります

### Vercel Blobを使用した動画ホスティング {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) は、Next.jsと適切に連携するスケーラブルなクラウドストレージソリューションを提供し、動画を効率的にホストする方法を提供します。Vercel Blobを使用して動画をホストする方法は次のとおりです：

**1. Vercel Blobに動画をアップロードする**

Vercelダッシュボードで、「Storage」タブに移動し、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)ストアを選択します。Blobテーブルの右上隅にある「Upload」ボタンを見つけてクリックします。次に、アップロードしたい動画ファイルを選択します。アップロードが完了すると、Blobテーブルに動画ファイルが表示されます。

代替として、サーバーアクションを使用して動画をアップロードできます。詳細な手順については、Vercelの[サーバーサイドのアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload)に関するドキュメントを参照してください。Vercelは[クライアントサイドのアップロード](https://vercel.com/docs/storage/vercel-blob/client-upload)もサポートしています。特定のユースケースではこの方法が好まれるかもしれません。

**2. Next.jsで動画を表示する**

動画がアップロードされて保存されたら、それをNext.jsアプリケーションで表示できます。以下は、`<video>`タグとReact Suspenseを使用してこれを行う例です：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページは動画の`@vercel/blob` URLを使用して動画を表示し、動画URLが取得され、動画が表示される準備が整うまでReact Suspenseを使用してフォールバックを表示します。

### 動画に字幕を追加する {#adding-subtitles-to-your-video}

動画に字幕がある場合、`<video>`タグ内の`<track>`要素を使用して簡単に追加できます。動画ファイルと同様に、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)から字幕ファイルを取得できます。以下に、`<VideoComponent>`に字幕を含める方法を示します。

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチに従うことで、動画を効果的に自己ホスティングし、Next.jsアプリケーションに統合できます。

## リソース {#resources}

動画の最適化とベストプラクティスについてさらに学ぶために、以下のリソースを参照してください：

- **動画形式とコーデックの理解**: MP4のような互換性のための形式や、WebMのようなウェブ最適化のためのコーデックを選択します。詳細については、[Mozillaの動画コーデックに関するガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs)をご覧ください
- **動画圧縮**: FFmpegのようなツールを使用して、品質とファイルサイズのバランスを取りながら効果的に動画を圧縮します。圧縮技術については[FFmpegの公式ウェブサイト](https://www.ffmpeg.org/)をご確認ください
- **解像度とビットレートの調整**: モバイルデバイス向けに解像度とビットレートの[調整](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%measure%20different%20aspects,yield%20different%20qualities%20of%20video)を行います
- **コンテンツデリバリネットワーク（CDN）**: CDNを利用して、動画配信速度を向上させ、高トラフィックを管理します。一部のストレージソリューション（Vercel Blobなど）を使用する際、CDN機能は自動的に処理されます。[詳細情報](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) やその利点を知ることができます。

Next.jsプロジェクトに動画を統合するためのこれらの動画ストリーミングプラットフォームを探索してください：

### オープンソースの`next-video`コンポーネント {#open-source-next-video-component}

- 各種ホスティングサービス（[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)、S3、Backblaze、Muxを含む）に対応したNext.js向けの`<Video>`コンポーネントを提供します
- `next-video.dev`を使用した異なるホスティングサービスについての[詳細なドキュメント](https://next-video.dev/docs)

### Cloudinary Integration {#cloudinary-integration}

- Next.jsと共にCloudinaryを使用するための公式の[ドキュメンテーションと統合ガイド](https://next.cloudinary.dev/)
- [簡単な動画サポート](https://next.cloudinary.dev/cldvideoplayer/basic-usage)のための`<CldVideoPlayer>`コンポーネントを含みます
- 次の例を含むNext.jsとのCloudinaryの統合例を見つけることができます：[適応ビットレートストリーミング](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr)
- Node.js SDKを含むその他の[Cloudinaryライブラリ](https://cloudinary.com/documentation)も利用可能です

### Mux Video API {#mux-video-api}

- Next.jsとMuxでビデオコースを作成するための[スターターテンプレート](https://github.com/muxinc/video-course-starter-kit)
- Next.jsアプリケーション向けの[高性能ビデオ埋め込み](https://www.mux.com/for/nextjs)に関するMuxの推奨事項を学ぶ
- MuxとNext.jsを示す[例のプロジェクト](https://with-mux-video.vercel.app/)を探索する

### Fastly {#fastly}

- Next.jsに対するFastlyの[オンデマンドビデオ](https://www.fastly.com/products/streaming-media/video-on-demand)およびストリーミングメディアのソリューションを統合する方法を学ぶ

### ImageKit.io Integration {#imagekit-io-integration}

- Next.jsとImageKitを統合するための[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs)を確認する
- 統合により`<IKVideo>`コンポーネントが提供され、[シームレスな動画サポート](https://imagekit.io/docs/integration/nextjs#rendering-videos)を提供します
- Node.js SDKを含むその他の[ImageKitライブラリ](https://imagekit.io/docs)も参照可能です
