---
title: 'Video Optimization'
nav_title: 'Videos'
description: 'Next.js アプリケーションで動画を最適化するための推奨事項とベストプラクティス。'
---

このページでは、Next.js アプリケーションで動画を使用する方法について説明し、パフォーマンスに影響を与えずに動画ファイルを保存および表示する方法を紹介します。

## `<video>` と `<iframe>` の使用 {#using-video-and-iframe}

Webページに動画を埋め込むには、直接的な動画ファイルにはHTMLの **`<video>`** タグを、外部プラットフォームにホストされた動画には **`<iframe>`** を使用します。

### `<video>` {#video}

HTML の [`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video) タグは、自己ホストまたは直接配信された動画コンテンツを埋め込むことができ、再生や外観の完全な制御を可能にします。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### 一般的な `<video>` タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                                                             | 例                                   |
| ------------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `src`         | 動画ファイルのソースを指定します。                                                                               | `<video src="/path/to/video.mp4" />` |
| `width`       | 動画プレーヤーの幅を設定します。                                                                                 | `<video width="320" />`              |
| `height`      | 動画プレーヤーの高さを設定します。                                                                               | `<video height="240" />`             |
| `controls`    | 存在する場合、デフォルトの再生コントロールを表示します。                                                         | `<video controls />`                 |
| `autoPlay`    | ページが読み込まれたときに自動的に動画の再生を開始します。注意：自動再生のポリシーはブラウザによって異なります。 | `<video autoPlay />`                 |
| `loop`        | 動画の再生をループさせます。                                                                                     | `<video loop />`                     |
| `muted`       | デフォルトでオーディオをミュートします。通常は `autoPlay` と一緒に使用されます。                                 | `<video muted />`                    |
| `preload`     | 動画をどのようにプリロードするかを指定します。値：`none`、`metadata`、`auto`。                                   | `<video preload="none" />`           |
| `playsInline` | iOS デバイスでのインライン再生を有効にし、iOS Safari で自動再生が動作するために頻繁に必要です。                  | `<video playsInline />`              |

> **Good to know**: `autoPlay` 属性を使用する際は、ほとんどのブラウザで動画が自動再生されるようにするために `muted` 属性を含めることが重要です。また、iOS デバイスとの互換性のために `playsInline` 属性も追加してください。

動画属性の完全なリストについては、[MDN のドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes)を参照してください。

### 動画のベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ**：`<video>` タグを使用する際は、動画再生をサポートしていないブラウザのためにタグ内にフォールバックコンテンツを含めます。
- **字幕やキャプション**：聴覚障害者や難聴のユーザーのために字幕やキャプションを含めます。`<video>` 要素と一緒に `<track>` タグを使用して、キャプションファイルのソースを指定します。
- **アクセシブルなコントロール**：キーボードナビゲーションやスクリーンリーダーとの互換性のために、標準的な HTML5 動画コントロールを推奨します。高度なニーズには、[react-player](https://github.com/cookpete/react-player) や [video.js](https://videojs.com/) などのサードパーティプレーヤーを検討してください。これらはアクセシブルなコントロールと一貫したブラウザ体験を提供します。

### `<iframe>` {#iframe}

HTML の `<iframe>` タグを使用すると、YouTube や Vimeo などの外部プラットフォームから動画を埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### 一般的な `<iframe>` タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                                 | 例                                     |
| ----------------- | -------------------------------------------------------------------- | -------------------------------------- |
| `src`             | 埋め込むページの URL。                                               | `<iframe src="https://example.com" />` |
| `width`           | iframe の幅を設定します。                                            | `<iframe width="500" />`               |
| `height`          | iframe の高さを設定します。                                          | `<iframe height="300" />`              |
| `allowFullScreen` | iframe コンテンツをフルスクリーン モードで表示できるようにします。   | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe 内のコンテンツに追加の制限を適用します。                      | `<iframe sandbox />`                   |
| `loading`         | 読み込みの動作を最適化します（例：遅延読み込み）。                   | `<iframe loading="lazy" />`            |
| `title`           | アクセシビリティをサポートするために iframe にタイトルを提供します。 | `<iframe title="Description" />`       |

iframe 属性の完全なリストについては、[MDN のドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes)を参照してください。

### 動画埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.js アプリケーションに動画を埋め込む方法は次の 2 つです：

- **自己ホストまたは直接動画ファイル**：プレーヤーの機能や見た目を詳細に制御する必要がある場合、`<video>` タグを使用して自己ホスト動画を埋め込みましょう。この統合方法を Next.js で使用すると、動画コンテンツをカスタマイズし制御できます。
- **ビデオホスティングサービスを使用する（YouTube、Vimeo など）**：YouTube や Vimeo などのビデオホスティングサービスを利用する場合、`<iframe>` タグを使用して、それらの iframe ベースプレーヤーを埋め込みます。この方法では、プレーヤーに対する制御が一部制限されますが、これらのプラットフォームが提供する機能と使いやすさを享受できます。

アプリケーションの要求事項と提供したいユーザー体験に合わせて、埋め込み方法を選択してください。

### 外部にホストされた動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームから動画を埋め込むには、Next.js を使用して動画の情報を取得し、React Suspense を使用して読み込み中のフォールバック状態を管理します。

**1. 動画埋め込み用の Server Component を作成**

最初のステップは、動画を埋め込むための適切な iframe を生成する [Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components) を作成することです。このコンポーネントは、動画のソース URL を取得し、iframe をレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. React Suspense を使用して動画コンポーネントをストリーミング**

動画を埋め込むための Server Component を作成したら、次のステップは、[React Suspense](https://react.dev/reference/react/Suspense) を使用してコンポーネントを[ストリーミング](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)することです。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* ページ内のその他のコンテンツ */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームから動画を埋め込む際には、次のベストプラクティスを考慮してください：
>
> - 動画の埋め込みをレスポンシブにすることを確認します。CSS を使用して、iframe または動画プレーヤーが異なる画面サイズに適応するようにします。
> - 特にデータプランが限られているユーザー向けに、ネットワーク条件に基づいて[動画の読み込み戦略](https://yoast.com/site-speed-tips-for-faster-video/)を実装します。

このアプローチにより、ユーザーがページと対話できる間に、動画コンポーネントがストリーミングされ、ページのブロッキングが防止され、より良いユーザー体験が実現されます。

より魅力的で情報満載のローディングエクスペリエンスを提供するために、フォールバック UI としてローディングスケルトンを使用することを検討してください。単純なローディングメッセージを表示する代わりに、次のように、動画プレーヤーに似たスケルトンを表示できます：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* ページ内のその他のコンテンツ */}
    </section>
  )
}
```

## サーバーホスト動画 {#self-hosted-videos}

サーバーホスト動画が好まれる理由はいくつかあります：

- **完全な管理と独立性**：サーバーホストは、外部プラットフォームの制約から解放され、再生から外観に至るまで動画コンテンツの直接的な管理を可能にし、完全な所有権と制御を保証します。
- **特定のニーズに応じたカスタマイズ**：ダイナミックな背景動画など、ユニークな要件に最適で、デザインと機能のニーズに合わせたカスタマイズが可能です。
- **パフォーマンスとスケーラビリティの考慮**：保管ソリューションは、高パフォーマンスでスケーラブルなものを選び、増加するトラフィックおよびコンテンツサイズに効果的に対応する必要があります。
- **コストと統合**：保存および帯域幅のコストを Next.js フレームワークへの簡単な統合と広範な技術エコシステムとのバランスをとります。

### Vercel Blob を使用した動画ホスティング {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) は、スケーラブルなクラウドストレージソリューションを提供することで、Next.js とよく連携し、動画をホスティングする効率的な方法を提供します。ここでは、Vercel Blob を使用して動画をホストする方法を紹介します：

**1. Vercel Blob への動画のアップロード**

Vercel のダッシュボードで「ストレージ」タブに移動し、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) ストアを選択します。Blob テーブルの右上隅で「アップロード」ボタンを見つけてクリックします。次に、アップロードする動画ファイルを選択します。アップロードが完了すると、動画ファイルが Blob テーブルに表示されます。

別の方法として、サーバーアクションを使用して動画をアップロードすることもできます。詳細な手順は、[サーバーサイドアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload)に関する Vercel のドキュメントを参照してください。Vercel は[クライアントサイドアップロード](https://vercel.com/docs/storage/vercel-blob/client-upload)もサポートしています。この方法が特定のユースケースには好ましい場合があります。

**2. Next.js で動画を表示する**

動画がアップロードおよび保存されたら、Next.js アプリケーションで表示できます。ここでの例は、`<video>` タグと React Suspense を使用して行う方法です：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページは動画の `@vercel/blob` URL を使用して、`VideoComponent` を使用して動画を表示します。React Suspense は、動画の URL が取得され動画が表示可能になるまでのフォールバック表示に使用されます。

### 動画に字幕を追加する {#adding-subtitles-to-your-video}

動画に字幕がある場合は、`<video>` タグ内に `<track>` 要素を使用して簡単に追加できます。動画ファイルと同様に [Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) から字幕ファイルを取得できます。ここでは、`<VideoComponent>` に字幕を含める方法を紹介します。

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチに従うことで、Next.js アプリケーションに動画を効果的にサーバーホストして統合できます。

## リソース {#resources}

動画最適化とベストプラクティスについてさらに学ぶためのリソースは以下のとおりです：

- **動画フォーマットとコーデックの理解**：互換性を重視した MP4 や、ウェブ最適化を重視した WebM など、動画ニーズに応じて適切なフォーマットとコーデックを選択してください。詳細は [Mozilla の動画コーデックガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs)を参照してください。
- **動画圧縮**：FFmpeg などのツールを使用して、ファイルサイズと品質のバランスを取った効果的な圧縮を行います。圧縮技術については [FFmpeg の公式サイト](https://www.ffmpeg.org/)で学んでください。
- **解像度とビットレート調整**：表示プラットフォームに基づいて[解像度とビットレート](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%20measure%20different%20aspects,yield%20different%20qualities%20of%20video)を調整し、モバイルデバイスにはより低い設定を使用します。
- **コンテンツ配信ネットワーク（CDN）**：CDN を利用して、動画の配信速度を向上させ、トラフィックが多い場合でも対応します。一部のストレージソリューション、例えばVercel Blob などを使用する場合、CDN 機能は自動的に処理されます。[CDN とその利点について学ぶ](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)。

Next.js プロジェクトへの動画統合に役立つ、これらの動画ストリーミング プラットフォームを探索してください：

### オープンソース `next-video` コンポーネント {#open-source-next-video-component}

- Vercel Blob や S3、Backblaze、Mux を含むさまざまなホスティングサービスと互換性のある Next.js 用の `<Video>` コンポーネントを提供します。
- 異なるホスティングサービスでの`next-video.dev` の使用に関する[詳細なドキュメント](https://next-video.dev/docs)があります。

### Cloudinary の統合 {#cloudinary-integration}

- Next.js で Cloudinary を使用するための公式[ドキュメントと統合ガイド](https://next.cloudinary.dev/)。
- [動画サポートのための簡単な使用法](https://next.cloudinary.dev/cldvideoplayer/basic-usage)の `<CldVideoPlayer>` コンポーネントが含まれています。
- Next.js との Cloudinary の統合を示す[例](https://github.com/cloudinary-community/cloudinary-examples/?tab=readme-ov-file#nextjs)が含まれ、[適応ビットレートストリーミング](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr)も含まれています。
- Node.js SDK など、他の[Cloudinary ライブラリ](https://cloudinary.com/documentation)も利用可能です。

### Mux ビデオ API {#mux-video-api}

- Mux では、Mux と Next.js を使用してビデオコースを作成するための[スターターテンプレート](https://github.com/muxinc/video-course-starter-kit)を提供しています。
- Next.js アプリケーション向けに[高性能な動画を埋め込む](https://www.mux.com/for/nextjs)ための Mux の推奨事項を学ぶことができます。
- Next.js と Mux の使用を示す[サンプルプロジェクト](https://with-mux-video.vercel.app/)を探索できます。

### Fastly {#fastly}

- Next.js に Fastly のソリューションを統合して[ビデオオンデマンド](https://www.fastly.com/products/streaming-media/video-on-demand)およびストリーミングメディアを配信する方法について学んでください。

### ImageKit.io の統合 {#imagekit-io-integration}

- ImageKit を Next.js に統合するための[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs)を確認してください。
- 統合には `<IKVideo>` コンポーネントが含まれ、[シームレスな動画サポート](https://imagekit.io/docs/integration/nextjs#rendering-videos)を提供します。
- Node.js SDK など、他の[ImageKit ライブラリ](https://imagekit.io/docs)も探索できます。
