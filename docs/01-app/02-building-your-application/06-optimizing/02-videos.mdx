---
title: 'ビデオ最適化'
nav_title: 'ビデオ'
description: 'Next.jsアプリケーションにおけるビデオの最適化のための推奨事項とベストプラクティス'
---

このページでは、Next.jsアプリケーションでビデオを使用する方法について説明し、パフォーマンスに影響を与えずにビデオファイルを保存し表示する方法を示します。

## `<video>`と`<iframe>`の使用 {#using-video-and-iframe}

ビデオは、HTMLの**`<video>`**タグを使用して直接ビデオファイルを埋め込んだり、**`<iframe>`**を使用して外部プラットフォームにホストされたビデオを埋め込むことができます。

### `<video>` {#video}

HTMLの[`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)タグは、自己ホスティングされたコンテンツや直接提供されるビデオコンテンツを埋め込むことができ、再生と外観を完全に制御できます。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### 一般的な`<video>`タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                                                      | 例                                   |
| ------------- | --------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `src`         | ビデオファイルのソースを指定します                                                                        | `<video src="/path/to/video.mp4" />` |
| `width`       | ビデオプレーヤーの幅を設定します                                                                          | `<video width="320" />`              |
| `height`      | ビデオプレーヤーの高さを設定します                                                                        | `<video height="240" />`             |
| `controls`    | 存在する場合、デフォルトの再生制御セットを表示します                                                      | `<video controls />`                 |
| `autoPlay`    | ページが読み込まれたときに自動的にビデオを再生します。注：再生ポリシーはブラウザによって異なります        | `<video autoPlay />`                 |
| `loop`        | ビデオの再生をループします                                                                                | `<video loop />`                     |
| `muted`       | デフォルトで音声をミュートします。通常は`autoPlay`と共に使用されます                                      | `<video muted />`                    |
| `preload`     | ビデオの事前読み込み方法を指定します。値は `none`、`metadata`、`auto` です。                              | `<video preload="none" />`           |
| `playsInline` | iOSデバイスでのインライン再生を有効にします。iOS Safariでの自動再生を機能させるために必要なことが多いです | `<video playsInline />`              |

> **Good to know**: `autoPlay`属性を使用する際は、`muted`属性も含めて、ビデオがほとんどのブラウザで自動再生されるようにし、iOSデバイスとの互換性を確保するために`playsInline`属性を含めることが重要です。

ビデオ属性の包括的なリストについては、[MDNドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes)を参照してください。

### ビデオのベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ**: `<video>`タグを使用する場合、ビデオ再生をサポートしていないブラウザのためにタグ内にフォールバックコンテンツを含めます。
- **字幕またはキャプション**: 聴覚障害があるまたは聴覚に障害があるユーザーのために、字幕またはキャプションを含めてください。 `<video>`要素と併せて[`<track>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track)タグを使用してキャプションファイルのソースを指定します。
- **アクセシブルコントロール**: キーボードナビゲーションやスクリーンリーダー互換性のためには、標準のHTML5ビデオコントロールが推奨されます。高度なニーズに対しては、[react-player](https://github.com/cookpete/react-player)や[video.js](https://videojs.com/)などのサードパーティプレーヤーを検討し、アクセシブルなコントロールと一貫したブラウザ体験を提供します。

### `<iframe>` {#iframe}

HTMLの`<iframe>`タグは、YouTubeやVimeoなどの外部プラットフォームからビデオを埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### 一般的な`<iframe>`タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                                 | 例                                     |
| ----------------- | -------------------------------------------------------------------- | -------------------------------------- |
| `src`             | 埋め込みたいページのURLを指定する                                    | `<iframe src="https://example.com" />` |
| `width`           | iframeの幅を設定                                                     | `<iframe width="500" />`               |
| `height`          | iframeの高さを設定                                                   | `<iframe height="300" />`              |
| `allowFullScreen` | iframeのコンテンツをフルスクリーンモードで表示することを許可します。 | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe内のコンテンツに追加の制限を課す                               | `<iframe sandbox />`                   |
| `loading`         | 読み込み動作を最適化する（例：遅延読み込み）。                       | `<iframe loading="lazy" />`            |
| `title`           | アクセシビリティーをサポートするためにiframeにタイトルを提供します。 | `<iframe title="Description" />`       |

iframe属性の包括的なリストについては、[MDNドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes)を参照してください。

### ビデオ埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.jsアプリケーションでビデオを埋め込む方法は2つあります：

- **自己ホストまたは直接のビデオファイル**: プレーヤーの機能と外観を詳細に制御する必要がある場合、`<video>`タグを使用して自己ホスト型ビデオを埋め込みます。この統合方法はNext.js内でカスタマイズ可能であり、ビデオコンテンツを詳細に制御できます。
- **ビデオホスティングサービスの活用（YouTube、Vimeoなど）**: YouTubeやVimeoなどの動画ホスティングサービスを利用する場合、`<iframe>`タグを使用してそのiframeベースのプレーヤーを埋め込みます。この方法ではプレーヤーの一部の制御は制限されますが、これらのプラットフォームが提供する使いやすさと機能を利用できます。

アプリケーションの要件と提供したいユーザーエクスペリエンスに合致する埋め込み方法を選択してください。

### 外部ホストされた動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームからビデオを埋め込むには、Next.jsを使ってビデオ情報を取得し、React Suspenseを使って読み込み中のフォールバック状態を処理することができます。

**1. ビデオ埋め込み用のサーバーコンポーネントを作成する**

最初のステップは、ビデオを埋め込むための適切なiframeを生成する[Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components)を作成することです。このコンポーネントはビデオのソースURLを取得してiframeをレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. React Suspenseを使ったビデオコンポーネントのストリーム**

ビデオを埋め込むためのServer Componentを作成した後、次のステップとして[React Suspense](https://react.dev/reference/react/Suspense)を使ってコンポーネントを[ストリーム](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)します。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* ページの他のコンテンツ */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームからビデオを埋め込む際は、次のベストプラクティスを考慮してください：
>
> - ビデオ埋め込みをレスポンシブにしましょう。CSSを使ってiframeやビデオプレーヤーがさまざまな画面サイズに適応するようにしましょう。
> - 特にデータプランが限られているユーザー向けに、ネットワーク条件に基づいた[ビデオの読み込み戦略](https://yoast.com/site-speed-tips-for-faster-video/)を実装しましょう。

このアプローチにより、ページブロックが防止され、ビデオコンポーネントがストリーミングされる間も、ユーザーがページと対話できるようになり、より良いユーザー体験が提供されます。

より魅力的で情報豊かな読み込み体験を提供するため、フォールバックUIとして読み込みスケルトンを使用することを検討してください。単純な読み込みメッセージを表示する代わりに、次のようにビデオプレーヤーに似たスケルトンを表示します：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* ページの他のコンテンツ */}
    </section>
  )
}
```

## 自己ホスト型ビデオ {#self-hosted-videos}

自己ホスト型ビデオには、以下のようにいくつかの利点があります：

- **完全な管理と独立性**: 自己ホスト型では、外部プラットフォームの制約に縛られることなく、ビデオコンテンツを直接管理できます。
- **特定のニーズに対するカスタマイズ**: 動的背景ビデオなど、独自の要件に最適であり、デザインと機能のニーズに合わせたカスタマイズが可能です。
- **パフォーマンスとスケーラビリティ考慮**: 効果的に増加するトラフィックとコンテンツのサイズをサポートするために、パフォーマンスが高くスケーラブルなストレージソリューションを選択します。
- **コストと統合**: Next.jsフレームワークおよび広範な技術エコシステムに容易に統合するためのストレージと帯域幅のコストバランスをとります。

### Vercel Blobを使用したビデオホスティング {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)は効率的なビデオホスティング手段を提供しており、Next.jsとよく連携するスケーラブルなクラウドストレージソリューションを提供します。Vercel Blobを利用してビデオをホストする方法を以下に示します：

**1. Vercel Blobへのビデオアップロード**

Vercelダッシュボードで「ストレージ」タブに移動し、自分の[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)ストアを選択します。Blobテーブルの右上にある「アップロード」ボタンをクリックし、アップロードしたいビデオファイルを選択します。アップロードが完了すると、ビデオファイルがBlobテーブルに表示されます。

また、サーバーアクションを使用してビデオをアップロードすることもできます。詳細な手順については、[サーバーサイドアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload)に関するVercelのドキュメントを参照してください。Vercelは[クライアントサイドアップロード](https://vercel.com/docs/storage/vercel-blob/client-upload)もサポートしています。この方法は、特定のユースケースに適している場合があります。

**2. Next.jsでビデオを表示する**

ビデオがアップロードされ保存されると、Next.jsアプリケーションで表示することができます。以下は、`<video>`タグとReact Suspenseを使って表示する方法の例です：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページは`@vercel/blob`のURLを使用して`VideoComponent`を通じてビデオを表示します。ビデオURLが取得されビデオが表示可能になるまで、React Suspenseを使ってフォールバックを表示します。

### ビデオに字幕を追加する {#adding-subtitles-to-your-video}

ビデオに字幕がある場合は、`<video>`タグ内の`<track>`要素を使用して簡単に追加できます。ビデオファイルと同様に、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)から字幕ファイルを取得できます。以下に、字幕を含めるための`<VideoComponent>`の更新方法を示します。

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチに従うことで、Next.jsアプリケーションにビデオを効果的に自己ホストして統合することができます。

## リソース {#resources}

ビデオの最適化やベストプラクティスについてさらに学ぶために、以下のリソースを参照してください：

- **ビデオフォーマットとコーデックの理解**: MP4の互換性やWebMのWeb最適化など、ニーズに応じた適切なフォーマットとコーデックを選択します。詳細については[Mozillaのビデオコーデックに関するガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs)を参照してください。
- **ビデオ圧縮**: FFmpegなどのツールを使用して、品質とファイルサイズのバランスを取りながらビデオを効果的に圧縮します。圧縮技術については[FFmpegの公式ウェブサイト](https://www.ffmpeg.org/)で学べます。
- **解像度とビットレートの調整**: 視聴プラットフォームに応じて[解像度とビットレート](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%20measure%20different%20aspects,yield%20different%20qualities%20of%20video)を調整し、モバイルデバイスには低めの設定を適用します。
- **コンテンツデリバリーネットワーク（CDN）**: 動画の配信速度を向上させ、高トラフィックを管理するためCDNを利用します。一部のストレージソリューション（Vercel Blobなど）を使用する際、多くの場合CDN機能が自動的に処理されます。CDNとその利点については[こちら](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)から学んでください。

Next.jsプロジェクトにビデオを統合するためのプラットフォームを以下に紹介します：

### オープンソース`next-video`コンポーネント {#open-source-next-video-component}

- [Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)、S3、Backblaze、Muxなどのさまざまなホスティングサービスと互換性のある`<Video>`コンポーネントをNext.js用に提供します
- 異なるホスティングサービスでの`next-video.dev`の利用に関する[詳細なドキュメント](https://next-video.dev/docs)があります

### Cloudinaryインテグレーション {#cloudinary-integration}

- CloudinaryをNext.jsで使用するための公式[ドキュメントと統合ガイド](https://next.cloudinary.dev/)
- [ビデオサポートの提供](https://next.cloudinary.dev/cldvideoplayer/basic-usage)を行うための`<CldVideoPlayer>`コンポーネントを含みます
- CloudinaryとNext.jsを統合する[例](https://github.com/cloudinary-community/cloudinary-examples/?tab=readme-ov-file#nextjs)には、[自動ビットレートストリーミング](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr)が含まれています
- 他の[Cloudinaryライブラリ](https://cloudinary.com/documentation)にはNode.js SDKも利用できます

### MuxビデオAPI {#mux-video-api}

- MuxとNext.jsを使用した動画コースを作成するための[Muxのスターターテンプレート](https://github.com/muxinc/video-course-starter-kit)
- Next.jsアプリケーション向けの[高性能ビデオ埋め込み](https://www.mux.com/for/nextjs)に関するMuxの推奨事項を学ぶ
- Next.jsとのMuxのデモプロジェクトを探索する[例](https://with-mux-video.vercel.app/)

### Fastly {#fastly}

- Next.jsにオンデマンドビデオ配信とストリーミングメディアを統合するためのFastlyのソリューションについて[詳しく学ぶ](https://www.fastly.com/products/streaming-media/video-on-demand)

### ImageKit.ioインテグレーション {#imagekit-io-integration}

- Next.jsとImageKitを統合するための[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs)
- 統合は[シームレスなビデオサポート](https://imagekit.io/docs/integration/nextjs#rendering-videos)を提供する`<IKVideo>`コンポーネントを提供します
- Node.js SDKなど、他の[ImageKitライブラリ](https://imagekit.io/docs)も利用できます
