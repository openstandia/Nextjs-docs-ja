---
title: 'Video Optimization'
nav_title: 'Videos'
description: 'Next.js アプリケーション内での動画最適化に関する推奨事項とベストプラクティス'
---

このページでは、Next.js アプリケーションで動画を使用する方法を説明します。性能に影響を与えずに動画ファイルを保存し表示する方法を紹介します。

## `<video>` と `<iframe>` の使用 {#using-video-and-iframe}

ページに動画を埋め込む方法は、HTML の **`<video>`** タグを使用して直接動画ファイルを埋め込むか、**`<iframe>`** を使用して外部プラットフォームにホストされた動画を埋め込むことができます。

### `<video>` {#video}

HTML の [`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video) タグを使用すると、自己ホストまたは直接提供される動画コンテンツを埋め込むことができ、再生や外観に関する完全な制御が可能です。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### よく使われる `<video>` タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                                                                   | 例                                   |
| ------------- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `src`         | 動画ファイルのソースを指定します。                                                                                     | `<video src="/path/to/video.mp4" />` |
| `width`       | 動画プレーヤーの幅を設定します。                                                                                       | `<video width="320" />`              |
| `height`      | 動画プレーヤーの高さを設定します。                                                                                     | `<video height="240" />`             |
| `controls`    | この属性が存在する場合、デフォルトの再生コントロールが表示されます。                                                   | `<video controls />`                 |
| `autoPlay`    | ページが読込まれた際、自動的に動画の再生を開始します。注意：自動再生ポリシーはブラウザにより異なります。               | `<video autoPlay />`                 |
| `loop`        | 動画の再生をループします。                                                                                             | `<video loop />`                     |
| `muted`       | デフォルトでオーディオをミュートにします。通常は `autoPlay` と共に使用されます。                                       | `<video muted />`                    |
| `preload`     | 動画をどのようにプリロードするかを指定します。値：`none`, `metadata`, `auto`。                                         | `<video preload="none" />`           |
| `playsInline` | iOS デバイスでのインライン再生を可能にし、自動再生を iOS Safari で機能させるために必要な場合があるアトリビュートです。 | `<video playsInline />`              |

> **Good to know**: `autoPlay` 属性を使用する場合、多くのブラウザで自動再生を確実に行うために `muted` 属性も含めることが重要です。また、iOS デバイスの互換性を確保するために `playsInline` 属性も追加してください。

動画の属性についての詳細なリストは、[MDN ドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes)を参照してください。

### 動画のベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ**：`<video>` タグを使用する場合、動画の再生がサポートされていないブラウザのためにタグ内にフォールバックコンテンツを含めてください
- **字幕またはキャプション**：聴覚障がいのあるユーザーのために字幕またはキャプションを提供してください。`<video>` 要素に [`<track>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track) タグを使用して、キャプションファイルのソースを指定してください
- **アクセシブルなコントロール**：キーボード操作とスクリーンリーダーの互換性を考慮して、標準の HTML5 ビデオコントロールを推奨します。高度なニーズがある場合は、[react-player](https://github.com/cookpete/react-player) や [video.js](https://videojs.com/) のようなサードパーティプレイヤーを検討してください。これらはアクセシブルなコントロールと一貫したブラウザ体験を提供します

### `<iframe>` {#iframe}

HTML の `<iframe>` タグを使用すると、YouTube または Vimeo からの動画を埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### よく使われる `<iframe>` タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                                  | 例                                     |
| ----------------- | --------------------------------------------------------------------- | -------------------------------------- |
| `src`             | 埋め込むページの URL を指定します。                                   | `<iframe src="https://example.com" />` |
| `width`           | iframe の幅を設定します。                                             | `<iframe width="500" />`               |
| `height`          | iframe の高さを設定します。                                           | `<iframe height="300" />`              |
| `allowFullScreen` | iframe のコンテンツをフルスクリーンモードで表示できるようにします。   | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe 内のコンテンツの上に追加の制限を有効にします。                 | `<iframe sandbox />`                   |
| `loading`         | ロードの動作を最適化します（例：遅延ロード）。                        | `<iframe loading="lazy" />`            |
| `title`           | アクセシビリティをサポートするために、iframe にタイトルを提供します。 | `<iframe title="Description" />`       |

iframe の属性についての詳細なリストは、[MDN ドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes)を参照してください。

### 動画埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.js アプリケーションに動画を埋め込む方法は2つあります：

- **自己ホストまたは直接動画ファイル**：詳細な制御が必要な状況では、`<video>` タグを使用して自己ホスト動画を埋め込みます。この統合方法は、Next.js 内での動画コンテンツのカスタマイズと制御を可能にします
- **YouTube や Vimeo などの動画ホスティングサービスの使用**：YouTube や Vimeo のような動画ホスティングサービスの場合、`<iframe>` タグを使用してこれらの iframe ベースのプレイヤーを埋め込みます。この方法はプレイヤーに対する制御を制限しますが、これらのプラットフォームが提供する使いやすさと機能を提供します

アプリケーションの要件や提供したいユーザーエクスペリエンスに合わせて、埋め込み方法を選んでください。

### 外部ホスティング動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームから動画を埋め込むには、Next.js を使用して動画情報を取得し、React Suspense を使用してロード中のフォールバック状態を処理することができます。

**1. 動画埋め込み用の Server Component を作成する**

最初のステップは、動画を埋め込むために適切な iframe を生成する [Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components) を作成することです。このコンポーネントは動画のソース URL を取得し、iframe をレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. React Suspense を使用して動画コンポーネントをストリームする**

動画を埋め込むための Server Component を作成した後、次のステップは [React Suspense](https://react.dev/reference/react/Suspense) を用いてコンポーネントを [ストリーム](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming) です。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* ページの他のコンテンツ */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームから動画を埋め込む際は、以下のベストプラクティスを考慮してください：
>
> - 動画埋め込みがレスポンシブであることを確認しましょう。CSS を使用して、iframe や動画プレーヤーを異なる画面サイズに適応させます。
> - 特にデータプランが限られているユーザーに対して、[ネットワーク条件に基づいた動画のロード戦略](https://yoast.com/site-speed-tips-for-faster-video/) を実装します。

このアプローチは、ページがブロックされるのを防ぎ、ページが動画コンポーネントをストリームしている間ユーザーがページと対話できるため、より良いユーザーエクスペリエンスを提供します。

より魅力的で情報豊富なロード体験を提供するために、ロードスケルトンをフォールバック UI として使用することを考慮してください。単純なロードメッセージを表示する代わりに、次のように動画プレーヤーに似たスケルトンを表示できます：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* ページの他のコンテンツ */}
    </section>
  )
}
```

## 自己ホスト動画 {#self-hosted-videos}

以下の理由から自己ホスト動画を選ぶことができます：

- **完全な制御と独立性**：自己ホストにより、外部プラットフォームの制約を受けずに、再生から外観に至るまでの動画コンテンツの直接管理と完全な所有権と制御を提供します
- **特定のニーズに対応したカスタマイズ**：動的な背景動画のような独自の要件に対して、デザインと機能のニーズに合わせたカスタマイズが可能です
- **性能とスケーラビリティの考慮**：増加するトラフィックとコンテンツサイズを効果的にサポートするため、高性能かつスケーラビリティのあるストレージソリューションを選択します
- **コストと統合**：ストレージと帯域幅のコストを、Next.js フレームワークとより広範なテクノロジーエコシステムへの統合の容易さとバランスさせます

### 動画ホスティングに Vercel Blob を使用する {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) は、Next.js と連携できるスケーラブルなクラウドストレージソリューションを提供し、動画を効率的にホスティングする方法を提供します。Vercel Blob を使用して動画をホスティングする方法は以下の通りです：

**1. 動画を Vercel Blob にアップロードする**

Vercel ダッシュボードで「ストレージ」タブに移動し、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) ストアを選択します。Blob テーブルの右上にある「アップロード」ボタンを見つけてクリックします。そして、アップロードしたい動画ファイルを選択します。アップロードが完了すると、動画ファイルは Blob テーブルに表示されます。

また、サーバーアクションを使用して動画をアップロードすることも可能です。詳細な指示は、[サーバーサイドアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload)に関する Vercel ドキュメントを参照してください。特定のユースケースに対しては、クライアントサイドアップロードもサポートされています。詳細は[Vercel の公式ドキュメント](https://vercel.com/docs/storage/vercel-blob/client-upload)を参照してください。

**2. Next.js で動画を表示する**

動画がアップロードされ保存されたら、Next.js アプリケーションで表示することができます。以下は、React Suspense と `<video>` タグを用いてこれを行う方法の例です：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページ内で `@vercel/blob` の動画 URL を使用し、`VideoComponent` を用いて動画を表示します。React Suspense を使用して、動画の URL が取得され動画が表示可能になるまでフォールバックを表示します。

### 動画に字幕を追加する {#adding-subtitles-to-your-video}

動画に字幕がある場合、`<video>` タグ内の `<track>` 要素を使用して簡単に追加できます。[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) から字幕ファイルを動画ファイルと同様な方法で取得できます。以下は、`<VideoComponent>` を更新して字幕を含める方法です。

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチを採用することで、Next.js アプリケーションに動画を効果的に自己ホストし統合することができます。

## リソース {#resources}

動画の最適化とベストプラクティスに関する知識を深めるために、次のリソースを参照してください：

- **動画形式とコーデックの理解**：適切な動画形式とコーデックを選択します。たとえば、互換性のために MP4 を、ウェブ最適化のために WebM を選択します。詳細は [Mozilla のビデオコーデックガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs)を参照してください
- **動画圧縮**：FFmpeg などのツールを使用して動画を効果的に圧縮し、品質とファイルサイズをバランスします。[FFmpeg の公式ページ](https://www.ffmpeg.org/)で圧縮技術を学びます
- **解像度とビットレートの調整**：閲覧プラットフォームに基づいて[解像度とビットレート](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%20measure%20different%20aspects,yield%20different%20qualities%20of%20video)を調整し、モバイルデバイスにはより低い設定を適用します
- **コンテンツデリバリネットワーク (CDN)**：CDN を活用して、動画配信速度を向上させ、高トラフィックを効率的に管理します。Vercel Blob などの一部のストレージソリューションを使用する場合、CDN 機能は自動的に管理されます。[CDN とその利点についてさらに学びます](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)

次のビデオストリーミングプラットフォームを探索して、Next.js プロジェクトに動画を統合します：

### オープンソース `next-video` コンポーネント {#open-source-next-video-component}

- 各種ホスティングサービスに互換性のある Next.js 用 `<Video>` コンポーネントを提供します。これには、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)、S3、Backblaze、Mux が含まれます
- 様々なホスティングサービスで `next-video.dev` を使用するための[詳細なドキュメント](https://next-video.dev/docs)があります

### Cloudinary 統合 {#cloudinary-integration}

- Next.js で Cloudinary を使用するための[公式ドキュメントと統合ガイド](https://next.cloudinary.dev/)があります
- [手軽な動画サポート](https://next.cloudinary.dev/cldvideoplayer/basic-usage)のための `<CldVideoPlayer>` コンポーネントを含んでいます
- [Adaptive Bitrate Streaming](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr) を含む、Next.js との Cloudinary 統合の[例](https://github.com/cloudinary-community/cloudinary-examples/?tab=readme-ov-file#nextjs)を見つけることができます
- Node.js SDK など、他の[Cloudinary ライブラリ](https://cloudinary.com/documentation)も利用可能です

### Mux Video API {#mux-video-api}

- Mux と Next.js でビデオコースを作成するための[スターターテンプレート](https://github.com/muxinc/video-course-starter-kit)を提供しています
- Mux の Next.js アプリケーションのための[高性能な動画埋め込み推奨事項](https://www.mux.com/for/nextjs)について学びます
- Next.js との Mux を実証する[サンプルプロジェクト](https://with-mux-video.vercel.app/)を探ります

### Fastly {#fastly}

- Next.js に Fastly の[オンデマンド動画](https://www.fastly.com/products/streaming-media/video-on-demand)とメディアストリーミングソリューションを統合する方法について詳しく学びます

### ImageKit.io 統合 {#imagekit-io-integration}

- Next.js と ImageKit 統合のための[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs)をチェックします
- 統合により、シームレスなビデオサポートを提供する `<IKVideo>` コンポーネントが提供されます。詳細は[こちら](https://imagekit.io/docs/integration/nextjs#rendering-videos)を参照してください
- Node.js SDK などの他の[ImageKit ライブラリ](https://imagekit.io/docs)も利用可能です
