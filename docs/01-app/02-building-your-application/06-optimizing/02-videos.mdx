---
title: 'Video Optimization'
nav_title: 'Videos'
description: 'Next.js アプリケーションにおける動画の最適化に関する推奨事項とベストプラクティス'
---

このページでは、Next.js アプリケーションで動画を使用する方法を説明し、動画ファイルを保存し、パフォーマンスを損なうことなく表示する方法を紹介します。

## `<video>` と `<iframe>` の使用 {#using-video-and-iframe}

動画は、HTML の **`<video>`** タグを使って直接動画ファイルを埋め込んだり、外部プラットフォームにホストされている動画を表示する場合は **`<iframe>`** を使ったりすることができます。

### `<video>` {#video}

HTML の [`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video) タグを使うと、セルフホストまたは直接提供される動画コンテンツを埋め込むことができ、再生や見た目を完全に制御できます。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### 一般的な `<video>` タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                         | 例                                   |
| ------------- | ---------------------------------------------------------------------------- | ------------------------------------ |
| `src`         | 動画ファイルのソースを指定します                                             | `<video src="/path/to/video.mp4" />` |
| `width`       | 動画プレイヤーの幅を設定します                                               | `<video width="320" />`              |
| `height`      | 動画プレイヤーの高さを設定します                                             | `<video height="240" />`             |
| `controls`    | デフォルトの再生コントロールを表示します                                     | `<video controls />`                 |
| `autoPlay`    | ページが読み込まれたときに自動的に動画を再生します                           | `<video autoPlay />`                 |
| `loop`        | 動画再生をループします                                                       | `<video loop />`                     |
| `muted`       | デフォルトで音声をミュートします。`autoPlay` と一緒に使われることが多いです  | `<video muted />`                    |
| `preload`     | 動画をどのようにプリロードするかを指定します。値：`none`、`metadata`、`auto` | `<video preload="none" />`           |
| `playsInline` | iOS デバイスでのインライン再生を可能にします                                 | `<video playsInline />`              |

> **Good to know**: `autoPlay` 属性を使用する場合、ほとんどのブラウザで動画を自動再生するために `muted` 属性も含めることが重要です。また、iOS デバイスと互換性を保つために `playsInline` 属性も含めることをお勧めします。

動画属性の包括的なリストについては、[MDN のドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes)を参照してください。

### 動画のベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ**: `<video>` タグを使用する場合、動画再生をサポートしないブラウザではフォールバックコンテンツをタグの中に含めてください
- **字幕やキャプション**: 聴覚障害者や難聴のユーザーのために字幕やキャプションを含めてください。`<video>` 要素で [`<track>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track) タグを使用してキャプションファイルのソースを指定してください
- **アクセシブルなコントロール**: 標準 HTML5 動画コントロールは、キーボードナビゲーションとスクリーンリーダー互換性のために推奨されます。高度なニーズには、アクセス可能なコントロールと一貫したブラウザの体験を提供する [react-player](https://github.com/cookpete/react-player) や [video.js](https://videojs.com/) などのサードパーティプレイヤーを検討してください

### `<iframe>` {#iframe}

HTML `<iframe>` タグを使用すると、YouTube や Vimeo のような外部プラットフォームから動画を埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### 一般的な `<iframe>` タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                             | 例                                     |
| ----------------- | ---------------------------------------------------------------- | -------------------------------------- |
| `src`             | 埋め込むページの URL を指定します                                | `<iframe src="https://example.com" />` |
| `width`           | iframe の幅を設定します                                          | `<iframe width="500" />`               |
| `height`          | iframe の高さを設定します                                        | `<iframe height="300" />`              |
| `allowFullScreen` | iframe コンテンツを全画面モードで表示することを許可します        | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe 内のコンテンツへの制限を追加します                        | `<iframe sandbox />`                   |
| `loading`         | 読み込み動作を最適化します（例：遅延読み込み）                   | `<iframe loading="lazy" />`            |
| `title`           | アクセシビリティをサポートするために iframe にタイトルを付けます | `<iframe title="Description" />`       |

iframe 属性の包括的なリストについては、[MDN のドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes)を参照してください。

### 動画埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.js アプリケーションで動画を埋め込む方法は2つあります：

- **セルフホストまたは直接の動画ファイル**: プレイヤーの機能と見た目を詳しく制御する必要がある場合は `<video>` タグを使ってセルフホスト動画を埋め込んでください。この統合方法は、Next.js 内でのカスタマイズと動画コンテンツの制御を可能にします
- **動画ホスティングサービスの使用（YouTube、Vimeo など）**: YouTube や Vimeo のような動画ホスティングサービスでは、iframeベースのプレイヤーを `<iframe>` タグを使って埋め込みます。この方法はプレイヤーの一部制御を制限しますが、これらのプラットフォームが提供する使いやすさと機能を提供します

アプリケーションの要件や提供したいユーザー体験に合った埋め込み方法を選択してください。

### 外部ホスト動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームの動画を埋め込むには、Next.js を使用して動画情報を取得し、React Suspense を使って読み込み中のフォールバック状態を処理します。

**1. 動画埋め込み用のサーバーコンポーネントを作成する**

最初のステップは、動画を埋め込むための適切な iframe を生成する [Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components) を作成することです。このコンポーネントは動画のソース URL を取得し、iframe をレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. React Suspense を使って動画コンポーネントをストリーミングする**

動画を埋め込む Server Component を作成したら、次に [React Suspense](https://react.dev/reference/react/Suspense) を使ってコンポーネントを[ストリーミング](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)します。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* Other content of the page */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームから動画を埋め込む際のベストプラクティス：
>
> - 動画埋め込みはレスポンシブであることが重要です。CSS を使用して、iframe または動画プレイヤーをさまざまな画面サイズに適応させてください。
> - 特にデータプランが制限されているユーザー向けに、ネットワーク状況に基づいた[動画読み込みの戦略](https://yoast.com/site-speed-tips-for-faster-video/)を実装してください。

この方法は、ページのブロックを防ぐため、ユーザーが動画コンポーネントがストリーミングされる間にページと対話できることを保証し、より良いユーザー体験を提供します。

より魅力的で情報豊富なローディング体験を提供するために、フォールバック UI としてローディングスケルトンを使用することを検討してください。この方法では、単純なローディングメッセージを表示する代わりに、次のように動画プレイヤーに似たスケルトンを表示することができます：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* Other content of the page */}
    </section>
  )
}
```

## セルフホストされた動画 {#self-hosted-videos}

セルフホスト動画は、次のような理由で好まれます：

- **完全な制御と独立性**: セルフホストは、再生から見た目まで、動画コンテンツの直接的な管理を提供し、外部プラットフォームの制約から解放された完全な所有権と制御を確保します
- **特定のニーズに合わせたカスタマイズ**: 動的背景動画などのユニークな要件に理想的で、デザインと機能のニーズと一致するようにカスタマイズが可能です
- **パフォーマンスとスケーラビリティの考慮**: 効果的に増加するトラフィックとコンテンツサイズをサポートするために、高性能でスケーラブルなストレージソリューションを選択してください
- **コストと統合**: ストレージと帯域幅のコストを Next.js フレームワークおよび広範な技術エコシステムへの容易な統合の必要性とバランスを取ってください

### Vercel Blob を使った動画ホスティング {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) は、Next.js によく適合するスケーラブルなクラウドストレージソリューションを提供し、動画をホスティングする効率的な方法を提供します。Vercel Blob を使って動画をホスティングする方法がこちらです：

**1. Vercel Blob に動画をアップロードする**

Vercel のダッシュボードで、 "Storage" タブに移動し、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) ストアを選択します。Blob テーブルの右上にある "Upload" ボタンを見つけてクリックし、アップロードしたい動画ファイルを選択します。アップロードが完了すると、動画ファイルが Blob テーブルに表示されます。

また、サーバーアクションを使用して動画をアップロードすることもできます。詳細な手順については、Vercel の [サーバーサイドアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload) に関するドキュメントを参照してください。Vercel は [クライアントサイドアップロード](https://vercel.com/docs/storage/vercel-blob/client-upload) もサポートしています。特定のユースケースには、この方法が好ましいかもしれません。

**2. Next.js で動画を表示する**

動画がアップロードされ、保存されたら、Next.js アプリケーションで表示することができます。以下に、`<video>` タグと React Suspense を使ってこれを行う方法の例を示します：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページはビデオの `@vercel/blob` URL を使用して `VideoComponent` を使って動画を表示します。React Suspense は、動画 URL を取得して動画が表示される準備ができるまでフォールバックを表示するために使用されます。

### 動画に字幕を追加する {#adding-subtitles-to-your-video}

動画に字幕がある場合、`<video>` タグ内に `<track>` 要素を使って容易に追加することができます。動画ファイルと同様に [Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) から字幕ファイルを取得することができます。ここでは字幕を含むように `<VideoComponent>` を更新する方法を紹介します：

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチに従うことで、Next.js アプリケーションに動画を効果的にセルフホストし、統合することができます。

## リソース {#resources}

動画の最適化とベストプラクティスについてさらに学習するには、以下のリソースをご覧ください：

- **動画形式とコーデックの理解**: MP4 の互換性や WebM のウェブ最適化など、あなたの動画ニーズに合った形式とコーデックを選択してください。詳しくは [Mozilla の動画コーデックガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs) をご覧ください
- **動画圧縮**: FFmpeg などのツールを使って効果的に動画を圧縮し、品質とファイルサイズのバランスを取りましょう。圧縮技術についての詳細は[FFmpeg の公式サイト](https://www.ffmpeg.org/)で学ぶことができます
- **解像度とビットレートの調整**: 視聴プラットフォームに基づいて[解像度とビットレート](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%20measure%20different%20aspects,yield%20different%20qualities%20of%20video)を調整し、モバイルデバイス向けには低い設定を検討しましょう
- **コンテンツ配信ネットワーク (CDN)**: 動画配信速度を向上させ、トラフィックを管理するために CDN を利用しましょう。一部のストレージソリューションを使用する場合、例：Vercel Blob、CDN 機能は自動的に処理されます。CDN とその利点については[こちら](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)を参照してください。

Next.js プロジェクトに動画を統合するために、これらの動画ストリーミングプラットフォームを探索してください：

### オープンソース `next-video` コンポーネント {#open-source-next-video-component}

- Vercel Blob、S3、Backblaze、MUX など、さまざまなホスティングサービスと互換性のある Next.js 用 `<Video>` コンポーネントを提供します
- 異なるホスティングサービスと `next-video.dev` を使用するための[詳細なドキュメント](https://next-video.dev/docs)

### Cloudinary の統合 {#cloudinary-integration}

- Next.js と Cloudinary を使用するための公式[ドキュメントおよび統合ガイド](https://next.cloudinary.dev/)
- [動画サポート](https://next.cloudinary.dev/cldvideoplayer/basic-usage)のための `<CldVideoPlayer>` コンポーネントが含まれており
- Cloudinary と Next.js の統合事例や、[Adaptive Bitrate Streaming](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr) の事例を見ることができます
- Node.js SDK などの[他の Cloudinary ライブラリ](https://cloudinary.com/documentation)も利用可能です

### Mux Video API {#mux-video-api}

- Mux および Next.js を使用して動画コースを作成するための [スターターテンプレート](https://github.com/muxinc/video-course-starter-kit) を提供します
- Next.js アプリケーションのための[高性能動画埋め込み](https://www.mux.com/for/nextjs)に関する Mux の推奨事項を学ぶこと
- Mux と Next.js を組み合わせた[例プロジェクト](https://with-mux-video.vercel.app/)を探索すること

### Fastly {#fastly}

- Next.js にストリーミングメディアおよび[ビデオオンデマンド](https://www.fastly.com/products/streaming-media/video-on-demand)を統合するための Fastly のソリューションについて学ぶこと

### ImageKit.io の統合 {#imagekit-io-integration}

- Next.js と ImageKit を統合するための[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs)をチェックしてください。
- 統合は、[シームレスなビデオサポート](https://imagekit.io/docs/integration/nextjs#rendering-videos)を提供する `<IKVideo>` コンポーネントを提供します。
- ノード.js SDK などの[他の ImageKit ライブラリ](https://imagekit.io/docs)を探索することができます。
