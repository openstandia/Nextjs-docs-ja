---
title: 'Server Components'
description: 'React Server Components を活用して、アプリケーションの一部をサーバー上でレンダリングする方法を学びます。'
related:
  description: 'Next.js がデータと静的レンダリングの結果をどのようにキャッシュするか学びます。'
  links:
    - app/building-your-application/caching
---

React Server Components を使用すると、UI をサーバー上でレンダリングし、必要に応じてキャッシュすることができます。Next.js では、ルートセグメントごとにレンダリング作業をさらに分割し、ストリーミングや部分レンダリングを可能にしています。サーバーレンダリングには次の3つの異なる戦略があります：

- [Static Rendering](#static-rendering-default)
- [Dynamic Rendering](#dynamic-rendering)
- [Streaming](#streaming)

このページでは、Server Components がどのように機能するのか、どのような場面で使用するのか、そしてさまざまなサーバーレンダリングの戦略について説明します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことには、次のような利点があります：

- **データフェッチング**: Server Components により、データソースに近いサーバー上でデータフェッチを移動できます。これにより、レンダリングに必要なデータの取得時間が短縮され、クライアントが行うリクエストの数を減らすことで、パフォーマンスを向上させます。
- **セキュリティ**: Server Components により、トークンや API キーなどの機密データとロジックをクライアントに公開するリスクなくサーバーに保持できます。
- **キャッシング**: サーバーでレンダリングすることで、その結果をキャッシュし、後続のリクエストやユーザー間で再利用できます。これにより、各リクエストで行うレンダリングやデータフェッチの量を減らすことで、パフォーマンスを向上させ、コストを削減できます。
- **パフォーマンス**: Server Components は、基本的な部分からパフォーマンスを最適化するための追加ツールを提供します。たとえば、完全に Client Components で構成されたアプリを始め、非対話的な UI 部分を Server Components に移動することで、クライアントサイドのJavaScriptの量を減らすことができます。これは、インターネット速度が遅いユーザーや性能の低いデバイスを使用しているユーザーにとって有益です。ブラウザがダウンロード、解析、実行するクライアントサイドのJavaScriptが減りますから。
- **初期ページロードと[ファーストコンテンツフルペイント（FCP）](https://web.dev/fcp/)**: サーバー上で HTML を生成し、ユーザーがページをすぐに閲覧できるようにします。これにより、クライアントがページをレンダリングするために必要な JavaScript をダウンロードし、解析し、実行するまで待つ必要がなくなります。
- **検索エンジン最適化とソーシャルネットワークでの共有性**: レンダリングされた HTML は、検索エンジンのボットによってページがインデックス化される際や、ソーシャルネットワークのボットがページのソーシャルカードプレビューを生成する際に利用されます。
- **ストリーミング**: Server Components により、レンダリング作業をチャンクに分割し、準備ができ次第、それらをクライアントにストリームすることができます。これにより、ユーザーはページ全体がサーバー上でレンダリングされるのを待たずに、ページの一部を早く見ることができます。

## Next.jsでServer Componentsを使用する {#using-server-components-in-next-js}

デフォルトでは、Next.js は Server Components を使用します。これにより、追加の設定なしにサーバーレンダリングを自動的に実装でき、必要に応じて Client Components を使用することができます。[Client Components](/docs/app/building-your-application/rendering/client-components)を参照してください。

## Server Componentsはどのようにレンダリングされますか？ {#how-are-server-components-rendered}

サーバー上で、Next.js は React の API を使用してレンダリングを指揮します。レンダリング作業はチャンクに分割されます： 個々のルートセグメントと [Suspense Boundaries](https://react.dev/reference/react/Suspense) によってです。

各チャンクは次の2段階でレンダリングされます：

1. React が Server Components を **React Server Component Payload（RSC Payload）** と呼ばれる特別なデータ形式にレンダリングします。
2. Next.js が RSC Payload と Client Component の JavaScript 命令を使用して、サーバー上で **HTML** をレンダリングします。

{/* レンダリング図 */}

次に、クライアント上では：

1. HTML はルートの素早く非対話的なプレビューを即座に表示するために使用されます。これは初期ページロード時のみです。
2. React Server Components Payload は、Client Component ツリーと Server Component ツリーを調整して、DOM を更新するために使用されます。
3. JavaScript 命令は Client Components を[ハイドレート](https://react.dev/reference/react-dom/client/hydrateRoot)し、アプリケーションを対話可能にします。

> #### React Server Component Payload（RSC）とは
>
> RSC Payload はレンダリングされた React Server Components のツリーをコンパクトなバイナリ形式で表現したものです。クライアント上の React によってブラウザの DOM を更新するために使用されます。RSC Payload には以下が含まれています：
>
> - Server Components のレンダリング結果
> - Client Components がレンダリングされる場所のプレースホルダとそれらの JavaScript ファイルへの参照
> - Server Component から Client Component に渡されるすべての props

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングは3つのサブセットに分かれます：Static、Dynamic、Streamingです。

### Static Rendering（デフォルト） {#static-rendering-default}

Static Rendering では、ルートは **ビルド時** または [データ再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)後のバックグラウンドでレンダリングされます。その結果はキャッシュされ、[Content Delivery Network（CDN）](https://developer.mozilla.org/docs/Glossary/CDN) にプッシュされることができます。この最適化により、レンダリング作業の結果をユーザーやサーバーリクエスト間で共有できます。

静的レンダリングは、ユーザーに個別化されないデータを持ち、ビルド時に知られるデータがあるルート、たとえば静的なブログ記事や商品ページに役立ちます。

### Dynamic Rendering {#dynamic-rendering}

Dynamic Rendering では、ルートはユーザーごとに **リクエスト時** にレンダリングされます。

Dynamic Rendering は、ユーザーに個別化されたデータや、リクエスト時にのみ知られる情報（cookie や URL の検索パラメータなど）を持つルートに役立ちます。

> **データがキャッシュされた動的ルート**
>
> ほとんどのウェブサイトでは、ルートは完全に静的または完全に動的ではありません - それはスペクトラムです。たとえば、一定の間隔で再検証されるキャッシュされた商品データを使用しているが、キャッシュされていない個別化された顧客データも持つeコマースページが考えられます。
>
> Next.js では、キャッシュされたデータとキャッシュされていないデータの両方を持つ動的にレンダリングされたルートを持つことができます。これは、RSC Payload とデータが別々にキャッシュされるためです。これにより、すべてのデータをリクエスト時にフェッチすることでパフォーマンスへの影響を心配せず、動的レンダリングを選択できます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache) と [データキャッシュ](/docs/app/building-your-application/caching#data-cache) についての詳細を確認してください。

#### Dynamic Rendering に切り替える {#switching-to-dynamic-rendering}

レンダリング中に [Dynamic API](#dynamic-apis) や `{ cache: 'no-store' }` の [fetch](/docs/app/api-reference/functions/fetch) オプションが検出されると、Next.js はルート全体を動的にレンダリングするモードに切り替わります。この表は、Dynamic API とデータキャッシングがルートが静的にレンダリングされるか動的にレンダリングされるかにどのように影響するかをまとめたものです：

| Dynamic API | データ     | ルート           |
| ----------- | ---------- | ---------------- |
| No          | Cached     | 静的レンダリング |
| Yes         | Cached     | 動的レンダリング |
| No          | Not Cached | 動的レンダリング |
| Yes         | Not Cached | 動的レンダリング |

上記の表では、ルートが完全に静的であるにはすべてのデータがキャッシュされている必要があります。ただし、キャッシュされたデータフェッチとキャッシュされていないデータフェッチの両方を使用する動的にレンダリングされたルートを持つことができます。

開発者として、静的レンダリングと動的レンダリングの間で選択する必要はありません。Next.js は使用する機能や API に基づいて各ルートに最適なレンダリング戦略を自動的に選択します。代わりに、いつ[キャッシュ](/docs/app/building-your-application/data-fetching/fetching)するか、または[特定のデータを再検証する](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)かを選択し、UI の一部を[ストリーム](#streaming)することを選択できます。

### Dynamic API {#dynamic-apis}

Dynamic API はリクエスト時にのみ知ることができる情報（事前のレンダリング中には知ることができない情報）に依存します。これらのAPIのいずれかを使用すると、開発者の意図を示し、リクエスト時にルート全体を動的レンダリングに選択します。これらのAPIには次のものがあります：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)

### Streaming {#streaming}

<Image
  alt="ストリーミング中におけるルートセグメントの並列化を示す図、個々のチャンクのデータフェッチ、レンダリング、ハイドレーションを示しています。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

Streamingにより、サーバーから UI を段階的にレンダリングできます。作業はチャンクに分割され、準備ができ次第それらをクライアントにストリームします。これにより、ユーザーはコンテンツ全体のレンダリングが完了する前に、ページの一部を即座に見ることができます。

<Image
  alt="ストリーミング中のクライアントに部分的にレンダリングされたページを示す図、ストリーミングされているチャンクの読み込み UI を示しています。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

StreamingはNext.jsのApp Routerにデフォルトで組み込まれています。これにより、初期ページの読み込みパフォーマンスが改善され、例えば商品ページのレビューのように、ルート全体のレンダリングを妨げる遅いデータフェッチに依存するUIを改善します。

`loading.js`とUIコンポーネントを使用してルートセグメントをストリームし始めることができます。[React Suspense](/docs/app/building-your-application/routing/loading-ui-and-streaming)を参照してください。[Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming)のセクションを詳しくご覧ください。
