---
title: 'Server Components'
description: 'React Server Components を使ってアプリケーションの一部をサーバでレンダリングする方法を学びます。'
related:
  description: 'Next.js がデータと静的レンダリングの結果をどのようにキャッシュするかを学びます。'
  links:
    - app/building-your-application/caching
---

React Server Components を使用すると、UI をサーバーでレンダリングし、オプションでキャッシュすることができます。Next.js では、レンダリング作業がルートセグメントによってさらに分割され、ストリーミングと部分的なレンダリングを可能にします。サーバーでのレンダリング戦略には次の3つがあります：

- [Static Rendering](#static-rendering-default)
- [Dynamic Rendering](#dynamic-rendering)
- [Streaming](#streaming)

このページでは、Server Components がどのように機能するのか、使用するタイミング、異なるサーバーレンダリング戦略について解説します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことには、いくつかの利点があります：

- **データフェッチ**：Server Components を使用すると、データフェッチをデータソースに近いサーバーで行うことができます。これにより、レンダリングに必要なデータの取得時間とクライアントが行うリクエストの数を減らし、パフォーマンスを向上させることができます
- **セキュリティ**：Server Components を使用すると、トークンや API キーなどの機密データやロジックをクライアントに公開するリスクなくサーバーに保持することができます
- **キャッシング**：サーバーでレンダリングすることで、その結果をキャッシュし、サブシーケントリクエストやユーザー間で再利用することができます。これにより、各リクエストで行われるレンダリングおよびデータフェッチの量を減らすことで、パフォーマンスを向上させ、コストを削減できます
- **パフォーマンス**：Server Components は、ベースラインからパフォーマンスを最適化するための追加ツールを提供します。たとえば、最初にすべてが Client Components から成るアプリを作成した場合、UI の非対話型部分を Server Components に移動することで、必要なクライアントサイド JavaScript の量を減らすことができます。これは、インターネット速度が遅いユーザーや処理能力が低いデバイスにとって有益です。ブラウザがダウンロード、解析、実行するクライアントサイド JavaScript が少ないからです
- **初期ページ読み込みと [First Contentful Paint (FCP)](https://web.dev/fcp/)**：サーバー上で HTML を生成することで、クライアントが JavaScript のダウンロード、解析、実行を待たずして、ページをすぐに閲覧できるようにします
- **検索エンジン最適化とソーシャルネットワークでの共有可能性**：レンダリングされた HTML は、検索エンジンボットがページをインデックスするためや、ソーシャルネットワークボットがページのソーシャルカードプレビューを生成するために使用できます
- **ストリーミング**：Server Components は、レンダリング作業をチャンクに分割して、クライアント側にそれが準備できたらストリーミングすることを可能にします。これにより、ユーザーはページの一部を早く見ることができ、サーバー上でページ全体がレンダリングされるのを待つ必要がありません

## Next.js での Server Components の使用 {#using-server-components-in-next-js}

デフォルトで、Next.js は Server Components を使用します。これにより追加設定なしでサーバーレンダリングを自動的に実装でき、必要に応じて Client Components の使用を選択することもできます。詳細は [Client Components](/docs/app/building-your-application/rendering/client-components) をご覧ください。

## Server Components はどのようにレンダリングされますか？ {#how-are-server-components-rendered}

サーバー上で、Next.js は React の API を使用してレンダリングを調整します。レンダリング作業は個々のルートセグメントと [Suspense Boundaries](https://react.dev/reference/react/Suspense) によってチャンクに分割されます。

各チャンクは2つのステップでレンダリングされます：

1. React は Server Components を特別なデータフォーマットである **React Server Component Payload (RSC Payload)** にレンダリングします。
2. Next.js は RSC Payload と Client Component の JavaScript 指示を使用して、サーバー上で **HTML** をレンダリングします。

{/* Rendering Diagram */}

次に、クライアント側で：

1. HTML はルートの素早い非対話型プレビューを即座に表示するために使われます - これは初期ページ読み込み時のみです。
2. React Server Components Payload は、Client と Server Component の tree を一致させるために使われ、DOM を更新します。
3. JavaScript 指示は、Client Components を [hydrate](https://react.dev/reference/react-dom/client/hydrateRoot) し、アプリケーションを対話可能にします。

> #### React Server Component Payload (RSC) とは？
>
> RSC Payload は、レンダリングされた React Server Components tree のコンパクトなバイナリ表現です。クライアントの React がブラウザの DOM を更新するために使います。RSC Payload には以下が含まれます：
>
> - Server Components のレンダリング結果
> - Client Components をレンダリングすべき場所とその JavaScript ファイルへの参照
> - Server Component から Client Component に渡される任意の prop

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングは、Static、Dynamic、Streaming の3つのサブセットに分類されます。

### Static Rendering (デフォルト) {#static-rendering-default}

Static Rendering では、ルートは **ビルド時** または [データ再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration) 後のバックグラウンドでレンダリングされます。その結果はキャッシュされ、[Content Delivery Network (CDN)](https://developer.mozilla.org/docs/Glossary/CDN) にプッシュされることができます。この最適化により、レンダリング作業の結果をユーザーとサーバーリクエスト間で共有できます。

Static Rendering は、ユーザーにパーソナライズされないデータを持つルートや、ビルド時に既知のデータを持つルートに有用です。例えば、静的なブログ記事や商品ページなどです。

### Dynamic Rendering {#dynamic-rendering}

Dynamic Rendering では、ルートは各ユーザーに対して **リクエスト時** にレンダリングされます。

Dynamic Rendering は、ユーザーにパーソナライズされたデータや、cookie や URL の検索パラメータのようなリクエスト時にしかわからない情報を持つルートに有用です。

> **キャッシュされたデータを用いる動的ルート**
>
> ほとんどのウェブサイトでは、ルートは完全に静的でも完全に動的でもありません - スペクトラムです。例えば、定期的に再検証されるキャッシュされた商品データを使用しつつ、キャッシュされていないパーソナライズされた顧客データも持つ e コマースページを持つことができます。
>
> Next.js では、キャッシュされたデータとキャッシュされていないデータの両方を持つ動的にレンダリングされたルートを持つことができます。これは、RSC Payload とデータが別々にキャッシュされるためです。これにより、すべてのデータをリクエスト時にフェッチする際のパフォーマンスへの影響を心配することなく、動的レンダリングを選ぶことができます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache) と [データキャッシュ](/docs/app/building-your-application/caching#data-cache) についてもっと学びましょう。

#### Dynamic Rendering への切り替え {#switching-to-dynamic-rendering}

レンダリング中に Dynamic API またはキャッシュされていないデータリクエストが検出された場合、Next.js はそのルート全体を動的にレンダリングすることに切り替えます。このテーブルは、Dynamic API とデータキャッシュがルートの静的または動的なレンダリングかどうかにどのように影響するかをまとめています：

| Dynamic APIs | Data       | Route                |
| ------------ | ---------- | -------------------- |
| No           | Cached     | Statically Rendered  |
| Yes          | Cached     | Dynamically Rendered |
| No           | Not Cached | Dynamically Rendered |
| Yes          | Not Cached | Dynamically Rendered |

上記のテーブルでは、ルートを完全に静的にするためには、すべてのデータがキャッシュされている必要があります。ただし、キャッシュされたデータフェッチとキャッシュされていないデータフェッチの両方を使用する動的にレンダリングされたルートを持つことができます。

開発者としては、例えばキャッシュや特定のデータの再検証をする場合や、UIの一部を [ストリーミング](#streaming) する場合を選択されます。しかし、Next.js が各ルートに対して使用される機能と API に基づいて最適なレンダリング戦略を自動的に選択します。

### Dynamic APIs {#dynamic-apis}

Dynamic APIs はリクエスト時にしかわからない情報（事前レンダリング時に知られる情報ではない）に依存しています。これらの API のいずれかを使用することは開発者の意図を示し、リクエスト時にルート全体を動的レンダリングに切り替えます。これらの API には次のものが含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)
- [`unstable_after`](/docs/app/api-reference/functions/unstable_after)

### Streaming {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並行化を示す図。個々のチャンクのデータフェッチ、レンダリング、およびハイドレーションを示します。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングにより、サーバーから UI を順次レンダリングすることができます。作業はチャンクに分割され、クライアントにそれが準備できたらストリーミングされます。これにより、ユーザーは全コンテンツがレンダリングされる前に、ページの部分をすぐに見ることができます。

<Image
  alt="クライアント上で部分的にレンダリングされたページを示す図。ストリーミングされるチャンクのロード中の UI を含みます。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

Next.js の App Router ではデフォルトでストリーミングが組み込まれています。これにより、初期ページの読み込みパフォーマンスが向上し、レビューのように、特定のデータフェッチ依存が遅い UI のパフォーマンスも向上します。

ルートセグメントを `loading.js` と UI コンポーネントを [React Suspense](/docs/app/building-your-application/routing/loading-ui-and-streaming) を使ってストリーミングし始めることができます。詳細は [Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming) セクションをご覧ください。
