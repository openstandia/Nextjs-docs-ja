---
title: 'Server Components'
description: 'React Server Components を使用して、アプリケーションの一部をサーバーでレンダリングする方法を学びます。'
related:
  description: 'Next.js がデータと静的レンダリングの結果をどのようにキャッシュするかを学びます。'
  links:
    - app/building-your-application/caching
---

React Server Components を使用すると、UIをサーバーでレンダリングし、オプションでキャッシュすることができます。Next.js では、レンダリング作業はルートセグメントによってさらに分割され、ストリーミングや部分レンダリングを可能にします。サーバーのレンダリング戦略には以下の3つがあります：

- [Static Rendering](#static-rendering-default)
- [Dynamic Rendering](#dynamic-rendering)
- [Streaming](#streaming)

このページでは、Server Components がどのように機能するか、いつそれを使用するべきか、そして異なるサーバーレンダリング戦略について説明します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでのレンダリング作業には、いくつかの利点があります：

- **データ取得**：Server Components を使用することで、データ取得をデータソースに近いサーバーに移すことができます。これにより、レンダリングに必要なデータを取得する時間が短縮され、クライアントが行うリクエストの数も減少するため、パフォーマンスが向上します。
- **セキュリティ**：Server Components を利用することで、トークンやAPIキーなどの機密データやロジックをサーバー上に保持し、クライアントに露出するリスクを避けることができます。
- **キャッシュ**：サーバーでレンダリングすることで、結果をキャッシュし、後続のリクエストやユーザー間で再利用できます。これにより、各リクエストで行われるレンダリングとデータ取得の量を減らし、パフォーマンスを改善し、コストを削減できます。
- **パフォーマンス**：Server Components は、基本からパフォーマンスを向上させるための追加ツールを提供します。たとえば、完全に Client Components で構成されたアプリから始め、UIの非インタラクティブな部分を Server Components に移動することで、必要なクライアントサイドのJavaScriptの量を減らすことができます。これは、インターネット速度が遅い、または性能が低いデバイスを使用するユーザーにとって有益です。ブラウザがダウンロード、解析、および実行するクライアントサイドのJavaScriptが少なくなるためです。
- **初期ページロードと[First Contentful Paint (FCP)](https://web.dev/fcp/)**：サーバー上でHTMLを生成することで、クライアントがページをレンダリングするために必要なJavaScriptをダウンロード、解析、そして実行するのを待つことなく、ユーザーがすぐにページを表示できます。
- **検索エンジン最適化とソーシャルネットワークでの共有性**：レンダリングされたHTMLは、検索エンジンボットによってページをインデックス化し、ソーシャルネットワークボットがページのソーシャルカードプレビューを生成するために使用できます。
- **ストリーミング**：Server Components を使用することで、レンダリング作業をチャンクに分割し、準備が整い次第クライアントにストリーミングすることができます。これにより、ユーザーはページ全体がサーバーでレンダリングされるのを待つことなく、ページの一部を早めに見ることができます。

## Next.js で Server Components を使用する {#using-server-components-in-next-js}

デフォルトでは、Next.js は Server Components を使用します。これにより、追加の設定をせずにサーバーレンダリングを自動的に実装できます。必要に応じて、Client Components を使用することもできます。[Client Components](/docs/app/building-your-application/rendering/client-components)を参照してください。

## Server Components はどのようにレンダリングされますか？ {#how-are-server-components-rendered}

サーバー上で、Next.js は React の API を使用してレンダリングを調整します。レンダリング作業は、個別のルートセグメントや[サスペンス境界（Suspense Boundaries）](https://react.dev/reference/react/Suspense)によってチャンクに分割されます。

各チャンクは次の2ステップでレンダリングされます：

1. React は Server Components を **React Server Component Payload (RSC Payload)** と呼ばれる特殊なデータ形式にレンダリングします。
2. Next.js は RSC Payload と Client Component のJavaScript命令を使用して、サーバー上で**HTML**をレンダリングします。

{/* Rendering Diagram */}

その後、クライアント側では：

1. HTML を使用して、ルートのインタラクティブでない高速なプレビューをすぐに表示します - これは最初のページロード時のみです。
2. React Server Components Payload を使用して、Client および Server Component tree を整合し、DOM を更新します。
3. JavaScript命令を使用して、Client Components を[ハイドレート](https://react.dev/reference/react-dom/client/hydrateRoot)し、アプリケーションをインタラクティブにします。

> #### React Server Component Payload (RSC) とは？
>
> RSC Payload は、レンダリングされた React Server Components tree のコンパクトなバイナリ表現です。クライアント上でReact がブラウザのDOMを更新するために使用されます。RSC Payload には以下が含まれます：
>
> - Server Components のレンダリング結果
> - Client Components をどこにレンダリングするべきかのプレースホルダーと、それらのJavaScriptファイルへの参照
> - Server Component から Client Component に渡される任意の props

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングには、Static、Dynamic 、Streaming の3つのサブセットがあります。

### スタティックレンダリング (デフォルト) {#static-rendering-default}

スタティックレンダリングでは、ルートは**ビルド時**または[データ再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)後にバックグラウンドでレンダリングされます。その結果はキャッシュされ、[コンテンツデリバリーネットワーク(CDN)](https://developer.mozilla.org/docs/Glossary/CDN)にプッシュできます。この最適化により、レンダリング作業の結果をユーザーやサーバーリクエスト間で共有できます。

スタティックレンダリングは、ルートにユーザーごとにパーソナライズされていない、ビルド時にわかっているデータがある場合に便利です。たとえば、静的なブログ投稿や製品ページなどです。

### ダイナミックレンダリング {#dynamic-rendering}

ダイナミックレンダリングでは、ルートは**リクエスト時**に各ユーザーごとにレンダリングされます。

ダイナミックレンダリングは、ルートにユーザーごとにパーソナライズされたデータがある、またはリクエスト時にのみわかる情報がある場合に便利です。たとえば、cookie や URL の検索パラメータなどです。

> **キャッシュされたデータを持つ動的ルート**
>
> ほとんどの Web サイトでは、ルートは完全にスタティックでも完全にダイナミックでもなく、スペクトラム上にあります。たとえば、キャッシュされた製品データを使い、一定の間隔で再検証されるeコマースページに、未キャッシュの個別の顧客データを持たせることが可能です。
>
> Next.js では、キャッシュされたデータと未キャッシュのデータの両方を含む動的にレンダリングされたルートを持つことができます。これは、RSC Payload とデータが個別にキャッシュされるためです。リクエスト時にすべてのデータを取得する際のパフォーマンスへの影響を心配することなく、動的レンダリングを選択できます。
>
> 詳細は、[full-route cache](/docs/app/building-your-application/caching#full-route-cache) および [Data Cache](/docs/app/building-your-application/caching#data-cache) について学んでください。

#### ダイナミックレンダリングへの切り替え {#switching-to-dynamic-rendering}

レンダリング中に、[Dynamic API](#dynamic-apis) または未キャッシュのデータリクエストが発見されると、Next.js はルート全体をダイナミックにレンダリングするように切り替えます。この表は、Dynamic API とデータキャッシングがルートがスタティックまたはダイナミックにレンダリングされるかどうかにどのように影響するかを要約したものです：

| Dynamic APIs | Data       | Route                |
| ------------ | ---------- | -------------------- |
| No           | Cached     | Statically Rendered  |
| Yes          | Cached     | Dynamically Rendered |
| No           | Not Cached | Dynamically Rendered |
| Yes          | Not Cached | Dynamically Rendered |

上記の表では、ルートが完全にスタティックになるためには、すべてのデータがキャッシュされている必要があります。ただし、キャッシュされたデータ取得と未キャッシュのデータ取得の両方を使用する動的にレンダリングされたルートを持つことができます。

開発者として、スタティックレンダリングとダイナミックレンダリングのどちらかを選択する必要はありません。Next.js は、使用する機能やAPIに基づいて、各ルートに最適なレンダリング戦略を自動的に選択します。代わりに、[キャッシュする](/docs/app/building-your-application/data-fetching/fetching) 場所や[特定のデータを再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)する場所を選択し、UIの一部を[ストリーミング](#streaming) することを選択することができます。

### Dynamic APIs {#dynamic-apis}

Dynamic APIs は、プレンダリング時にはわからない、リクエスト時にのみ判明する情報に基づいています。これらのAPIを使用することにより、開発者の意図が示され、リクエスト時にルート全体をダイナミックレンダリングに含めることができます。これらのAPIには以下が含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)
- [`unstable_after`](/docs/app/api-reference/functions/unstable_after)

### Streaming {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並列化を示す図、個々のチャンクのデータ取得、レンダリング、ハイドレートを示しています。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングを使用することで、サーバーからUIを段階的にレンダリングできます。作業はチャンクに分割され、準備が整い次第クライアントにストリーミングされます。これにより、ユーザーはすべてのコンテンツのレンダリングが完了する前に、ページの一部を見ることができます。

<Image
  alt="クライアント側に部分的にレンダリングされたページを示す図、ストリーミングされているチャンクのロード中のUIを示しています。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

ストリーミングは、デフォルトで Next.js の App Router に組み込まれています。これにより、初期ページロードパフォーマンスの改善や、ルート全体のレンダリングをブロックする遅いデータ取得に依存するUIの改善に役立ちます。たとえば、製品ページのレビューです。

`loading.js` やUIコンポーネントと[React Suspense](/docs/app/building-your-application/routing/loading-ui-and-streaming)を使用して、ルートセグメントのストリーミングを開始できます。詳細は[Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming) セクションを参照してください。
