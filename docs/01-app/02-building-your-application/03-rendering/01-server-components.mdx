---
title: 'Server Components'
description: 'React Server Components を使用して、アプリケーションの一部をサーバーでレンダリングする方法を学びます。'
related:
  description: 'Next.js がデータと静的レンダリングの結果をどのようにキャッシュするかを学びます。'
  links:
    - app/building-your-application/caching
---

React Server Components を使用すると、サーバー側でレンダリングされる UI を記述できます。また、サーバーでキャッシュすることも選択できます。Next.js では、ストリーミングと部分的なレンダリングを可能にするために、レンダリング作業がルートセグメントによってさらに分割され、3つの異なるサーバーレンダリング戦略があります：

- [静的レンダリング](#static-rendering-default)
- [動的レンダリング](#dynamic-rendering)
- [ストリーミング](#streaming)

このページでは、Server Component の動作方法、使用するケース、および異なるサーバーレンダリング戦略について説明します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバー上でレンダリング作業を行うことには、いくつかの利点があります。以下の項目が含まれます：

- **データフェッチング**：Server Component を使用すると、データフェッチングをサーバーに移動できます。これにより、レンダリングに必要なデータの取得時間が短縮され、クライアントが行うリクエストの数も減少します。
- **セキュリティ**：Server Component を使用すると、トークンや API キーなどの機密データとロジックをサーバー上に保持できます。これにより、クライアントにさらすリスクを回避できます。
- **キャッシュ**：サーバーでレンダリングすることにより、その結果をキャッシュして、後続のリクエストおよびユーザー間で再利用することができます。これにより、各リクエストで行うレンダリングやデータフェッチングの量を減らして、パフォーマンスを向上させ、コストを削減できます。
- **パフォーマンス**：Server Component は、基本パフォーマンスを最適化するための追加ツールを提供します。たとえば、完全に Client Component で構成されたアプリから始めた場合、UI の非対話部分を Server Component に移動することで、必要なクライアントサイド JavaScript の量を削減できます。これにより、遅いインターネットや性能の低いデバイスを持つユーザーにもメリットがあります。ブラウザがダウンロード、解析、実行するクライアントサイド JavaScript が少なるためです。
- **初期ページロードと[ファースト コンテンツフル ペイント（FCP）](https://web.dev/fcp/)**：サーバー上で HTML を生成することで、クライアントが JavaScript のダウンロード、解析、ページのレンダリングに必要な JavaScript の実行を待つことなく、即座にページを表示できます。
- **検索エンジンの最適化とソーシャルネットワークでの共有性**：レンダリングされた HTML は、検索エンジンのボットがページをインデックスするためや、ソーシャルネットワークのボットがページのソーシャルカードプレビューを生成するために使用できます。
- **ストリーミング**：Server Component により、レンダリング作業をチャンクに分割して、それらが準備できたらクライアントにストリーミングすることができます。これにより、ユーザーはページ全体がサーバーでレンダリングされるのを待たずに、ページの一部を早めに見ることができます。

## Next.js における Server Component の使用 {#using-server-components-in-next-js}

デフォルトで、Next.js は Server Component を使用します。これにより、追加の設定なしでサーバーレンダリングを自動的に実装できます。必要に応じて Client Component を使用することもできます。詳細は [Client Components](/docs/app/building-your-application/rendering/client-components) を参照してください。

## Server Component はどのようにレンダリングされるか？ {#how-are-server-components-rendered}

サーバー上で、Next.js は React の API を使用してレンダリングを調整します。レンダリング作業は、個々のルートセグメントと [Suspense Boundaries](https://react.dev/reference/react/Suspense) によって分割されます。

それぞれのチャンクは2つのステップでレンダリングされます：

1. React が Server Component を特別なデータ形式、**React Server Component Payload（RSC Payload）**にレンダリングします。
2. Next.js は RSC Payload と Client Component の JavaScript 命令を使用して、サーバー上で **HTML** をレンダリングします。

{/* Rendering Diagram */}

その後、クライアントでは：

1. HTML を使用して、ルートの迅速な非対話プレビューを即座に表示します。これは初回ページロードに限ります。
2. React Server Component Payload を使用して、クライアントと Server Component のツリーを一致させ、DOM を更新します。
3. JavaScript 命令を使用して、Client Component を[ハイドレート](https://react.dev/reference/react-dom/client/hydrateRoot)し、アプリケーションを対話可能にします。

> #### React Server Component Payload (RSC) とは？
>
> RSC Payload は、レンダリングされた React Server Components ツリーのコンパクトなバイナリ表現です。クライアント上の React によってブラウザの DOM を更新するために使用されます。RSC Payload には以下が含まれます：
>
> - Server Component のレンダリング結果
> - Client Component がレンダリングされるべき場所に対するプレースホルダーと、それらの JavaScript ファイルへの参照
> - Server Component から Client Component への渡された任意の props

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングには、静的、動的、ストリーミングの3つのサブセットがあります。

### 静的レンダリング（デフォルト） {#static-rendering-default}

静的レンダリングでは、ルートは **ビルド時**、または[data や情報の再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration) の後、バックグラウンドでレンダリングされます。その結果はキャッシュされ、[コンテンツデリバリーネットワーク（CDN）](https://developer.mozilla.org/docs/Glossary/CDN) にプッシュされることができます。この最適化により、レンダリング作業の結果をユーザー間およびサーバーリクエスト間で共有できます。

静的レンダリングは、ルートがユーザーに個別化されておらず、ビルド時にわかるデータ（たとえば、静的なブログポストや製品ページ）の場合に役立ちます。

### 動的レンダリング {#dynamic-rendering}

動的レンダリングを使用すると、ルートは各ユーザーに対して **リクエスト時** にレンダリングされます。

動的レンダリングは、ルートがユーザーに個別化されたデータや、リクエスト時にのみわかる情報（たとえばcookieやURLの検索パラメータ）を持つ場合に役立ちます。

> **データがキャッシュされた動的ルート**
>
> 多くのウェブサイトでは、ルートは完全に静的または完全に動的ではなく、それらはスペクトラム上にあります。たとえば、定期的に再確認されるキャッシュされた製品データを使用するものの、キャッシュされていない個別化された顧客データも持つeコマースページがあるかもしれません。
>
> Next.js では、キャッシュされたデータとキャッシュされていないデータの両方を持つ動的にレンダリングされたルートを持つことができます。これは、RSC Payload とデータが別々にキャッシュされるためです。これにより、すべてのデータをリクエスト時にフェッチすることによるパフォーマンスへの影響を心配せずに、動的レンダリングを選択することができます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache)と[データキャッシュ](/docs/app/building-your-application/caching#data-cache)についてさらに学びましょう。

#### 動的レンダリングへの切り替え {#switching-to-dynamic-rendering}

レンダリング中に、[Dynamic API](#dynamic-apis) または [`fetch`](/docs/app/api-reference/functions/fetch) の `{ cache: 'no-store' }` オプションが発見された場合、Next.js はルート全体の動的レンダリングに切り替えます。以下の表は、Dynamic API とデータキャッシュがルートが静的または動的にレンダリングされるかどうかにどのように影響するかを示しています：

| Dynamic APIs | データ         | ルート           |
| ------------ | -------------- | ---------------- |
| いいえ       | キャッシュ済み | 静的レンダリング |
| はい         | キャッシュ済み | 動的レンダリング |
| いいえ       | キャッシュなし | 動的レンダリング |
| はい         | キャッシュなし | 動的レンダリング |

上記の表では、ルートが完全に静的であるためには、すべてのデータがキャッシュされている必要があります。ただし、キャッシュ済みおよびキャッシュされていないデータフェッチの両方を使用する動的にレンダリングされたルートを持つこともできます。

開発者として、静的レンダリングと動的レンダリングのどちらを選択する必要はありません。Next.js は、使用される機能や API に基づいて、各ルートに最適なレンダリング戦略を自動的に選択します。代わりに、[特定のデータをキャッシュする](/docs/app/building-your-application/data-fetching/fetching)または[再検証する](/docs/app/building-your-application/data-fetching/incremental-static-regeneration) 時期を選び、UI の一部を[ストリーミング](/docs/app/building-your-application/routing/loading-ui-and-streaming)するかどうかを選ぶことができます。

### Dynamic APIs {#dynamic-apis}

Dynamic API は、事前レンダリング中に事前に知ることができない情報に依存します。これらの API のいずれかを使用すると、開発者の意図が示され、リクエスト時にルート全体を動的レンダリングに切り替えることができます。これらの API には次のものが含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)

### ストリーミング {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並行化を示す図。個々のチャンクのデータフェッチ、レンダリング、およびハイドレーションを示しています。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングにより、サーバーから UI を段階的にレンダリングできます。作業はチャンクに分割され、準備ができたらクライアントにストリーミングされます。これにより、ユーザーはコンテンツ全体がレンダリングされる前にページの一部を即座に確認できます。

<Image
  alt="クライアント上で部分的にレンダリングされたページを示す図。ストリーミング中のチャンクのロード中の UI が表示されています。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

ストリーミングはデフォルトで Next.js の App Router に組み込まれています。これにより、初回ページロードのパフォーマンスと、ルート全体のレンダリングをブロックする遅いデータフェッチに依存する UI の両方を改善できます。たとえば、製品ページのレビューなどです。

`loading.js` と UI コンポーネントを使用して、ルートセグメントのストリーミングを開始できます。詳細は[Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming) セクションをご覧ください。
