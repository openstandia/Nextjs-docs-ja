---
title: 'Server Components'
description: 'React Server Componentsを利用して、アプリケーションの一部をサーバー上でレンダリングする方法を学びましょう。'
related:
  description: 'Next.jsがデータのキャッシュと静的レンダリングの結果をどのように行うかを学びましょう。'
  links:
    - app/building-your-application/caching
---

React Server Componentsを使用すると、UIをサーバー上でレンダリングし、オプションでキャッシュすることができます。Next.jsでは、ルートセグメントごとにレンダリング作業を分割し、ストリーミングや部分レンダリングを可能にしています。以下の3つの異なるサーバーレンダリング戦略があります：

- [Static Rendering](#static-rendering-default)
- [Dynamic Rendering](#dynamic-rendering)
- [Streaming](#streaming)

このページでは、Server Componentsの動作原理、使用場面、および異なるサーバーレンダリング戦略について説明します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことには、いくつかの利点があります。これらには以下が含まれます：

- **データフェッチ**: Server Componentsを使用することで、データ取得をサーバー上、すなわちデータソースに近い場所に移行できます。これにより、レンダリングに必要なデータの取得時間を短縮し、クライアントが行うリクエストの数を減らすことで、パフォーマンスを向上させることができます。
- **セキュリティ**: Server Componentsを使用すると、トークンやAPIキーなどの機密データやロジックをクライアントに公開することなくサーバーに保持できます。
- **キャッシング**: サーバーでレンダリングすることにより、その結果がキャッシュされ、次回以降のリクエストや異なるユーザー間で再利用されます。これにより、レンダリングやデータ取得の量を減らすことで、パフォーマンスが向上し、コストを削減できます。
- **パフォーマンス**: Server Componentsは、基礎からパフォーマンスを最適化するための追加のツールを提供します。たとえば、完全にClient Componentsで構成されたアプリから始めて、UIの非インタラクティブなパーツをServer Componentsに移行することで、クライアントサイドのJavaScript量を減らせます。これは、インターネットの速度が遅いユーザーや、処理能力の劣るデバイスを持つユーザーにとって有益であり、ブラウザがダウンロード、解析、実行するクライアントサイドのJavaScriptが少なく済むためです。
- **初期ページロードと[ファーストコンテンツフルペイント (FCP)](https://web.dev/fcp/)**: サーバー上でHTMLを生成し、ユーザーがJavaScriptがページをレンダリングするのを待たずに、すぐにページを表示できるようにします。
- **検索エンジン最適化とソーシャルネットワーク共有性**: レンダリングされたHTMLは、検索エンジンボットがページをインデックスするのに使用され、ソーシャルネットワークボットがページのソーシャルカードプレビューを生成するのに使用されます。
- **ストリーミング**: Server Componentsを使用すると、レンダリング作業をチャンクに分割し、それらを準備ができ次第クライアントにストリーミングできます。これにより、全ページがサーバー上でレンダリングされるのを待つことなく、ページの一部を先にユーザーに表示することができます。

## Next.jsでServer Componentsを使用する {#using-server-components-in-next-js}

デフォルトでは、Next.jsはServer Componentsを使用します。これにより、追加の設定なしに自動的にサーバーレンダリングを実装できます。必要に応じてClient Componentsを使用することもできます。詳しくは[Client Components](/docs/app/building-your-application/rendering/client-components)を参照してください。

## Server Componentsのレンダリング方法 {#how-are-server-components-rendered}

サーバーでは、Next.jsはReactのAPIを利用してレンダリングを行います。レンダリング作業は、個々のルートセグメントと[サスペンスバウンダリー](https://react.dev/reference/react/Suspense)ごとにチャンクに分割されます。

各チャンクは以下の2つのステップでレンダリングされます：

1. ReactはServer Componentsを特別なデータ形式である**React Server Component Payload（RSC Payload）**にレンダリングします。
2. Next.jsはRSC PayloadおよびClient ComponentのJavaScript命令を使用して、サーバー上で**HTML**をレンダリングします。

{/* レンダリング図 */}

その後、クライアントでは：

1. HTMLは、ルートの高速な非インタラクティブなプレビューを即座に表示するために使用されます。これは初期ページロード時のみです。
2. React Server Components Payloadは、クライアントとServer Componentのtreeを調整し、DOMを更新するのに使用されます。
3. JavaScript命令は、[hydratre](https://react.dev/reference/react-dom/client/hydrateRoot)を使用してClient Componentをインタラクティブにするのに使用されます。

> #### React Server Component Payload（RSC）とは？
>
> RSC Payloadは、レンダリング済みのReact Server Components treeのコンパクトなバイナリ表現です。クライアントのReactによってブラウザのDOMを更新するのに使用されます。RSC Payloadには以下が含まれます：
>
> - Server Componentsのレンダリング結果
> - Client Componentsをレンダリングすべき場所のプレースホルダーと、それらのJavaScriptファイルへの参照
> - Server ComponentからClient Componentに渡される任意のprops

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングには、Static、Dynamic、Streamingの3つのサブセットがあります。

### 静的レンダリング（デフォルト） {#static-rendering-default}

静的レンダリングでは、ルートは**ビルド時**または[データ再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)後にバックグラウンドでレンダリングされます。結果はキャッシュされ、[コンテンツデリバリネットワーク（CDN）](https://developer.mozilla.org/docs/Glossary/CDN)にプッシュされることがあります。この最適化により、レンダリング作業の結果をユーザーやサーバーリクエスト間で共有できます。

静的レンダリングは、ユーザーにカスタマイズされておらず、ビルド時に判明しているデータを持つルートに便利です。例えば、静的なブログ投稿や製品ページです。

### 動的レンダリング {#dynamic-rendering}

動的レンダリングでは、ルートは**リクエスト時**にユーザーごとにレンダリングされます。

動的レンダリングは、ユーザーにカスタマイズされたデータ、またはリクエスト時にしか分からない情報（クッキーやURLの検索パラメータなど）が含まれるルートに適しています。

> **キャッシュされたデータを使用する動的ルート**
>
> 大多数のウェブサイトでは、ルートが完全に静的または完全に動的ではなく、スペクトラムにあります。たとえば、一定の間隔で再検証されるキャッシュされた製品データを使用するeコマースページも、キャッシュされていない個別化された顧客データを持つことがあります。
>
> Next.jsでは、キャッシュされたデータとキャッシュされていないデータの両方を持つ、動的にレンダリングされたルートを持つことができます。これは、RSC Payloadとデータが別々にキャッシュされるからです。これにより、リクエスト時にすべてのデータを取得することによるパフォーマンスへの影響を心配することなく、動的レンダリングを選択できます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache)および[データキャッシュ](/docs/app/building-your-application/caching#data-cache)について詳しく学びましょう。

#### 動的レンダリングへの切り替え {#switching-to-dynamic-rendering}

レンダリング中に、[Dynamic API](#dynamic-apis) またはキャッシュされていないデータリクエストが発見されると、Next.jsはルート全体を動的にレンダリングする方向に切り替わります。この表は、Dynamic APIとデータ キャッシングが、ルートが静的または動的にレンダリングされるかどうかにどのように影響するかをまとめたものです：

| Dynamic APIs | データ         | ルート             |
| ------------ | -------------- | ------------------ |
| いいえ       | キャッシュ済み | 静的にレンダリング |
| はい         | キャッシュ済み | 動的にレンダリング |
| いいえ       | 非キャッシュ   | 動的にレンダリング |
| はい         | 非キャッシュ   | 動的にレンダリング |

上記の表では、ルートが完全に静的であるためには、すべてのデータがキャッシュされている必要があります。ただし、キャッシュされたおよびキャッシュされていないデータ取得の両方を使用する動的にレンダリングされたルートを持つことができます。

開発者として、使用する機能やAPIに基づいて、Next.jsが自動的に各ルートに最適なレンダリング戦略を選択します。代わりに、[データをキャッシュする](/docs/app/building-your-application/data-fetching/fetching)、または[特定のデータの再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)のタイミングを選択し、UIの一部を[ストリーム](#streaming)することを選ぶ可能性があります。

### 動的API {#dynamic-apis}

Dynamic APIは、プリレンダリング中に事前に知られていることができないリクエスト時にのみ判明する情報に依存します。これらのAPIのいずれかを使用すると、開発者の意図が示され、リクエスト時にルート全体が動的レンダリングに切り替えられます。これらのAPIには以下が含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)

### ストリーミング {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並列化を示す図で、データ取得、レンダリング、および個々のチャンクのハイドレーションを示しています。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングを使用すると、サーバーからUIを段階的にレンダリングできます。作業はチャンクに分割され、準備が整い次第クライアントにストリームされます。これにより、ユーザーはコンテンツ全体のレンダリングが完了する前に、ページの一部をすぐに見ることができます。

<Image
  alt="クライアント上で部分的にレンダリングされたページと、ストリーミングされているチャンクの読み込みUIを示す図。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

ストリーミングはデフォルトでNext.js App Routerに組み込まれています。これにより、初期ページロードのパフォーマンス、およびルート全体のレンダリングを妨げる可能性がある遅いデータ取得に依存するUIの両方が改善されます。たとえば、製品ページのレビューなどが例として挙げられます。

`loading.js`を使用してルートセグメントをストリーミングし、React Suspenseを使用してUIコンポーネントをストリーミングし始めることができます。詳細は[Loading UIとストリーミング](/docs/app/building-your-application/routing/loading-ui-and-streaming)セクションを参照してください。
