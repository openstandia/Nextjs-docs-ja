---
title: 'Server Components'
description: 'React Server Components を使用して、アプリケーションの一部をサーバーでレンダリングする方法を学ぶ'
related:
  description: 'Next.js がどのようにデータや静的レンダリングの結果をキャッシュするかを学ぶ'
  links:
    - app/building-your-application/caching
---

React Server Components を使用すると、サーバーでレンダリングされ、オプションでキャッシュされる UI を作成できます。Next.js では、レンダリングの作業がさらにルートセグメントごとに分割され、ストリーミングと部分的なレンダリングが可能になります。サーバーレンダリングには 3 種類の戦略があります：

- [Static Rendering](#static-rendering-default)
- [Dynamic Rendering](#dynamic-rendering)
- [Streaming](#streaming)

このページでは、Server Components の動作、使用シーン、およびサーバーレンダリングのさまざまな戦略について説明します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことで得られる利点はいくつかあります：

- **データ取得**：Server Components により、データ取得をサーバーに移動し、データソースに近づけます。これにより、レンダリングに必要なデータの取得時間とクライアントが行う必要のあるリクエストの数を減らすことで、パフォーマンスが向上します。
- **セキュリティ**：Server Components により、トークンや API キーなどの機密データとロジックをクライアントに公開するリスクなしにサーバーに保持できます。
- **キャッシュ**：サーバーでレンダリングすることで、その結果をキャッシュし、後続のリクエストや複数のユーザー間で再利用できます。これにより、各リクエストでのレンダリングとデータ取得の量が減り、パフォーマンスが向上しコストが削減されます。
- **パフォーマンス**：Server Components は、基本からパフォーマンスを最適化するための追加のツールを提供します。例えば、完全に Client Components で構成されたアプリを使用している場合、UI の非インタラクティブな部分を Server Components に移行することで、必要なクライアントサイドの JavaScript の量を減らすことができます。これは、インターネットが遅いまたはデバイスがパワフルでないユーザーにとって有益です。ブラウザでダウンロード、解析、実行するクライアントサイドの JavaScript が少なくなります。
- **初期ページロードと[First Contentful Paint (FCP)](https://web.dev/fcp/)**：サーバー上で、ユーザーがページをすぐに表示できるように HTML を生成できます。クライアントがページをレンダリングするために必要な JavaScript をダウンロード、解析、実行するのを待つ必要がありません。
- **検索エンジン最適化とソーシャルネットワークの共有性**：レンダリングされた HTML は検索エンジンボットによってページをインデックス化し、ソーシャルネットワークボットによってページのソーシャルカードプレビューを生成するのに使用されます。
- **ストリーミング**：Server Components により、レンダリング作業をチャンクに分割し、それらが準備ができた時点でクライアントにストリーミングできます。これにより、ユーザーはページ全体がサーバーでレンダリングされるのを待つことなく、ページの一部を早く見ることができます。

## Next.js での Server Components の使用 {#using-server-components-in-next-js}

デフォルトでは、Next.js は Server Components を使用します。これにより、追加の設定なしでサーバーレンダリングを自動的に実装できます。また、必要に応じて Client Components を使用することもできます。詳しくは[Client Components](/docs/app/building-your-application/rendering/client-components) を参照してください。

## Server Components はどのようにレンダリングされますか？ {#how-are-server-components-rendered}

サーバー上で、Next.js は React の API を使用してレンダリングを調整します。レンダリングの作業は、個々のルートセグメントと [Suspense Boundaries](https://react.dev/reference/react/Suspense) ごとにチャンクに分割されます。

各チャンクは次の 2 ステップでレンダリングされます：

1. React が Server Components を **React Server Component Payload (RSC Payload)** と呼ばれる特別なデータ形式にレンダリングします。
2. Next.js は RSC Payload と Client Component JavaScript の指示を使用して、サーバー上で **HTML** をレンダリングします。

{/* Rendering Diagram */}

次に、クライアント側で：

1. HTML は、ルートの初期ページロードに関する高速の非インタラクティブプレビューをすぐに表示するために使用されます。
2. React Server Components Payload は Client と Server Component の tree を調整し、DOM を更新します。
3. JavaScript の指示を使用して、[Client Components をハイドレート](https://react.dev/reference/react-dom/client/hydrateRoot)し、アプリケーションをインタラクティブにします。

> #### React サーバーコンポーネントペイロード (RSC) とは？
>
> RSC ペイロードは、レンダリングされた React Server Components tree のコンパクトなバイナリ表現です。React がクライアントでブラウザの DOM を更新するのに使用されます。RSC ペイロードには以下が含まれます：
>
> - Server Components のレンダリング結果
> - Client Components がレンダリングされるべきプレースホルダーおよびその JavaScript ファイルへの参照
> - Server Component から Client Component へ渡された任意の props

## サーバーレンダリングの戦略 {#server-rendering-strategies}

サーバーレンダリングには、Static、Dynamic、Streaming の 3 つのサブセットがあります。

### Static Rendering（デフォルト）{#static-rendering-default}

Static Rendering では、ルートは **ビルド時**または[データ再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)の後ろでレンダリングされます。その結果はキャッシュされ、[Content Delivery Network (CDN)](https://developer.mozilla.org/docs/Glossary/CDN) にプッシュすることができます。この最適化により、レンダリング作業の結果をユーザー間およびサーバーリクエスト間で共有することができます。

Static Rendering は、ユーザーにパーソナライズされていないデータを含むルート（たとえば静的なブログ投稿や製品ページ）に適しています。

### Dynamic Rendering {#dynamic-rendering}

Dynamic Rendering では、ルートは各ユーザーのために **リクエスト時**にレンダリングされます。

Dynamic Rendering は、ユーザーにパーソナライズされたデータを含むルートや、リクエスト時にのみ知られる情報（cookie や URL の検索パラメータなど）を含むルートに適しています。

> **キャッシュされたデータによる動的ルート**
>
> ほとんどのウェブサイトでは、ルートは完全に静的でも完全に動的でもありません。たとえば、定期的に再検証されるキャッシュされた製品データを使用する e コマースページで、キャッシュされていないパーソナライズされた顧客データも持つことができます。
>
> Next.js ではキャッシュされたデータとキャッシュされていないデータの両方で、動的にレンダリングされたルートを持つことができます。これは、RSC ペイロードとデータが別々にキャッシュされるためです。これにより、リクエスト時にすべてのデータを取得するパフォーマンスへの影響を心配することなく、動的レンダリングを選択できます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache)と[データキャッシュ](/docs/app/building-your-application/caching#data-cache)について詳しく学ぶことができます。

#### Dynamic Rendering への切り替え {#switching-to-dynamic-rendering}

レンダリング中に [Dynamic API](#dynamic-apis) または `fetch` のオプション `{ cache: 'no-store' }` が発見された場合、Next.js はルート全体を動的にレンダリングするように切り替えます。この表は Dynamic API とデータのキャッシュがルートを静的または動的にレンダリングするかどうかにどのように影響するかをまとめています：

| Dynamic APIs | Data       | Route                |
| ------------ | ---------- | -------------------- |
| No           | Cached     | Statically Rendered  |
| Yes          | Cached     | Dynamically Rendered |
| No           | Not Cached | Dynamically Rendered |
| Yes          | Not Cached | Dynamically Rendered |

上記の表で、ルートが完全に静的であるには、すべてのデータがキャッシュされる必要があります。しかし、キャッシュされたデータフェッチとキャッシュされていないデータフェッチの両方を使用する動的にレンダリングされたルートを持つことができます。

開発者として、静的レンダリングと動的レンダリングの間で選択を行う必要はありません。Next.js は使用される機能および API に基づいて、各ルートの最適なレンダリング戦略を自動的に選択します。その代わりに、いつ[キャッシュするか](/docs/app/building-your-application/data-fetching/fetching)や[特定のデータを再検証するか](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)を選択し、UI の一部を[ストリームする](#streaming)ことを選択できます。

### Dynamic APIs {#dynamic-apis}

Dynamic APIs は、プリレンダリング中に前もって知ることができない情報に依拠しています。これらの API を使用すると、開発者の意図が示され、リクエスト時にルート全体が動的レンダリングに対応します。これらの API には以下が含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)

### ストリーミング {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並列化を示すダイアグラム。データ取得、レンダリング、個々のチャンクのハイドレーションが表示される。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングを使用すると、サーバーから UI を段階的にレンダリングできます。作業はチャンクに分割され、準備ができた時点でクライアントにストリーミングされます。これにより、ユーザーはページの全部のコンテンツがレンダリングを終了する前に、すぐに部分的にページを表示できるようになります。

<Image
  alt="クライアント上で部分的にレンダリングされたページを示すダイアグラム。ストリーミングされているチャンクの読み込み UI が表示される。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

ストリーミングはデフォルトで Next.js の App Router に組み込まれています。これにより、初期ページの読み込みパフォーマンスだけでなく、ルート全体のレンダリングをブロックする遅いデータフェッチに依存する UI も改善されます。たとえば、製品ページのレビューです。

`loading.js` を使用してルートセグメントをストリーミングし、[React Suspense](/docs/app/building-your-application/routing/loading-ui-and-streaming) で UI コンポーネントをストリーミングし始めることができます。[Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming) セクションを参照してください。
