---
title: 'Server Components'
description: 'アプリケーションの一部をサーバーで描画するためにReact Server Componentsを使用する方法を学びましょう。'
related:
  description: 'Next.jsがデータと静的レンダリングの結果をどのようにキャッシュするか学んでください。'
  links:
    - app/building-your-application/caching
---

React Server Componentsを利用すると、UIをサーバーでレンダリングし、オプションでキャッシュすることが可能です。Next.jsでは、ルートセグメントごとにレンダリング作業がさらに分割され、ストリーミングや部分的なレンダリングが可能となり、異なる3つのサーバーレンダリング戦略があります：

- [Static Rendering](#static-rendering-default)
- [Dynamic Rendering](#dynamic-rendering)
- [Streaming](#streaming)

このページでは、Server Componentsがどのように機能するのか、どのような場面で使用するのか、そして異なるサーバーレンダリング戦略について説明します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことには、いくつかの利点があります：

- **データ取得**：Server Componentsを使用すると、データ取得をサーバー側に移動させ、データソースに近づけることができます。これにより、レンダリングに必要なデータを取得するための時間が短縮され、クライアントが行うリクエストの数が減少し、パフォーマンスが向上します。
- **セキュリティ**：Server Componentsを使用することで、トークンやAPIキーなどの機密データやロジックをサーバー側に保持し、クライアントに露出するリスクを避けることができます。
- **キャッシュ**：サーバーでレンダリングすることで、その結果をキャッシュし、後続のリクエストや他のユーザーでも再利用することができます。これにより、各リクエスト時に行うレンダリングやデータ取得の量が減少し、パフォーマンスが向上し、コストが削減されます。
- **パフォーマンス**：Server Componentsは、パフォーマンスの最適化のための追加ツールを提供します。例えば、完全にClient Componentsで構成されたアプリから始めた場合、UIの対話性のない部分をServer Componentsに移行すると、クライアント側のJavaScriptの量を減らすことができます。これは、遅いインターネットやパワーの少ないデバイスを使用しているユーザーにとって有益です。ブラウザはダウンロード、パース、実行するクライアント側のJavaScriptの量が少なくて済むからです。
- **初回ページロードと[First Contentful Paint (FCP)](https://web.dev/fcp/)**：サーバーサイドでHTMLを生成し、クライアントがページをレンダリングするために必要なJavaScriptをダウンロード、パース、実行するのを待つことなく、ユーザーに即座にページを表示することができます。
- **検索エンジン最適化とソーシャルネットワーク共有**：レンダリングされたHTMLは、検索エンジンボットによってページをインデックス化したり、ソーシャルカードプレビューを生成したりするために使用できます。
- **ストリーミング**：Server Componentsを使用すると、レンダリング作業をチャンクに分割し、それらを準備が整い次第クライアントにストリーミングすることができます。これにより、ページ全体がサーバーでレンダリングされるのを待たずに、ページの一部を早く見ることができます。

## Next.jsでのServer Componentsの使用 {#using-server-components-in-next-js}

デフォルトでは、Next.jsはServer Componentsを使用します。これにより、追加の設定なしでサーバーレンダリングを自動的に実装できますが、必要に応じてClient Componentsを使用することができます。詳細は[Client Components](/docs/app/building-your-application/rendering/client-components)を参照してください。

## Server Componentsのレンダリング方法 {#how-are-server-components-rendered}

サーバー側では、Next.jsはReactのAPIを使ってレンダリングを調整します。レンダリング作業は、個々のルートセグメントと[サスペンス境界](https://react.dev/reference/react/Suspense)によりチャンクに分割されます。

各チャンクは2つのステップでレンダリングされます：

1. Reactはサーバーコンポーネントを**React Server Component Payload (RSC Payload)**と呼ばれる特別なデータ形式にレンダリングします。
2. Next.jsはRSC PayloadとClient ComponentsのJavaScript命令を使用して、サーバー上で**HTML**をレンダリングします。

{/* Rendering Diagram */}

その後、クライアント側で：

1. HTMLは瞬時にルートの非対話的プレビューを表示するために使用されます - これは初回ページロード時のみです。
2. React Server Components Payloadがクライアントとサーバーコンポーネントのツリーを調整し、DOMを更新するために使用されます。
3. JavaScript命令が使用され、クライアントコンポーネントが[ハイドレーション](https://react.dev/reference/react-dom/client/hydrateRoot)され、アプリケーションが対話的になります。

> #### React Server Component Payload (RSC)とは？
>
> RSC Payloadは、レンダリングされたReact Server Componentsツリーのコンパクトなバイナリ表現です。クライアント上でReactによってブラウザのDOMが更新されるために使用されます。RSC Payloadには以下が含まれます：
>
> - サーバーコンポーネントのレンダリング結果
> - クライアントコンポーネントがレンダリングされるべき場所のプレースホルダーとそれらのJavaScriptファイルへの参照
> - サーバーコンポーネントからクライアントコンポーネントに渡されるプロップ

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングには、Static、Dynamic、Streamingの3つのサブセットがあります。

### Static Rendering (デフォルト) {#static-rendering-default}

Static Renderingでは、ルートは**ビルド時**または[データの再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)後にバックグラウンドでレンダリングされます。結果はキャッシュされ、[コンテンツ配信ネットワーク (CDN)](https://developer.mozilla.org/docs/Glossary/CDN)にプッシュすることができます。この最適化により、ユーザーやサーバーのリクエスト間でレンダリング作業の結果を共有できます。

Static renderingは、ブログ記事や商品ページのように、ユーザーにパーソナライズされないデータがある場合や、ビルド時に知り得るデータがある場合に有用です。

### Dynamic Rendering {#dynamic-rendering}

Dynamic Renderingでは、ルートはユーザーごとに**リクエスト時**にレンダリングされます。

Dynamic renderingは、ユーザーにパーソナライズされたデータがある場合や、リクエスト時にしか知り得ない情報（cookieやURLの検索パラメータなど）がある場合に有用です。

> **キャッシュされたデータを持つ動的ルート**
>
> ほとんどのウェブサイトでは、ルートが完全に静的でも完全に動的でもありません。例えば、キャッシュされた商品データを一定間隔で再検証するが、キャッシュされていない個別の顧客データを持つEコマースページがあります。
>
> Next.jsでは、キャッシュされたデータとキャッシュされていないデータの両方を持つ、動的にレンダリングされたルートを構築できます。これは、RSC Payloadとデータが個別にキャッシュされるためです。これにより、リクエスト時にすべてのデータをフェッチする際のパフォーマンスへの影響を心配することなく、動的レンダリングを選択できます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache)と[データキャッシュ](/docs/app/building-your-application/caching#data-cache)の詳細を学びましょう。

#### 動的レンダリングへの切り替え {#switching-to-dynamic-rendering}

レンダリング中に、[Dynamic API](#dynamic-apis)や`{ cache: 'no-store' }`の[fetch](/docs/app/api-reference/functions/fetch)オプションが発見された場合、Next.jsは全体のルートをダイナミックにレンダリングするように切り替えます。この表は、Dynamic APIとデータキャッシュがルートが静的または動的にレンダリングされるかどうかに与える影響をまとめたものです：

| Dynamic APIs | Data       | Route                |
| ------------ | ---------- | -------------------- |
| No           | Cached     | Statically Rendered  |
| Yes          | Cached     | Dynamically Rendered |
| No           | Not Cached | Dynamically Rendered |
| Yes          | Not Cached | Dynamically Rendered |

上記の表では、完全に静的なルートにするには、すべてのデータをキャッシュする必要があります。しかし、キャッシュされたデータフェッチとキャッシュされていないデータフェッチの両方を使用する、動的にレンダリングされたルートを持つことができます。

開発者としては、Next.jsが各ルートに使用する機能やAPIに基づいて、最適なレンダリング戦略を自動的に選択するため、静的と動的のレンダリングの間で選ぶ必要はありません。代わりに、いつ[キャッシュする](/docs/app/building-your-application/data-fetching/fetching)か、またはいつ特定のデータを[再検証する](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)かを選択し、UIの一部を[ストリーム](/docs/app/building-your-application/routing/loading-ui-and-streaming)することを選択することができます。

### Dynamic APIs {#dynamic-apis}

Dynamic APIは、（プレンダーリング時ではなく）リクエスト時にしか知られない情報に依存しています。これらのAPIを使用することは、開発者の意図を示し、リクエスト時にルート全体を動的レンダリングに選択します。これらのAPIには以下が含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)

### Streaming {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並列化を示す図で、データフェッチ、レンダリング、および個々のチャンクのハイドレーションを示します。”
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

Streamingを使用すると、サーバー側からUIを段階的にレンダリングすることができます。作業はチャンクに分割され、それらが準備ができ次第クライアントにストリームされます。これにより、ページ全体のコンテンツがレンダリングを完了する前に、ユーザーが即座にページの一部を見ることができます。

<Image
  alt="クライアント側で部分的にレンダリングされたページを示し、ストリーミングされているチャンクのロード中UIを表示した図。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

StreamingはデフォルトでNext.js App Routerに組み込まれています。これにより、初期ページロードのパフォーマンスだけでなく、ルート全体のレンダリングをブロックする遅いデータフェッチに依存するUIの改善にも役立ちます。例えば、商品ページのレビューなどです。

ルートセグメントを`loading.js`とUIコンポーネントを使用してストリーミングを開始できます。詳細は[Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming)セクションを参照してください。
