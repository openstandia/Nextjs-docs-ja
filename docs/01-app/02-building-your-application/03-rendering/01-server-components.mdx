---
title: 'Server Components'
description: 'アプリケーションの一部をサーバーでレンダリングするためにReact Server Componentsを使う方法を学びましょう。'
related:
  description: 'Next.jsがどのようにデータと静的レンダリング結果をキャッシュするかを学びましょう。'
  links:
    - app/building-your-application/caching
---

React Server Componentsを使用すると、UIをサーバーでレンダリングし、オプションでキャッシュすることができます。Next.jsでは、ルートセグメントごとにレンダリング作業をさらに分割して、ストリーミングおよび部分レンダリングを可能にし、3つの異なるサーバーレンダリング戦略があります：

- [静的レンダリング](#static-rendering-default)
- [動的レンダリング](#dynamic-rendering)
- [ストリーミング](#streaming)

このページでは、Server Componentsがどのように機能するか、いつそれらを使用するか、そして異なるサーバーレンダリング戦略を紹介します。

## サーバーレンダリングの利点 {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことには、以下のような利点があります：

- **データフェッチ**：Server Componentsを使用すると、データフェッチをサーバーに移動でき、データソースに近づけることができます。これにより、レンダリングに必要なデータの取得時間を短縮し、クライアントが行うリクエストの数を減らすことでパフォーマンスが向上します。
- **セキュリティ**： Server Componentsを使用すると、トークンやAPIキーなどの機密データやロジックをクライアントに公開するリスクなしにサーバーで保持できます。
- **キャッシュ**：サーバーでレンダリングすることで、その結果をキャッシュし、後続のリクエストや複数のユーザー間で再利用できます。これにより、各リクエストで行われるレンダリングとデータフェッチの量を減らし、パフォーマンスを向上させ、コストを削減できます。
- **パフォーマンス**：Server Componentsは、ベースラインからパフォーマンスを最適化するための追加ツールを提供します。たとえば、完全にClient Componentsで構成されたアプリを最初に作成した場合、UIの非対話部分をServer Componentsに移すことで、クライアント側のJavaScriptの量を減らすことができます。これは、インターネット速度が遅いユーザーや性能が低いデバイスを持つユーザーにとって、ダウンロード、解析、実行するクライアント側のJavaScriptが少なく、メリットがあります。
- **初回ページロードと[First Contentful Paint (FCP)](https://web.dev/fcp/)**：サーバー側でHTMLを生成することで、ユーザーはクライアントがページをレンダリングするために必要なJavaScriptをダウンロード、解析、実行するのを待たずに、すぐにページを表示できます。
- **検索エンジン最適化とソーシャルネットワークでの共有性**：レンダリングされたHTMLは、検索エンジンのボットがページをインデックスするためや、ソーシャルカードのプレビューを生成するために使用できます。
- **ストリーミング**：Server Componentsを使用すると、レンダリング作業をチャンクに分割し、それらが準備でき次第クライアントにストリーミングすることが可能です。これにより、サーバーですべてのページが完全にレンダリングされるのを待たずに、ユーザーはページの一部を早く見ることができます。

## Next.jsでのServer Componentsの使用 {#using-server-components-in-next-js}

Next.jsではデフォルトでServer Componentsを使用します。これにより、追加の設定なしでサーバーレンダリングを自動的に実装でき、必要に応じてClient Componentsを使用することもできます（[Client Components](/docs/app/building-your-application/rendering/client-components)を参照）。

## Server Componentsはどのようにレンダリングされるのか？ {#how-are-server-components-rendered}

Next.jsでは、サーバー側でReactのAPIを使用してレンダリングを調整します。レンダリング作業は、個々のルートセグメントと[サスペンス境界](https://react.dev/reference/react/Suspense)ごとにチャンクに分割されます。

各チャンクは次の2ステップでレンダリングされます：

1. ReactがServer Componentsを**React Server Component Payload (RSC Payload)**と呼ばれる特別なデータ形式にレンダリングします。
2. Next.jsはRSC PayloadとClient ComponentのJavaScript命令を使用して、サーバー上で**HTML**をレンダリングします。

{/* Rendering Diagram */}

次に、クライアント側では：

1. HTMLがルートの迅速な非対話プレビューを即座に表示します - これは初回ページロード時のみです。
2. React Server Components Payloadを使用して、Client ComponentとServer Componentのtreeを整合し、DOMを更新します。
3. JavaScript命令を使用してClient Componentsを[ハイドレート](https://react.dev/reference/react-dom/client/hydrateRoot)し、アプリケーションを対話可能にします。

> #### React Server Component Payload (RSC)とは？
>
> RSC PayloadはレンダリングされたReact Server Componentsのtreeのコンパクトなバイナリ表現です。クライアントのReactがブラウザのDOMを更新するために使用します。RSC Payloadには以下が含まれています：
>
> - Server Componentsのレンダリング結果
> - Client Componentsがレンダリングされるべき位置のプレースホルダーとそのJavaScriptファイルの参照
> - Server ComponentからClient Componentに渡される任意のprops

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングには、静的、動的、ストリーミングの3つのサブセットがあります。

### 静的レンダリング（デフォルト） {#static-rendering-default}

静的レンダリングでは、ルートは**ビルド時**または[データ再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)後にバックグラウンドでレンダリングされます。結果はキャッシュされ、[コンテンツデリバリネットワーク（CDN）](https://developer.mozilla.org/docs/Glossary/CDN)にプッシュすることができます。この最適化により、ユーザー間やサーバーリクエスト間でレンダリング作業の結果を共有することができます。

静的レンダリングは、ユーザーに対して個別化されておらず、ビルド時に知ることができるデータを含むルート（例えば、静的なブログ投稿や製品ページなど）に適しています。

### 動的レンダリング {#dynamic-rendering}

動的レンダリングでは、ルートは各ユーザーの**リクエスト時**にレンダリングされます。

動的レンダリングは、ユーザーに対して個別化されたデータや、クッキーやURLの検索パラメータなど、リクエスト時にのみ知ることができる情報を含むルートに適しています。

> **キャッシュされたデータを持つ動的ルート**
>
> ほとんどのウェブサイトは、完全に静的または完全に動的ではなく、スペクトラム全体に広がっています。例えば、キャッシュされた製品データをインターバルで再検証しながら、キャッシュされていない個別化された顧客データも含むeコマースページがあります。
>
> Next.jsでは、キャッシュされたデータとキャッシュされていないデータの両方を持つ動的にレンダリングされたルートを持つことができます。これは、RSC Payloadとデータが別々にキャッシュされるためです。これにより、すべてのデータをリクエスト時に取得することによるパフォーマンスへの影響を心配することなく動的レンダリングを選択できます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache)と[データキャッシュ](/docs/app/building-your-application/caching#data-cache)についての詳細をご覧ください。

#### 動的レンダリングへの切り替え {#switching-to-dynamic-rendering}

レンダリング中に[動的API](#dynamic-apis)または`{ cache: 'no-store' }`の[fetch](/docs/app/api-reference/functions/fetch)オプションが発見されると、Next.jsはルート全体を動的にレンダリングするように切り替えます。この表は、動的APIとデータキャッシュがルートが静的または動的にレンダリングされるかどうかにどのように影響するかをまとめたものです：

| 動的API | データ       | ルート             |
| ------- | ------------ | ------------------ |
| いいえ  | キャッシュ   | 静的にレンダリング |
| はい    | キャッシュ   | 動的にレンダリング |
| いいえ  | 非キャッシュ | 動的にレンダリング |
| はい    | 非キャッシュ | 動的にレンダリング |

上記の表では、ルートが完全に静的であるためには、すべてのデータがキャッシュされている必要があります。ただし、キャッシュされたデータ取得とキャッシュされていないデータ取得の両方を使用する動的にレンダリングされたルートを持つこともできます。

開発者としては、Next.jsが使用した機能やAPIに基づいて各ルートに対して最適なレンダリング戦略を自動的に選択するため、静的レンダリングと動的レンダリングの間で選択する必要はありません。代わりに、[キャッシュ](/docs/app/building-your-application/data-fetching/fetching)または特定のデータの[再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)のタイミングを選択し、UIの一部を[ストリーミング](#streaming)することを選択できます。

### 動的API {#dynamic-apis}

動的APIは、プレンダリング時に事前に知ることができない情報に依存します。これらのAPIのいずれかを使用することで、開発者の意図が示され、リクエスト時にルート全体が動的レンダリングに入ることになります。これらのAPIには以下が含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)

### ストリーミング {#streaming}

<Image
  alt="ストリーミング中にルートセグメントの並列化を示す図、個々のチャンクのデータ取得、レンダリング、ハイドレーションを示す"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングを使用することで、サーバーから徐々にUIをレンダリングできます。作業はチャンクに分割され、それが準備でき次第クライアントにストリーミングされます。これにより、コンテンツ全体がレンダリングされる前に、ページの一部を即座に見ることができます。

<Image
  alt="ストリーミング中で部分的にレンダリングされたクライアントのページの図、ストリーミングされているチャンクのためのローディングUIを表示"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

ストリーミングはNext.jsのApp Routerにデフォルトで組み込まれています。これにより、初回ページロードのパフォーマンスが向上し、遅いデータフェッチに依存するUIでもルート全体のレンダリングをブロックすることがなくなります。たとえば、製品ページのレビューなどです。

ストリーミングルートセグメントを開始するには`loading.js`を使用し、UIコンポーネントには[React Suspense](/docs/app/building-your-application/routing/loading-ui-and-streaming)を使用します。[Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming)セクションを参照して詳細をご確認ください。
