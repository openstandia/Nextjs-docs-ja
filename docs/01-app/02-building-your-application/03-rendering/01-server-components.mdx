---
title: 'Server Components'
description: 'アプリケーションの一部をサーバーでレンダリングするために、React Server Componentsを使用する方法を学びます。'
related:
  description: 'Next.jsがデータと静的レンダリングの結果をどのようにキャッシュするかを学びます。'
  links:
    - app/building-your-application/caching
---

React Server Componentsを使用すると、UIをサーバーでレンダリングして、オプションでキャッシュすることができます。Next.jsでは、レンダリング作業はルートセグメントごとにさらに分割され、ストリーミングや部分描画を可能にします。サーバーレンダリングには、次の3つの戦略があります：

- [Static Rendering](#static-rendering-default)
- [Dynamic Rendering](#dynamic-rendering)
- [Streaming](#streaming)

このページでは、Server Componentsがどのように機能するのか、どのようなときに使用するのか、そして異なるサーバーレンダリング戦略について説明します。

## サーバーレンダリングのメリット {#benefits-of-server-rendering}

サーバーでレンダリング作業を行うことには、いくつかの利点があります：

- **データフェッチ**：Server Componentsを使用すると、データフェッチをサーバーに移動し、データソースに近づけることができます。これにより、レンダリングに必要なデータのフェッチにかかる時間や、クライアントが作成するリクエストの数を減らし、パフォーマンスを向上させることができます
- **セキュリティ**：Server Componentsを使用すると、トークンやAPIキーなどの機密データやロジックをクライアントに公開するリスクを避けて、サーバー上に保持することができます
- **キャッシュ**：サーバーでレンダリングを行うことで、その結果をキャッシュして、以降のリクエストや他のユーザーに再利用できます。これにより、各リクエストごとに行うレンダリングやデータフェッチの回数を減らし、パフォーマンスを向上させ、コストを削減することができます
- **パフォーマンス**：Server Componentsは、パフォーマンスをベースラインから最適化するための追加のツールを提供します。たとえば、完全にClient Componentsで構成されたアプリから始める場合、UIの対話型ではない部分をServer Componentsに移動することで、クライアントサイドのJavaScriptの量を減らすことができます。これは、インターネットが遅いユーザーや性能が低いデバイスを使用しているユーザーにとって有益です。ブラウザがダウンロード、解析、実行するクライアントサイドJavaScriptが少なくなるためです
- **初回ページ読み込みと[First Contentful Paint (FCP)](https://web.dev/fcp/)**：サーバー上で、JavaScriptがページをレンダリングするためのダウンロード、解析、実行を待たずに、すぐにユーザーがページを表示できるようにHTMLを生成できます
- **検索エンジン最適化とソーシャルネットワークとの共有性**：レンダリングされたHTMLは、検索エンジンボットがページをインデックスして、ソーシャルネットワークボットがページのソーシャルカードプレビューを生成するために使用できます
- **ストリーミング**：Server Componentsにより、レンダリング作業をチャンクに分割して、クライアントに準備ができた段階でストリーミングできます。これにより、サーバー上でページ全体がレンダリングされるのを待たずに、ページの一部を早く表示することが可能になります。

## Next.jsでのServer Componentsの使用 {#using-server-components-in-next-js}

デフォルトで、Next.jsはServer Componentsを使用します。これにより、追加の設定なしでサーバーレンダリングを自動的に実装することができ、必要に応じてClient Componentsを選択して使用できます。詳細は、[Client Components](/docs/app/building-your-application/rendering/client-components)を参照してください。

## Server Componentsはどのようにレンダリングされますか？ {#how-are-server-components-rendered}

サーバーでは、Next.jsはReactのAPIを使用してレンダリングを調整します。レンダリング作業は、個々のルートセグメントと[サスペンス境界](https://react.dev/reference/react/Suspense)でチャンクに分割されます。

各チャンクは、次の2段階でレンダリングされます：

1. ReactがServer Componentsを**React Server Component Payload (RSC Payload)**という特殊なデータ形式にレンダリングします。
2. Next.jsはRSC PayloadとClient ComponentのJavaScript命令を使用して、サーバーで**HTML**をレンダリングします。

{/* レンダリング図 */}

次に、クライアントでは：

1. HTMLを使用して、ルートのすばやく非対話的なプレビューを即座に表示します。このプレビューは初回ページ読み込み時のみです。
2. React Server Components Payloadを使用して、ClientおよびServer Componentのtreeを調整し、DOMを更新します。
3. JavaScript命令を使用して、Client Componentsを[ハイドレート](https://react.dev/reference/react-dom/client/hydrateRoot)し、アプリケーションをインタラクティブにします。

> #### React Server Component Payload (RSC)とは？
>
> RSC Payloadとは、レンダリングされたReact Server Componentsのtreeのコンパクトなバイナリ表現です。クライアント上のReactがブラウザのDOMを更新するために使用されます。RSC Payloadには次のものが含まれます：
>
> - Server Componentsのレンダリング結果
> - Client Componentsをレンダリングするプレースホルダーと、そのJavaScriptファイルへの参照
> - Server ComponentからClient Componentに渡される任意のprops

## サーバーレンダリング戦略 {#server-rendering-strategies}

サーバーレンダリングには、3つのサブセットがあります：Static、Dynamic、そしてStreamingです。

### Static Rendering（デフォルト） {#static-rendering-default}

Static Renderingでは、ルートは**ビルド時**または[データ再検証](/docs/app/building-your-application/data-fetching/incremental-static-regeneration)後のバックグラウンドでレンダリングされます。結果はキャッシュされ、[Content Delivery Network (CDN)](https://developer.mozilla.org/docs/Glossary/CDN)にプッシュすることができます。この最適化により、ユーザー間やサーバーリクエスト間でレンダリング作業の結果を共有できるようになります。

Static Renderingは、静的なブログ投稿や商品ページのように、ユーザに個別化されていない、ビルド時に判明するデータがあるルートに有効です。

### Dynamic Rendering {#dynamic-rendering}

Dynamic Renderingでは、ルートは**リクエスト時**に各ユーザーのためにレンダリングされます。

Dynamic Renderingは、クッキーやURLの検索パラメータのようなリクエスト時にしか判明できない情報を持つ、ユーザーに個別化されたデータを持つルートに有効です。

> **キャッシュされたデータを持つDynamic Routes**
>
> ほとんどのウェブサイトでは、ルートが完全に静的または完全に動的というわけではありません。たとえば、定期的に再検証されるキャッシュされた商品データを使用するeコマースページがありつつ、キャッシュされていない個別化された顧客データが含まれる場合があります。
>
> Next.jsでは、キャッシュされたデータとキャッシュされていないデータの両方を持つ、動的にレンダリングされたルートを持つことができます。これは、RSC Payloadとデータが個別にキャッシュされるためです。これにより、すべてのデータをリクエスト時にフェッチすることによるパフォーマンスへの影響を心配せずに、動的レンダリングを選択できます。
>
> [フルルートキャッシュ](/docs/app/building-your-application/caching#full-route-cache)および[データキャッシュ](/docs/app/building-your-application/caching#data-cache)について詳しくは、こちらを参照してください。

#### 動的レンダリングへの切り替え {#switching-to-dynamic-rendering}

レンダリング中に[Dynamic API](#dynamic-apis)やキャッシュされていないデータリクエストが検出された場合、Next.jsはルート全体を動的にレンダリングに切り替えます。この表は、Dynamic APIとデータキャッシングがルートを静的または動的にレンダリングするかどうかに与える影響をまとめたものです：

| Dynamic APIs | Data       | Route                |
| ------------ | ---------- | -------------------- |
| No           | Cached     | Statically Rendered  |
| Yes          | Cached     | Dynamically Rendered |
| No           | Not Cached | Dynamically Rendered |
| Yes          | Not Cached | Dynamically Rendered |

上記の表では、ルートを完全に静的にするには、すべてのデータがキャッシュされている必要があります。ただし、キャッシュされたデータフェッチとキャッシュされていないデータフェッチの両方を使用する、動的にレンダリングされたルートを持つことができます。

開発者としては、静的と動的のレンダリングの選択は必要ありません。Next.jsは、使用する機能やAPIに基づいて、各ルートの最適なレンダリング戦略を自動的に選択します。代わりに、いつキャッシュするかや特定のデータを再検証するかを選択し、UIの部分をストリーミングするか選択できます。

### Dynamic APIs {#dynamic-apis}

Dynamic APIsは、リクエ스트時にしか判明できない情報に依存します（予描画中には判明できない）。これらのAPIのいずれかを使用することで、開発者の意図を示し、リクエスト時にルート全体を動的レンダリングにオプトインします。これらのAPIには次のものが含まれます：

- [`cookies`](/docs/app/api-reference/functions/cookies)
- [`headers`](/docs/app/api-reference/functions/headers)
- [`connection`](/docs/app/api-reference/functions/connection)
- [`draftMode`](/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](/docs/app/api-reference/functions/unstable_noStore)
- [`unstable_after`](/docs/app/api-reference/functions/unstable_after)

### Streaming {#streaming}

<Image
  alt="ストリーミング中のルートセグメントの並列化を示す図。個々のチャンクのデータフェッチ、レンダリング、ハイドレーションを示しています。"
  srcLight="/docs/light/sequential-parallel-data-fetching.png"
  srcDark="/docs/dark/sequential-parallel-data-fetching.png"
  width="1600"
  height="525"
/>

ストリーミングは、サーバーからのUIの段階的なレンダリングを可能にします。作業はチャンクに分割され、準備ができたときにクライアントにストリームされます。これにより、すべてのコンテンツがレンダリングされるのを待たずに、ユーザーはページの一部を即座に見ることができます。

<Image
  alt="クライアント上で部分的にレンダリングされたページを示す図。ストリーミング中のチャンクの読み込みUIを表示しています。"
  srcLight="/docs/light/server-rendering-with-streaming.png"
  srcDark="/docs/dark/server-rendering-with-streaming.png"
  width="1600"
  height="785"
/>

ストリーミングは、Next.js App Routerにデフォルトで組み込まれています。これにより、初期のページ読み込みパフォーマンスと、ルート全体のレンダリングをブロックするような遅いデータフェッチに依存するUIの両方が改善されます。たとえば、商品ページのレビューなどです。

`loading.js`とUIコンポーネントを使用して、ルートセグメントのストリーミングを開始できます。[React Suspense](/docs/app/building-your-application/routing/loading-ui-and-streaming)を使用します。詳しくは、[Loading UI and Streaming](/docs/app/building-your-application/routing/loading-ui-and-streaming)セクションをご覧ください。
