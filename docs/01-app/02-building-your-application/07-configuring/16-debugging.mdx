---
title: 'デバッグ'
description: 'VS Code、Chrome DevTools、または Firefox DevToolsを使用してNext.jsアプリケーションをデバッグする方法を学びます。'
---

{/* このドキュメントの内容はapp routerとpages routerの間で共有されます。Pages Routerに特化した内容を追加するには、 `<PagesOnly>Content</PagesOnly>` コンポーネントを使用できます。共有されるコンテンツは、コンポーネントでラップされてはいけません。 */}

このドキュメントでは、[VS Code デバッガー](https://code.visualstudio.com/docs/editor/debugging)、[Chrome DevTools](https://developers.google.com/web/tools/chrome-devtools)、または [Firefox DevTools](https://firefox-source-docs.mozilla.org/devtools-user/)を使用して、Next.js のフロントエンドとバックエンドコードをフルソースマップサポート付きでデバッグする方法を説明します。

Node.js にアタッチできる任意のデバッガーを使用して、Next.js アプリケーションをデバッグできます。詳細は、Node.js の[デバッグガイド](https://nodejs.org/en/docs/guides/debugging-getting-started/)で確認できます。

## VS Codeを使用したデバッグ {#debugging-with-vs-code}

プロジェクトのrootに `.vscode/launch.json` という名前のファイルを作成し、次の内容を追加してください。

```json title="launch.json"
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node-terminal",
      "request": "launch",
      "command": "npm run dev"
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    },
    {
      "name": "Next.js: debug client-side (Firefox)",
      "type": "firefox",
      "request": "launch",
      "url": "http://localhost:3000",
      "reAttach": true,
      "pathMappings": [
        {
          "url": "webpack://_N_E",
          "path": "${workspaceFolder}"
        }
      ]
    },
    {
      "name": "Next.js: debug full stack",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/next",
      "runtimeArgs": ["--inspect"],
      "skipFiles": ["<node_internals>/**"],
      "serverReadyAction": {
        "action": "debugWithEdge",
        "killOnServerStop": true,
        "pattern": "- Local:.+(https?://.+)",
        "uriFormat": "%s",
        "webRoot": "${workspaceFolder}"
      }
    }
  ]
}
```

> **注意**: VS CodeでFirefoxのデバッグを使用するには、[Firefox Debugger extension](https://marketplace.visualstudio.com/items?itemName=firefox-devtools.vscode-firefox-debug)をインストールする必要があります。

`npm run dev`は、Yarnを使用している場合は `yarn dev`、pnpmを使用している場合は `pnpm dev`に置き換えることができます。

「Next.js: debug full stack」構成では、`serverReadyAction.action`がサーバーが準備完了したときにどのブラウザを開くかを指定しています。 `debugWithEdge` はEdgeブラウザを起動することを意味します。Chromeを使用している場合は、この値を`debugWithChrome`に変更してください。

アプリケーションを開始する際の[ポート番号を変更している](https://nextjs.org/docs/canary/pages/api-reference/cli/next#next-dev-options)場合は、`http://localhost:3000`の`3000`を使用しているポートに置き換えてください。

Next.jsをroot以外のディレクトリから実行している場合（例えば、Turborepoを使用している場合）には、サーバーサイドとフルスタックデバッグタスクに `cwd`を追加する必要があります。例えば、 `"cwd": "${workspaceFolder}/apps/web"`です。

次にデバッグパネル（Windows/Linuxでは `Ctrl+Shift+D`、macOSでは `⇧+⌘+D`）に移動し、ラウンチ構成を選択して`F5`を押すか、コマンドパレットから**Debug: Start Debugging**を選択して、デバッグセッションを開始してください。

## Jetbrains WebStormでのデバッガーの使用 {#using-the-debugger-in-jetbrains-webstorm}

ランタイム構成のリスト表示のドロップダウンメニューをクリックし、`Edit Configurations...` をクリックします。`http://localhost:3000` をURLとして設定した `JavaScript Debug` のデバッグ構成を作成します。お好みに応じてカスタマイズし（例えば、デバッグ用のブラウザー、プロジェクトファイルとして保存）、`OK`をクリックします。このデバッグ構成を実行すると、選択したブラウザーが自動的に開かれます。この時点で、NextJS nodeアプリケーションとクライアント/ブラウザーアプリケーションの2つのアプリケーションがデバッグモードになっています。

## ブラウザDevToolsを使用したデバッグ {#debugging-with-browser-devtools}

### クライアントサイドのコード {#client-side-code}

通常どおりに開発サーバーを開始し、`next dev`、`npm run dev`、または `yarn dev` を実行します。サーバーが起動すると、ご使用のブラウザで `http://localhost:3000`（または別のURL）を開きます。

Chromeの場合:

- Chromeの開発者ツールを開く（Windows/Linuxでは `Ctrl+Shift+J`、macOSでは `⌥+⌘+I`）
- **Sources** タブに移動する

Firefoxの場合:

- Firefoxの開発者ツールを開く（Windows/Linuxでは `Ctrl+Shift+I`、macOSでは `⌥+⌘+I`）
- **Debugger** タブに移動する

いずれのブラウザでも、クライアントサイドのコードが[`debugger`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/debugger)ステートメントに達するたびに、コードの実行が一時停止し、そのファイルがデバッグエリアに表示されます。また、手動でブレークポイントを設定するファイルを探索することもできます。

- Chromeの場合: Windows/Linuxでは `Ctrl+P`、macOSでは `⌘+P`を押す
- Firefoxの場合: Windows/Linuxでは `Ctrl+P`、macOSでは`⌘+P`を押すか、左側のパネルでファイルツリーを使用する

探索する際に、ソースファイルのパスが `webpack://_N_E/./` で始まりますのでご注意ください。

### サーバーサイドのコード {#server-side-code}

ブラウザDevToolsでサーバーサイドのNext.jsコードをデバッグするためには、基盤となるNode.jsプロセスに[`--inspect`](https://nodejs.org/api/cli.html#cli_inspect_host_port)フラグを渡す必要があります。

```bash title="Terminal"
NODE_OPTIONS='--inspect' next dev
```

> **知っておくと良いこと**: `NODE_OPTIONS='--inspect=0.0.0.0'` を使用して、Dockerコンテナでアプリを実行している場合のように、ローカルホスト以外でリモートデバッグアクセスを許可します。

`npm run dev` または `yarn dev` を使用している場合は、`package.json` の `dev`スクリプトを更新する必要があります。

```json title="package.json"
{
  "scripts": {
    "dev": "NODE_OPTIONS='--inspect' next dev"
  }
}
```

`--inspect` フラグを使用して Next.js 開発サーバーを起動すると、以下のようになります。

```bash title="Terminal"
Debugger listening on ws://127.0.0.1:9229/0cf90313-350d-4466-a748-cd60f4e47c95
For help, see: https://nodejs.org/en/docs/inspector
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
```

Chromeの場合:

1. 新しいタブを開いて `chrome://inspect` にアクセスする
2. **Remote Target** セクションで Next.js アプリケーションを探す
3. **inspect** をクリックして別の DevTools ウィンドウを開く
4. **Sources** タブに移動する

Firefoxの場合:

1. 新しいタブを開いて `about:debugging` にアクセスする
2. 左サイドバーで **This Firefox** をクリックする
3. **Remote Targets** の下で Next.js アプリケーションを見つける
4. **Inspect** をクリックしてデバッガーを開く
5. **Debugger** タブに移動する

サーバーサイドコードのデバッグは、クライアントサイドのデバッグと同様に機能します。ファイルを探索する場合（`Ctrl+P`/`⌘+P`）、ソースファイルのパスは `webpack://{application-name}/./` で始まり（`{application-name}` は `package.json` によるアプリケーションの名前に置き換えられます）、ご注意ください。

### ブラウザDevToolsでのサーバーエラーの検査 {#inspect-server-errors-with-browser-devtools}

エラーが発生したときは、ソースコードを検査することでエラーの原因を追跡することができます。

Next.js は、開発オーバーレイに緑色のボタンのようなNode.jsのロゴを表示します。そのボタンをクリックすると、DevToolsのURLがクリップボードにコピーされます。そのURLを使用して新しいブラウザタブを開き、Next.jsサーバープロセスを検査することができます。

<Image
  alt="コピーDevTools URLの例"
  srcLight="/docs/dark/copy-devtool-url-example.png"
  srcDark="/docs/dark/copy-devtool-url-example.png"
  width="1600"
  height="594"
/>

### Windowsでのデバッグ {#debugging-on-windows}

Windowsのユーザーは、`NODE_OPTIONS='--inspect'` を使用すると、この構文がWindowsプラットフォームでサポートされていないため、問題が発生することがあります。これを回避するには、開発依存関係として[`cross-env`](https://www.npmjs.com/package/cross-env)パッケージをインストール（`npm` と `yarn` では `-D`）し、`dev`スクリプトを以下のように置き換えます。

```json title="package.json"
{
  "scripts": {
    "dev": "cross-env NODE_OPTIONS='--inspect' next dev"
  }
}
```

`cross-env`は、Mac、Linux、Windowsを含むどのプラットフォームでも`NODE_OPTIONS`環境変数を設定し、デバイスやオペレーティングシステムを超えた一貫したデバッグを可能にします。

> **知っておくと良いこと**： Windows Defenderをマシン上で無効にしてください。これは、*すべてのファイルを読み取るたびに*チェックする外部サービスであり、`next dev`を使用している場合の高速更新時間を大幅に増加させると報告されています。これはNext.jsに関連しない既知の問題ですが、Next.jsの開発に影響を与えます。

## 詳細情報 {#more-information}

JavaScriptデバッガーの使用方法についてさらに学ぶには、以下のドキュメントをご覧ください。

- [VS CodeでのNode.jsデバッグ: ブレークポイント](https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_breakpoints)
- [Chrome DevTools: JavaScriptのデバッグ](https://developers.google.com/web/tools/chrome-devtools/javascript)
- [Firefox DevTools: デバッガー](https://firefox-source-docs.mozilla.org/devtools-user/debugger/)
