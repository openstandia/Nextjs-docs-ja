---
title: 'デバッグ'
description: 'VS Code、Chrome DevTools、または Firefox DevToolsを使用して、Next.jsアプリケーションをデバッグする方法を学びます'
---

{/* このドキュメントの内容はapp routerとpages routerで共有されます。Pages routerに特化したコンテンツを追加するには、`<PagesOnly>Content</PagesOnly>`コンポーネントを使用できます。共有コンテンツはコンポーネントでラップされるべきではありません。 */}

このドキュメントでは、[VS Codeデバッガー](https://code.visualstudio.com/docs/editor/debugging)、[Chrome DevTools](https://developers.google.com/web/tools/chrome-devtools)、または[Firefox DevTools](https://firefox-source-docs.mozilla.org/devtools-user/)を使用して、完全なソースマップサポートでNext.jsのフロントエンドとバックエンドコードをデバッグする方法を説明します。

Node.jsにアタッチできるデバッガーであれば、Next.jsアプリケーションのデバッグに使用できます。詳細はNode.jsの[デバッグガイド](https://nodejs.org/en/docs/guides/debugging-getting-started/)を参照してください。

## VS Codeでのデバッグ {#debugging-with-vs-code}

あなたのプロジェクトのrootに`.vscode/launch.json`という名前のファイルを次のように作成します：

```json title="launch.json"
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: デバッグ サーバーサイド",
      "type": "node-terminal",
      "request": "launch",
      "command": "npm run dev"
    },
    {
      "name": "Next.js: デバッグ クライアントサイド",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    },
    {
      "name": "Next.js: デバッグ クライアントサイド (Firefox)",
      "type": "firefox",
      "request": "launch",
      "url": "http://localhost:3000",
      "reAttach": true,
      "pathMappings": [
        {
          "url": "webpack://_N_E",
          "path": "${workspaceFolder}"
        }
      ]
    },
    {
      "name": "Next.js: デバッグ フルスタック",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/next",
      "runtimeArgs": ["--inspect"],
      "skipFiles": ["<node_internals>/**"],
      "serverReadyAction": {
        "action": "debugWithEdge",
        "killOnServerStop": true,
        "pattern": "- Local:.+(https?://.+)",
        "uriFormat": "%s",
        "webRoot": "${workspaceFolder}"
      }
    }
  ]
}
```

> **Note**: VS CodeでFirefoxデバッグを利用するには、[Firefox Debugger拡張機能](https://marketplace.visualstudio.com/items?itemName=firefox-devtools.vscode-firefox-debug)をインストールする必要があります。

`npm run dev`は、Yarnを使用している場合は`yarn dev`、pnpmを使用している場合は`pnpm dev`に置き換えられます。

"Next.js: デバッグ フルスタック"構成の中で、`serverReadyAction.action`はサーバーが準備完了したときに開くブラウザを指定します。`debugWithEdge`というのはEdgeブラウザを起動することを意味します。Chromeを使っている場合は、この値を`debugWithChrome`に変更します。

アプリケーションの開始ポート番号を変更する場合は、`http://localhost:3000`の`3000`を使用しているポートに置き換えます。

root以外のディレクトリからNext.jsを実行している場合（たとえば、Turborepoを使用している場合）、サーバーサイドおよびフルスタックデバッグタスクに`cwd`を追加する必要があります。たとえば、`"cwd": "${workspaceFolder}/apps/web"`のようにします。

次に、デバッグパネル（Windows/Linuxでは`Ctrl+Shift+D`、macOSでは`⇧+⌘+D`）に移動し、起動構成を選択してから`F5`を押すか、コマンドパレットから**デバッグ: デバッグ開始**を選択してデバッグセッションを開始します。

## Jetbrains WebStormでのデバッガーの使用 {#using-the-debugger-in-jetbrains-webstorm}

ランタイム構成をリストしているドロップダウンメニューをクリックし、`構成を編集...`をクリックします。`http://localhost:3000`をURLとする`JavaScript デバッグ`デバッグ構成を作成します。好みに合わせてカスタマイズ（例: デバッグ用のブラウザ、プロジェクトファイルとして保存）し、`OK`をクリックします。このデバッグ構成を実行すると、選択したブラウザが自動的に開きます。この時点で、NextJSノードアプリケーションとクライアント/ブラウザアプリケーションの2つがデバッグモードになります。

## ブラウザDevToolsでのデバッグ {#debugging-with-browser-devtools}

### クライアントサイドコード {#client-side-code}

`next dev`、`npm run dev`、または`yarn dev`を実行して通常どおり開発サーバーを起動します。サーバーが起動したら、好みのブラウザで`http://localhost:3000`（または別のURL）を開きます。

Chromeの場合：

- Chromeの開発者ツールを開く（Windows/Linuxでは`Ctrl+Shift+J`、macOSでは`⌥+⌘+I`）
- **Sources**タブに移動

Firefoxの場合：

- Firefoxの開発者ツールを開く（Windows/Linuxでは`Ctrl+Shift+I`、macOSでは`⌥+⌘+I`）
- **Debugger**タブに移動

いずれのブラウザでも、クライアントサイドコードが[`debugger`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/debugger)ステートメントに達すると、コード実行が一時停止し、そのファイルはデバッグエリアに表示されます。また、手動でブレークポイントを設定するためにファイルを検索することもできます：

- Chromeで：Windows/Linuxの場合は`Ctrl+P`、macOSの場合は`⌘+P`を押す
- Firefoxで：Windows/Linuxの場合は`Ctrl+P`、macOSの場合は`⌘+P`を押すか、左パネルのファイルtreeを使用

検索時、ソースファイルのパスは`webpack://_N_E/./`から始まります。

### サーバーサイドコード {#server-side-code}

ブラウザのDevToolsを使用してサーバーサイドのNext.jsコードをデバッグするには、基盤となるNode.jsプロセスに[`--inspect`](https://nodejs.org/api/cli.html#cli_inspect_host_port)フラグを渡す必要があります：

```bash title="Terminal"
NODE_OPTIONS='--inspect' next dev
```

> **Good to know**: `NODE_OPTIONS='--inspect=0.0.0.0'`を使用すると、Dockerコンテナ内でアプリを実行するときのように、localhost以外のリモートデバッグアクセスを許可します。

`npm run dev`または`yarn dev`を使用している場合は、`package.json`の`dev`スクリプトを更新する必要があります：

```json title="package.json"
{
  "scripts": {
    "dev": "NODE_OPTIONS='--inspect' next dev"
  }
}
```

`--inspect`フラグを使用してNext.js開発サーバーを起動すると、次のようになります：

```bash title="Terminal"
Debugger listening on ws://127.0.0.1:9229/0cf90313-350d-4466-a748-cd60f4e47c95
For help, see: https://nodejs.org/en/docs/inspector
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
```

Chromeの場合：

1. 新しいタブを開き、`chrome://inspect`に移動
2. **リモートターゲット**セクションでNext.jsアプリケーションを探す
3. **inspect**をクリックして別のDevToolsウィンドウを開く
4. **Sources**タブに移動

Firefoxの場合：

1. 新しいタブを開き、`about:debugging`に移動
2. 左サイドバーの**このFirefox**をクリック
3. **リモートターゲット**の下でNext.jsアプリケーションを探す
4. **Inspect**をクリックしてデバッガを開く
5. **Debugger**タブに移動

サーバーサイドのコードのデバッグはクライアントサイドデバッグと同様に機能します。ファイルを検索するとき（`Ctrl+P`/`⌘+P`）、ソースファイルのパスは`webpack://{application-name}/./`から始まります（`{application-name}`は`package.json`ファイルに従ってあなたのアプリケーションの名前に置き換えられます）。

### ブラウザDevToolsを用いてサーバーエラーを調査する {#inspect-server-errors-with-browser-devtools}

エラーが発生した場合、ソースコードを調査することでエラーの根本原因を追跡するのに役立ちます。

Next.jsはdevオーバーレイ上に緑色のボタンとしてNode.jsのロゴを表示します。そのボタンをクリックすると、DevToolsのURLがクリップボードにコピーされます。そのURLで新しいブラウザタブを開くことで、Next.jsサーバープロセスを調査できます。

<Image
  alt="DevTools URLをコピーする例"
  srcLight="/docs/dark/copy-devtool-url-example.png"
  srcDark="/docs/dark/copy-devtool-url-example.png"
  width="1600"
  height="594"
/>

### Windowsでのデバッグ {#debugging-on-windows}

Windowsユーザーは`NODE_OPTIONS='--inspect'`を使用するときに問題に遭遇する可能性があります。というのも、その構文はWindowsプラットフォームでサポートされていないためです。これを回避するために、[`cross-env`](https://www.npmjs.com/package/cross-env)パッケージを開発依存関係（`npm`および`yarn`では`-D`）としてインストールし、`dev`スクリプトを次のように置き換えます。

```json title="package.json"
{
  "scripts": {
    "dev": "cross-env NODE_OPTIONS='--inspect' next dev"
  }
}
```

`cross-env`は、あなたのプラットフォームに関係なく（Mac、Linux、Windowsを含む）`NODE_OPTIONS`環境変数を設定し、デバイスやオペレーティングシステム全体で一貫してデバッグを可能にします。

> **Good to know**: Windows Defenderがコンピュータで無効になっていることを確認してください。この外部サービスは*すべてのファイル読み取り*を確認し、`next dev`での高速リフレッシュ時間が大幅に増加すると報告されています。これはNext.jsに関連しない既知の問題ですが、Next.js開発に影響を与えます。

## 詳細情報 {#more-information}

JavaScriptデバッガーの使用方法についてさらに学習するには、以下のドキュメントを参照してください：

- [VS CodeでのNode.jsデバッグ: ブレークポイント](https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_breakpoints)
- [Chrome DevTools: JavaScriptをデバッグする](https://developers.google.com/web/tools/chrome-devtools/javascript)
- [Firefox DevTools: デバッガー](https://firefox-source-docs.mozilla.org/devtools-user/debugger/)
