---
title: 'Video Optimization'
nav_title: 'Videos'
description: 'Next.jsアプリケーションでの動画最適化に関する推奨事項とベストプラクティス。'
---

このページでは、Next.jsアプリケーションで動画を使用する方法を概説し、動画ファイルをどのように保存し表示することでパフォーマンスに影響を与えないかを示します。

## `<video>` と `<iframe>` の使用 {#using-video-and-iframe}

動画は、HTMLの **`<video>`** タグを使用して直接的な動画ファイルを埋め込むか、**`<iframe>`** を使用して外部プラットフォームにホストされている動画を埋め込むことができます。

### `<video>` {#video}

HTMLの[`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)タグを使用すると、自己ホストまたは直接提供される動画コンテンツを埋め込むことができ、再生および外観の完全な制御を行うことができます。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### 一般的な `<video>` タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                                                             | 例の値                               |
| ------------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `src`         | 動画ファイルのソースを指定します                                                                                 | `<video src="/path/to/video.mp4" />` |
| `width`       | 動画プレーヤーの幅を設定します                                                                                   | `<video width="320" />`              |
| `height`      | 動画プレーヤーの高さを設定します                                                                                 | `<video height="240" />`             |
| `controls`    | 存在する場合、デフォルトの再生コントロールセットを表示します                                                     | `<video controls />`                 |
| `autoPlay`    | ページが読み込まれたときに、自動的に動画の再生を開始します。注意：オートプレイのポリシーはブラウザ間で異なります | `<video autoPlay />`                 |
| `loop`        | 動画の再生を繰り返します                                                                                         | `<video loop />`                     |
| `muted`       | デフォルトで音声がミュートされます。通常は`autoPlay`とともに使用されます                                         | `<video muted />`                    |
| `preload`     | 動画のプリロード方法を指定します。値：`none`、`metadata`、`auto`                                                 | `<video preload="none" />`           |
| `playsInline` | iOSデバイス上でのインライン再生を可能にし、オートプレイをiOS Safariで動作させるために必要な場合が多い            | `<video playsInline />`              |

> **Good to know**: `autoPlay`属性を使用する場合、`muted`属性も含めることが重要です。これにより、ほとんどのブラウザで動画が自動的に再生され、iOSデバイスとの互換性のために`playsInline`属性を含めることも推奨されます。

詳細な動画属性のリストについては、[MDNのドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes)を参照してください。

### 動画のベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ：** `<video>`タグを使用する際には、動画再生をサポートしないブラウザ向けにタグ内にフォールバックコンテンツを含めてください
- **字幕やキャプション：** 聴覚障がいのあるユーザーのために字幕やキャプションを含めてください。`<video>`要素に[`<track>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track)タグを利用してキャプションファイルのソースを指定してください
- **アクセシブルコントロール：** 標準のHTML5動画コントロールは、キーボードナビゲーションやスクリーンリーダーとの互換性のために推奨されます。高度なニーズの場合、[react-player](https://github.com/cookpete/react-player)や[video.js](https://videojs.com/)などのサードパーティプレーヤーを検討してください。これらはアクセシブルなコントロールと一貫したブラウザ体験を提供します

### `<iframe>` {#iframe}

HTMLの`<iframe>`タグを使うと、YouTubeやVimeoなどの外部プラットフォームから動画を埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### 一般的な `<iframe>` タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                             | 例の値                                 |
| ----------------- | ---------------------------------------------------------------- | -------------------------------------- |
| `src`             | 埋め込むページのURL                                              | `<iframe src="https://example.com" />` |
| `width`           | iframeの幅を設定します                                           | `<iframe width="500" />`               |
| `height`          | iframeの高さを設定します                                         | `<iframe height="300" />`              |
| `allowFullScreen` | iframeのコンテンツをフルスクリーンモードで表示できるようにします | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe内のコンテンツに制限を追加します                           | `<iframe sandbox />`                   |
| `loading`         | 読み込み動作を最適化します（例：遅延読み込み）                   | `<iframe loading="lazy" />`            |
| `title`           | アクセシビリティをサポートするためにiframeにタイトルを提供します | `<iframe title="Description" />`       |

詳細なiframe属性のリストについては、[MDNのドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes)を参照してください。

### 動画埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.jsアプリケーションに動画を埋め込む方法には2つあります：

- **自己ホストまたは直接動画ファイルの場合：** `<video>`タグを使用して自己ホスト動画を埋め込みます。この方法では、プレイヤーの機能や外観について詳細に制御する必要があるシナリオで使用します。この統合方法はNext.js内でカスタマイズと動画コンテンツの制御を可能にします。
- **動画ホスティングサービスを使用する場合（YouTube, Vimeoなど）：** YouTubeやVimeoのような動画ホスティングサービスを利用する場合、`<iframe>`タグを使用して彼らのiframeベースのプレーヤーを埋め込みます。この方法はプレーヤーの制御が一部制限される一方で、使用の容易さとこれらのプラットフォームが提供する機能を提供します。

アプリケーションの要件と提供したいユーザー体験に合った埋め込み方法を選択してください。

### 外部ホストされた動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームからの動画を埋め込むには、Next.jsを使用して動画情報を取得し、React Suspenseを用いて読み込みのフォールバック状態を処理できます。

**1. 動画埋め込み用のServer Componentを作成**

まず、[Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components)を作成し、動画埋め込みに適したiframeを生成します。このコンポーネントは、動画のソースURLを取得し、iframeをレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. React Suspenseを使用して動画コンポーネントをストリームする**

動画を埋め込むためのServer Componentを作成した後、[React Suspense](https://react.dev/reference/react/Suspense)を使用してコンポーネントを[ストリーム](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)します。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* ページの他のコンテンツ */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームから動画を埋め込む際のベストプラクティスを考慮してください：
>
> - 動画埋め込みがレスポンシブであることを確認してください。 CSSを利用してiframeまたは動画プレーヤーをさまざまな画面サイズに適応させます
> - ネットワーク条件に基づく[動画の読み込み戦略](https://yoast.com/site-speed-tips-for-faster-video/)を実装してください。特にデータプランが限られたユーザーの場合

このアプローチは、ページのブロックを防ぐため、向上したユーザー体験を提供することになります。つまり、動画コンポーネントがストリームされる間、ユーザーがページと対話することができます。

より魅力的で情報量の多い読み込み体験を提供するために、フォールバックUIとして読み込みスケルトンを使用することを検討してください。単純な読み込みメッセージを表示する代わりに、次のように動画プレーヤーに似たスケルトンを表示することができます：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* ページの他のコンテンツ */}
    </section>
  )
}
```

## 自己ホスト動画 {#self-hosted-videos}

自己ホスト動画が推奨される理由はいくつかあります：

- **完全な制御と独立性：** 自己ホストにより、動画コンテンツの再生から外観までを直接管理することができ、外部プラットフォームの制約のない完全な所有と制御を保証します。
- **特定のニーズに合わせたカスタマイズ：** 動的な背景動画などのユニークな要件に最適であり、デザインと機能のニーズに合わせたカスタマイズが可能です。
- **パフォーマンスと拡張性の考慮事項：** 高性能かつ拡張可能なストレージソリューションを選択し、増加するトラフィックとコンテンツサイズに効果的に対応します。
- **コストと統合：** ストレージと帯域幅のコストをNext.jsのフレームワークや広範な技術エコシステムに簡単に統合する必要とバランスをとります。

### Vercel Blobで動画をホストする {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)は、Next.jsとよく連携するスケーラブルなクラウドストレージソリューションを提供し、効率的に動画をホストする方法を提供します。Vercel Blobを使用して動画をホストする方法を次に示します：

**1. Vercel Blobに動画をアップロードする**

Vercelのダッシュボードで「ストレージ」タブに移動し、[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)ストアを選択します。Blobテーブルの右上にある「アップロード」ボタンをクリックし、アップロードしたい動画ファイルを選択してください。アップロードが完了すると、動画ファイルがBlobテーブルに表示されます。

別の方法として、サーバーアクションを使用して動画をアップロードすることもできます。詳細な手順については、[サーバーサイドのアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload)に関するVercelのドキュメントを参照してください。Vercelは[クライアントサイドのアップロード](https://vercel.com/docs/storage/vercel-blob/client-upload)もサポートしています。特定のユースケースでは、この方法が好ましい場合があります。

**2. Next.jsで動画を表示する**

動画をアップロードして保存したら、Next.jsアプリケーションで表示できます。以下に`<video>`タグとReact Suspenseを使用してこれを行う例を示します：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページは動画の`@vercel/blob`URLを使用して動画を`VideoComponent`で表示します。React Suspenseは、動画URLが取得され動画が表示される準備ができるまでフォールバックを表示するために使用されます。

### 動画に字幕を追加する {#adding-subtitles-to-your-video}

動画に字幕がある場合、`<video>`タグ内の`<track>`要素を使用して簡単に追加できます。[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)から動画ファイルと同様に字幕ファイルを取得することができます。`<VideoComponent>`を更新して字幕を含める方法は以下の通りです。

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチに従うことで、Next.jsアプリケーションに動画を効果的に自己ホストし、統合することができます。

## リソース {#resources}

動画の最適化やベストプラクティスについてさらに学ぶために、次のリソースを参照してください：

- **動画フォーマットとコーデックの理解：** MP4の互換性やWebMによるウェブ最適化など、動画のニーズに応じて適切なフォーマットとコーデックを選択してください。詳細については、[Mozillaの動画コーデックガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs)をご覧ください。
- **動画圧縮：** FFmpegなどのツールを使用して動画を効果的に圧縮し、品質とファイルサイズのバランスを取ります。圧縮技術については[FFmpegの公式ウェブサイト](https://www.ffmpeg.org/)で学ぶことができます。
- **解像度とビットレートの調整：** 閲覧プラットフォームに基づいて[解像度とビットレート](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%20measure%20different%20aspects,yield%20different%20qualities%20of%20video)を調整します。モバイルデバイス向けには低い設定にします。
- **コンテンツデリバリーネットワーク（CDN）：** 動画の配信速度を向上させ、トラフィックが多い場合にも対応できるようにCDNを利用してください。一部のストレージソリューション（例：Vercel Blobなど）を使用する場合、CDN機能は自動的に処理されます。[CDNとその利点について詳しく学ぶ](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website)ことが可能です。

Next.jsプロジェクトに動画を統合するためのこれらの動画ストリーミングプラットフォームを探求してください：

### オープンソースの`next-video`コンポーネント {#open-source-next-video-component}

- Vercel Blob、S3、Backblaze、Muxなどのさまざまなホスティングサービスに対応したNext.js用の`<Video>`コンポーネントを提供します
- 異なるホスティングサービスでの`next-video.dev`の使用に関する[詳細なドキュメント](https://next-video.dev/docs)

### Cloudinary統合 {#cloudinary-integration}

- Next.jsでCloudinaryを使用するための[公式ドキュメントと統合ガイド](https://next.cloudinary.dev/)
- [ドロップイン動画サポート](https://next.cloudinary.dev/cldvideoplayer/basic-usage)用の`<CldVideoPlayer>`コンポーネントを含んでいます
- CloudinaryをNext.jsと統合する[例を見つける](https://github.com/cloudinary-community/cloudinary-examples/?tab=readme-ov-file#nextjs)ことができ、[アダプティブビットレートストリーミング](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr)を含む
- Node.js SDKを含むその他の[Cloudinaryライブラリ](https://cloudinary.com/documentation)も利用可能です

### Mux Video API {#mux-video-api}

- Muxは、MuxとNext.jsを使用してビデオコースを作成するための[スターターテンプレート](https://github.com/muxinc/video-course-starter-kit)を提供します
- Next.jsアプリケーションでの[高パフォーマンス動画の埋め込み](https://www.mux.com/for/nextjs)に関するMuxの推奨事項を学びます
- Next.jsとMuxを利用した[プロジェクトの例](https://with-mux-video.vercel.app/)を探ります

### Fastly {#fastly}

- Next.jsへの[ビデオオンデマンド](https://www.fastly.com/products/streaming-media/video-on-demand)とストリーミングメディアのFastlyソリューションの統合について詳しく学びましょう

### ImageKit.io統合 {#imagekit-io-integration}

- Next.jsとのImageKit統合に関する[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs)をチェックしてください
- 統合は`<IKVideo>`コンポーネントを提供し、[シームレスな動画サポート](https://imagekit.io/docs/integration/nextjs#rendering-videos)を提供します
- また、Node.js SDKなどのその他の[ImageKitライブラリ](https://imagekit.io/docs)を探求することも可能です
