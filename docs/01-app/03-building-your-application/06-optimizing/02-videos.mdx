---
title: 'ビデオの最適化'
nav_title: 'Videos'
description: 'Next.jsアプリケーションでのビデオの最適化に関する推奨事項とベストプラクティス。'
---

このページでは、Next.jsアプリケーションで動画を使用する方法を説明しており、パフォーマンスに影響を与えずに動画ファイルを保存し表示する方法を示しています。

## `<video>` と `<iframe>` の使用 {#using-video-and-iframe}

動画は、直接の動画ファイルにはHTMLの **`<video>`** タグを、外部プラットフォームでホストされている動画には **`<iframe>`** を使用してページに埋め込むことができます。

### `<video>` {#video}

HTMLの [`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video) タグは、自己ホスト又は直接配信される動画コンテンツを埋め込むことができ、再生や外観を完全に制御できます。

```jsx title="app/ui/video.jsx"
export function Video() {
  return (
    <video width="320" height="240" controls preload="none">
      <source src="/path/to/video.mp4" type="video/mp4" />
      <track
        src="/path/to/captions.vtt"
        kind="subtitles"
        srcLang="en"
        label="English"
      />
      Your browser does not support the video tag.
    </video>
  )
}
```

### よく使われる `<video>` タグの属性 {#common-video-tag-attributes}

| 属性          | 説明                                                                                               | 例値                                 |
| ------------- | -------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `src`         | 動画ファイルのソースを指定します。                                                                 | `<video src="/path/to/video.mp4" />` |
| `width`       | ビデオプレイヤーの幅を設定します。                                                                 | `<video width="320" />`              |
| `height`      | ビデオプレイヤーの高さを設定します。                                                               | `<video height="240" />`             |
| `controls`    | 存在する場合、デフォルトの再生コントロールセットを表示します。                                     | `<video controls />`                 |
| `autoPlay`    | ページの読み込み時に動画再生を自動で開始します。注意：自動再生ポリシーはブラウザごとに異なります。 | `<video autoPlay />`                 |
| `loop`        | 動画再生をループさせます。                                                                         | `<video loop />`                     |
| `muted`       | デフォルトでオーディオを消音します。 `autoPlay` と共に使用されることが多いです。                   | `<video muted />`                    |
| `preload`     | 動画のプリロード方法を指定します。値: `none`, `metadata`, `auto`。                                 | `<video preload="none" />`           |
| `playsInline` | iOSデバイスでのインライン再生を可能にし、多くのブラウザでの自動再生のためにしばしば必要です。      | `<video playsInline />`              |

> **Good to know**: `autoPlay` 属性を使用する際は、ほとんどのブラウザで動画を自動再生するために `muted` 属性も付けることが重要であり、iOSデバイスと互換性を保つために `playsInline` 属性を含めるとよいです。

動画属性の包括的なリストについては、[MDNドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes) を参照してください。

### ビデオのベストプラクティス {#video-best-practices}

- **フォールバックコンテンツ:** `<video>` タグを使用する際、動画の再生をサポートしないブラウザ向けに、タグ内にフォールバックコンテンツを含めるようにする
- **字幕またはキャプション:** 聴覚障害のあるユーザー向けに字幕やキャプションを含める。 `<video>` 要素に [`<track>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track) タグを使用してキャプションファイルのソースを指定する
- **アクセシブルコントロール:** 標準のHTML5ビデオコントロールは、キーボード操作とスクリーンリーダーの互換性のために推奨される。より高度なニーズには、アクセシブルなコントロールと一貫したブラウザの体験を提供するサードパーティのプレーヤー、例えば [react-player](https://github.com/cookpete/react-player) や [video.js](https://videojs.com/) を考慮する

### `<iframe>` {#iframe}

HTMLの `<iframe>` タグを使うと、YouTubeやVimeoなどの外部プラットフォームから動画を埋め込むことができます。

```jsx title="app/page.jsx"
export default function Page() {
  return (
    <iframe src="https://www.youtube.com/embed/19g66ezsKAg" allowFullScreen />
  )
}
```

### よく使われる `<iframe>` タグの属性 {#common-iframe-tag-attributes}

| 属性              | 説明                                                               | 例値                                   |
| ----------------- | ------------------------------------------------------------------ | -------------------------------------- |
| `src`             | 埋め込むページのURL。                                              | `<iframe src="https://example.com" />` |
| `width`           | iframeの幅を設定します。                                           | `<iframe width="500" />`               |
| `height`          | iframeの高さを設定します。                                         | `<iframe height="300" />`              |
| `allowFullScreen` | iframeコンテンツをフルスクリーンモードで表示できるようにします。   | `<iframe allowFullScreen />`           |
| `sandbox`         | iframe内のコンテンツに対して追加の制限を有効にします。             | `<iframe sandbox />`                   |
| `loading`         | 読み込み動作を最適化します（例：遅延読み込み）。                   | `<iframe loading="lazy" />`            |
| `title`           | アクセシビリティをサポートするためにiframeのタイトルを提供します。 | `<iframe title="Description" />`       |

iframe属性の包括的なリストについては、[MDNドキュメント](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attributes) を参照してください。

### ビデオ埋め込み方法の選択 {#choosing-a-video-embedding-method}

Next.jsアプリケーションにビデオを埋め込む方法は2つあります：

- **自己ホストまたは直接配信動画ファイル:** プレイヤーの機能と外観に対する詳細な制御が必要な場合は、`<video>` タグを使用して自己ホストのビデオを埋め込む。Next.jsでのこの統合方法により、ビデオコンテンツのカスタマイズと制御が可能になる
- **動画ホスティングサービスを使用する（YouTube、Vimeoなど）:** YouTubeやVimeoなどの動画ホスティングサービスの場合、 `<iframe>` タグを使用してそれらのiframeベースのプレイヤーを埋め込む。この方法はプレイヤーへの制御を一部制限しますが、これらのプラットフォームが提供する機能の利用と使用の容易さを提供する

アプリケーションの要件と提供したいユーザー体験に応じた埋め込み方法を選択する。

### 外部でホストされた動画の埋め込み {#embedding-externally-hosted-videos}

外部プラットフォームから動画を埋め込むには、Next.jsを使用して動画情報を取得し、React Suspenseを利用して読み込み中のフォールバック状態を処理することができます。

**1. ビデオ埋め込み用のサーバーコンポーネントを作成する**

最初のステップは、動画埋め込み用の適切なiframeを生成する [Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components) を作成することです。このコンポーネントは動画のソースURLを取得し、iframeをレンダリングします。

```jsx title="app/ui/video-component.jsx"
export default async function VideoComponent() {
  const src = await getVideoSrc()

  return <iframe src={src} allowFullScreen />
}
```

**2. React Suspenseを使ってビデオコンポーネントをストリームする**

動画を埋め込むためのサーバーコンポーネントを作成した後は、 [React Suspense](https://react.dev/reference/react/Suspense) を使用してコンポーネントを [ストリーム](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming) する手順に進みます。

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<p>Loading video...</p>}>
        <VideoComponent />
      </Suspense>
      {/* 他のページコンテンツ */}
    </section>
  )
}
```

> **Good to know**: 外部プラットフォームから動画を埋め込む際には、以下のベストプラクティスを考慮すること：
>
> - 動画埋め込みがレスポンシブであることを確認する。異なる画面サイズに適応するためにCSSを使用してiframeや動画プレイヤーを調整する。
> - 特にデータ通信量が限られているユーザーに対して、ネットワーク状態に基づいた [動画の読み込み戦略](https://yoast.com/site-speed-tips-for-faster-video/) を実施する

このアプローチにより、ページがブロックされない、つまりユーザーが動画コンポーネントがストリーミングされる間にページと対話できるため、ユーザー体験が向上します。

より魅力的で情報豊かな読み込み体験を提供するために、フォールバックUIとして読み込みスケルトンを使用することを検討してください。シンプルな読み込みメッセージを表示する代わりに、次のようなビデオプレイヤーに似たスケルトンを表示することができます：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import VideoComponent from '../ui/VideoComponent.jsx'
import VideoSkeleton from '../ui/VideoSkeleton.jsx'

export default function Page() {
  return (
    <section>
      <Suspense fallback={<VideoSkeleton />}>
        <VideoComponent />
      </Suspense>
      {/* 他のページコンテンツ */}
    </section>
  )
}
```

## 自己ホストのビデオ {#self-hosted-videos}

いくつかの理由で自己ホスティングビデオが好まれます：

- **完全な制御と独立性**: 自己ホスティングでは、再生から外観に至るまでビデオコンテンツを直接管理できるため、外部プラットフォームの制約から解放された完全な所有権と制御が確保されます。
- **特定のニーズへのカスタマイズ**: 動的な背景動画など独自の要件に理想的で、デザインと機能のニーズに合わせたカスタマイズが可能になります。
- **パフォーマンスとスケーラビリティの考慮事項**: 高トラフィックやコンテンツサイズの増加を効果的にサポートするために、性能とスケーラブルなストレージソリューションを選択してください。
- **コストと統合**: ストレージと帯域のコストを、Next.jsフレームワークや広範な技術エコシステムへの容易な統合の必要性とバランスさせてください。

### Vercel Blobを使用した動画ホスティング {#using-vercel-blob-for-video-hosting}

[Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) は効率的に動画をホストする方法を提供し、Next.jsと相性の良いスケーラブルなクラウドストレージソリューションです。以下において、Vercel Blobを使用して動画をホストする方法を示します：

**1. Vercel Blobに動画をアップロードする**

Vercelダッシュボードで、「ストレージ」タブに移動し、あなたの [Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) ストアを選択します。Blobテーブルの右上にある「アップロード」ボタンを見つけてクリックし、アップロードしたいビデオファイルを選択してください。アップロード完了後、ビデオファイルはBlobテーブルに表示されます。

また、サーバーアクションを使用して動画をアップロードすることもできます。詳細については、[サーバーサイドアップロード](https://vercel.com/docs/storage/vercel-blob/server-upload) に関するVercelのドキュメントを参照してください。Vercelはまた、[クライアントサイドのアップロード](https://vercel.com/docs/storage/vercel-blob/client-upload) もサポートしています。この方法は特定のユースケースにおいては好まれるかもしれません。

**2. Next.jsでビデオを表示する**

ビデオがアップロードされ保存されたら、Next.jsアプリケーションで表示できます。以下に `<video>` タグとReact Suspenseを使用した例を示します：

```jsx title="app/page.jsx"
import { Suspense } from 'react'
import { list } from '@vercel/blob'

export default function Page() {
  return (
    <Suspense fallback={<p>Loading video...</p>}>
      <VideoComponent fileName="my-video.mp4" />
    </Suspense>
  )
}

async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 1,
  })
  const { url } = blobs[0]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  )
}
```

このアプローチでは、ページはビデオの `@vercel/blob` URL を使用してビデオを表示しようとし、 `VideoComponent` を使用します。React Suspenseは、ビデオのURLが取得されてビデオが表示可能になるまで、フォールバックを表示するために使用されます。

### ビデオに字幕を追加する {#adding-subtitles-to-your-video}

ビデオに字幕がある場合、それを `<video>` タグ内の `<track>` 要素を使って簡単に追加できます。ビデオファイルと同様に [Vercel Blob](https://vercel.com/docs/storage/vercel-blob?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) から字幕ファイルを取得することができます。以下では、字幕を含めるように `<VideoComponent>` を更新する方法を示します。

```jsx title="app/page.jsx"
async function VideoComponent({ fileName }) {
  const { blobs } = await list({
    prefix: fileName,
    limit: 2,
  })
  const { url } = blobs[0]
  const { url: captionsUrl } = blobs[1]

  return (
    <video controls preload="none" aria-label="Video player">
      <source src={url} type="video/mp4" />
      <track src={captionsUrl} kind="subtitles" srcLang="en" label="English" />
      Your browser does not support the video tag.
    </video>
  )
}
```

この手法に従うことで、自分のNext.jsアプリケーションにビデオを効果的に自己ホストし、統合することができます。

## リソース {#resources}

ビデオの最適化とベストプラクティスについてさらに学習を続けるには、以下のリソースを参照してください：

- **ビデオ形式とコーデックの理解**: ビデオニーズに基づいて、MP4の互換性やWebMのWeb最適化など、適切な形式とコーデックを選択する。詳細については、[Mozillaのビデオコーデックに関するガイド](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs) を参照。
- **ビデオ圧縮**: FFmpegのようなツールを使用して動画を効果的に圧縮し、品質とファイルサイズのバランスを取る。[FFmpegの公式サイト](https://www.ffmpeg.org/)で圧縮技術について学ぶ。
- **解像度とビットレートの調整**: モバイルデバイス向けに低い設定での [解像度とビットレート](https://www.dacast.com/blog/bitrate-vs-resolution/#:~:text=The%20two%20measure%20different%20aspects,yield%20different%20qualities%20of%20video) の調整。
- **コンテンツ・デリバリー・ネットワーク（CDNs）** : 動画伝送速度を向上させ高トラフィクを管理するためにCDNを活用する。Vercel Blobのような一部のストレージソリューションを使用する場合、CDNの機能は自動的に処理されます。CDNsとその利点についての詳細は[こちら](https://vercel.com/docs/edge-network/overview?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) 。

Next.jsプロジェクトに動画を組み込むために、以下のビデオストリーミングプラットフォームを探求する：

### オープンソース `next-video` コンポーネント {#open-source-next-video-component}

- Vercel Blob, S3, Backblaze, Muxなど、複数のホスティングサービスと互換性のあるNext.js用 `<Video>` コンポーネントを提供
- さまざまなホスティングサービスでの `next-video.dev` の使用に関する [詳細なドキュメント](https://next-video.dev/docs)

### Cloudinaryとの統合 {#cloudinary-integration}

- Next.jsでCloudinaryを使用するための公式 [ドキュメントと統合ガイド](https://next.cloudinary.dev/)
- [ドロップインビデオサポート](https://next.cloudinary.dev/cldvideoplayer/basic-usage) のための `<CldVideoPlayer>` コンポーネントを含む
- [適応ビットレートストリーミング](https://github.com/cloudinary-community/cloudinary-examples/tree/main/examples/nextjs-cldvideoplayer-abr) を含むNext.jsとCloudinaryの統合例を[見つける](https://github.com/cloudinary-community/cloudinary-examples/?tab=readme-ov-file#nextjs)
- Node.js SDKを含む他の [Cloudinaryライブラリ](https://cloudinary.com/documentation) も利用可能

### Mux Video API {#mux-video-api}

- MuxとNext.jsでビデオコースを作成するための [スターターテンプレート](https://github.com/muxinc/video-course-starter-kit) を提供
- Next.jsアプリケーションの[高性能ビデオの埋め込みに関するMuxの推奨事項](https://www.mux.com/for/nextjs)
- MuxとNext.jsを示す[サンプルプロジェクト](https://with-mux-video.vercel.app/) を探索

### Fastly {#fastly}

- Next.jsにFastlyの[オンデマンドビデオ](https://www.fastly.com/products/streaming-media/video-on-demand) とストリーミングメディアのソリューションを統合する方法について詳細を学ぶ

### ImageKit.ioとの統合 {#imagekit-io-integration}

- Next.jsにImageKitを統合するための[公式クイックスタートガイド](https://imagekit.io/docs/integration/nextjs) をチェック
- 統合は [シームレスなビデオサポート](https://imagekit.io/docs/integration/nextjs#rendering-videos) を提供する `<IKVideo>` コンポーネントを提供
- Node.js SDKを含む他の [ImageKitライブラリ](https://imagekit.io/docs) も探ることができます。
