---
title: 'cacheLife'
description: 'キャッシュされた関数またはコンポーネントのキャッシュ有効期限を設定するためのcacheLife関数の使い方を学びましょう。'
version: 'canary'
related:
  title: '関連'
  description: '関連するAPIリファレンスを表示。'
  links:
    - app/api-reference/config/next-config-js/dynamicIO
    - app/api-reference/directives/use-cache
    - app/api-reference/functions/revalidateTag
    - app/api-reference/functions/cacheTag
---

`cacheLife` 関数は、関数またはコンポーネントのキャッシュの有効期間を設定するために使用されます。これは [`use cache`](/docs/app/api-reference/directives/use-cache) ディレクティブとともに、関数またはコンポーネントのスコープ内で使用する必要があります。

## 使い方 {#usage}

`cacheLife` を使用するには、`next.config.js` ファイルで [`dynamicIO` フラグ](/docs/app/api-reference/config/next-config-js/dynamicIO) を有効にします：

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="next.config.ts" switcher
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  experimental: {
    dynamicIO: true,
  },
}

export default nextConfig
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="next.config.js" switcher
const nextConfig = {
  experimental: {
    dynamicIO: true,
  },
}

export default nextConfig
```

</TabItem>
</Tabs>

その後、関数またはコンポーネントのスコープ内で `cacheLife` 関数をインポートして実行します：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/page.tsx" highlight={5} switcher
'use cache'
import { unstable_cacheLife as cacheLife } from 'next/cache'

export default async function Page() {
  cacheLife('hours')
  return <div>Page</div>
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/page.js" highlight={5} switcher
'use cache'
import { unstable_cacheLife as cacheLife } from 'next/cache'

export default async function Page() {
  cacheLife('hours')
  return <div>Page</div>
}
```

</TabItem>
</Tabs>

## リファレンス {#reference}

### デフォルトのキャッシュプロファイル {#default-cache-profiles}

Next.js は、さまざまな時間スケールに基づいた名前付きキャッシュプロファイルを提供します。`cacheLife` 関数とともに `use cache` ディレクティブでキャッシュプロファイルを指定しない場合、Next.js は自動的に「default」キャッシュプロファイルを適用します。

ただし、`use cache` ディレクティブを使用する場合は、キャッシュの動作を明確に定義するために常にキャッシュプロファイルを追加することをお勧めします。

| **プロファイル** | **Stale** | **Revalidate** | **Expire**     | **説明**                                                           |
| ---------------- | --------- | -------------- | -------------- | ------------------------------------------------------------------ |
| `default`        | undefined | 15 minutes     | INFINITE_CACHE | 頻繁に更新する必要のないコンテンツに適したデフォルトのプロファイル |
| `seconds`        | undefined | 1 second       | 1 minute       | ほぼリアルタイムの更新が必要な急速に変化するコンテンツ向け         |
| `minutes`        | 5 minutes | 1 minute       | 1 hour         | 1時間以内に頻繁に更新されるコンテンツ向け                          |
| `hours`          | 5 minutes | 1 hour         | 1 day          | 毎日更新されるが少し古くても良いコンテンツ向け                     |
| `days`           | 5 minutes | 1 day          | 1 week         | 週単位で更新されるが1日程度古くても問題ないコンテンツ向け          |
| `weeks`          | 5 minutes | 1 week         | 1 month        | 月単位で更新されるが1週間程度古くても問題ないコンテンツ向け        |
| `max`            | 5 minutes | 1 month        | INFINITE_CACHE | ほとんど更新が必要ない非常に安定したコンテンツ向け                 |

キャッシュプロファイルを参照するために使用される文字列値自体に固有の意味はありません。代わりに、セマンティックラベルとして機能します。これにより、コードベース内でキャッシュされたコンテンツをよりよく理解して管理できます。

### カスタムキャッシュプロファイル {#custom-cache-profiles}

次のようにして、カスタムキャッシュプロファイルを構成することができます。`next.config.ts` ファイルで [`cacheLife`](/docs/app/api-reference/config/next-config-js/cacheLife) オプションに追加します。

キャッシュプロファイルは次のプロパティを含むオブジェクトです：

| **プロパティ** | **値**   | **説明**                                                                                                  | **要件**                                           |
| -------------- | -------- | --------------------------------------------------------------------------------------------------------- | -------------------------------------------------- |
| `stale`        | `number` | クライアントがサーバーをチェックせずに値をキャッシュする期間。                                            | 任意                                               |
| `revalidate`   | `number` | サーバー側でキャッシュが更新される頻度。再検証中に古い値を提供する場合があります。                        | 任意                                               |
| `expire`       | `number` | 動的フェッチに切り替える前に値が古くなることができる最長期間；`revalidate` よりも長くなければなりません。 | 任意 - `revalidate` よりも長くする必要があります。 |

「stale」プロパティは、クライアントサイドの router キャッシュを具体的に制御するという点で、[`staleTimes`](/docs/app/api-reference/config/next-config-js/staleTimes) 設定とは異なります。`staleTimes` は、動的データと静的データの両方のすべてのインスタンスに影響を与えるグローバルな設定ですが、`cacheLife` の設定を使用すると、関数またはルートごとに「stale」時間を定義できます。

> **知っておくと良いこと**: 「stale」プロパティは `Cache-control: max-age` ヘッダーを設定しません。代わりにクライアントサイドの router キャッシュを制御します。

## 例 {#examples}

### 再利用可能なキャッシュプロファイルを定義する {#defining-reusable-cache-profiles}

再利用可能なキャッシュプロファイルを `next.config.ts` ファイルで定義することにより作成できます。使用例に適した名前を選択し、`stale`、`revalidate`、`expire` プロパティの値を設定します。必要に応じて、カスタムキャッシュプロファイルをいくつでも作成できます。各プロファイルは、文字列値として `cacheLife` 関数に渡すことでその名前で参照できます。

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="next.config.ts" switcher
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  experimental: {
    dynamicIO: true,
    cacheLife: {
      biweekly: {
        stale: 60 * 60 * 24 * 14, // 14日
        revalidate: 60 * 60 * 24, // 1日
        expire: 60 * 60 * 24 * 14, // 14日
      },
    },
  },
}

module.exports = nextConfig
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="next.config.js" switcher
const nextConfig = {
  experimental: {
    dynamicIO: true,
    cacheLife: {
      biweekly: {
        stale: 60 * 60 * 24 * 14, // 14日
        revalidate: 60 * 60 * 24, // 1日
        expire: 60 * 60 * 24 * 14, // 14日
      },
    },
  },
}

module.exports = nextConfig
```

</TabItem>
</Tabs>

上記の例では、14日間キャッシュし、毎日更新をチェックし、14日後にキャッシュが切れます。アプリケーション全体でこのプロファイルを名前で参照することができます：

```tsx title="app/page.tsx" highlight={5}
'use cache'
import { unstable_cacheLife as cacheLife } from 'next/cache'

export default async function Page() {
  cacheLife('biweekly')
  return <div>Page</div>
}
```

### デフォルトのキャッシュプロファイルをオーバーライドする {#overriding-the-default-cache-profiles}

デフォルトのキャッシュプロファイルは、キャッシュ可能な出力のどの部分がどれだけ新鮮で古いかを考えるための有用な方法を提供しますが、アプリケーションのキャッシング戦略により良く一致する異なる名前付きプロファイルを使用したいことがあります。

デフォルトと同じ名前の新しい構成を作成することで、デフォルトの名前付きキャッシュプロファイルをオーバーライドできます。

以下の例では、デフォルトの「days」キャッシュプロファイルをオーバーライドする方法を示しています：

```ts title="next.config.ts"
const nextConfig = {
  experimental: {
    dynamicIO: true,
    cacheLife: {
      days: {
        stale: 3600, // 1時間
        revalidate: 900, // 15分
        expire: 86400, // 1日
      },
    },
  },
}

module.exports = nextConfig
```

### インラインでキャッシュプロファイルを定義する {#defining-cache-profiles-inline}

特定の使用例に対して、`cacheLife` 関数にオブジェクトを渡すことでカスタムキャッシュプロファイルを設定できます：

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/page.tsx" highlight={5-9} switcher
'use cache'
import { unstable_cacheLife as cacheLife } from 'next/cache'

export default async function Page() {
  cacheLife({
    stale: 3600, // 1時間
    revalidate: 900, // 15分
    expire: 86400, // 1日
  })

  return <div>Page</div>
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/page.js" highlight={5-9} switcher
'use cache'
import { unstable_cacheLife as cacheLife } from 'next/cache'

export default async function Page() {
  cacheLife({
    stale: 3600, // 1時間
    revalidate: 900, // 15分
    expire: 86400, // 1日
  })

  return <div>Page</div>
}
```

</TabItem>
</Tabs>

このインラインキャッシュプロファイルは作成された関数またはファイルにのみ適用されます。アプリケーション全体で同じプロファイルを再利用したい場合は、`next.config.ts` ファイルの `cacheLife` プロパティに[設定を追加](#defining-reusable-cache-profiles)することができます。

### `use cache` および `cacheLife` のネストされた使用法 {#nested-usage-of-use-cache-and-cachelife}

同じルートまたはコンポーネントツリーで複数のキャッシュ動作を定義する場合、内部キャッシュが独自の `cacheLife` プロファイルを指定している場合、外部キャッシュは内部の中で最も短いキャッシュ期間を考慮します。これは、外部キャッシュ自身が明示的な `cacheLife` プロファイルを定義していない場合にのみ適用されます。

たとえば、ページに `use cache` ディレクティブを追加し、キャッシュプロファイルを指定しない場合、デフォルトのキャッシュプロファイルが暗黙的に適用されます（`cacheLife("default")`）。ページにインポートされたコンポーネントが独自のキャッシュプロファイルを持つ `use cache` ディレクティブを含む場合、外部キャッシュプロファイルと内部キャッシュプロファイルが比較され、プロファイルに設定された最短時間が適用されます。

```tsx title="app/components/parent.tsx" highlight={5,6}
// 親コンポーネント
import { unstable_cacheLife as cacheLife } from 'next/cache'
import { ChildComponent } from './child'

export async function ParentComponent() {
  'use cache'
  cacheLife('days')

  return (
    <div>
      <ChildComponent />
    </div>
  )
}
```

そして、インポートされた子コンポーネントを別ファイルで定義しました：

```tsx title="app/components/child.tsx" highlight={4,5}
// 子コンポーネント
import { unstable_cacheLife as cacheLife } from 'next/cache'

export async function ChildComponent() {
  'use cache'
  cacheLife('hours')
  return <div>Child Content</div>

  // このコンポーネントのキャッシュは短い「hours」プロファイルを考慮します
}
```
