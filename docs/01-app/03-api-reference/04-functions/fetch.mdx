---
title: 'fetch'
description: '拡張された fetch 関数のAPIリファレンス。'
---

Next.jsはサーバーでの各リクエストが固有の永続的なキャッシングと再検証のセマンティクスを設定できるように、[Web `fetch()` API](https://developer.mozilla.org/docs/Web/API/Fetch_API)を拡張しています。

ブラウザでは、`cache`オプションはfetchリクエストがブラウザのHTTPキャッシュとどのように相互作用するかを示します。この拡張により、`cache`はサーバーサイドのfetchリクエストがフレームワークの永続的な[データキャッシュ](/docs/app/building-your-application/caching#data-cache)とどのように相互作用するかを示します。

Server Component内で`async`と`await`を使用して直接`fetch`を呼び出すことができます。

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="app/page.tsx" switcher
export default async function Page() {
  let data = await fetch('https://api.vercel.app/blog') // データをフェッチ
  let posts = await data.json() // JSONとしてデータを解析
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li> // 各ポストのタイトルをリスト表示
      ))}
    </ul>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="app/page.js" switcher
export default async function Page() {
  let data = await fetch('https://api.vercel.app/blog') // データをフェッチ
  let posts = await data.json() // JSONとしてデータを解析
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li> // 各ポストのタイトルをリスト表示
      ))}
    </ul>
  )
}
```

</TabItem>
</Tabs>

## `fetch(url, options)` {#fetch-url-options}

Next.jsは[Web `fetch()` API](https://developer.mozilla.org/docs/Web/API/Fetch_API)を拡張しているので、[便利なオプション](https://developer.mozilla.org/docs/Web/API/fetch#parameters)を使用できます。

### `options.cache` {#options-cache}

Next.js [データキャッシュ](/docs/app/building-your-application/caching#data-cache)との相互作用方法を設定します。

```ts
fetch(`https://...`, { cache: 'force-cache' | 'no-store' })
```

- **`auto no cache`** （デフォルト）: Next.jsは開発環境で毎回リモートサーバーからリソースをフェッチしますが、`next build`の間に1回だけフェッチします。ルートが静的にプリレンダリングされるためです。ルートで[Dynamic APIs](/docs/app/building-your-application/rendering/server-components#dynamic-rendering)が検出される場合、Next.jsは毎回リソースをフェッチします
- **`no-store`**: Dynamic APIsがルートで検出されない場合でも、Next.jsは毎回リモートサーバーからリソースをフェッチします
- **`force-cache`**: Next.jsはデータキャッシュで一致するリクエストを探します
  - 一致があり、かつ新鮮であれば、キャッシュから返されます
  - 一致がないか、古い場合、Next.jsはリモートサーバーからリソースをフェッチし、ダウンロードしたリソースでキャッシュを更新します

### `options.next.revalidate` {#options-next-revalidate}

```ts
fetch(`https://...`, { next: { revalidate: false | 0 | number } })
```

リソースのキャッシュ有効期間を設定します（秒単位）。

- **`false`** - リソースを無期限にキャッシュします。セマンティクス的には`revalidate: Infinity`に等しいです。HTTPキャッシュは時間の経過とともに古いリソースを削除するかもしれません
- **`0`** - リソースをキャッシュしないようにします
- **`number`** - （秒単位）リソースは最大`n`秒間のキャッシュ有効期限を持つべきと指定します

> **知っておくと良いこと**:
>
> - 個別の`fetch()`リクエストがルートの[デフォルト`revalidate`](/docs/app/api-reference/file-conventions/route-segment-config#revalidate)より低い`revalidate`数を設定すると、ルート全体の再検証間隔が短縮されます
> - 同一ルートで同じURLを持つ二つのフェッチリクエストが異なる`revalidate`値を持つ場合、より低い値が使用されます
> - 便利なことに、`revalidate`が数値で設定されている場合、`cache`オプションを設定する必要はありません
> - `{ revalidate: 3600, cache: 'no-store' }`のような矛盾するオプションはエラーを引き起こします

### `options.next.tags` {#options-next-tags}

```ts
fetch(`https://...`, { next: { tags: ['collection'] } })
```

リソースのキャッシュタグを設定します。その後、[`revalidateTag`](https://nextjs.org/docs/app/api-reference/functions/revalidateTag)を使用してデータをオンデマンドで再検証できます。カスタムタグの最大長は256文字で、タグ項目の最大数は128です。

## 問題のトラブルシューティング {#troubleshooting}

### 開発環境で`auto no store`または`cache: 'no-store'`が新しいデータを表示しない {#fetch-default-auto-no-store-and-cache-no-store-not-showing-fresh-data-in-development}

Next.jsは、ローカル開発でのHot Module Replacement (HMR)を通じてServer Componentsでの`fetch`レスポンスをキャッシュし、レスポンスを高速化し、請求されたAPI呼び出しのコストを削減しています。

デフォルトでは、[HMRキャッシュ](/docs/app/api-reference/config/next-config-js/serverComponentsHmrCache)はデフォルトの`auto no cache`および`cache: 'no-store'`オプションを含むすべてのフェッチリクエストに適用されます。これにより、キャッシュされていないリクエストはHMRのリフレッシュ間で新しいデータを表示しません。ただし、ナビゲーションまたはページ全体のリロード時にキャッシュはクリアされます。

詳細は、[`serverComponentsHmrCache`](/docs/app/api-reference/config/next-config-js/serverComponentsHmrCache)ドキュメントを参照してください。

## バージョン履歴 {#version-history}

| Version   | 変更点                  |
| --------- | ----------------------- |
| `v13.0.0` | `fetch`が導入されました |
