---
title: '<Image>'
description: 'Next.jsアプリケーションで組み込みの`next/image`コンポーネントを使用して画像を最適化します。'
---

{/* このドキュメントの内容はapp routerとpages routerの間で共有されています。Pages Routerに特有のコンテンツを追加するには、`<PagesOnly>Content</PagesOnly>`コンポーネントを使用できます。共有内容にはコンポーネントをラップしないでください。 */}

<details>
  <summary>例</summary>

- [Image Component](https://github.com/vercel/next.js/tree/canary/examples/image-component)

</details>

<PagesOnly>

> **Good to know**: Next.jsのバージョン13より前を使用している場合、コンポーネント名が変更されているため[next/legacy/image](https://nextjs.org/docs/canary/pages/api-reference/components/image-legacy)のドキュメントを使用してください。

</PagesOnly>

このAPIリファレンスは、Imageコンポーネントで使用できる[props](#props)と[設定オプション](#configuration-options)の使用方法を理解するのに役立ちます。機能と使用方法については、[Image Component](/docs/app/building-your-application/optimizing/images)ページをご覧ください。

```jsx title="app/page.js"
import Image from 'next/image'

export default function Page() {
  return <Image src="/profile.png" width={500} height={500} alt="作者の写真" />
}
```

## Props {#props}

Imageコンポーネントで使用可能なpropsの概要です：

<div style={{ overflowX: 'auto', width: '100%' }}>
  | Prop | Example | Type | Status | | -----------------------------------------
  | ---------------------------------------- | --------------- | ---------- | |
  [`src`](#src) | `src="/profile.png"` | String | 必須 | | [`width`](#width) |
  `width={500}` | Integer (px) | 必須 | | [`height`](#height) | `height={500}` |
  Integer (px) | 必須 | | [`alt`](#alt) | `alt="作者の写真"` | String | 必須 | |
  [`loader`](#loader) | `loader={imageLoader}` | Function | - | |
  [`fill`](#fill) | `fill={true}` | Boolean | - | | [`sizes`](#sizes) |
  `sizes="(max-width: 768px) 100vw, 33vw"` | String | - | |
  [`quality`](#quality) | `quality={80}` | Integer (1-100) | - | |
  [`priority`](#priority) | `priority={true}` | Boolean | - | |
  [`placeholder`](#placeholder) | `placeholder="blur"` | String | - | |
  [`style`](#style) | `style={{ objectFit: 'contain' }}` | Object | - | |
  [`onLoadingComplete`](#onloadingcomplete) | `onLoadingComplete=
  {(img) => done()}` | Function | 廃止予定 | | [`onLoad`](#onload) | `onLoad=
  {(event) => done()}` | Function | - | | [`onError`](#onerror) | `onError=
  {(event) => fail()}` | Function | - | | [`loading`](#loading) |
  `loading="lazy"` | String | - | | [`blurDataURL`](#blurdataurl) |
  `blurDataURL="data:image/jpeg..."` | String | - | |
  [`overrideSrc`](#overridesrc) | `overrideSrc="/seo.png"` | String | - |
</div>

## 必須プロパティ {#required-props}

Imageコンポーネントには、`src`、`alt`、`width`、および`height`（または`fill`）という次のプロパティが必要です。

```jsx title="app/page.js"
import Image from 'next/image'

export default function Page() {
  return (
    <div>
      <Image src="/profile.png" width={500} height={500} alt="作者の写真" />
    </div>
  )
}
```

### `src` {#src}

次のいずれかである必要があります：

- [静的にインポートされた](/docs/app/building-your-application/optimizing/images#local-images)画像ファイル
- パス文字列。これは[loader](#loader)プロパティに依存して、絶対外部URLまたは内部パスのいずれかになることができます。

デフォルトの[loader](#loader)を使用する際は、次のことも考慮ください：

- `src`が外部URLの場合は、[remotePatterns](#remotepatterns)も設定する必要があります
- `src`が[アニメーション化されている](#animated-images)場合や知られている形式以外の場合（JPEG、PNG、WebP、AVIF、GIF、TIFF）、画像はそのままとして提供されます
- `src`がSVG形式の場合、[`unoptimized`](#unoptimized)または[`dangerouslyAllowSVG`](#dangerouslyallowsvg)が有効になっていない限り、ブロックされます

### `width` {#width}

`width`プロパティは、画像の*固有の*幅をピクセル単位で表します。このプロパティは、画像の正しいアスペクト比を推測し、読み込み中のレイアウトシフトを回避するために使用されます。HTMLの`<img>`タグ内の`width`属性に似て、CSSによって制御される画像のレンダリングサイズを決定しません。

[静的にインポートされた画像](/docs/app/building-your-application/optimizing/images#local-images)または[`fill`プロパティ](#fill)を使用する画像を除いて、必須です。

### `height` {#height}

`height`プロパティは、画像の*固有の*高さをピクセル単位で表します。このプロパティは、画像の正しいアスペクト比を推測し、読み込み中のレイアウトシフトを回避するために使用されます。HTMLの`<img>`タグ内の`height`属性に似て、CSSによって制御される画像のレンダリングサイズを決定しません。

[静的にインポートされた画像](/docs/app/building-your-application/optimizing/images#local-images)または[`fill`プロパティ](#fill)を使用する画像を除いて、必須です。

> **Good to know:**
>
> - `width`と`height`の両方のプロパティを組み合わせることで、ブラウザが読み込む前に画像のスペースを確保するために使用する画像のアスペクト比を決定します。
> - 固有サイズはブラウザでのレンダリングサイズとは必ずしも一致せず、親コンテナによって決定されます。たとえば、親コンテナが固有サイズよりも小さい場合、画像はコンテナに合わせて縮小されます。
> - `width`と`height`が不明な場合、[`fill`](#fill)プロパティを使用できます。

### `alt` {#alt}

`alt`プロパティは、スクリーンリーダーや検索エンジン向けに画像を説明するために使用されます。画像が無効化されている場合や読み込み中にエラーが発生した場合の代替テキストでもあります。

これは、[ページの意味を変えることなく](https://html.spec.whatwg.org/multipage/images.html#general-guidelines)画像を置き換えることのできるテキストを含むべきです。画像を補足することを意図したものではなく、画像の上や下に既に提供されている情報を繰り返すべきではありません。

画像が[純粋に装飾的](https://html.spec.whatwg.org/multipage/images.html#a-purely-decorative-image-that-doesn't-add-any-information)または[ユーザーを意図していない](https://html.spec.whatwg.org/multipage/images.html#an-image-not-intended-for-the-user)場合、`alt`プロパティは空文字列（`alt=""`）にする必要があります。

[Learn more](https://html.spec.whatwg.org/multipage/images.html#alt)

## 任意のプロパティ {#optional-props}

`<Image />`コンポーネントは、必須プロパティ以外にもいくつかの追加プロパティを受け入れます。このセクションでは、Imageコンポーネントで最もよく使用されるプロパティについて説明します。あまり使用されないプロパティの詳細は、[高度なプロパティ](#advanced-props)のセクションを参照してください。

### `loader` {#loader}

画像URLを解決するために使用されるカスタム関数です。

`loader`は、以下のパラメータを受け取って画像のURL文字列を返す関数です：

- [`src`](#src)
- [`width`](#width)
- [`quality`](#quality)

カスタムローダを使用する例を示します：

<AppOnly>

```js
'use client'

import Image from 'next/image'

const imageLoader = ({ src, width, quality }) => {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}

export default function Page() {
  return (
    <Image
      loader={imageLoader}
      src="me.png"
      alt="作者の写真"
      width={500}
      height={500}
    />
  )
}
```

> **Good to know**: `loader`のように関数を受け入れるpropsを使用するには、[Client Components](/docs/app/building-your-application/rendering/client-components)を使用して提供された関数をシリアライズする必要があります。

</AppOnly>

<PagesOnly>

```js
import Image from 'next/image'

const imageLoader = ({ src, width, quality }) => {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}

export default function Page() {
  return (
    <Image
      loader={imageLoader}
      src="me.png"
      alt="作者の写真"
      width={500}
      height={500}
    />
  )
}
```

</PagesOnly>

あるいは、`next.config.js`の[loaderFile](#loaderfile)設定を使用して、アプリケーション内の`next/image`のすべてのインスタンスを設定し、propを渡さずに使用できます。

### `fill` {#fill}

```js
fill={true} // {true} | {false}
```

親要素を埋める画像を引き起こすブール値です。[`width`](#width)と[`height`](#height)が未知の場合に使用されます。

親要素は、`position: "relative"`、`position: "fixed"`、または`position: "absolute"`スタイルを割り当てる必要があります。

デフォルトでは、img要素には`position: "absolute"`スタイルが自動的に割り当てられます。

画像にスタイルが適用されていない場合、画像はコンテナに合わせて引き伸ばされます。コンテナに合わせてレターボックス化し、アスペクト比を維持する画像には`object-fit: "contain"`を設定するのが望ましいかもしれません。

あるいは、`object-fit: "cover"`は画像がコンテナ全体を埋め、アスペクト比を維持するためにクロップを行います。

詳細は、次も参照してください：

- [`position`](https://developer.mozilla.org/docs/Web/CSS/position)
- [`object-fit`](https://developer.mozilla.org/docs/Web/CSS/object-fit)
- [`object-position`](https://developer.mozilla.org/docs/Web/CSS/object-position)

### `sizes` {#sizes}

メディアクエリに似た文字列で、異なるブレークポイントで画像の幅がどのようになるかを提供します。`sizes`の値は[`fill`](#fill)を使用する画像や[レスポンシブサイズを持つようにスタイルされた](#responsive-images)画像の場合にパフォーマンスに大きく影響します。

`sizes`プロパティは画像のパフォーマンスに関連する2つの重要な役割を果たします：

- まず、`sizes`の値はブラウザによって、`next/image`の自動生成された`srcset`からダウンロードする画像のサイズを決定するために使用されます。ブラウザが選択するとき、そのページ上の画像のサイズをまだ知らないため、ビューポートと同じサイズまたはそれ以上のサイズの画像を選択します。`sizes`プロパティを使用すると、実際には画像が全画面よりも小さくなることをブラウザに伝えることができます。`fill`プロパティを持つ画像で`sizes`値を指定しない場合、デフォルト値の`100vw`（全画面幅）が使用されます。
- 次に、`sizes`プロパティは、自動生成された`srcset`値の動作を変更します。`sizes`値がない場合は、（1x/2xなど）固定サイズの画像に適した小さな`srcset`が生成されます。`sizes`が定義されている場合、レスポンシブ画像に適した大きな`srcset`が生成されます。`sizes`プロパティが`50vw`などのビューポート幅のパーセンテージを表すサイズを含んでいる場合、`srcset`は必要以上に小さくなる可能性がある値を含まないようにトリミングされます。

たとえば、スタイリングが画像をモバイルデバイスでフル幅、タブレットで2カラムレイアウト、デスクトップディスプレイで3カラムレイアウトにすることを知っている場合、次のような`sizes`プロパティを含めるべきです：

```jsx
import Image from 'next/image'

export default function Page() {
  return (
    <div className="grid-element">
      <Image
        fill
        src="/example.png"
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      />
    </div>
  )
}
```

この例の`sizes`はパフォーマンスメトリクスに劇的な効果をもたらす可能性があります。`33vw`サイズがないと、サーバーから選択される画像は必要以上に3倍広くなるでしょう。ファイルサイズは幅の2乗に比例するため、ユーザーは必要以上に9倍大きな画像をダウンロードすることになります。

`srcset`と`sizes`についてもっと学ぶ：

- [web.dev](https://web.dev/learn/design/responsive-images/#sizes)
- [mdn](https://developer.mozilla.org/docs/Web/HTML/Element/img#sizes)

### `quality` {#quality}

```js
quality={75} // {number 1-100}
```

最適化された画像の品質で、`1`から`100`の間の整数です。`100`が最高品質で、したがって最大ファイルサイズです。デフォルトは`75`です。

### `priority` {#priority}

```js
priority={false} // {false} | {true}
```

trueにすると、画像は高優先とみなされ
[preload](https://web.dev/preload-responsive-images/)されます。`priority`を使用する画像では、遅延読み込みが自動的に無効になります。`priority`が必要な場合は[`loading`](#loading)プロパティを使用して`lazy`に設定することはできません。`loading`プロパティは高度なユースケースのみに向けられているため、優先度が必要な場合は削除してください。

`priority`プロパティは、[Largest Contentful Paint (LCP)](https://nextjs.org/learn/seo/web-performance/lcp)要素として検出された画像に使用する必要があります。異なるビューポートサイズに対して異なる画像がLCP要素になるため、複数の優先度画像を持つことが適切かもしれません。

スクロールしない位置に画像が表示されている場合にのみ使用するべきです。デフォルトは`false`です。

### `placeholder` {#placeholder}

```js
placeholder = 'empty' // "empty" | "blur" | "data:image/..."
```

画像が読み込まれるまで使用するプレースホルダー。`blur`、`empty`、または`data:image/...`が可能な値です。デフォルトは`empty`です。

`blur`時は、[`blurDataURL`](#blurdataurl)プロパティがプレースホルダーとして使用されます。静的インポートからの`src`が`.jpg`、`.png`、`.webp`、または`.avif`で、インポートされた画像が静止画である場合、`blurDataURL`は自動的に設定されますが、画像がアニメーションとして検出された場合は例外です。

動的画像の場合、[`blurDataURL`](#blurdataurl)プロパティを提供する必要があります。[Plaiceholder](https://github.com/joe-bell/plaiceholder)などのソリューションが`base64`の生成に役立ちます。

`data:image/...`の場合、[データURL](https://developer.mozilla.org/docs/Web/HTTP/Basics_of_HTTP/Data_URIs)が画像の読み込み中にプレースホルダーとして使用されます。

`empty`の場合、画像が読み込まれる間にプレースホルダーはありません。

試してみてください：

- [`blur`プレースホルダーのデモ](https://image-component.nextjs.gallery/placeholder)
- データURLのシマリング効果での`placeholder`プロップのデモ](https://image-component.nextjs.gallery/shimmer)
- [`blurDataURL`プロップを使用したカラー効果のデモ](https://image-component.nextjs.gallery/color)

## 高度なプロパティ {#advanced-props}

より高度な使用が必要な場合があります。`<Image />`コンポーネントは、次の高度なプロパティをオプションで受け入れます。

### `style` {#style}

基盤となる画像要素にCSSスタイルを渡すことができます。

```jsx title="components/ProfileImage.js"
const imageStyle = {
  borderRadius: '50%',
  border: '1px solid #fff',
}

export default function ProfileImage() {
  return <Image src="..." style={imageStyle} />
}
```

必須の幅と高さのプロパティがスタイリングに影響を与える可能性があることに注意してください。スタイリングを使用して画像の幅を変更する場合、固有のアスペクト比を維持するために高さも自動にスタイル設定する必要があります。そうでないと、画像が歪む可能性があります。

### `onLoadingComplete` {#onloadingcomplete}

<AppOnly>

```jsx
'use client'

<Image onLoadingComplete={(img) => console.log(img.naturalWidth)} />
```

</AppOnly>

<PagesOnly>

```jsx
<Image onLoadingComplete={(img) => console.log(img.naturalWidth)} />
```

</PagesOnly>

> **Warning**: Next.js 14以降、[`onLoad`](#onload)に代わり廃止されました。

画像が完全に読み込まれ、[プレースホルダー](#placeholder)が削除された後に呼び出されるコールバック関数です。

コールバック関数は1つの引数、基盤となる`<img>`要素への参照で呼び出されます。

<AppOnly>

> **Good to know**: `onLoadingComplete`のように関数を受け入れるpropsを使用するには、[Client Components](/docs/app/building-your-application/rendering/client-components)を使用して提供された関数をシリアライズする必要があります。

</AppOnly>

### `onLoad` {#onload}

```jsx
<Image onLoad={(e) => console.log(e.target.naturalWidth)} />
```

画像が完全に読み込まれ、[プレースホルダー](#placeholder)が削除された後に呼び出されるコールバック関数です。

コールバック関数は1つの引数、`target`として基盤となる`<img>`要素への参照を持つイベントとともに呼び出されます。

<AppOnly>

> **Good to know**: `onLoad`のように関数を受け入れるpropsを使用するには、[Client Components](/docs/app/building-your-application/rendering/client-components)を使用して提供された関数をシリアライズする必要があります。

</AppOnly>

### `onError` {#onerror}

```jsx
<Image onError={(e) => console.error(e.target.id)} />
```

画像の読み込みに失敗したときに呼び出されるコールバック関数です。

<AppOnly>

> **Good to know**: `onError`のように関数を受け入れるpropsを使用するには、[Client Components](/docs/app/building-your-application/rendering/client-components)を使用して提供された関数をシリアライズする必要があります。

</AppOnly>

### `loading` {#loading}

```js
loading = 'lazy' // {lazy} | {eager}
```

画像の読み込み動作です。デフォルトは`lazy`です。

`lazy`のときは、ビューポートから計算された距離に達するまで画像の読み込みを遅延させます。

`eager`のときは、画像をすぐに読み込みます。

[`loading`属性](https://developer.mozilla.org/docs/Web/HTML/Element/img#loading)について詳しく学びます。

### `blurDataURL` {#blurdataurl}

`src`画像が正常に読み込まれる前にプレースホルダー画像として使用される[データURL](https://developer.mozilla.org/docs/Web/HTTP/Basics_of_HTTP/Data_URIs)。[`placeholder="blur"`](#placeholder)と組み合わせるときにのみ効果を発揮します。

base64でエンコードされた画像である必要があります。拡大されてぼかされるため、非常に小さな画像（10px以下）を推奨します。プレースホルダーとして大きな画像を含めると、アプリケーションのパフォーマンスが低下するおそれがあります。

試してみてください：

- [デフォルトの`blurDataURL`プロップのデモ](https://image-component.nextjs.gallery/placeholder)
- [`blurDataURL`プロップを使用したカラー効果のデモ](https://image-component.nextjs.gallery/color)

画像と一致するソリッドカラーのデータURLを[生成する](https://png-pixel.com)こともできます。

### `unoptimized` {#unoptimized}

```js
unoptimized = {false} // {false} | {true}
```

`true`の場合、ソース画像は品質、サイズ、形式を変更せずに`src`からそのまま提供されます。デフォルトは`false`です。

小さな画像（1KB未満）やベクター画像（SVG）、またはアニメーション画像（GIF）など、最適化のメリットがない画像に対して便利です。

```js
import Image from 'next/image'

const UnoptimizedImage = (props) => {
  return <Image {...props} unoptimized />
}
```

Next.js 12.3.0以降、このプロップは以下の設定を使って`next.config.js`内のすべての画像に割り当てることができます：

```js title="next.config.js"
module.exports = {
  images: {
    unoptimized: true,
  },
}
```

### `overrideSrc` {#overridesrc}

`<Image>`コンポーネントに`src`プロップを提供すると、結果の`<img>`に対して`srcset`および`src`属性が自動的に生成されます。

```jsx title="input.js"
<Image src="/me.jpg" />
```

```html title="output.html"
<img
  srcset="
    /_next/image?url=%2Fme.jpg&w=640&q=75 1x,
    /_next/image?url=%2Fme.jpg&w=828&q=75 2x
  "
  src="/_next/image?url=%2Fme.jpg&w=828&q=75"
/>
```

特定の状況では、`src`属性が生成されることが望ましくない場合があります。その場合、SEO目的（例えば、画像ランクの維持や再巡回回避）で`src`属性を保持したい場合、`overrideSrc`プロップを使用してそれを上書きできます。

```jsx title="input.js"
<Image src="/me.jpg" overrideSrc="/override.jpg" />
```

```html title="output.html"
<img
  srcset="
    /_next/image?url=%2Fme.jpg&w=640&q=75 1x,
    /_next/image?url=%2Fme.jpg&w=828&q=75 2x
  "
  src="/override.jpg"
/>
```

### decoding {#decoding}

ブラウザに対するヒントで、画像がデコードされるのを待つべきか他のコンテンツ更新を提示するべきかを示します。デフォルトは`async`です。

可能な値は次のとおりです：

- `async` - 画像を非同期にデコードし、それが完了する前に他のコンテンツをレンダリングします。
- `sync` - 他のコンテンツとアトミックに提示するために画像を同期的にデコードします。
- `auto` - デコードモードに対して好みはなく、ブラウザが最適と思うものを選択します。

[`decoding`属性](https://developer.mozilla.org/docs/Web/HTML/Element/img#decoding)について詳しく学びます。

### その他のプロパティ {#other-props}

`<Image />`コンポーネント上の他のプロパティは、以下を除いて基盤となる`img`要素に引き渡されます：

- `srcSet`。代わりに[デバイスサイズ](#devicesizes)を使用してください。

## 設定オプション {#configuration-options}

propsに加えて、`next.config.js`でImageコンポーネントを設定することができます。利用可能なオプションは次の通りです：

## `localPatterns` {#localpatterns}

`specificPaths`で特定のパスを最適化するように設定し、他のすべてのパスをブロックするために、`next.config.js`ファイルで`localPatterns`をオプションで設定することができます。

```js title="next.config.js"
module.exports = {
  images: {
    localPatterns: [
      {
        pathname: '/assets/images/**',
        search: '',
      },
    ],
  },
}
```

> **Good to know**: 上記の例では、`next/image`の`src`プロパティが`/assets/images/`で始まらなければならず、クエリストリングがないことを保証します。他のパスを最適化しようとすると、400 Bad Requestが返されます。

### `remotePatterns` {#remotepatterns}

悪意のあるユーザーからアプリケーションを保護するために、外部画像を使用するには設定が必要です。これにより、アカウントからの外部画像のみがNext.js画像最適化APIから配信されることが保証されます。これらの外部画像は、以下に示すように、`next.config.js`ファイルの`remotePatterns`プロパティで設定できます：

```js title="next.config.js"
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'example.com',
        port: '',
        pathname: '/account123/**',
        search: '',
      },
    ],
  },
}
```

> **Good to know**: 上記の例では、`next/image`の`src`プロパティが`https://example.com/account123/`で始まらなければならず、クエリストリングがないことを保証します。他のプロトコル、ホスト名、ポート、または一致しないパスは400 Bad Requestが返されます。

以下は、`hostname`内でワイルドカードパターンを使用した`next.config.js`ファイルの`remotePatterns`プロパティの例です：

```js title="next.config.js"
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**.example.com',
        port: '',
        search: '',
      },
    ],
  },
}
```

> **Good to know**: 上記の例では、`next/image`の`src`プロパティが`https://img1.example.com`または`https://me.avatar.example.com`または任意のサブドメインで始まらなければなりません。ポートやクエリストリングがあってはなりません。他のプロトコルまたは一致しないホスト名は400 Bad Requestが返されます。

ワイルドカードパターンは`pathname`および`hostname`の両方について使用でき、次の構文を持ちます：

- `*`は単一のパスセグメントまたはサブドメインに一致します
- `**`はセグメントの任意の数に一致します（終了部または開始部）

`**`構文はパターンの中間部では機能しません。

> **Good to know**: `protocol`、`port`、`pathname`、`search`を省略した場合、ワイルドカード`**`が暗黙的に使用されます。意図しないURLを攻撃者が最適化する可能性があるため、お勧めしません。

以下は、`search`を使用した`next.config.js`ファイルの`remotePatterns`プロパティの例です：

```js title="next.config.js"
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'assets.example.com',
        search: '?v=1727111025337',
      },
    ],
  },
}
```

> **Good to know**: 上記の例では、`next/image`の`src`プロパティが`https://assets.example.com`で始まり、正確なクエリストリング`?v=1727111025337`を持たなければならないことを保証します。他のプロトコルまたはクエリストリングは400 Bad Requestが返されます。

### `domains` {#domains}

> **警告**: 悪意のあるユーザーからアプリケーションを保護するために、Next.js 14以降、厳密な[`remotePatterns`](#remotepatterns)推奨により廃止されました。`domains`は自分が所有するすべてのコンテンツが提供される場合のみ使用してください。

[`remotePatterns`](#remotepatterns)に類似しており、外部画像用の許可されたホスト名のリストを提供するのに`domains`設定を使用できます。

ただし、`domains`設定はワイルドカードパターンマッチングをサポートしておらず、プロトコル、ポート、またはパスを制限できません。

以下は、`next.config.js`ファイル内の`domains`プロパティの例です：

```js title="next.config.js"
module.exports = {
  images: {
    domains: ['assets.acme.com'],
  },
}
```

### `loaderFile` {#loaderfile}

Next.js組み込みの画像最適化APIの代わりにクラウドプロバイダーを使用して画像を最適化する場合、以下のように`next.config.js`で`loaderFile`を設定することができます：

```js title="next.config.js"
module.exports = {
  images: {
    loader: 'custom',
    loaderFile: './my/image/loader.js',
  },
}
```

これは、Next.jsアプリケーションのルートに対して相対的なファイルを指さなければなりません。このファイルは文字列を返すデフォルトの関数をエクスポートしなければなりません。たとえば：

<AppOnly>

```js title="my/image/loader.js"
'use client'

export default function myImageLoader({ src, width, quality }) {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}
```

</AppOnly>

<PagesOnly>

```js title="my/image/loader.js"
export default function myImageLoader({ src, width, quality }) {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}
```

</PagesOnly>

あるいは、[`loader`プロップ](#loader)を使用して各インスタンス`next/image`を設定できます。

例:

- [カスタム画像ローダ設定](/docs/app/api-reference/config/next-config-js/images#example-loader-configuration)

<AppOnly>

> **Good to know**: カスタム画像ローダファイルをカスタマイズする際には、[Client Components](/docs/app/building-your-application/rendering/client-components)を使用して提供された関数をシリアライズする必要があります。

</AppOnly>

## 高度な設定 {#advanced}

以下の設定は高度なユースケース向けで、通常は必要ありません。以下のプロパティを設定することにより、将来の更新でNext.jsのデフォルトに対する変更をオーバーライドします。

### `deviceSizes` {#devicesizes}

ユーザーの想定されるデバイス幅を知っている場合、`next.config.js`に`deviceSizes`プロパティを使用してデバイス幅のブレークポイントリストを指定できます。これらの幅は、`next/image`コンポーネントが[`sizes`](#sizes)プロップを使用する際に、ユーザーのデバイスに対して適切な画像が提供されることを保証するために使用されます。

設定が提供されていない場合、以下のデフォルトが使用されます。

```js title="next.config.js"
module.exports = {
  images: {
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  },
}
```

### `imageSizes` {#imagesizes}

`next.config.js`ファイルで`images.imageSizes`プロパティを使用して画像の幅リストを指定できます。これらの幅は、[デバイスサイズ](#devicesizes)の配列との結合により、画像の[srcset](https://developer.mozilla.org/docs/Web/API/HTMLImageElement/srcset)を生成するのに使用されるサイズの完全な配列を形成します。

2つの別々のリストがある理由は、imageSizesは[`sizes`](#sizes)プロパティを提供する画像にのみ使用され、画像が画面の全幅未満であることを示します。**したがって、imageSizesのサイズはすべてdeviceSizesの最小サイズよりも小さくなければなりません。**

設定が提供されていない場合、以下のデフォルトが使用されます。

```js title="next.config.js"
module.exports = {
  images: {
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
}
```

### `formats` {#formats}

デフォルトの[画像最適化API](#loader)は、リクエストの`Accept`ヘッダーを介してブラウザがサポートする画像形式を自動的に検出し、最適な出力形式を決定します。

`Accept`ヘッダーが構成された形式の複数に一致する場合、配列内の最初の一致が使用されます。したがって、配列の順序は重要です。一致がない場合（またはソース画像が[アニメーション化されている場合](#animated-images)）、画像最適化APIは元の画像形式にフォールバックします。

設定が提供されていない場合、以下のデフォルトが使用されます。

```js title="next.config.js"
module.exports = {
  images: {
    formats: ['image/webp'],
  },
}
```

AVIFサポートを有効にして、WebPにフォールバックするには、次の設定を使用します。

```js title="next.config.js"
module.exports = {
  images: {
    formats: ['image/avif', 'image/webp'],
  },
}
```

> **Good to know**:
>
> - AVIFは通常、エンコードに50％長くかかりますが、WebPに比べて20％小さく圧縮されます。つまり、画像が初めてリクエストされるときは通常遅く、その後のキャッシュされたリクエストは高速になります。
> - Next.jsの前にプロキシ/CDNを使用してセルフホストしている場合、プロキシを構成して`Accept`ヘッダーを転送する必要があります。

## キャッシング動作 {#caching-behavior}

次に、デフォルトの[loader](#loader)のキャッシングアルゴリズムを説明します。その他のローダについては、クラウドプロバイダーのドキュメントを参照してください。

画像はリクエスト時に動的に最適化され、`<distDir>/cache/images`ディレクトリに保存されます。最適化された画像ファイルは、有効期限が到達するまでの後続のリクエストに対して提供されます。キャッシュされたが有効期限が切れたファイルに一致するリクエストがあると、期限切れの画像はすぐに無効で提供されます。その後、画像はバックグラウンドで再最適化（再検証とも呼ばれる）され、新しい有効期限日でキャッシュに保存されます。

画像のキャッシュステータスは、`x-nextjs-cache`レスポンスヘッダーの値を読み取って判断できます。可能な値は次のとおりです：

- `MISS` - パスがキャッシュにありません（最大1回発生し、最初の訪問時）
- `STALE` - パスがキャッシュにありますが、更新時間を超過しているため、バックグラウンドで更新されます
- `HIT` - パスがキャッシュにあり、更新時間を超過していません

有効期限（またはマックスエイジ）は、[`minimumCacheTTL`](#minimumcachettl)設定または上流画像`Cache-Control`ヘッダーのいずれか大きい方によって定義されます。具体的には、`Cache-Control`ヘッダーの`max-age`値が使用されます。`s-maxage`と`max-age`の両方が見つかった場合、`s-maxage`が優先されます。`max-age`は、CDNやブラウザなどの下位クライアントに透過されます。

- 上流画像が`Cache-Control`ヘッダーを含んでいなかったり、その値が非常に低い場合、[`minimumCacheTTL`](#minimumcachettl)を設定してキャッシュ期間を延ばすことができます。
- [`deviceSizes`](#devicesizes)と[`imageSizes`](#imagesizes)を設定して、生成される画像の可能性のある総数を減らすことができます。
- [formats](#formats)を構成して複数の形式を無効にし、単一の画像形式を優先することができます。

### `minimumCacheTTL` {#minimumcachettl}

キャッシュされた最適化画像の生存時間（TTL）を秒単位で構成することができます。多くの場合は、[静的画像インポート](/docs/app/building-your-application/optimizing/images#local-images)を使用する方が良く、自動的にファイルの内容をハッシュで永久にキャッシュし、`Cache-Control`ヘッダーが`immutable`になります。

```js title="next.config.js"
module.exports = {
  images: {
    minimumCacheTTL: 60,
  },
}
```

最適化画像の有効期限（またはマックスエイジ）は、`minimumCacheTTL`または上流画像`Cache-Control`ヘッダーのいずれか大きい方によって定義されます。

画像ごとにキャッシュの動作を変更する必要がある場合、[`headers`](/docs/app/api-reference/config/next-config-js/headers)を構成して、上流画像（例えば`/some-asset.jpg`、`/_next/image`自身ではない）の`Cache-Control`ヘッダーを設定できます。

現時点ではキャッシュを無効化するためのメカニズムはありませんので、`minimumCacheTTL`を低く保つのが最善ですが、必要に応じて`src`プロップを手動で変更するか、`<distDir>/cache/images`を削除する必要があるかもしれません。

### `disableStaticImages` {#disablestaticimages}

デフォルトの動作では`import icon from './icon.png'`のような静的ファイルをインポートし、それを`src`プロパティに渡すことができます。

場合によっては、この機能が他のプラグインと競合する場合、この機能を無効にしたいことがあります。

`next.config.js`内で静的画像インポートを無効にすることができます：

```js title="next.config.js"
module.exports = {
  images: {
    disableStaticImages: true,
  },
}
```

### `dangerouslyAllowSVG` {#dangerouslyallowsvg}

デフォルトの[loader](#loader)は、いくつかの理由でSVG画像を最適化しません。まず、SVGはベクター形式であり、ロスレスでサイズ変更できるからです。第二に、SVGはHTML/CSSと同じ機能が多く、適切な[コンテンツセキュリティポリシー（CSP）ヘッダー](/docs/app/api-reference/config/next-config-js/headers#content-security-policy)がないと脆弱性を引き起こす可能性があります。

したがって、[`src`](#src)プロップがSVGであると知っている場合、[`unoptimized`](#unoptimized)プロップを使用することをお勧めします。`src`が`".svg"`で終わる場合、これは自動的に発生します。

しかし、デフォルトの画像最適化APIでSVG画像を配信する必要がある場合、`next.config.js`内で`dangerouslyAllowSVG`を設定できます：

```js title="next.config.js"
module.exports = {
  images: {
    dangerouslyAllowSVG: true,
    contentDispositionType: 'attachment',
    contentSecurityPolicy: "default-src 'self'; script-src 'none'; sandbox;",
  },
}
```

さらに、`contentDispositionType`を設定してブラウザに画像をダウンロードさせ、画像内のスクリプトの実行を防ぐために`contentSecurityPolicy`を設定することを強くお勧めします。

### `contentDispositionType` {#contentdispositiontype}

デフォルトの[loader](#loader)は、任意のリモート画像がAPIを通じて提供される可能性があるため、追加の保護として[`Content-Disposition`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition#as_a_response_header_for_the_main_body)ヘッダーを`attachment`に設定します。

デフォルト値は`attachment`であり、ブラウザが直接訪問したときに画像をダウンロードさせます。特に[`dangerouslyAllowSVG`](#dangerouslyallowsvg)がtrueの場合に重要です。

オプションで、画像の直接訪問時にダウンロードせずにレンダリングできるように`inline`を設定できます。

```js title="next.config.js"
module.exports = {
  images: {
    contentDispositionType: 'inline',
  },
}
```

## アニメーション画像 {#animated-images}

デフォルトの[loader](#loader)は、アニメーション画像を最適化せず、そのまま提供します。

アニメーションファイルの自動検出はベストエフォートであり、GIF、APNG、およびWebPをサポートしています。特定のアニメーション画像を画像最適化対象から明示的に外したい場合は、[non-optimized](#unoptimized)プロップを使用してください。

## レスポンシブ画像 {#responsive-images}

デフォルトで生成される`srcset`には、異なるデバイスピクセル比をサポートするために、`1x`および`2x`の画像が含まれています。ただし、ビューポートとともに伸縮するレスポンシブ画像をレンダリングしたい場合もあります。その場合、[`sizes`](#sizes)だけでなく、`style`（または`className`）も設定する必要があります。

以下の方法のいずれかを使用してレスポンシブ画像をレンダリングすることができます。

### 静的インポートを使用したレスポンシブ画像 {#responsive-image-using-a-static-import}

ソース画像が動的でない場合、静的にインポートしてレスポンシブ画像を作成できます：

```jsx title="components/author.js"
import Image from 'next/image'
import me from '../photos/me.jpg'

export default function Author() {
  return (
    <Image
      src={me}
      alt="作者の写真"
      sizes="100vw"
      style={{
        width: '100%',
        height: 'auto',
      }}
    />
  )
}
```

試してみてください：

- [ビューポートにレスポンシブな画像のデモ](https://image-component.nextjs.gallery/responsive)

### アスペクト比を使ったレスポンシブ画像 {#responsive-image-with-aspect-ratio}

ソース画像が動的またはリモートURLである場合、レスポンシブ画像の正しいアスペクト比を設定するために`width`と`height`を提供する必要があります：

```jsx title="components/page.js"
import Image from 'next/image'

export default function Page({ photoUrl }) {
  return (
    <Image
      src={photoUrl}
      alt="作者の写真"
      sizes="100vw"
      style={{
        width: '100%',
        height: 'auto',
      }}
      width={500}
      height={300}
    />
  )
}
```

試してみてください：

- [ビューポートにレスポンシブな画像のデモ](https://image-component.nextjs.gallery/responsive)

### `fill`を使ったレスポンシブ画像 {#responsive-image-with-fill}

アスペクト比がわからない場合は、[`fill`](#fill)プロップを設定し、親に`position: relative`を設定する必要があります。必要に応じて、ストレッチ対クロップの動作に応じて`object-fit`スタイルを設定できます：

```jsx title="app/page.js"
import Image from 'next/image'

export default function Page({ photoUrl }) {
  return (
    <div style={{ position: 'relative', width: '300px', height: '500px' }}>
      <Image
        src={photoUrl}
        alt="作者の写真"
        sizes="300px"
        fill
        style={{
          objectFit: 'contain',
        }}
      />
    </div>
  )
}
```

試してみてください：

- [`fill`プロップのデモ](https://image-component.nextjs.gallery/fill)

## テーマ検出CSS {#theme-detection-css}

ライトモードとダークモードで異なる画像を表示したい場合は、CSSメディアクエリに基づいて正しい画像を表示する2つの`<Image>`コンポーネントをラップする新しいコンポーネントを作成できます。

```css title="components/theme-image.module.css"
.imgDark {
  display: none;
}

@media (prefers-color-scheme: dark) {
  .imgLight {
    display: none;
  }
  .imgDark {
    display: unset;
  }
}
```

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="components/theme-image.tsx" switcher
import styles from './theme-image.module.css'
import Image, { ImageProps } from 'next/image'

type Props = Omit<ImageProps, 'src' | 'priority' | 'loading'> & {
  srcLight: string
  srcDark: string
}

const ThemeImage = (props: Props) => {
  const { srcLight, srcDark, ...rest } = props

  return (
    <>
      <Image {...rest} src={srcLight} className={styles.imgLight} />
      <Image {...rest} src={srcDark} className={styles.imgDark} />
    </>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="components/theme-image.js" switcher
import styles from './theme-image.module.css'
import Image from 'next/image'

const ThemeImage = (props) => {
  const { srcLight, srcDark, ...rest } = props

  return (
    <>
      <Image {...rest} src={srcLight} className={styles.imgLight} />
      <Image {...rest} src={srcDark} className={styles.imgDark} />
    </>
  )
}
```

</TabItem>
</Tabs>

> **Good to know**: デフォルトの`loading="lazy"`動作により、適切な画像のみがロードされることが保証されます。`priority`や`loading="eager"`は、両方の画像をロードしてしまうため使用できません。代わりに、[`fetchPriority="high"`](https://developer.mozilla.org/docs/Web/API/HTMLImageElement/fetchPriority)を使用できます。

試してみてください：

- [ライト/ダークモードのテーマ検出のデモ](https://image-component.nextjs.gallery/theme)

## getImageProps {#getimageprops}

より高度なユースケースでは、`getImageProps()`を呼び出して基礎となる`<img>`要素に渡されるプロップを取得し、別のコンポーネント、スタイル、キャンバスなどに渡すことができます。

これによりReactの`useState()`の呼び出しを回避できるため、パフォーマンスが向上する可能性がありますが、[`placeholder`](#placeholder)プロップは使用できません。プレースホルダーが削除されることはありません。

### テーマ検出のためのPicture {#theme-detection-picture}

ライトモードとダークモードで異なる画像を表示したい場合、ユーザーの[好みの色調](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme)に基づいて異なる画像を表示するために[`<picture>`](https://developer.mozilla.org/docs/Web/HTML/Element/picture)要素を使用できます。

```jsx title="app/page.js"
import { getImageProps } from 'next/image'

export default function Page() {
  const common = { alt: 'テーマの例', width: 800, height: 400 }
  const {
    props: { srcSet: dark },
  } = getImageProps({ ...common, src: '/dark.png' })
  const {
    props: { srcSet: light, ...rest },
  } = getImageProps({ ...common, src: '/light.png' })

  return (
    <picture>
      <source media="(prefers-color-scheme: dark)" srcSet={dark} />
      <source media="(prefers-color-scheme: light)" srcSet={light} />
      <img {...rest} />
    </picture>
  )
}
```

### Art Direction {#art-direction}

モバイルとデスクトップで異なる画像を表示したい場合、[アートディレクション](https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images#art_direction)とも呼ばれる、この場合は、異なる`src`、`width`、`height`、および`quality`プロップを`getImageProps()`に提供します。

```jsx title="app/page.js"
import { getImageProps } from 'next/image'

export default function Home() {
  const common = { alt: 'アートディレクションの例', sizes: '100vw' }
  const {
    props: { srcSet: desktop },
  } = getImageProps({
    ...common,
    width: 1440,
    height: 875,
    quality: 80,
    src: '/desktop.jpg',
  })
  const {
    props: { srcSet: mobile, ...rest },
  } = getImageProps({
    ...common,
    width: 750,
    height: 1334,
    quality: 70,
    src: '/mobile.jpg',
  })

  return (
    <picture>
      <source media="(min-width: 1000px)" srcSet={desktop} />
      <source media="(min-width: 500px)" srcSet={mobile} />
      <img {...rest} style={{ width: '100%', height: 'auto' }} />
    </picture>
  )
}
```

### バックグラウンドCSS {#background-css}

`srcSet`文字列を最適化された背景画像に変換して[`image-set()`](https://developer.mozilla.org/en-US/docs/Web/CSS/image/image-set)CSS関数を使用することさえできます。

```jsx title="app/page.js"
import { getImageProps } from 'next/image'

function getBackgroundImage(srcSet = '') {
  const imageSet = srcSet
    .split(', ')
    .map((str) => {
      const [url, dpi] = str.split(' ')
      return `url("${url}") ${dpi}`
    })
    .join(', ')
  return `image-set(${imageSet})`
}

export default function Home() {
  const {
    props: { srcSet },
  } = getImageProps({ alt: '', width: 128, height: 128, src: '/img.png' })
  const backgroundImage = getBackgroundImage(srcSet)
  const style = { height: '100vh', width: '100vw', backgroundImage }

  return (
    <main style={style}>
      <h1>Hello World</h1>
    </main>
  )
}
```

## 既知のブラウザバグ {#known-browser-bugs}

この`next/image`コンポーネントは、ブラウザネイティブの[遅延読み込み](https://caniuse.com/loading-lazy-attr)を使用しており、Safari 15.4より前の古いブラウザでは欲求が持ちません。[ぼかしアッププレースホルダー](#blur)を使用すると、Safari 12より前の古いブラウザでは空のプレースホルダーが代わりに表示されます。[幅`/`高さ`スタイルでレイアウトシフトを引き起こす可能性があります](https://web.dev/cls/)古いブラウザ（Safari 15以前）は[アスペクト比を保存](https://caniuse.com/mdn-html_elements_img_aspect_ratio_computed_from_attributes)せず、このMDNビデオを参照してください。([このYouTubeビデオ](https://www.youtube.com/watch?v=4-d_SoCHeWE)をご覧ください。)

- [Safari 15 - 16.3](https://bugs.webkit.org/show_bug.cgi?id=243601)がロード中に灰色のボーダーを表示します。Safari 16.4でこの問題が修正されます。[詳細はこちら](https://webkit.org/blog/13966/webkit-features-in-safari-16-4/#:~:text=Now%20in%20Safari%2016.4%2C%20a%20gray%20line%20no%20longer%20appears%20to%20mark%20the%20space%20where%20a%20lazy%2Dloaded%20image%20will%20appear%20once%20it%E2%80%99s%20been%20loaded.)。可能な解決策：
  - CSS `@supports (font: -apple-system-body) and (-webkit-appearance: none) { img[loading="lazy"] { clip-path: inset(0.6px) } }`を使用します。
  - 画像がスクロールしない位置にある場合は[`priority`](#priority)を使用します。
- [Firefox 67+](https://bugzilla.mozilla.org/show_bug.cgi?id=1556156)がロード中に白い背景を表示します。可能な解決策：
  - AVIF[`formats`](#formats)を有効にします。
  - [`placeholder`](#placeholder)を使用します。

## バージョン履歴 {#version-history}

| Version    | 変更                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `v15.0.0`  | `decoding`プロップが追加されました。`contentDispositionType`の設定デフォルトが`attachment`に変更されました。                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `v14.2.0`  | `overrideSrc`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `v14.1.0`  | `getImageProps()`が安定しました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `v14.0.0`  | `onLoadingComplete`プロップと`domains`設定が廃止されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `v13.4.14` | `placeholder`プロップの`data:/image...`がサポートされました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `v13.2.0`  | `contentDispositionType`設定が追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `v13.0.6`  | `ref`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `v13.0.0`  | `next/image`インポート名が`next/legacy/image`に変更されました。`next/future/image`インポート名が`next/image`に変更されました。[安全かつ自動的にインポート名を変更するためのcodemodが利用可能です](/docs/app/building-your-application/upgrading/codemods#next-image-to-legacy-image)。`<span>`ラッパーが削除されました。`layout`、`objectFit`、`objectPosition`、`lazyBoundary`、`lazyRoot`のプロップが削除されました。`alt`が必須になりました。`img`要素への参照を受け取る`onLoadingComplete`。組み込みローダ設定が削除されました。 |
| `v12.3.0`  | `remotePatterns`と`unoptimized`設定が安定しました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `v12.2.0`  | 実験的`remotePatterns`と実験的`unoptimized`設定が追加されました。`layout="raw"`が削除されました。                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `v12.1.1`  | `style`プロップが追加されました。`layout="raw"`の実験的サポートが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `v12.1.0`  | `dangerouslyAllowSVG`と`contentSecurityPolicy`設定が追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `v12.0.9`  | `lazyRoot`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `v12.0.0`  | `formats`設定が追加されました。<br/>AVIFサポートが追加されました。<br/>ラッパー`<div>`が`<span>`に変更されました。                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `v11.1.0`  | `onLoadingComplete`と`lazyBoundary`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `v11.0.0`  | スタティックインポート用の`src`プロップサポート。<br/>`placeholder`プロップが追加されました。<br/>`blurDataURL`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                            |
| `v10.0.5`  | `loader`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `v10.0.1`  | `layout`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `v10.0.0`  | `next/image`が導入されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
