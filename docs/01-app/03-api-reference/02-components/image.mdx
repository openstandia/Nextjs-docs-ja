---
title: '<Image>'
description: 'Next.jsのアプリケーションにおいて組み込みの`next/image`コンポーネントを使用して画像を最適化する方法。'
---

{/* このドキュメントの内容はapp routerとpages routerで共有されています。Pages Router専用の内容を追加するには、`<PagesOnly>Content</PagesOnly>`コンポーネントを使用してください。共有される内容はコンポーネントでラップしないでください。 */}

<details>
  <summary>例</summary>

- [Image Component](https://github.com/vercel/next.js/tree/canary/examples/image-component)

</details>

<PagesOnly>

> **補足情報**: Next.jsのバージョン13より前のバージョンを使用している場合、コンポーネントの名前が変更されたため、[next/legacy/image](https://nextjs.org/docs/canary/pages/api-reference/components/image-legacy)のドキュメントを参照してください。

</PagesOnly>

このAPIリファレンスは、Imageコンポーネントに利用可能な[props](#props)と[設定オプション](#configuration-options)の使い方を理解するのに役立ちます。機能と使用方法については、[Image Component](/docs/app/building-your-application/optimizing/images)のページをご覧ください。

```jsx title="app/page.js"
import Image from 'next/image'

export default function Page() {
  return (
    <Image
      src="/profile.png"
      width={500}
      height={500}
      alt="Picture of the author"
    />
  )
}
```

## Props {#props}

Imageコンポーネントで利用可能なpropsの概要は以下のとおりです：

<div style={{ overflowX: 'auto', width: '100%' }}>
| Prop                                      | Example                                  | Type            | Status     |
| ----------------------------------------- | ---------------------------------------- | --------------- | ---------- |
| [`src`](#src)                             | `src="/profile.png"`                     | String          | Required   |
| [`width`](#width)                         | `width={500}`                            | Integer (px)    | Required   |
| [`height`](#height)                       | `height={500}`                           | Integer (px)    | Required   |
| [`alt`](#alt)                             | `alt="Picture of the author"`            | String          | Required   |
| [`loader`](#loader)                       | `loader={imageLoader}`                   | Function        | -          |
| [`fill`](#fill)                           | `fill={true}`                            | Boolean         | -          |
| [`sizes`](#sizes)                         | `sizes="(max-width: 768px) 100vw, 33vw"` | String          | -          |
| [`quality`](#quality)                     | `quality={80}`                           | Integer (1-100) | -          |
| [`priority`](#priority)                   | `priority={true}`                        | Boolean         | -          |
| [`placeholder`](#placeholder)             | `placeholder="blur"`                     | String          | -          |
| [`style`](#style)                         | `style={{objectFit: "contain"}}`         | Object          | -          |
| [`onLoadingComplete`](#onloadingcomplete) | `onLoadingComplete={img => done())}`     | Function        | deprecated |
| [`onLoad`](#onload)                       | `onLoad={event => done())}`              | Function        | -          |
| [`onError`](#onerror)                     | `onError(event => fail()}`               | Function        | -          |
| [`loading`](#loading)                     | `loading="lazy"`                         | String          | -          |
| [`blurDataURL`](#blurdataurl)             | `blurDataURL="data:image/jpeg..."`       | String          | -          |
| [`overrideSrc`](#overridesrc)             | `overrideSrc="/seo.png"`                 | String          | -          |
</div>

## 必須のProps {#required-props}

Imageコンポーネントには、以下のプロパティが必要です：`src`、`alt`、`width`および`height`（または`fill`）。

```jsx title="app/page.js"
import Image from 'next/image'

export default function Page() {
  return (
    <div>
      <Image
        src="/profile.png"
        width={500}
        height={500}
        alt="Picture of the author"
      />
    </div>
  )
}
```

### `src` {#src}

次のいずれかである必要があります：

- [静的にインポートされた](/docs/app/building-your-application/optimizing/images#local-images)画像ファイル
- パス文字列。これは、絶対外部URLまたは[loader](#loader)プロップによる内部パスのいずれかにすることができます。

デフォルトの[loader](#loader)を使用する場合、ソース画像について次の点を考慮してください：

- srcが外部URLの場合、[remotePatterns](#remotepatterns)も設定する必要があります
- srcが[アニメーション](#animated-images)されているか、知られている形式でない場合（JPEG、PNG、WebP、AVIF、GIF、TIFF）、画像はそのまま提供されます
- srcがSVG形式の場合、[`unoptimized`](#unoptimized)または[`dangerouslyAllowSVG`](#dangerouslyallowsvg)が有効になっていない限りブロックされます

### `width` {#width}

`width`プロパティは、ピクセル単位の*内部*画像の幅を表します。このプロパティは、画像の正しいアスペクト比を推測し、読み込み中のレイアウトシフトを防ぐために使用されます。これは、レンダリングされた画像のサイズを決定するものではなく、HTMLの`<img>`タグの`width`属性と同様にCSSによって制御されます。

[静的にインポートされた画像](/docs/app/building-your-application/optimizing/images#local-images)または[`fill`プロパティ](#fill)を持つ画像を除き、必須です。

### `height` {#height}

`height`プロパティは、ピクセル単位の*内部*画像の高さを表します。このプロパティは、画像の正しいアスペクト比を推測し、読み込み中のレイアウトシフトを防ぐために使用されます。これは、レンダリングされた画像のサイズを決定するものではなく、HTMLの`<img>`タグの`height`属性と同様にCSSによって制御されます。

[静的にインポートされた画像](/docs/app/building-your-application/optimizing/images#local-images)または[`fill`プロパティ](#fill)を持つ画像を除き、必須です。

> **補足情報**:
>
> - `width`と`height`プロパティは組み合わされて、ブラウザが画像のスペースを読み込む前に確保するために使用する画像のアスペクト比を決定します。
> - 内部サイズは、必ずしもブラウザでのレンダリングサイズを意味するわけではありません。レンダリングサイズは親コンテナによって決定されます。たとえば、親コンテナが内部サイズより小さい場合、画像はコンテナに合わせて縮小されます。
> - 幅と高さが不明な場合、[`fill`](#fill)プロパティを使用できます。

### `alt` {#alt}

`alt`プロパティは、スクリーンリーダーや検索エンジンで画像を説明するために使用されます。また、画像が無効になっているか、読み込み中にエラーが発生した場合のフォールバックテキストでもあります。

それは[ページの意味を変えずに](https://html.spec.whatwg.org/multipage/images.html#general-guidelines)画像を置き換えられるテキストを含むべきです。画像を補足するためのものではなく、画像の上または下に既に提供されている情報を繰り返してはなりません。

画像が[装飾のみの目的](https://html.spec.whatwg.org/multipage/images.html#a-purely-decorative-image-that-doesn't-add-any-information)であるか、[ユーザーに意図されていない](https://html.spec.whatwg.org/multipage/images.html#an-image-not-intended-for-the-user)場合、`alt`プロパティは空の文字列（`alt=""`）にする必要があります。

[詳細はこちら](https://html.spec.whatwg.org/multipage/images.html#alt)

## オプションのProps {#optional-props}

`<Image />` コンポーネントは、必須のもの以外にも追加のプロパティを受け付けます。このセクションでは、Imageコンポーネントで最も一般的に使用されるプロパティについて説明します。より稀に使用されるプロパティの詳細は、[高度なプロパティ](#advanced-props)セクションをご覧ください。

### `loader` {#loader}

画像URLを解決するために使用されるカスタム関数。

`loader`は、次のパラメータに基づいて画像のURL文字列を返す関数です：

- [`src`](#src)
- [`width`](#width)
- [`quality`](#quality)

以下は、カスタムローダーを使用する例です：

<AppOnly>

```js
'use client'

import Image from 'next/image'

const imageLoader = ({ src, width, quality }) => {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}

export default function Page() {
  return (
    <Image
      loader={imageLoader}
      src="me.png"
      alt="Picture of the author"
      width={500}
      height={500}
    />
  )
}
```

> **補足情報**: 関数を受け入れる`loader`などのプロップを使用する場合、提供された関数をシリアライズするために[Client Components](/docs/app/building-your-application/rendering/client-components)を使用する必要があります。

</AppOnly>

<PagesOnly>

```js
import Image from 'next/image'

const imageLoader = ({ src, width, quality }) => {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}

export default function Page() {
  return (
    <Image
      loader={imageLoader}
      src="me.png"
      alt="Picture of the author"
      width={500}
      height={500}
    />
  )
}
```

</PagesOnly>

また、各インスタンスの`next/image`をプロップを渡さずにアプリケーション内で設定するために、`next.config.js`の`loaderFile`設定を使用することもできます。

### `fill` {#fill}

```js
fill={true} // {true} | {false}
```

画像が親要素を埋めることを引き起こすブール値です。[`width`](#width)と[`height`](#height)が不明な場合に役立ちます。

親要素は必ず`position: "relative"`、`position: "fixed"`、または`position: "absolute"`スタイルを割り当てる必要があります。

デフォルトでは、img要素には自動的に`position: "absolute"`スタイルが割り当てられます。

画像にスタイルが適用されない場合、画像はコンテナに合わせて伸縮します。画像がコンテナにフィットし、アスペクト比を保持するためにletterbox化される場合、`object-fit: "contain"`を設定することをお勧めします。

代替的に、`object-fit: "cover"`は画像がコンテナ全体を埋め、アスペクト比を保持するようにクロップされます。

詳細については、以下もご覧ください：

- [`position`](https://developer.mozilla.org/docs/Web/CSS/position)
- [`object-fit`](https://developer.mozilla.org/docs/Web/CSS/object-fit)
- [`object-position`](https://developer.mozilla.org/docs/Web/CSS/object-position)

### `sizes` {#sizes}

様々なブレークポイントで画像の幅がどのようになるかを提供する、メディアクエリに似た文字列。この`サイズ`の値は、[`fill`](#fill)を使用している画像や[レスポンシブサイズにスタイルされている](#responsive-images)画像にとって、パフォーマンスに大きく影響します。

`sizes`プロパティは画像のパフォーマンスに関連して2つの重要な目的を果たします：

- 一つ目に、`sizes`の値は、ブラウザが`next/image`により自動的に生成された`srcset`からどのサイズの画像をダウンロードするかを決定するために使用されます。ブラウザは選択時にページ上の画像のサイズをまだ知らないため、ビューポートと同じサイズまたはそれ以上の画像を選択します。`sizes`プロパティは、実際にはフルスクリーンよりも画像が小さくなることをブラウザに伝えるために使用します。`fill`プロパティを持つ画像で`sizes`の値を指定しない場合、デフォルトで`100vw`（フルスクリーン幅）の値が使用されます。
- 二つ目に、`sizes`プロパティは自動的に生成された`srcset`値の動作を変更します。`sizes`が存在しない場合は、小さい`srcset`が生成され、固定サイズの画像に適しています（1x/2xなど）。もし`sizes`が定義されると、大きな`srcset`が生成され、レスポンシブ画像に適しています（640w/750wなど）。もし`sizes`プロパティに`50vw`のようなビューポート幅のパーセンテージであるサイズが含まれる場合、`srcset`は必要になり得ないほど小さい値を含まないようにトリムされます。

例えば、スタイリングによって画像がモバイル端末では全幅にわたり、タブレットでは2カラム、デスクトップディスプレイでは3カラムレイアウトになる場合、次のような`sizes`プロパティを含めるべきです：

```jsx
import Image from 'next/image'

export default function Page() {
  return (
    <div className="grid-element">
      <Image
        fill
        src="/example.png"
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      />
    </div>
  )
}
```

この例で示した`sizes`はパフォーマンス指標に大きな影響を与える可能性があります。`33vw`のサイズを指定しない場合、サーバーから選択される画像は必要以上に3倍の幅になり、データサイズが幅の二乗に比例するため、`sizes`がなければユーザーは必要のない9倍の大きさの画像をダウンロードすることになります。

`srcset`と`sizes`の詳細については以下を参照してください：

- [web.dev](https://web.dev/learn/design/responsive-images/#sizes)
- [mdn](https://developer.mozilla.org/docs/Web/HTML/Element/img#sizes)

### `quality` {#quality}

```js
quality={75} // {number 1-100}
```

最適化された画像の品質を整数で指定し、`1`から`100`の範囲で、`100`が最良の品質で最大のファイルサイズを意味します。デフォルトは`75`です。

### `priority` {#priority}

```js
priority={false} // {false} | {true}
```

trueに設定すると、画像は高優先度と見なされます。`priority`を使用する画像では遅延読み込みが自動的に無効になります。[`loading`](#loading)プロパティも使用していて`lazy`に設定されている場合、`priority`プロパティは使用できません。`loading`プロパティは高度な使用例のためだけのものです。`priority`が必要な場合は`loading`を削除してください。

画像が[Largest Contentful Paint (LCP)](https://nextjs.org/learn/seo/web-performance/lcp)要素として検出された場合は`priority`プロパティを使用するべきです。異なるビューポートサイズでは異なる画像がLCP要素となる可能性があるため、複数の優先度のある画像を持つことが適切な場合があります。

ビューポートの最上部に画像が可視である場合にのみ使用するべきです。デフォルトは`false`です。

### `placeholder` {#placeholder}

```js
placeholder = 'empty' // "empty" | "blur" | "data:image/..."
```

画像が読み込まれる間に使用されるプレースホルダ。可能な値は`blur`、`empty`、または`data:image/...`です。デフォルトは`empty`です。

`blur`の場合、[`blurDataURL`](#blurdataurl)プロパティがプレースホルダとして使用されます。もし`src`が[静的インポート](/docs/app/building-your-application/optimizing/images#local-images)からのオブジェクトであり、インポートされた画像が`.jpg`、`.png`、`.webp`、または`.avif`である場合、`blurDataURL`は自動的に埋め込まれます。ただし、画像がアニメーションとして検出された場合は除きます。

動的画像に対しては、[`blurDataURL`](#blurdataurl)プロパティを提供する必要があります。[Plaiceholder](https://github.com/joe-bell/plaiceholder)などのソリューションは`base64`生成に役立ちます。

`data:image/...`の場合、画像が読み込まれている間、プレースホルダとして[データURL](https://developer.mozilla.org/docs/Web/HTTP/Basics_of_HTTP/Data_URIs)が使用されます。

`empty`の場合、画像が読み込まれている間に空のスペースのみが表示されます。

試してみましょう：

- [`blur`プレースホルダデモ](https://image-component.nextjs.gallery/placeholder)
- データURL `placeholder` プロップを使用したシマ―効果のデモ](https://image-component.nextjs.gallery/shimmer)
- [`blurDataURL`プロップを使用したカラ―効果のデモ](https://image-component.nextjs.gallery/color)

## 高度なProps {#advanced-props}

場合によっては、より高度な使用が必要になることがあります。 `<Image />` コンポーネントは、次の高度なプロパティをオプションで受け入れます。

### `style` {#style}

基本の画像要素にCSSスタイルを渡すことを許可します。

```jsx title="components/ProfileImage.js"
const imageStyle = {
  borderRadius: '50%',
  border: '1px solid #fff',
}

export default function ProfileImage() {
  return <Image src="..." style={imageStyle} />
}
```

必須の幅と高さのプロップがあなたのスタイリングと相互作用することを忘れないでください。スタイリングで画像の幅を変更する場合、その高さを`auto`にスタイルする必要があります。そうでなければ、画像のアスペクト比が内部的に歪んでしまいます。

### `onLoadingComplete` {#onloadingcomplete}

<AppOnly>

```jsx
'use client'

<Image onLoadingComplete={(img) => console.log(img.naturalWidth)} />
```

</AppOnly>

<PagesOnly>

```jsx
<Image onLoadingComplete={(img) => console.log(img.naturalWidth)} />
```

</PagesOnly>

> **警告**: Next.js 14からは[`onLoad`](#onload)への移行が推奨されています。

画像が完全に読み込まれ、[プレースホルダ](#placeholder)が削除されると呼び出されるコールバック関数。

コールバック関数は、基本の`<img>`要素への参照を引数として呼び出されます。

<AppOnly>

> **補足情報**: 関数を受け入れるプロップように`onLoadingComplete`を使用する場合、提供された関数をシリアライズするために[Client Components](/docs/app/building-your-application/rendering/client-components)を使用する必要があります。

</AppOnly>

### `onLoad` {#onload}

```jsx
<Image onLoad={(e) => console.log(e.target.naturalWidth)} />
```

画像が完全に読み込まれ、[プレースホルダ](#placeholder)が削除されると呼び出されるコールバック関数。

コールバック関数は、基本の`<img>`要素を指す`target`を持つイベントを引数として呼び出されます。

<AppOnly>

> **補足情報**: 関数を受け入れるプロップように`onLoad`を使用する場合、提供された関数をシリアライズするために[Client Components](/docs/app/building-your-application/rendering/client-components)を使用する必要があります。

</AppOnly>

### `onError` {#onerror}

```jsx
<Image onError={(e) => console.error(e.target.id)} />
```

画像の読み込みが失敗した場合に呼び出されるコールバック関数。

<AppOnly>

> **補足情報**: 関数を受け入れるプロップように`onError`を使用する場合、提供された関数をシリアライズするために[Client Components](/docs/app/building-your-application/rendering/client-components)を使用する必要があります。

</AppOnly>

### `loading` {#loading}

```js
loading = 'lazy' // {lazy} | {eager}
```

画像の読み込み挙動。デフォルトは`lazy`です。

`lazy`の場合、画像がビューポートから計算された距離に達するまで読み込みを遅延させます。

`eager`の場合、画像は即座に読み込まれます。

[`loading`属性](https://developer.mozilla.org/docs/Web/HTML/Element/img#loading)について詳細を学びましょう。

### `blurDataURL` {#blurdataurl}

`src`画像が正常に読み込まれる前にプレースホルダ画像として使用される[データURL](https://developer.mozilla.org/docs/Web/HTTP/Basics_of_HTTP/Data_URIs)。[`placeholder="blur"`](#placeholder)と組み合わせて使用した場合にのみ効果があります。

base64エンコードされた画像である必要があります。これは拡大されてブラーがかけられるため、非常に小さな画像（10ピクセル以下）を推奨します。プレースホルダとして大きな画像を含めるとパフォーマンスに悪影響を及ぼす場合があります。

試してみましょう：

- [`blurDataURL`プロップのデフォルトデモ](https://image-component.nextjs.gallery/placeholder)
- [`blurDataURL`プロップのカラ―効果デモ](https://image-component.nextjs.gallery/color)

また、画像に一致するような単色のデータURLを[生成する](https://png-pixel.com)こともできます。

### `unoptimized` {#unoptimized}

```js
unoptimized = {false} // {false} | {true}
```

trueの場合、元の画像は品質、サイズ、形式を変更せずに`src`からそのまま提供されます。デフォルトは`false`です。

1KB以下の小さな画像やSVGなどのベクター画像、GIFのようなアニメーション画像に最適化の利点がない場合に有用です。

```js
import Image from 'next/image'

const UnoptimizedImage = (props) => {
  return <Image {...props} unoptimized />
}
```

Next.js 12.3.0以降、このプロップは次の構成を使用して、`next.config.js`を更新することによりすべての画像に割り当てることができます：

```js title="next.config.js"
module.exports = {
  images: {
    unoptimized: true,
  },
}
```

### `overrideSrc` {#overridesrc}

`<Image>`コンポーネントに`src`プロップを提供する場合、結果的に`srcset`と`src`属性が自動生成されます。

```jsx title="input.js"
<Image src="/me.jpg" />
```

```html title="output.html"
<img
  srcset="
    /_next/image?url=%2Fme.jpg&w=640&q=75 1x,
    /_next/image?url=%2Fme.jpg&w=828&q=75 2x
  "
  src="/_next/image?url=%2Fme.jpg&w=828&q=75"
/>
```

場合によっては、`src`属性が生成されることが望ましくなく、SEO目的（画像のランク付けや再クロールの回避など）で同じ`src`属性を保持したい場合があります。このような場合、`overrideSrc`プロップを使用して上書きできます。

```jsx title="input.js"
<Image src="/me.jpg" overrideSrc="/override.jpg" />
```

```html title="output.html"
<img
  srcset="
    /_next/image?url=%2Fme.jpg&w=640&q=75 1x,
    /_next/image?url=%2Fme.jpg&w=828&q=75 2x
  "
  src="/override.jpg"
/>
```

### decoding {#decoding}

ブラウザに画像がデコードされる前に他のコンテンツ更新を表示するか否かを示唆するヒント。デフォルトは`async`です。

考えられる値は次のとおりです：

- `async` - 画像を非同期にデコードし、他のコンテンツが完了する前にレンダリングを許可。
- `sync` - 他のコンテンツと共に画像を一括表示するために同期的にデコード。
- `auto` - デコードモードについて特に好ましい方法がない。ブラウザが最適と判断する方法を選択。

[`decoding`属性](https://developer.mozilla.org/docs/Web/HTML/Element/img#decoding)についての詳細を学びましょう。

### その他のProps {#other-props}

その他の`<Image />` コンポーネント上のプロパティは、`srcSet`を除いて基となる`img`要素に渡されます。`srcSet`については[Device Sizes](#devicesizes)を使用してください。

## Configuration Options {#configuration-options}

プロップに加えて、`next.config.js`でImageコンポーネントを設定することができます。利用可能なオプションは以下のとおりです：

## `localPatterns` {#localpatterns}

特定のパスを最適化するようにして他のすべてのパスをブロックするために、`next.config.js`ファイルで`localPatterns`を設定することがオプションで可能です。

```js title="next.config.js"
module.exports = {
  images: {
    localPatterns: [
      {
        pathname: '/assets/images/**',
        search: '',
      },
    ],
  },
}
```

> **補足情報**: 上記の例は`next/image`の`src`プロパティが必ず`/assets/images/`で始まりクエリ文字列を持たないことを保証します。他のパスを最適化しようとすると400 Bad Requestが返されます。

### `remotePatterns` {#remotepatterns}

悪意のあるユーザーからアプリケーションを保護するために、外部画像を使用する場合は設定が必要です。これにより、あなたのアカウントからの外部画像のみがNext.jsの画像最適化APIから提供されることが保証されます。これらの外部画像は、以下に示すように、`next.config.js`ファイルの`remotePatterns`プロパティで設定できます：

```js title="next.config.js"
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'example.com',
        port: '',
        pathname: '/account123/**',
        search: '',
      },
    ],
  },
}
```

> **補足情報**: 上記の例は`next/image`の`src`プロパティが必ず`https://example.com/account123/`で始まりクエリ文字列を持たないことを保証します。他のプロトコル、ホスト名、ポート、または一致しないパスは400 Bad Requestが返されます。

以下は`next.config.js`ファイルで`hostname`にワイルドカードパターンを使用した`remotePatterns`プロパティの例です：

```js title="next.config.js"
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**.example.com',
        port: '',
        search: '',
      },
    ],
  },
}
```

> **補足情報**: 上記の例は、`next/image`の`src`プロパティが必ず`https://img1.example.com`や`https://me.avatar.example.com`、または任意の数のサブドメインで始まり、ポートまたはクエリ文字列を持たないことを保証します。 他のプロトコルや一致しないホスト名は400 Bad Requestが返されます。

ワイルドカードパターンは、`pathname`と`hostname`の両方に使用することができ、次の構文があります：

- `*`は単一のパスセグメントまたはサブドメインと一致
- `**`は末尾の任意の数のパスセグメントまたは先頭の任意の数のサブドメインと一致

`**`構文はパターンの途中では機能しません。

> **補足情報**: `protocol`、`port`、`pathname`または`search`を省略する場合、ワイルドカード`**`が暗黙されます。これは、意図しなかったURLの最適化を悪意のあるアクターが行う可能性があるため推奨されません。

以下はクエリの`search`で`remotePatterns`プロパティを使用した`next.config.js`ファイルの例です：

```js title="next.config.js"
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'assets.example.com',
        search: '?v=1727111025337',
      },
    ],
  },
}
```

> **補足情報**: 上記の例は`next/image`の`src`プロパティが必ず`https://assets.example.com`で始まり、特定のクエリ文字列`?v=1727111025337`を持つことを保証します。他のプロトコルやクエリ文字列は400 Bad Requestが返されます。

### `domains` {#domains}

> **警告**: Next.js 14以降、`remotePatterns`に代わる厳格な設定として推奨されます。悪意のあるユーザーからアプリケーションを保護するためです。ドメインからのすべてのコンテンツを自分で所有している場合に限り、`domains`を使用してください。

[`remotePatterns`](#remotepatterns)と同様に、`domains`設定は、外部画像の許可されたホスト名のリストを提供するために使用できます。

ただし、`domains`設定はワイルドカードパターンマッチングに対応しておらず、プロトコル、ポート、またはパス名を制限することはできません。

以下は`next.config.js`ファイル内の`domains`プロパティの例です：

```js title="next.config.js"
module.exports = {
  images: {
    domains: ['assets.acme.com'],
  },
}
```

### `loaderFile` {#loaderfile}

Next.jsの組み込みImage最適化APIの代わりにクラウドプロバイダを使用して画像を最適化したい場合、`next.config.js`で`loaderFile`を以下のように設定できます：

```js title="next.config.js"
module.exports = {
  images: {
    loader: 'custom',
    loaderFile: './my/image/loader.js',
  },
}
```

これは、Next.jsアプリケーションのルートから相対的なファイルを指す必要があります。ファイルは、文字列を返すデフォルトの関数をエクスポートする必要があります。例えば：

<AppOnly>

```js title="my/image/loader.js"
'use client'

export default function myImageLoader({ src, width, quality }) {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}
```

</AppOnly>

<PagesOnly>

```js title="my/image/loader.js"
export default function myImageLoader({ src, width, quality }) {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`
}
```

</PagesOnly>

または、`next/image`の各インスタンスを設定するために[`loader`プロップ](#loader)を使用することもできます。

例：

- [カスタムImageローダ設定](/docs/app/api-reference/config/next-config-js/images#example-loader-configuration)

<AppOnly>

> **補足情報**: 関数を受け入れるカスタムイメージローダーファイルをカスタマイズするには、提供された関数をシリアライズするために[Client Components](/docs/app/building-your-application/rendering/client-components)を使用する必要があります。

</AppOnly>

## 高度な設定 {#advanced}

以下の設定は高度なユースケース向けで、通常は必要ありません。以下のプロパティを設定すると、将来のアップデートでNext.jsのデフォルトに対する変更を上書きします。

### `deviceSizes` {#devicesizes}

ユーザーの予想されるデバイス幅を把握している場合は、`next.config.js`の`deviceSizes`プロパティを使用してデバイス幅のブレークポイントリストを指定できます。これらの幅は、ユーザーのデバイスに対して適切な画像が提供されることを保証するために`next/image`コンポーネントが[`sizes`](#sizes)プロップを使用するときに使用されます。

構成が提供されない場合は、以下のデフォルトが使用されます。

```js title="next.config.js"
module.exports = {
  images: {
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  },
}
```

### `imageSizes` {#imagesizes}

`next.config.js`で`images.imageSizes`プロパティを使用して画像の幅のリストを指定できます。これらの幅は、画像[srcset](https://developer.mozilla.org/docs/Web/API/HTMLImageElement/srcset)を生成するために使用されるサイズの完全な配列を形成するために、[デバイスサイズ](#devicesizes)の配列と連結されます。

2つの独立したリストがある理由は、imageSizesは画像が画面のフル幅より小さいことを示す[`sizes`](#sizes)プロップを持つ画像にのみ使用されるためです。したがって、imageSizes内のサイズはdeviceSizes内の最小サイズよりも小さくする必要があります。

構成が提供されない場合は、以下のデフォルトが使用されます。

```js title="next.config.js"
module.exports = {
  images: {
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
}
```

### `formats` {#formats}

デフォルトの[Image最適化API](#loader)は、要求の`Accept`ヘッダを介してブラウザがサポートする画像形式を自動的に検出し、最適な出力形式を決定します。

もし`Accept`ヘッダが設定されたフォーマットのうちより多くに一致する場合、配列内の最初の一致が使用されます。したがって、配列の順番は重要です。もし一致しない場合（またはソース画像が[アニメーション](#animated-images)されている場合）、Image最適化APIは元の画像の形式にフォールバックします。

構成が提供されない場合は、以下のデフォルトが使用されます。

```js title="next.config.js"
module.exports = {
  images: {
    formats: ['image/webp'],
  },
}
```

以下の設定でAVIFサポートを有効にしてWebPにフォールバックすることもできます。

```js title="next.config.js"
module.exports = {
  images: {
    formats: ['image/avif', 'image/webp'],
  },
}
```

> **補足情報**:
>
> - AVIFはエンコードに通常50%長くかかりますが、WebPに比べて20%小さく圧縮します。これは、初めて画像が要求されたときに通常は遅くなりますが、後続のキャッシュされた要求では高速になります。
> - Next.jsのプロキシ/CDNの後ろで自己ホストする場合、プロキシが`Accept`ヘッダを転送するように設定する必要があります。

## キャッシュ動作 {#caching-behavior}

以下はデフォルトの[ローダ](#loader)のキャッシングアルゴリズムについて説明しています。他のローダーについては、クラウドプロバイダのドキュメントを参照してください。

画像は要求に応じて動的に最適化され、`<distDir>/cache/images`ディレクトリに保存されます。この最適化された画像ファイルは、期限が切れるまで後続の要求に対して提供されます。キャッシュされているが有効期限が切れたファイルに一致する要求が行われた場合、失効した画像は即座にサーブされ、バックグラウンドで画像が再度最適化（有効化）され、新しい有効期限日とともにキャッシュに保存されます。

画像のキャッシュ状態は、`x-nextjs-cache`レスポンスヘッダの値を読み取ることによって判断することができます。考えられる値は以下の通りです：

- `MISS` - パスがキャッシュにない（初回訪問時にのみ発生）
- `STALE` - パスはキャッシュにあるが再バリデーション時間を超えたため、バックグラウンドで更新される
- `HIT` - パスはキャッシュにあり、再バリデーション時間を超えていない

失効日（またはむしろ最大年齢）は、[`minimumCacheTTL`](#minimumcachettl)設定または上流画像の`Cache-Control`ヘッダのいずれか大きい方によって定義されます。具体的には、`Cache-Control`ヘッダの`max-age`値が使用されます。`s-maxage`と`max-age`の両方が見つかった場合は、`s-maxage`が優先されます。この`max-age`は、CDNやブラウザを含む任意の下流のクライアントにも透過します。

- 上流画像に`Cache-Control`ヘッダが含まれていないか、値が非常に低い場合、[`minimumCacheTTL`](#minimumcachettl)でキャッシュの持続時間を増やすことができます。
- [`deviceSizes`](#devicesizes)と[`imageSizes`](#imagesizes)を設定することで、生成される画像の総数を削減することができます。
- 単一の画像形式を優先するためにフォーマットを無効にして、[formats](#formats)を設定することができます。

### `minimumCacheTTL` {#minimumcachettl}

キャッシュされた最適化された画像の生存時間（TTL）を秒単位で設定できます。多くの場合、Static Image Importを使用することが良いです。これにより、自動的にファイルコンテンツをハッシュし、`Cache-Control`ヘッダを`immutable`で設定して画像を永遠にキャッシュします。

```js title="next.config.js"
module.exports = {
  images: {
    minimumCacheTTL: 60,
  },
}
```

最適化された画像の失効日は、`minimumCacheTTL`または上流画像の`Cache-Control`ヘッダのいずれか大きい方によって定義されます。

画像ごとにキャッシュ動作を変更する必要がある場合、[`headers`](https://nextjs.org/docs/app/api-reference/config/next-config-js/headers)を設定して上流画像（例：`/_next/image`自体ではなく`/some-asset.jpg`）の`Cache-Control`ヘッダを設定できます。

現時点では、キャッシュを無効にするメカニズムはないため、`minimumCacheTTL`を低く保つことが最善です。それ以外の場合、手動で[`src`](#src)プロパティを変更するか、`<distDir>/cache/images`を削除する必要があるかもしれません。

### `disableStaticImages` {#disablestaticimages}

デフォルトの動作により、`import icon from './icon.png'`のような静的ファイルをインポートし、そのプロップを`src`プロパティに渡すことができます。

場合によっては、インポートが異なる動作をすると予想される他のプラグインと競合する場合にこの機能を無効にすることを選択するかもしれません。

`next.config.js`内で静的画像のインポートを無効にすることができます：

```js title="next.config.js"
module.exports = {
  images: {
    disableStaticImages: true,
  },
}
```

### `dangerouslyAllowSVG` {#dangerouslyallowsvg}

デフォルトの[ローダ](#loader)は、いくつかの理由からSVG画像を最適化しません。まず、SVGはベクター形式であり、損失なくリサイズ可能です。第二に、SVGにはHTML/CSSと同じ機能が多くあり、適切な[コンテンツセキュリティポリシー（CSP）ヘッダ](/docs/app/api-reference/config/next-config-js/headers#content-security-policy)がないと脆弱性を引き起こす可能性があります。

したがって、[`src`](#src)プロパティがSVGであることが判明している場合は、[`unoptimized`](#unoptimized)プロップを使用することをお勧めします。これは、srcが`".svg"`で終わる場合は自動的に発生します。

しかし、デフォルトのImage最適化APIでSVG画像を提供する必要がある場合、次のように次のように`next.config.js`で`dangerouslyAllowSVG`を設定できます：

```js title="next.config.js"
module.exports = {
  images: {
    dangerouslyAllowSVG: true,
    contentDispositionType: 'attachment',
    contentSecurityPolicy: "default-src 'self'; script-src 'none'; sandbox;",
  },
}
```

さらに、画像に埋め込まれたスクリプトの実行を防ぐために、画像のダウンロードをブラウザに強制し、`contentSecurityPolicy`を設定するように`contentDispositionType`も強く推奨されます。

### `contentDispositionType` {#contentdispositiontype}

デフォルトの[ローダ](#loader)は追加の保護のために[`Content-Disposition`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition#as_a_response_header_for_the_main_body)ヘッダを`attachment`に設定します。これにより、APIが任意のリモート画像を提供できるためです。

デフォルトの値は`attachment`であり、直接訪問するときに画像をブラウザにダウンロードさせます。これは、[`dangerouslyAllowSVG`](#dangerouslyallowsvg)がtrueである場合に特に重要です。

画像を直接訪問するときにダウンロードせずにブラウザにレンダリングを許可する`inline`を設定することも可能です。

```js title="next.config.js"
module.exports = {
  images: {
    contentDispositionType: 'inline',
  },
}
```

## アニメーション画像 {#animated-images}

デフォルトの[ローダ](#loader)は、自動的にアニメーション画像のImage最適化をバイパスし、画像をそのまま提供します。

アニメーションファイルの自動検出は、GIF、APNG、およびWebPをサポートしており、可能な限り正確に行います。指定されたアニメーション画像に対してImage最適化を明示的にバイパスしたい場合、[unoptimized](#unoptimized)プロップを使用してください。

## レスポンシブ画像 {#responsive-images}

デフォルトで生成される`srcset`には、異なるデバイス画素密度をサポートするために`1x`および`2x`画像が含まれています。ただし、ビューポートに応じて伸縮するレスポンシブ画像をレンダリングしたい場合があるかもしれません。その場合、[`sizes`](#sizes)を設定し、`style`（または`className`）も設定する必要があります。

以下の方法のいずれかを使用してレスポンシブ画像をレンダリングできます。

### 静的インポートを使用したレスポンシブ画像 {#responsive-image-using-a-static-import}

ソース画像が動的でない場合、静的にインポートすることでレスポンシブ画像を作成できます：

```jsx title="components/author.js"
import Image from 'next/image'
import me from '../photos/me.jpg'

export default function Author() {
  return (
    <Image
      src={me}
      alt="Picture of the author"
      sizes="100vw"
      style={{
        width: '100%',
        height: 'auto',
      }}
    />
  )
}
```

試してみましょう：

- [ビューポートに応じた画像デモ](https://image-component.nextjs.gallery/responsive)

### アスペクト比を持つレスポンシブ画像 {#responsive-image-with-aspect-ratio}

ソース画像が動的またはリモートURLである場合、レスポンシブ画像の正しいアスペクト比を設定するために`width`と`height`を提供する必要もあります：

```jsx title="components/page.js"
import Image from 'next/image'

export default function Page({ photoUrl }) {
  return (
    <Image
      src={photoUrl}
      alt="Picture of the author"
      sizes="100vw"
      style={{
        width: '100%',
        height: 'auto',
      }}
      width={500}
      height={300}
    />
  )
}
```

試してみましょう：

- [ビューポート対応の画像デモ](https://image-component.nextjs.gallery/responsive)

### `fill`を使用したレスポンシブ画像{#responsive-image-with-fill}

アスペクト比を把握していない場合は、[`fill`](#fill)プロップを設定し、親に`position: relative`を設定する必要があります。オプションで、ストレッチやクロップの動作に応じて`object-fit`スタイルを設定できます：

```jsx title="app/page.js"
import Image from 'next/image'

export default function Page({ photoUrl }) {
  return (
    <div style={{ position: 'relative', width: '300px', height: '500px' }}>
      <Image
        src={photoUrl}
        alt="Picture of the author"
        sizes="300px"
        fill
        style={{
          objectFit: 'contain',
        }}
      />
    </div>
  )
}
```

試してみましょう：

- [`fill`プロップのデモ](https://image-component.nextjs.gallery/fill)

## テーマ検出CSS{#theme-detection-css}

ライトモードとダークモードで異なる画像を表示したい場合、2つの`<Image>`コンポーネントをラップし、CSSメディアクエリに基づいて正しいものを表示する新しいコンポーネントを作成できます。

```css title="components/theme-image.module.css"
.imgDark {
  display: none;
}

@media (prefers-color-scheme: dark) {
  .imgLight {
    display: none;
  }
  .imgDark {
    display: unset;
  }
}
```

<Tabs>
<TabItem value="tsx" label="TypeScript">

```tsx title="components/theme-image.tsx" switcher
import styles from './theme-image.module.css'
import Image, { ImageProps } from 'next/image'

type Props = Omit<ImageProps, 'src' | 'priority' | 'loading'> & {
  srcLight: string
  srcDark: string
}

const ThemeImage = (props: Props) => {
  const { srcLight, srcDark, ...rest } = props

  return (
    <>
      <Image {...rest} src={srcLight} className={styles.imgLight} />
      <Image {...rest} src={srcDark} className={styles.imgDark} />
    </>
  )
}
```

</TabItem>
<TabItem value="jsx" label="JavaScript">

```jsx title="components/theme-image.js" switcher
import styles from './theme-image.module.css'
import Image from 'next/image'

const ThemeImage = (props) => {
  const { srcLight, srcDark, ...rest } = props

  return (
    <>
      <Image {...rest} src={srcLight} className={styles.imgLight} />
      <Image {...rest} src={srcDark} className={styles.imgDark} />
    </>
  )
}
```

</TabItem>
</Tabs>

> **補足情報**: `loading="lazy"`のデフォルト動作により、正しい画像のみが読み込まれます。デフォルトでは`priority`または`loading="eager"`は使用できません。それは、両方の画像が読み込まれることを引き起こします。代わりに、[`fetchPriority="high"`](https://developer.mozilla.org/docs/Web/API/HTMLImageElement/fetchPriority)を使用できます。

試してみましょう：

- [ライト/ダークモードテーマ検出のデモ](https://image-component.nextjs.gallery/theme)

## getImageProps {#getimageprops}

より高度なユースケースのために、`getImageProps()`を呼び出して基となる`<img>`要素に渡されるプロップを取得することができます。それを別のコンポーネント、スタイル、キャンバスなどに渡すことができます。

これはまた、Reactの`useState()`を呼び出さないのでパフォーマンスが向上する可能性がありますが、[`placeholder`](#placeholder)プロップと一緒に使用することはできません。プレースホルダが決して削除されないからです。

### テーマ検出画像 {#theme-detection-picture}

ライトモードとダークモードで異なる画像を表示したい場合は、ユーザーの[好みのカラースキーム](https://developer.mozilla.org/ja/docs/Web/CSS/@media/prefers-color-scheme)に基づいて異なる画像を表示するために[`<picture>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/picture)要素を使用できます。

```jsx title="app/page.js"
import { getImageProps } from 'next/image'

export default function Page() {
  const common = { alt: 'Theme Example', width: 800, height: 400 }
  const {
    props: { srcSet: dark },
  } = getImageProps({ ...common, src: '/dark.png' })
  const {
    props: { srcSet: light, ...rest },
  } = getImageProps({ ...common, src: '/light.png' })

  return (
    <picture>
      <source media="(prefers-color-scheme: dark)" srcSet={dark} />
      <source media="(prefers-color-scheme: light)" srcSet={light} />
      <img {...rest} />
    </picture>
  )
}
```

### Art Direction {#art-direction}

モバイルとデスクトップで異なる画像を表示したい場合、[アートディレクション](https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images#art_direction)と呼ばれる場合がありますが、`getImageProps()`に異なる`src`、`width`、`height`、`quality`プロップを指定できます。

```jsx title="app/page.js"
import { getImageProps } from 'next/image'

export default function Home() {
  const common = { alt: 'Art Direction Example', sizes: '100vw' }
  const {
    props: { srcSet: desktop },
  } = getImageProps({
    ...common,
    width: 1440,
    height: 875,
    quality: 80,
    src: '/desktop.jpg',
  })
  const {
    props: { srcSet: mobile, ...rest },
  } = getImageProps({
    ...common,
    width: 750,
    height: 1334,
    quality: 70,
    src: '/mobile.jpg',
  })

  return (
    <picture>
      <source media="(min-width: 1000px)" srcSet={desktop} />
      <source media="(min-width: 500px)" srcSet={mobile} />
      <img {...rest} style={{ width: '100%', height: 'auto' }} />
    </picture>
  )
}
```

### Background CSS {#background-css}

`srcSet`文字列を[`image-set()`](https://developer.mozilla.org/en-US/docs/Web/CSS/image/image-set) CSS関数に変換して、背景画像を最適化することもできます。

```jsx title="app/page.js"
import { getImageProps } from 'next/image'

function getBackgroundImage(srcSet = '') {
  const imageSet = srcSet
    .split(', ')
    .map((str) => {
      const [url, dpi] = str.split(' ')
      return `url("${url}") ${dpi}`
    })
    .join(', ')
  return `image-set(${imageSet})`
}

export default function Home() {
  const {
    props: { srcSet },
  } = getImageProps({ alt: '', width: 128, height: 128, src: '/img.png' })
  const backgroundImage = getBackgroundImage(srcSet)
  const style = { height: '100vh', width: '100vw', backgroundImage }

  return (
    <main style={style}>
      <h1>Hello World</h1>
    </main>
  )
}
```

## 知られているブラウザのバグ {#known-browser-bugs}

この`next/image`コンポーネントはブラウザネイティブの[遅延ロード](https://caniuse.com/loading-lazy-attr)を使用しており、Safari 15.4以前の古いブラウザではイマーゲンを意図したりしてフォールバックすることがあるかもしれません。`blur-up`プレースホルダを使うときは、Safari 12以前の古いブラウザは空白のプレースホルダにフォールバックします。`width`/`height`を`auto`で指定するスタイルを使うと、`img`属性から計算されたアスペクト比を保持しないSafari 15以前の古いブラウザで[レイアウトシフト](https://web.dev/cls/)が発生する可能性があります。詳細は、この[MDNビデオ](https://www.youtube.com/watch?v=4-d_SoCHeWE)を参照してください。

- [Safari 15 - 16.3](https://bugs.webkit.org/show_bug.cgi?id=243601)はロード中に灰色のボーダーを表示します。Safari 16.4は[この問題を修正しました](https://webkit.org/blog/13966/webkit-features-in-safari-16-4/#:~:text=Now%20in%20Safari%2016.4%2C%20a%20gray%20line%20no%20longer%20appears%20to%20mark%20the%20space%20where%20a%20lazy%2Dloaded%20image%20will%20appear%20once%20it%E2%80%99s%20been%20loaded.)。可能な解決策：
  - CSS `@supports (font: -apple-system-body) and (-webkit-appearance: none) { img[loading="lazy"] { clip-path: inset(0.6px) } }`を使用
  - 画像が最初に表示される場合は[`priority`](#priority)を使用
- [Firefox 67+](https://bugzilla.mozilla.org/show_bug.cgi?id=1556156)はロード中に白い背景を表示します。可能な解決策：
  - AVIF [`formats`](#formats)を有効にする
  - [`placeholder`](#placeholder)を使用する

## バージョン履歴 {#version-history}

| バージョン | 変更内容                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `v15.0.0`  | `decoding`プロップの追加。`contentDispositionType`設定のデフォルトが`attachment`に変更されました。                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `v14.2.0`  | `overrideSrc`プロップの追加。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `v14.1.0`  | `getImageProps()`の安定化。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `v14.0.0`  | `onLoadingComplete`プロップと`domains`の設定がdeprecatedされました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `v13.4.14` | `placeholder`プロップが`data:/image...`をサポート。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `v13.2.0`  | `contentDispositionType`設定の追加。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `v13.0.6`  | `ref`プロップの追加。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `v13.0.0`  | `next/image`のインポートが`next/legacy/image`に名前が変更されました。`next/future/image`のインポートが`next/image`に名前が変更されました。[自動移行ツールが利用可能](/docs/app/building-your-application/upgrading/codemods#next-image-to-legacy-image) でインポートを安全かつ自動的に名前変更できます。`<span>`のラッパーが削除。`layout`、`objectFit`、`objectPosition`、`lazyBoundary`、`lazyRoot`プロップが削除されました。 `alt`が必須。`onLoadingComplete`は`img`要素への参照を受け取ります。ビルトインローダー設定が削除されました。 |
| `v12.3.0`  | `remotePatterns`と`unoptimized` 設定が安定しました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `v12.2.0`  | `remotePatterns`と`unoptimized` 設定の実験的サポートが追加されました。`layout="raw"` が削除されました。                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `v12.1.1`  | `style`プロップが追加されました。`layout="raw"` の実験的サポートが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `v12.1.0`  | `dangerouslyAllowSVG`と`contentSecurityPolicy`設定が追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `v12.0.9`  | `lazyRoot`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `v12.0.0`  | `formats`設定が追加されました。<br/>AVIFサポートが追加されました。<br/>ラッパー`<div>`が`<span>`に変更されました。                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `v11.1.0`  | `onLoadingComplete`と`lazyBoundary`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `v11.0.0`  | `src`プロップが静的インポートをサポート。<br/>`placeholder`プロップが追加されました。<br/>`blurDataURL`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                           |
| `v10.0.5`  | `loader`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `v10.0.1`  | `layout`プロップが追加されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `v10.0.0`  | `next/image`が導入されました。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
