---
title: 'turbo'
description: 'Next.js を Turbopack 固有のオプションで設定する'
version: 'experimental'
---

{/* このドキュメントの内容はapp routerとpages routerで共有されています。Pages Routerに特化した内容を追加するには、`<PagesOnly>Content</PagesOnly>`コンポーネントを使用してください。共有される内容はコンポーネント内にラップしないでください。 */}

`turbo`オプションを使用すると、異なるファイルを変換し、モジュールの解決方法を変更するために[Turbopack](/docs/app/api-reference/turbopack)をカスタマイズできます。

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="next.config.ts" switcher
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  experimental: {
    turbo: {
      // ...
    },
  },
}

export default nextConfig
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="next.config.js" switcher
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    turbo: {
      // ...
    },
  },
}

module.exports = nextConfig
```

</TabItem>
</Tabs>

> **Good to know**:
>
> - Next.js 用の Turbopack は、内蔵の機能に対してローダーやローダー設定を必要としません。Turbopack には、CSS や最新の JavaScript をコンパイルするためのサポートが組み込まれているため、`@babel/preset-env`を使用している場合、`css-loader`、`postcss-loader`、または`babel-loader`は不要です。

## Reference {#reference}

### Options {#options}

`turbo`構成に利用可能な次のオプションがあります：

| Option              | Description                                                            |
| ------------------- | ---------------------------------------------------------------------- |
| `rules`             | Turbopack を使用する際に適用する非対応のwebpackローダーのリストです    |
| `resolveAlias`      | エイリアスされたインポートを他のロードするモジュールにマッピングします |
| `resolveExtensions` | ファイルをインポートする際に解決する拡張子のリストです                 |
| `moduleIdStrategy`  | モジュールIDを割り当てます                                             |
| `treeShaking`       | turbopack 開発サーバーとビルドのためにtree shakingを有効にします       |
| `memoryLimit`       | turbo の目標メモリ制限（バイト単位）です                               |

### Supported loaders {#supported-loaders}

以下のローダーが、Turbopackのwebpackローダーの実装で動作することが確認されています：

- [`babel-loader`](https://www.npmjs.com/package/babel-loader)
- [`@svgr/webpack`](https://www.npmjs.com/package/@svgr/webpack)
- [`svg-inline-loader`](https://www.npmjs.com/package/svg-inline-loader)
- [`yaml-loader`](https://www.npmjs.com/package/yaml-loader)
- [`string-replace-loader`](https://www.npmjs.com/package/string-replace-loader)
- [`raw-loader`](https://www.npmjs.com/package/raw-loader)
- [`sass-loader`](https://www.npmjs.com/package/sass-loader)

## Examples {#examples}

### webpackローダーの設定 {#configuring-webpack-loaders}

組み込み以上のローダーサポートが必要な場合、多くのwebpackローダーがすでにTurbopackと連携しています。ただし、現在のところいくつかの制限があります：

- 現在、webpackローダーAPIのコア部分のみが実装されています。現在は一部の人気ローダーに対して十分なサポートがあり、今後APIサポートを拡大していきます。
- JavaScriptコードを返すローダーのみがサポートされています。スタイルシートや画像のようなファイルを変換するローダーは現時点でサポートされていません。
- webpackローダーに渡すオプションは、単純なJavaScriptプリミティブ、オブジェクト、および配列でなければなりません。たとえば、`require()`プラグインモジュールをオプション値として渡すことはできません。

ローダーを設定するには、`next.config.js`にインストールしたローダーの名前とオプションを追加し、ファイル拡張子をローダーのリストにマッピングします：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      rules: {
        '*.svg': {
          loaders: ['@svgr/webpack'],
          as: '*.js',
        },
      },
    },
  },
}
```

> **Good to know**: Next.js バージョン13.4.4以前は、`turbo.rules`は`turbo.loaders`と呼ばれ、`.mdx`のようなファイル拡張子のみを受け入れていました。

### エイリアスの解決 {#resolving-aliases}

Turbopack は、webpack の[`resolve.alias`](https://webpack.js.org/configuration/resolve/#resolvealias)設定に似た方法で、モジュールの解決をエイリアスで変更できます。

エイリアスを解決するには、`next.config.js`でインポートされたパターンを新しい宛先にマッピングします：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      resolveAlias: {
        underscore: 'lodash',
        mocha: { browser: 'mocha/browser-entry.js' },
      },
    },
  },
}
```

これにより、`underscore`パッケージのインポートが`lodash`パッケージにエイリアスされます。言い換えれば、`import underscore from 'underscore'`は`underscore`の代わりに`lodash`モジュールを読み込みます。

Turbopackはこのフィールドを通じて条件付きエイリアスもサポートしており、これはNode.jsの[条件付きエクスポート](https://nodejs.org/docs/latest-v18.x/api/packages.html#conditional-exports)に似ています。現在サポートされているのは`browser`条件のみです。上記の例では、ブラウザ環境をターゲットにするとき、`mocha`モジュールのインポートは`mocha/browser-entry.js`にエイリアスされます。

### カスタム拡張子の解決 {#resolving-custom-extensions}

Turbopack は、webpack の[`resolve.extensions`](https://webpack.js.org/configuration/resolve/#resolveextensions)設定に似た方法でカスタム拡張子を持つモジュールを解決するように設定できます。

解決する拡張子を設定するには、`next.config.js`内の`resolveExtensions`フィールドを使用します：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      resolveExtensions: [
        '.mdx',
        '.tsx',
        '.ts',
        '.jsx',
        '.js',
        '.mjs',
        '.json',
      ],
    },
  },
}
```

これにより、元の解決拡張子が提供されたリストで上書きされます。デフォルトの拡張子を含めるようにしてください。

アプリをwebpackからTurbopackに移行する方法に関する詳細情報やガイドについては、[Turbopackのドキュメントのwebpack互換性](https://turbo.build/pack/docs/migrating-from-webpack)を参照してください。

### モジュールIDの割り当て {#assigning-module-ids}

Turbopackは現在、モジュールIDを割り当てるための2つの戦略をサポートしています：

- `'named'` はモジュールのパスおよび機能に基づいて読みやすいモジュールIDを割り当てます。
- `'deterministic'` は小さなハッシュ化された数値モジュールIDを割り当て、ビルド間でほとんど一貫性があり、長期的なキャッシングに役立ちます。

設定されていない場合、Turbopack は開発ビルドでは `'named'` を、製品ビルドでは `'deterministic'` を使用します。

モジュールID戦略を設定するには、`next.config.js`の`moduleIdStrategy`フィールドを使用します：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      moduleIdStrategy: 'deterministic',
    },
  },
}
```

## バージョン履歴 {#version-history}

| Version  | Changes                               |
| -------- | ------------------------------------- |
| `13.0.0` | `experimental.turbo` が導入されました |
