---
title: 'turbo'
description: 'Next.js の Turbopack特有のオプションを設定する'
version: '実験的'
---

{/* この文書の内容はapp routerとpages routerの両方で共有されています。pages routerに特化したコンテンツを追加するためには、`<PagesOnly>コンテンツ</PagesOnly>` コンポーネントを使用できます。共有されるコンテンツはコンポーネントで囲まないでください。 */}

`turbo` オプションを使用すると、さまざまなファイルを変換したり、モジュールの解決方法を変更したりするために [Turbopack](/docs/app/api-reference/turbopack) をカスタマイズできます。

<Tabs>
<TabItem value="ts" label="TypeScript">

```ts title="next.config.ts" switcher
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  experimental: {
    turbo: {
      // ...
    },
  },
}

export default nextConfig
```

</TabItem>
<TabItem value="js" label="JavaScript">

```js title="next.config.js" switcher
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    turbo: {
      // ...
    },
  },
}

module.exports = nextConfig
```

</TabItem>
</Tabs>

> **Good to know**:
>
> - Next.js用のTurbopackには、組み込み機能のためのローダーやローダー設定が必要ありません。Turbopackは、CSSと最新のJavaScriptのコンパイルをサポートしているため、組み込み機能のために `css-loader`、`postcss-loader`、または `babel-loader` を使用する必要はありません。

## 参考 {#reference}

### オプション {#options}

`turbo` 設定で利用可能なオプションは次のとおりです：

| オプション          | 説明                                                               |
| ------------------- | ------------------------------------------------------------------ |
| `rules`             | Turbopackで実行する際に適用する非対応のwebpackローダーリスト       |
| `resolveAlias`      | インポートされたエイリアスをモジュールにマップし、代わりに読み込む |
| `resolveExtensions` | ファイルをインポートするときに解決する拡張子のリスト               |
| `moduleIdStrategy`  | モジュールIDを割り当てる                                           |
| `treeShaking`       | turbopackの開発サーバーとビルド用にツリーシェーキングを有効にする  |
| `memoryLimit`       | turboのターゲットメモリ制限（バイト単位）                          |

### 対応するローダー {#supported-loaders}

以下のローダーは、Turbopackのwebpackローダー実装で動作することが確認されています：

- [`babel-loader`](https://www.npmjs.com/package/babel-loader)
- [`@svgr/webpack`](https://www.npmjs.com/package/@svgr/webpack)
- [`svg-inline-loader`](https://www.npmjs.com/package/svg-inline-loader)
- [`yaml-loader`](https://www.npmjs.com/package/yaml-loader)
- [`string-replace-loader`](https://www.npmjs.com/package/string-replace-loader)
- [`raw-loader`](https://www.npmjs.com/package/raw-loader)
- [`sass-loader`](https://www.npmjs.com/package/sass-loader)

## 例 {#examples}

### webpackローダーの設定 {#configuring-webpack-loaders}

組み込み以上のローダーサポートが必要な場合、多くのwebpackローダーはすでにTurbopackと連携しています。現在、いくつかの制限があります：

- webpackのローダーAPIの中心的なサブセットのみが実装されています。現在、一部の人気のあるローダーをサポートするためのカバレッジがありますが、今後APIサポートを拡張していきます。
- JavaScriptコードを返すローダーのみがサポートされています。スタイルシートや画像などのファイルを変換するローダーは現在サポートされていません。
- webpackローダーに渡されるオプションは、単純なJavaScriptプリミティブ、オブジェクト、および配列でなければなりません。たとえば、オプション値として `require()` プラグインモジュールを渡すことはできません。

ローダーを設定するには、インストールしたローダーの名前と `next.config.js` におけるオプションを追加し、ファイル拡張子をローダーのリストにマッピングします：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      rules: {
        '*.svg': {
          loaders: ['@svgr/webpack'],
          as: '*.js',
        },
      },
    },
  },
}
```

> **Good to know**: Next.js バージョン 13.4.4以前では、`turbo.rules`は`turbo.loaders`と呼ばれており、`.mdx`のようなファイル拡張子のみを受け入れていました。

### エイリアスの解決 {#resolving-aliases}

Turbopackは、エイリアスを介してモジュールの解決を変更するように設定できます。これはwebpackの[`resolve.alias`](https://webpack.js.org/configuration/resolve/#resolvealias)設定に似ています。

解決エイリアスを設定するには、`next.config.js`でインポートパターンを新しい宛先にマッピングします：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      resolveAlias: {
        underscore: 'lodash',
        mocha: { browser: 'mocha/browser-entry.js' },
      },
    },
  },
}
```

これにより、`underscore` パッケージのインポートが `lodash` パッケージにエイリアスされます。言い換えれば、`import underscore from 'underscore'` は `underscore` の代わりに `lodash` モジュールを読み込みます。

Turbopackはこのフィールドを介した条件付きのエイリアスもサポートしており、Node.jsの [条件付きエクスポート](https://nodejs.org/docs/latest-v18.x/api/packages.html#conditional-exports) に似ています。現在、`browser` の条件のみがサポートされています。上記の例では、Turbopackがブラウザ環境をターゲットとしている場合に `mocha` モジュールのインポートが `mocha/browser-entry.js` にエイリアスされます。

### カスタム拡張子を解決する {#resolving-custom-extensions}

Turbopackは、カスタム拡張子を持つモジュールを解決するように設定できます。これはwebpackの[`resolve.extensions`](https://webpack.js.org/configuration/resolve/#resolveextensions)設定に似ています。

解決拡張子を設定するには、`next.config.js`で`resolveExtensions`フィールドを使用します：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      resolveExtensions: [
        '.mdx',
        '.tsx',
        '.ts',
        '.jsx',
        '.js',
        '.mjs',
        '.json',
      ],
    },
  },
}
```

これにより、指定されたリストで元の解決拡張子が上書きされます。デフォルトの拡張子を含めることを確認してください。

アプリをwebpackからTurbopackへ移行する方法についての詳細情報とガイダンスは、[Turbopackのwebpack互換性に関するドキュメント](https://turbo.build/pack/docs/migrating-from-webpack)を参照してください。

### モジュールIDの割り当て {#assigning-module-ids}

Turbopackは現在、モジュールIDを割り当てるために2つの戦略をサポートしています：

- `'named'` は、モジュールのパスと機能に基づいた読みやすいモジュールIDを割り当てます。
- `'deterministic'` は、小さなハッシュ化された数値のモジュールIDを割り当て、ビルド間でほぼ一貫性があり、長期的なキャッシングに役立ちます。

設定しない場合、Turbopackは開発ビルドで`'named'`を、プロダクションビルドで`'deterministic'`を使用します。

モジュールIDの戦略を設定するには、`next.config.js`で`moduleIdStrategy`フィールドを使用します：

```js title="next.config.js"
module.exports = {
  experimental: {
    turbo: {
      moduleIdStrategy: 'deterministic',
    },
  },
}
```

## バージョン履歴 {#version-history}

| バージョン | 変更点                                 |
| ---------- | -------------------------------------- |
| `13.0.0`   | `experimental.turbo`が導入されました。 |
